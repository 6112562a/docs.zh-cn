---
title: 流式处理服务与重复字段-gRPC for WCF 开发人员
description: 将重复字段比较流式处理服务，作为通过使用 gRPC 传递数据集合的方式。
ms.date: 09/02/2019
ms.openlocfilehash: 0e717df57ba2bb52d63a063072d8a45bf0f7e395
ms.sourcegitcommit: f38e527623883b92010cf4760246203073e12898
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/20/2020
ms.locfileid: "77503371"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC 流式处理服务与重复字段

gRPC services 提供两种方法来返回数据集或对象的列表。 协议缓冲区消息规范使用 `repeated` 关键字来声明另一消息内的列表或消息的数组。 GRPC service 规范使用 `stream` 关键字声明长时间运行的永久性连接。 在该连接上，将发送多条消息，并可单独处理。 

你还可以使用 `stream` 功能来执行长时间运行的临时数据，如通知或日志消息。 但本章会将其用于返回单个数据集。

使用哪种方式取决于以下因素：

- 数据集的总体大小。
- 在客户端或服务器端创建数据集所用的时间。
- 数据集的使用者是否可以在第一项可用时立即开始处理它，或者需要完整的数据集来执行任何有用的操作。

## <a name="when-to-use-repeated-fields"></a>何时使用 `repeated` 字段

对于任何大小受限制并且可以在短时间内完全生成的数据集（例如，在一秒钟内），你应在常规 Protobuf 消息中使用 `repeated` 字段。 例如，在电子商务系统中，若要在订单内生成项列表，可能会很快，并且列表将不会太大。 使用 `repeated` 字段返回一条消息比使用 `stream` 更快，导致网络开销降低。

如果客户端在开始处理之前需要所有数据，并且数据集足够小，可以在内存中构造，则考虑使用 `repeated` 字段。 即使在服务器内存中创建数据集的速度较慢，也应考虑此情况。

## <a name="when-to-use-stream-methods"></a>何时使用 `stream` 方法

当数据集中的消息对象可能非常大时，最好是使用流式处理请求或响应传输这些对象。 在内存中构造大型对象、将其写入网络，然后释放资源更有效。 此方法可提高服务的可伸缩性。

同样，你应该在流上发送无限制大小的数据集，以避免在构造这些数据时内存不足。

对于使用者可单独处理每个项的数据集，如果它表示可以向用户指示进度，则应考虑使用流。 使用流可以提高应用程序的响应能力，但应将其与应用程序的总体性能进行平衡。

流可能很有用的另一种情况是跨多个服务对消息进行处理。 如果链中的每个服务都返回一个流，则终端服务（即该链中的最后一个服务）可以开始返回消息。 可以处理这些消息并将其传递回原始请求者。 请求者可以返回流，或将结果聚合到单个响应消息中。 此方法非常适合于 MapReduce 等模式。

>[!div class="step-by-step"]
>[上一页](migrate-duplex-services.md)
>[下一页](client-libraries.md)
