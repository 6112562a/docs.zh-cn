---
title: 关系与 NoSQL 数据
description: 了解云原生应用程序中的关系数据和 NoSQL 数据
author: robvet
ms.date: 01/22/2020
ms.openlocfilehash: 04693e30ba3848f1e51f1c69a75be5f18ead4cf1
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/12/2020
ms.locfileid: "79141414"
---
# <a name="relational-vs-nosql-data"></a><span data-ttu-id="38ce2-103">关系与 NoSQL 数据</span><span class="sxs-lookup"><span data-stu-id="38ce2-103">Relational vs. NoSQL data</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="38ce2-104">关系和 NoSQL 是两种类型的数据库系统，通常在云本机应用程序中实现。</span><span class="sxs-lookup"><span data-stu-id="38ce2-104">Relational and NoSQL are two types of database systems commonly implemented in cloud-native apps.</span></span> <span data-ttu-id="38ce2-105">它们构建方式不同，存储数据不同，访问方式也不同。</span><span class="sxs-lookup"><span data-stu-id="38ce2-105">They're built differently, store data differently, and accessed differently.</span></span> <span data-ttu-id="38ce2-106">在本节中，我们将介绍这两个。</span><span class="sxs-lookup"><span data-stu-id="38ce2-106">In this section, we'll look at both.</span></span> <span data-ttu-id="38ce2-107">在本章的后面部分，我们将介绍一种名为*NewSQL*的新兴数据库技术。</span><span class="sxs-lookup"><span data-stu-id="38ce2-107">Later in this chapter, we'll look at an emerging database technology called *NewSQL*.</span></span>

<span data-ttu-id="38ce2-108">*几十年来，关系数据库*一直是一种流行的技术。</span><span class="sxs-lookup"><span data-stu-id="38ce2-108">*Relational databases* have been a prevalent technology for decades.</span></span> <span data-ttu-id="38ce2-109">它们成熟、成熟且广泛实施。</span><span class="sxs-lookup"><span data-stu-id="38ce2-109">They're mature, proven, and widely implemented.</span></span> <span data-ttu-id="38ce2-110">竞争的数据库产品、工具和专业知识比比皆是。</span><span class="sxs-lookup"><span data-stu-id="38ce2-110">Competing database products, tooling, and expertise abound.</span></span> <span data-ttu-id="38ce2-111">关系数据库提供相关数据表的存储。</span><span class="sxs-lookup"><span data-stu-id="38ce2-111">Relational databases provide a store of related data tables.</span></span> <span data-ttu-id="38ce2-112">这些表具有固定的架构，使用 SQL（结构化查询语言）来管理数据，并支持 ACID 保证。</span><span class="sxs-lookup"><span data-stu-id="38ce2-112">These tables have a fixed schema, use SQL (Structured Query Language) to manage data, and support ACID guarantees.</span></span>

<span data-ttu-id="38ce2-113">*无 SQL 数据库*是指高性能、非关系数据存储。</span><span class="sxs-lookup"><span data-stu-id="38ce2-113">*No-SQL databases* refer to high-performance, non-relational data stores.</span></span> <span data-ttu-id="38ce2-114">他们在易用性、可扩展性、弹性和可用性特性方面表现卓越。</span><span class="sxs-lookup"><span data-stu-id="38ce2-114">They excel in their ease-of-use, scalability, resilience, and availability characteristics.</span></span> <span data-ttu-id="38ce2-115">NoSQL 不是联接规范化数据的表，而是存储非结构化或半结构化数据，通常存储在键值对或 JSON 文档中。</span><span class="sxs-lookup"><span data-stu-id="38ce2-115">Instead of joining tables of normalized data, NoSQL stores unstructured or semi-structured data, often in key-value pairs or JSON documents.</span></span> <span data-ttu-id="38ce2-116">无 SQL 数据库通常不提供超出单个数据库分区范围的 ACID 保证。</span><span class="sxs-lookup"><span data-stu-id="38ce2-116">No-SQL databases typically don't provide ACID guarantees beyond the scope of a single database partition.</span></span> <span data-ttu-id="38ce2-117">需要次秒响应时间的高容量服务有利于 NoSQL 数据存储。</span><span class="sxs-lookup"><span data-stu-id="38ce2-117">High volume services that require sub second response time favor NoSQL datastores.</span></span>

<span data-ttu-id="38ce2-118">[NoSQL](https://www.geeksforgeeks.org/introduction-to-nosql/)技术对分布式云本机系统的影响怎么强调也不为过。</span><span class="sxs-lookup"><span data-stu-id="38ce2-118">The impact of [NoSQL](https://www.geeksforgeeks.org/introduction-to-nosql/) technologies for distributed cloud-native systems can't be overstated.</span></span> <span data-ttu-id="38ce2-119">这一领域的新数据技术的激增打乱了曾经完全依赖关系数据库的解决方案。</span><span class="sxs-lookup"><span data-stu-id="38ce2-119">The proliferation of new data technologies in this space has disrupted solutions that once exclusively relied on relational databases.</span></span>

<span data-ttu-id="38ce2-120">NoSQL 数据库包括几个用于访问和管理数据的不同模型，每个模型都适合特定的用例。</span><span class="sxs-lookup"><span data-stu-id="38ce2-120">NoSQL databases include several different models for accessing and managing data, each suited to specific use cases.</span></span> <span data-ttu-id="38ce2-121">图 5-9 显示了四种常见模型。</span><span class="sxs-lookup"><span data-stu-id="38ce2-121">Figure 5-9 presents four common models.</span></span>

![无SQL数据模型](./media/types-of-nosql-datastores.png)

<span data-ttu-id="38ce2-123">**图 5-9**： NoSQL 数据库的数据模型</span><span class="sxs-lookup"><span data-stu-id="38ce2-123">**Figure 5-9**: Data models for NoSQL databases</span></span>

| <span data-ttu-id="38ce2-124">“模型”</span><span class="sxs-lookup"><span data-stu-id="38ce2-124">Model</span></span> | <span data-ttu-id="38ce2-125">特征</span><span class="sxs-lookup"><span data-stu-id="38ce2-125">Characteristics</span></span> |
| :-------- | :-------- |
| <span data-ttu-id="38ce2-126">文档存储</span><span class="sxs-lookup"><span data-stu-id="38ce2-126">Document Store</span></span> | <span data-ttu-id="38ce2-127">数据和元数据在数据库中基于 JSON 的文档中分层存储。</span><span class="sxs-lookup"><span data-stu-id="38ce2-127">Data and metadata are stored hierarchically in JSON-based documents inside the database.</span></span> |
| <span data-ttu-id="38ce2-128">关键价值存储</span><span class="sxs-lookup"><span data-stu-id="38ce2-128">Key Value Store</span></span> | <span data-ttu-id="38ce2-129">作为 NoSQL 数据库中最简单的数据，数据表示为键值对的集合。</span><span class="sxs-lookup"><span data-stu-id="38ce2-129">The simplest of the NoSQL databases, data is represented as a collection of key-value pairs.</span></span> |
| <span data-ttu-id="38ce2-130">宽柱商店</span><span class="sxs-lookup"><span data-stu-id="38ce2-130">Wide-Column Store</span></span> | <span data-ttu-id="38ce2-131">相关数据存储在单个列中的一组嵌套键/值对中。</span><span class="sxs-lookup"><span data-stu-id="38ce2-131">Related data is stored as a set of nested-key/value pairs within a single column.</span></span> |
| <span data-ttu-id="38ce2-132">图形存储</span><span class="sxs-lookup"><span data-stu-id="38ce2-132">Graph Store</span></span> | <span data-ttu-id="38ce2-133">数据存储在图形结构中作为节点、边和数据属性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-133">Data is stored in a graph structure as node, edge, and data properties.</span></span> |

## <a name="the-cap-theorem"></a><span data-ttu-id="38ce2-134">CAP 定理</span><span class="sxs-lookup"><span data-stu-id="38ce2-134">The CAP theorem</span></span>

<span data-ttu-id="38ce2-135">为了了解这些类型的数据库之间的差异，请考虑 CAP 定理，这是一组应用于存储状态的分布式系统的原则。</span><span class="sxs-lookup"><span data-stu-id="38ce2-135">As a way to understand the differences between these types of databases, consider the CAP theorem, a set of principles applied to distributed systems that store state.</span></span> <span data-ttu-id="38ce2-136">图 5-10 显示了 CAP 定理的三个属性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-136">Figure 5-10 shows the three properties of the CAP theorem.</span></span>

![The CAP Theorem（CAP 定理）](./media/cap-theorem.png)

<span data-ttu-id="38ce2-138">**图 5-10**.</span><span class="sxs-lookup"><span data-stu-id="38ce2-138">**Figure 5-10**.</span></span> <span data-ttu-id="38ce2-139">CAP 定理</span><span class="sxs-lookup"><span data-stu-id="38ce2-139">The CAP theorem</span></span>

<span data-ttu-id="38ce2-140">该定理指出，分布式数据系统将在一致性、可用性和分区容差之间进行权衡。</span><span class="sxs-lookup"><span data-stu-id="38ce2-140">The theorem states that distributed data systems will offer a trade-off between consistency, availability, and partition tolerance.</span></span> <span data-ttu-id="38ce2-141">而且，任何数据库只能保证三个属性中的*两*个：</span><span class="sxs-lookup"><span data-stu-id="38ce2-141">And, that any database can only guarantee *two* of the three properties:</span></span>

- <span data-ttu-id="38ce2-142">*一致性。*</span><span class="sxs-lookup"><span data-stu-id="38ce2-142">*Consistency.*</span></span> <span data-ttu-id="38ce2-143">群集中的每个节点都响应最新的数据，即使系统必须阻止请求，直到所有副本更新。</span><span class="sxs-lookup"><span data-stu-id="38ce2-143">Every node in the cluster responds with the most recent data, even if the system must block the request until all replicas update.</span></span> <span data-ttu-id="38ce2-144">如果查询当前正在更新的项目的"一致系统"，则将等待该响应，直到所有副本成功更新。</span><span class="sxs-lookup"><span data-stu-id="38ce2-144">If you query a "consistent system" for an item that is currently updating, you'll wait for that response until all replicas successfully update.</span></span> <span data-ttu-id="38ce2-145">但是，您将收到最新的数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-145">However, you'll receive the most current data.</span></span>

- <span data-ttu-id="38ce2-146">*可用 性。*</span><span class="sxs-lookup"><span data-stu-id="38ce2-146">*Availability.*</span></span> <span data-ttu-id="38ce2-147">每个节点都会返回即时响应，即使该响应不是最新的数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-147">Every node returns an immediate response, even if that response isn't the most recent data.</span></span> <span data-ttu-id="38ce2-148">如果查询正在更新的项目的"可用系统"，您将获得该服务此时可以提供的最佳答案。</span><span class="sxs-lookup"><span data-stu-id="38ce2-148">If you query an "available system" for an item that is updating, you'll get the best possible answer the service can provide at that moment.</span></span>

- <span data-ttu-id="38ce2-149">*分区容差。*</span><span class="sxs-lookup"><span data-stu-id="38ce2-149">*Partition Tolerance.*</span></span> <span data-ttu-id="38ce2-150">保证即使复制的数据节点发生故障或失去与其他复制数据节点的连接，系统也能继续运行。</span><span class="sxs-lookup"><span data-stu-id="38ce2-150">Guarantees the system continues to operate even if a replicated data node fails or loses connectivity with other replicated data nodes.</span></span>

<span data-ttu-id="38ce2-151">关系数据库通常提供一致性和可用性，但不提供分区容差。</span><span class="sxs-lookup"><span data-stu-id="38ce2-151">Relational databases typically provide consistency and availability, but not partition tolerance.</span></span> <span data-ttu-id="38ce2-152">它们通常预配到单个服务器，并通过向计算机添加更多资源来垂直扩展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-152">They're typically provisioned to a single server and scale vertically by adding more resources to the machine.</span></span>

<span data-ttu-id="38ce2-153">许多关系数据库系统都支持内置复制功能，其中主数据库的副本可以制作到其他辅助服务器实例。</span><span class="sxs-lookup"><span data-stu-id="38ce2-153">Many relational database systems support built-in replication features where copies of the primary database can be made to other secondary server instances.</span></span> <span data-ttu-id="38ce2-154">写入操作对主实例执行，并复制到每个辅助实例。</span><span class="sxs-lookup"><span data-stu-id="38ce2-154">Write operations are made to the primary instance and replicated to each of the secondaries.</span></span> <span data-ttu-id="38ce2-155">发生故障时，主实例可能会故障转移到辅助实例以提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-155">Upon a failure, the primary instance can fail over to a secondary to provide high availability.</span></span> <span data-ttu-id="38ce2-156">辅助数据库还可用于分发读取操作。</span><span class="sxs-lookup"><span data-stu-id="38ce2-156">Secondaries can also be used to distribute read operations.</span></span> <span data-ttu-id="38ce2-157">虽然写入操作始终针对主副本，但读取操作可以路由到任何辅助副本，以减少系统负载。</span><span class="sxs-lookup"><span data-stu-id="38ce2-157">While writes operations always go against the primary replica, read operations can be routed to any of the secondaries to reduce system load.</span></span>

<span data-ttu-id="38ce2-158">数据也可以跨多个节点水平分区，例如分[片](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-scale-introduction)。</span><span class="sxs-lookup"><span data-stu-id="38ce2-158">Data can also be horizontally partitioned across multiple nodes, such as with [sharding](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-scale-introduction).</span></span> <span data-ttu-id="38ce2-159">但是，分片化通过将数据吐出许多不易通信的片段，大大增加了操作开销。</span><span class="sxs-lookup"><span data-stu-id="38ce2-159">But, sharding dramatically increases operational overhead by spitting data across many pieces that cannot easily communicate.</span></span> <span data-ttu-id="38ce2-160">管理可能既昂贵又耗时。</span><span class="sxs-lookup"><span data-stu-id="38ce2-160">It can be costly and time consuming to manage.</span></span> <span data-ttu-id="38ce2-161">它最终可能会影响性能、表联接和参考完整性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-161">It can end up impacting performance, table joins, and referential integrity.</span></span>

<span data-ttu-id="38ce2-162">如果数据副本在"高度一致"的关系数据库群集中失去网络连接，您将无法写入数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-162">If data replicas were to lose network connectivity in a "highly consistent" relational database cluster, you wouldn't be able to write to the database.</span></span> <span data-ttu-id="38ce2-163">系统将拒绝写入操作，因为它无法将该更改复制到其他数据副本。</span><span class="sxs-lookup"><span data-stu-id="38ce2-163">The system would reject the write operation as it can't replicate that change to the other data replica.</span></span> <span data-ttu-id="38ce2-164">每个数据副本都必须在事务完成之前进行更新。</span><span class="sxs-lookup"><span data-stu-id="38ce2-164">Every data replica has to update before the transaction can complete.</span></span>

<span data-ttu-id="38ce2-165">NoSQL 数据库通常支持高可用性和分区容差。</span><span class="sxs-lookup"><span data-stu-id="38ce2-165">NoSQL databases typically support high availability and partition tolerance.</span></span> <span data-ttu-id="38ce2-166">它们横向扩展，通常跨商品服务器扩展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-166">They scale out horizontally, often across commodity servers.</span></span> <span data-ttu-id="38ce2-167">这种方法在地理区域内和跨地理区域之间提供巨大的可用性，成本降低。</span><span class="sxs-lookup"><span data-stu-id="38ce2-167">This approach provides tremendous availability, both within and across geographical regions at a reduced cost.</span></span> <span data-ttu-id="38ce2-168">跨这些计算机或节点对数据进行分区和复制，从而提供冗余和容错能力。</span><span class="sxs-lookup"><span data-stu-id="38ce2-168">You partition and replicate data across these machines, or nodes, providing redundancy and fault tolerance.</span></span> <span data-ttu-id="38ce2-169">缺点是一致性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-169">The downside is consistency.</span></span> <span data-ttu-id="38ce2-170">更改一个 NoSQL 节点上的数据可能需要一些时间才能传播到其他节点。</span><span class="sxs-lookup"><span data-stu-id="38ce2-170">A change to data on one NoSQL node can take some time to propagate to other nodes.</span></span> <span data-ttu-id="38ce2-171">通常，NoSQL 数据库节点会立即响应查询 - 即使显示的数据已过时且尚未更新。</span><span class="sxs-lookup"><span data-stu-id="38ce2-171">Typically, a NoSQL database node will provide an immediate response to a query - even if the data that is presented is stale and hasn't updated yet.</span></span>

<span data-ttu-id="38ce2-172">如果数据副本在"高度可用"的 NoSQL 数据库群集中失去连接，您仍然可以完成对数据库的写入操作。</span><span class="sxs-lookup"><span data-stu-id="38ce2-172">If data replicas were to lose connectivity in a "highly available" NoSQL database cluster, you could still complete a write operation to the database.</span></span> <span data-ttu-id="38ce2-173">数据库群集将允许写入操作，并在每个数据副本可用时更新它。</span><span class="sxs-lookup"><span data-stu-id="38ce2-173">The database cluster would allow the write operation and update each data replica as it becomes available.</span></span>

<span data-ttu-id="38ce2-174">这种结果称为最终一致性，这是不支持 ACID 事务的分布式数据系统的一个特征。</span><span class="sxs-lookup"><span data-stu-id="38ce2-174">This kind of result is known as eventual consistency, a characteristic of distributed data systems where ACID transactions aren't supported.</span></span> <span data-ttu-id="38ce2-175">在数据项的更新与将该更新传播到每个副本节点所需的时间之间，这是短暂的延迟。</span><span class="sxs-lookup"><span data-stu-id="38ce2-175">It's a brief delay between the update of a data item and time that it takes to propagate that update to each of the replica nodes.</span></span> <span data-ttu-id="38ce2-176">在正常情况下，滞后通常是短的，但当出现问题时可能会增加。</span><span class="sxs-lookup"><span data-stu-id="38ce2-176">Under normal conditions, the lag is typically short, but can increase when problems arise.</span></span> <span data-ttu-id="38ce2-177">例如，如果要更新美国 NoSQL 数据库中的产品项并从欧洲的副本节点查询同一数据项，会发生什么情况？</span><span class="sxs-lookup"><span data-stu-id="38ce2-177">For example, what would happen if you were to update a product item in a NoSQL database in the United States and query that same data item from a replica node in Europe?</span></span> <span data-ttu-id="38ce2-178">您将收到较早的产品信息，直到群集更新带有产品更改的欧洲节点。</span><span class="sxs-lookup"><span data-stu-id="38ce2-178">You would receive the earlier product information, until the cluster updates the European node with the product change.</span></span> <span data-ttu-id="38ce2-179">通过立即返回查询结果，而不是等待所有副本节点更新，您可以获得巨大的规模和卷，但可以呈现较旧的数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-179">By immediately returning a query result and not waiting for all replica nodes to update, you gain enormous scale and volume, but with the possibility of presenting older data.</span></span>

<span data-ttu-id="38ce2-180">高可用性和大规模可扩展性通常比强一致性对业务更关键。</span><span class="sxs-lookup"><span data-stu-id="38ce2-180">High availability and massive scalability are often more critical to the business than strong consistency.</span></span> <span data-ttu-id="38ce2-181">开发人员可以实施像 Sagas、CQRS 和异步消息传递这样的技术和模式，以拥抱最终的一致性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-181">Developers can implement techniques and patterns such as Sagas, CQRS, and asynchronous messaging to embrace eventual consistency.</span></span>

> <span data-ttu-id="38ce2-182">如今，在约束 CAP 定理约束时必须小心谨慎。</span><span class="sxs-lookup"><span data-stu-id="38ce2-182">Nowadays, care must be taken when conidering the CAP theorem constraints.</span></span> <span data-ttu-id="38ce2-183">一种称为NewSQL的新型数据库已经扩展了关系数据库引擎，以支持NoSQL系统的横向可扩展性和可扩展性能。</span><span class="sxs-lookup"><span data-stu-id="38ce2-183">A new type of database, called NewSQL, has emerged which extends the relational database engine to support both horizontal scalability and the scalable performance of NoSQL systems.</span></span>

## <a name="considerations-for-relational-vs-nosql-systems"></a><span data-ttu-id="38ce2-184">关系与 NoSQL 系统的注意事项</span><span class="sxs-lookup"><span data-stu-id="38ce2-184">Considerations for relational vs. NoSQL systems</span></span>

<span data-ttu-id="38ce2-185">根据特定数据要求，基于云的微服务可以实现关系、NoSQL 数据存储或两者。</span><span class="sxs-lookup"><span data-stu-id="38ce2-185">Based upon specific data requirements, a cloud-native-based microservice can implement a relational, NoSQL datastore or both.</span></span>

|  <span data-ttu-id="38ce2-186">在以下时间考虑 NoSQL 数据存储：</span><span class="sxs-lookup"><span data-stu-id="38ce2-186">Consider a NoSQL datastore when:</span></span> | <span data-ttu-id="38ce2-187">在以下时间考虑关系数据库：</span><span class="sxs-lookup"><span data-stu-id="38ce2-187">Consider a relational database when:</span></span> |
| :-------- | :-------- |
| <span data-ttu-id="38ce2-188">您拥有需要大规模的高容量工作负载</span><span class="sxs-lookup"><span data-stu-id="38ce2-188">You have high volume workloads that require large scale</span></span> | <span data-ttu-id="38ce2-189">您的工作负载量是一致的，需要大中型</span><span class="sxs-lookup"><span data-stu-id="38ce2-189">Your workload volume is consistent and requires medium to large scale</span></span> |
| <span data-ttu-id="38ce2-190">您的工作负载不需要 ACID 保证</span><span class="sxs-lookup"><span data-stu-id="38ce2-190">Your workloads don't require ACID guarantees</span></span> |  <span data-ttu-id="38ce2-191">需要 ACID 保证</span><span class="sxs-lookup"><span data-stu-id="38ce2-191">ACID guarantees are required</span></span> |
| <span data-ttu-id="38ce2-192">您的数据是动态的，并且经常更改</span><span class="sxs-lookup"><span data-stu-id="38ce2-192">Your data is dynamic and frequently changes</span></span> | <span data-ttu-id="38ce2-193">您的数据是可预测的，并且结构高度</span><span class="sxs-lookup"><span data-stu-id="38ce2-193">Your data is predictable and highly structured</span></span> |
| <span data-ttu-id="38ce2-194">数据可以在没有关系的情况下表达</span><span class="sxs-lookup"><span data-stu-id="38ce2-194">Data can be expressed without relationships</span></span> | <span data-ttu-id="38ce2-195">数据最好以关系表示</span><span class="sxs-lookup"><span data-stu-id="38ce2-195">Data is best expressed relationally</span></span> |  
| <span data-ttu-id="38ce2-196">您需要快速写入，写入安全性不重要</span><span class="sxs-lookup"><span data-stu-id="38ce2-196">You need fast writes and write safety isn't critical</span></span> | <span data-ttu-id="38ce2-197">写入安全是一项要求</span><span class="sxs-lookup"><span data-stu-id="38ce2-197">Write safety is a requirement</span></span> |  
| <span data-ttu-id="38ce2-198">数据检索简单，趋于平面</span><span class="sxs-lookup"><span data-stu-id="38ce2-198">Data retrieval is simple and tends to be flat</span></span> | <span data-ttu-id="38ce2-199">您处理复杂的查询和报表</span><span class="sxs-lookup"><span data-stu-id="38ce2-199">You work with complex queries and reports</span></span>|
| <span data-ttu-id="38ce2-200">您的数据需要广泛的地理分布</span><span class="sxs-lookup"><span data-stu-id="38ce2-200">Your data requires a wide geographic distribution</span></span> | <span data-ttu-id="38ce2-201">您的用户更集中</span><span class="sxs-lookup"><span data-stu-id="38ce2-201">Your users are more centralized</span></span> |
| <span data-ttu-id="38ce2-202">您的应用程序将部署到商用硬件，例如使用公共云</span><span class="sxs-lookup"><span data-stu-id="38ce2-202">Your application will be deployed to commodity hardware, such as with public clouds</span></span> | <span data-ttu-id="38ce2-203">您的应用程序将部署到大型高端硬件</span><span class="sxs-lookup"><span data-stu-id="38ce2-203">Your application will be deployed to large, high-end hardware</span></span> |
|||

<span data-ttu-id="38ce2-204">在下一节中，我们将探讨 Azure 云中可用于存储和管理云原生数据的选项。</span><span class="sxs-lookup"><span data-stu-id="38ce2-204">In the next sections, we'll explore the options available in the Azure cloud for storing and managing your cloud-native data.</span></span>

## <a name="database-as-a-service"></a><span data-ttu-id="38ce2-205">数据库即服务</span><span class="sxs-lookup"><span data-stu-id="38ce2-205">Database as a Service</span></span>

<span data-ttu-id="38ce2-206">首先，您可以预配 Azure 虚拟机，并为每个服务安装您选择的数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-206">To start, you could provision an Azure virtual machine and install your database of choice for each service.</span></span> <span data-ttu-id="38ce2-207">虽然您可以完全控制环境，但您会放弃云平台的许多内置功能。</span><span class="sxs-lookup"><span data-stu-id="38ce2-207">While you'd have full control over the environment, you'd forgo many built-in features of the cloud platform.</span></span> <span data-ttu-id="38ce2-208">您还将负责管理每个服务的虚拟机和数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-208">You'd also be responsible for managing the virtual machine and database for each service.</span></span> <span data-ttu-id="38ce2-209">这种方法可能很快变得耗时且成本高昂。</span><span class="sxs-lookup"><span data-stu-id="38ce2-209">This approach could quickly become time-consuming and expensive.</span></span>

<span data-ttu-id="38ce2-210">相反，云原生应用程序倾向于作为[数据库作为服务 （DBaaS）](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/)公开的数据服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-210">Instead, cloud-native applications favor data services exposed as a [Database as a Service (DBaaS)](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/).</span></span> <span data-ttu-id="38ce2-211">这些服务完全由云供应商管理，可提供内置的安全性、可扩展性和监视。</span><span class="sxs-lookup"><span data-stu-id="38ce2-211">Fully managed by a cloud vendor, these services provide built-in security, scalability, and monitoring.</span></span> <span data-ttu-id="38ce2-212">您只需将其用作[支持服务](./definition.md#backing-services)，而不是拥有该服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-212">Instead of owning the service, you simply consume it as a [backing service](./definition.md#backing-services).</span></span> <span data-ttu-id="38ce2-213">提供商大规模运营资源，并负责性能和维护。</span><span class="sxs-lookup"><span data-stu-id="38ce2-213">The provider operates the resource at scale and bears the responsibility for performance and maintenance.</span></span>

<span data-ttu-id="38ce2-214">它们可以跨云可用性区域和区域进行配置，以实现高可用性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-214">They can be configured across cloud availability zones and regions to achieve high availability.</span></span> <span data-ttu-id="38ce2-215">他们都支持准时的容量和即用即付模式。</span><span class="sxs-lookup"><span data-stu-id="38ce2-215">They all support just-in-time capacity and a pay-as-you-go model.</span></span> <span data-ttu-id="38ce2-216">Azure 具有不同类型的托管数据服务选项，每个选项都有特定的优势。</span><span class="sxs-lookup"><span data-stu-id="38ce2-216">Azure features different kinds of managed data service options, each with specific benefits.</span></span>

<span data-ttu-id="38ce2-217">我们首先将了解 Azure 中提供的关系 DBaaS 服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-217">We'll first look at relational DBaaS services available in Azure.</span></span> <span data-ttu-id="38ce2-218">您将看到 Microsoft 的旗舰 SQL Server 数据库以及几个开源选项都可用。</span><span class="sxs-lookup"><span data-stu-id="38ce2-218">You'll see that Microsoft's flagship SQL Server database is available along with several open-source options.</span></span> <span data-ttu-id="38ce2-219">然后，我们将讨论 Azure 中的 NoSQL 数据服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-219">Then, we'll talk about the NoSQL data services in Azure.</span></span>

## <a name="azure-relational-databases"></a><span data-ttu-id="38ce2-220">Azure 关系数据库</span><span class="sxs-lookup"><span data-stu-id="38ce2-220">Azure relational databases</span></span>

<span data-ttu-id="38ce2-221">对于需要关系数据的云原生微服务，Azure 提供四个托管关系数据库作为服务 （DBaaS） 产品，如图 5-11 所示。</span><span class="sxs-lookup"><span data-stu-id="38ce2-221">For cloud-native microservices that require relational data, Azure offers four managed relational databases as a service (DBaaS) offerings, shown in Figure 5-11.</span></span>

![Azure 中的托管关系数据库](./media/azure-managed-databases.png)

<span data-ttu-id="38ce2-223">**图5-11**.</span><span class="sxs-lookup"><span data-stu-id="38ce2-223">**Figure 5-11**.</span></span> <span data-ttu-id="38ce2-224">Azure 中提供的托管关系数据库</span><span class="sxs-lookup"><span data-stu-id="38ce2-224">Managed relational databases available in Azure</span></span>

<span data-ttu-id="38ce2-225">在上图中，请注意每个基础设施如何位于通用 DBaaS 基础结构上，该基础结构具有关键功能，无需额外费用。</span><span class="sxs-lookup"><span data-stu-id="38ce2-225">In the previous figure, note how each sits upon a common DBaaS infrastructure which features key capabilities at no additional cost.</span></span>

<span data-ttu-id="38ce2-226">这些功能对于提供大量数据库但管理这些数据库的资源有限的组织尤其重要。</span><span class="sxs-lookup"><span data-stu-id="38ce2-226">These features are especially important to organizations who provision large numbers of databases, but have limited resources to administer them.</span></span>
<span data-ttu-id="38ce2-227">通过选择处理核心、内存和基础存储的数量，可以在几分钟内预配 Azure 数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-227">You can provision an Azure database in minutes by selecting the amount of processing cores, memory, and underlying storage.</span></span> <span data-ttu-id="38ce2-228">您可以动态扩展数据库并动态调整资源，但停机时间很少或没有停机时间。</span><span class="sxs-lookup"><span data-stu-id="38ce2-228">You can scale the database on-the-fly and dynamically adjust resources with little to no downtime.</span></span>

## <a name="azure-sql-database"></a><span data-ttu-id="38ce2-229">Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="38ce2-229">Azure SQL Database</span></span>

<span data-ttu-id="38ce2-230">具有 Microsoft SQL Server 专业知识的开发团队应考虑[Azure SQL 数据库](https://docs.microsoft.com/azure/sql-database/)。</span><span class="sxs-lookup"><span data-stu-id="38ce2-230">Development teams with expertise in Microsoft SQL Server should consider [Azure SQL Database](https://docs.microsoft.com/azure/sql-database/).</span></span> <span data-ttu-id="38ce2-231">它是基于 Microsoft SQL Server 数据库引擎的完全托管关系数据库即服务 （DBaaS）。</span><span class="sxs-lookup"><span data-stu-id="38ce2-231">It's a fully managed relational database-as-a-service (DBaaS) based on the Microsoft SQL Server Database Engine.</span></span> <span data-ttu-id="38ce2-232">该服务共享 SQL Server 的本地版本中的许多功能，并运行 SQL Server 数据库引擎的最新稳定版本。</span><span class="sxs-lookup"><span data-stu-id="38ce2-232">The service shares many features found in the on-premises version of SQL Server and runs the latest stable version of the SQL Server Database Engine.</span></span>

<span data-ttu-id="38ce2-233">对于与云原生微服务一起使用，Azure SQL 数据库提供三个部署选项：</span><span class="sxs-lookup"><span data-stu-id="38ce2-233">For use with a cloud-native microservice, Azure SQL Database is available with three deployment options:</span></span>

- <span data-ttu-id="38ce2-234">单个数据库表示在 Azure 云中的 Azure [SQL 数据库服务器上](https://docs.microsoft.com/azure/sql-database/sql-database-servers)运行的完全托管 SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-234">A Single Database represents a fully managed SQL Database running on an [Azure SQL Database server](https://docs.microsoft.com/azure/sql-database/sql-database-servers) in the Azure cloud.</span></span> <span data-ttu-id="38ce2-235">数据库被视为[*包含*](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases)，因为它对基础数据库服务器上没有配置依赖项。</span><span class="sxs-lookup"><span data-stu-id="38ce2-235">The database is considered [*contained*](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases) as it has no configuration dependencies on the underlying database server.</span></span>
  
- <span data-ttu-id="38ce2-236">[托管实例](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance)是 Microsoft SQL Server 数据库引擎的完全托管实例，它提供与本地 SQL Server 的近 100% 兼容性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-236">A [Managed Instance](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance) is a fully managed instance of the Microsoft SQL Server Database Engine that provides near-100% compatibility with an on-premises SQL Server.</span></span> <span data-ttu-id="38ce2-237">此选项支持更大的数据库（最多 35 TB）并放置在[Azure 虚拟网络中](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview)以更好的隔离。</span><span class="sxs-lookup"><span data-stu-id="38ce2-237">This option supports larger databases, up to 35 TB and is placed in an [Azure Virtual Network](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) for better isolation.</span></span>

- <span data-ttu-id="38ce2-238">[Azure SQL 数据库无服务器](https://docs.microsoft.com/azure/sql-database/sql-database-serverless)是单个数据库的计算层，该数据库根据工作负载需求自动扩展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-238">[Azure SQL Database serverless](https://docs.microsoft.com/azure/sql-database/sql-database-serverless) is a compute tier for a single database that automatically scales based on workload demand.</span></span> <span data-ttu-id="38ce2-239">它只对每秒使用的计算量进行账单。</span><span class="sxs-lookup"><span data-stu-id="38ce2-239">It bills only for the amount of compute used per second.</span></span> <span data-ttu-id="38ce2-240">该服务非常适合间歇性、不可预知的使用模式的工作负载，这些工作负载穿插于不活动期。</span><span class="sxs-lookup"><span data-stu-id="38ce2-240">The service is well suited for workloads with intermittent, unpredictable usage patterns, interspersed with periods of inactivity.</span></span> <span data-ttu-id="38ce2-241">无服务器计算层还会在非活动期间自动暂停数据库，以便只收取存储费用。</span><span class="sxs-lookup"><span data-stu-id="38ce2-241">The serverless compute tier also automatically pauses databases during inactive periods so that only storage charges are billed.</span></span> <span data-ttu-id="38ce2-242">当活动返回时，它会自动恢复。</span><span class="sxs-lookup"><span data-stu-id="38ce2-242">It automatically resumes when activity returns.</span></span>

<span data-ttu-id="38ce2-243">除了传统的 Microsoft SQL Server 堆栈之外，Azure 还具有三个常用开源数据库的托管版本。</span><span class="sxs-lookup"><span data-stu-id="38ce2-243">Beyond the traditional Microsoft SQL Server stack, Azure also features managed versions of three popular open-source databases.</span></span>

## <a name="open-source-databases-in-azure"></a><span data-ttu-id="38ce2-244">Azure 中的开源数据库</span><span class="sxs-lookup"><span data-stu-id="38ce2-244">Open-source databases in Azure</span></span>

<span data-ttu-id="38ce2-245">开源关系数据库已成为云原生应用程序的热门选择。</span><span class="sxs-lookup"><span data-stu-id="38ce2-245">Open-source relational databases have become a popular choice for cloud-native applications.</span></span> <span data-ttu-id="38ce2-246">许多企业比商业数据库产品更青睐它们，尤其是为了节省成本。</span><span class="sxs-lookup"><span data-stu-id="38ce2-246">Many enterprises favor them over commercial database products, especially for cost savings.</span></span> <span data-ttu-id="38ce2-247">许多开发团队都享有灵活性、社区支持的开发以及工具和扩展的生态系统。</span><span class="sxs-lookup"><span data-stu-id="38ce2-247">Many development teams enjoy their flexibility, community-backed development, and ecosystem of tools and extensions.</span></span> <span data-ttu-id="38ce2-248">开源数据库可以跨多个云提供商部署，有助于最大限度地减少"供应商锁定"的问题。</span><span class="sxs-lookup"><span data-stu-id="38ce2-248">Open-source databases can be deployed across multiple cloud providers, helping minimize the concern of "vendor lock-in."</span></span>

<span data-ttu-id="38ce2-249">开发人员可以轻松地在 Azure VM 上自承载任何开源数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-249">Developers can easily self-host any open-source database on an Azure VM.</span></span> <span data-ttu-id="38ce2-250">在提供完全控制的同时，此方法使您能够对数据库和 VM 的管理、监视和维护。</span><span class="sxs-lookup"><span data-stu-id="38ce2-250">While providing full control, this approach puts you on the hook for the management, monitoring, and maintenance of the database and VM.</span></span>

<span data-ttu-id="38ce2-251">但是，Microsoft 继续致力于将 Azure 作为*完全托管*的 DBaaS 服务提供几个流行的开源数据库，从而保持 Azure 的"开放平台"。</span><span class="sxs-lookup"><span data-stu-id="38ce2-251">However, Microsoft continues its commitment to keeping Azure an “open platform” by offering several popular open-source databases as *fully managed* DBaaS services.</span></span>

### <a name="azure-database-for-mysql"></a><span data-ttu-id="38ce2-252">Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="38ce2-252">Azure Database for MySQL</span></span>

<span data-ttu-id="38ce2-253">[MySQL](https://en.wikipedia.org/wiki/MySQL) 是一个开源关系数据库，是[建立在LAMP软件堆栈](https://en.wikipedia.org/wiki/LAMP_(software_bundle))上的应用程序的支柱。</span><span class="sxs-lookup"><span data-stu-id="38ce2-253">[MySQL](https://en.wikipedia.org/wiki/MySQL) is an open-source relational database and a pillar for applications built on the [LAMP software stack](https://en.wikipedia.org/wiki/LAMP_(software_bundle)).</span></span> <span data-ttu-id="38ce2-254">广泛选择*阅读繁重的*工作量，它被许多大型组织使用，包括Facebook，Twitter和YouTube。</span><span class="sxs-lookup"><span data-stu-id="38ce2-254">Widely chosen for *read heavy* workloads, it's used by many large organizations, including Facebook, Twitter, and YouTube.</span></span> <span data-ttu-id="38ce2-255">社区版免费提供，而企业版需要购买许可证。</span><span class="sxs-lookup"><span data-stu-id="38ce2-255">The community edition is available for free, while the enterprise edition requires a license purchase.</span></span> <span data-ttu-id="38ce2-256">该产品最初创建于1995年，于2008年被Sun微系统公司购买。</span><span class="sxs-lookup"><span data-stu-id="38ce2-256">Originally created in 1995, the product was purchased by Sun Microsystems in 2008.</span></span> <span data-ttu-id="38ce2-257">甲骨文于2010年收购了Sun和MySQL。</span><span class="sxs-lookup"><span data-stu-id="38ce2-257">Oracle acquired Sun and MySQL in 2010.</span></span>

<span data-ttu-id="38ce2-258">[MySQL 的 Azure 数据库](https://azure.microsoft.com/services/mysql/)是基于开源 MySQL Server 引擎的托管关系数据库服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-258">[Azure Database for MySQL](https://azure.microsoft.com/services/mysql/) is a managed relational database service based on the open-source MySQL Server engine.</span></span> <span data-ttu-id="38ce2-259">它使用 MySQL 社区版本。</span><span class="sxs-lookup"><span data-stu-id="38ce2-259">It uses the MySQL Community edition.</span></span> <span data-ttu-id="38ce2-260">Azure MySQL 服务器是服务的管理点。</span><span class="sxs-lookup"><span data-stu-id="38ce2-260">The Azure MySQL server is the administrative point for the service.</span></span> <span data-ttu-id="38ce2-261">它与用于本地部署的 MySQL 服务器引擎相同。</span><span class="sxs-lookup"><span data-stu-id="38ce2-261">It's the same MySQL server engine used for on-premises deployments.</span></span> <span data-ttu-id="38ce2-262">引擎可以创建每个服务器的单个数据库，也可以创建每个共享资源的服务器的多个数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-262">The engine can create a single database per server or multiple databases per server that share resources.</span></span> <span data-ttu-id="38ce2-263">您可以继续使用相同的开源工具管理数据，而无需学习新技能或管理虚拟机。</span><span class="sxs-lookup"><span data-stu-id="38ce2-263">You can continue to manage data using the same open-source tools without having to learn new skills or manage virtual machines.</span></span>

### <a name="azure-database-for-mariadb"></a><span data-ttu-id="38ce2-264">Azure Database for MariaDB</span><span class="sxs-lookup"><span data-stu-id="38ce2-264">Azure Database for MariaDB</span></span>

<span data-ttu-id="38ce2-265">[玛丽亚DB](https://mariadb.com/)服务器是另一个流行的开源数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="38ce2-265">[MariaDB](https://mariadb.com/) Server is another popular open-source database server.</span></span> <span data-ttu-id="38ce2-266">当甲骨文收购拥有MySQL的太阳微系统公司时，它被创建为MySQL的*分叉*。</span><span class="sxs-lookup"><span data-stu-id="38ce2-266">It was created as a *fork* of MySQL when Oracle purchased Sun Microsystems, who owned MySQL.</span></span> <span data-ttu-id="38ce2-267">目的是确保MariaDB保持开放源码。</span><span class="sxs-lookup"><span data-stu-id="38ce2-267">The intent was to ensure that MariaDB remained open-source.</span></span> <span data-ttu-id="38ce2-268">由于 MariaDB 是 MySQL 的分叉，因此数据和表定义是兼容的，并且客户端协议、结构和 API 是紧密相连的。</span><span class="sxs-lookup"><span data-stu-id="38ce2-268">As MariaDB is a fork of MySQL, the data and table definitions are compatible, and the client protocols, structures, and APIs, are close-knit.</span></span>

<span data-ttu-id="38ce2-269">MariaDB 拥有强大的社区，被许多大型企业所使用。</span><span class="sxs-lookup"><span data-stu-id="38ce2-269">MariaDB has a strong community and is used by many large enterprises.</span></span> <span data-ttu-id="38ce2-270">当 Oracle 继续维护、增强和支持 MySQL 时，MariaDB 基金会管理 MariaDB，允许对产品和文档进行公共贡献。</span><span class="sxs-lookup"><span data-stu-id="38ce2-270">While Oracle continues to maintain, enhance, and support MySQL, the MariaDB foundation manages MariaDB, allowing public contributions to the product and documentation.</span></span>

<span data-ttu-id="38ce2-271">[MariaDB 的 Azure 数据库](https://azure.microsoft.com/services/mariadb/)是 Azure 云中完全托管的关系数据库，即服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-271">[Azure Database for MariaDB](https://azure.microsoft.com/services/mariadb/) is a fully managed relational database as a service in the Azure cloud.</span></span> <span data-ttu-id="38ce2-272">该服务基于 MariaDB 社区版服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="38ce2-272">The service is based on the MariaDB community edition server engine.</span></span> <span data-ttu-id="38ce2-273">它能够处理任务关键型工作负载，具有可预测的性能和动态可扩展性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-273">It can handle mission-critical workloads with predictable performance and dynamic scalability.</span></span>

### <a name="azure-database-for-postgresql"></a><span data-ttu-id="38ce2-274">Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="38ce2-274">Azure Database for PostgreSQL</span></span>

<span data-ttu-id="38ce2-275">[PostgreSQL](https://www.postgresql.org/)是一个开源关系数据库，拥有超过 30 年的积极发展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-275">[PostgreSQL](https://www.postgresql.org/) is an open-source relational database with over 30 years of active development.</span></span> <span data-ttu-id="38ce2-276">PostgresSQL 在可靠性和数据完整性方面享有盛誉。</span><span class="sxs-lookup"><span data-stu-id="38ce2-276">PostgresSQL has a strong reputation for reliability and data integrity.</span></span> <span data-ttu-id="38ce2-277">它功能丰富、SQL 兼容，并且被认为比 MySQL 更具性能- 尤其对于具有复杂查询和大量写入的工作负载。</span><span class="sxs-lookup"><span data-stu-id="38ce2-277">It’s feature rich, SQL compliant, and considered more performant than MySQL - especially for workloads with complex queries and heavy writes.</span></span> <span data-ttu-id="38ce2-278">许多大型企业，包括苹果，红帽和富士通已经建立了产品使用PostgreSQL。</span><span class="sxs-lookup"><span data-stu-id="38ce2-278">Many large enterprises including Apple, Red Hat, and Fujitsu have built products using PostgreSQL.</span></span>

<span data-ttu-id="38ce2-279">[基于开源 Postgres 数据库引擎的 PostgreSQL Azure 数据库](https://azure.microsoft.com/services/postgresql/)是一个完全托管的关系数据库服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-279">[Azure Database for PostgreSQL](https://azure.microsoft.com/services/postgresql/) is a fully managed relational database service, based on the open-source Postgres database engine.</span></span> <span data-ttu-id="38ce2-280">该服务支持许多开发平台，包括C++、Java、Python、Node、C\#和 PHP。</span><span class="sxs-lookup"><span data-stu-id="38ce2-280">The service supports many development platforms, including C++, Java, Python, Node, C\#, and PHP.</span></span> <span data-ttu-id="38ce2-281">您可以使用[命令行接口](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1)工具或 Azure 数据迁移服务将 PostgreSQL 数据库迁移到该数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-281">You can migrate PostgreSQL databases to it using the [command-line interface](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1) tool or Azure Data Migration Service.</span></span>

<span data-ttu-id="38ce2-282">用于 PostgreSQL 的 Azure 数据库提供两个部署选项：</span><span class="sxs-lookup"><span data-stu-id="38ce2-282">Azure Database for PostgreSQL is available with two deployment options:</span></span>

- <span data-ttu-id="38ce2-283">[单服务器](https://docs.microsoft.com/azure/postgresql/concepts-servers)部署选项是多个数据库的中心管理点，您可以向其部署多个数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-283">The [Single Server](https://docs.microsoft.com/azure/postgresql/concepts-servers) deployment option is a central administrative point for multiple databases to which you can deploy many databases.</span></span> <span data-ttu-id="38ce2-284">定价基于内核和存储，按服务器进行结构化。</span><span class="sxs-lookup"><span data-stu-id="38ce2-284">The pricing is structured per-server based upon cores and storage.</span></span>

- <span data-ttu-id="38ce2-285">[超大规模 （Citus） 选项](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/)由 Citus 数据技术提供支持。</span><span class="sxs-lookup"><span data-stu-id="38ce2-285">The [Hyperscale (Citus) option](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/) is powered by Citus Data technology.</span></span> <span data-ttu-id="38ce2-286">通过跨数百个节点*水平扩展*单个数据库，实现高性能，从而提供快速性能和扩展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-286">It enables high performance by *horizontally scaling* a single database across hundreds of nodes to deliver fast performance and scale.</span></span> <span data-ttu-id="38ce2-287">此选项允许引擎在内存中容纳更多数据，跨数百个节点并行化查询，并更快地索引数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-287">This option allows the engine to fit more data in memory, parallelize queries across hundreds of nodes, and index data faster.</span></span>

## <a name="nosql-data-in-azure"></a><span data-ttu-id="38ce2-288">Azure 中的无 SQL 数据</span><span class="sxs-lookup"><span data-stu-id="38ce2-288">NoSQL data in Azure</span></span>

<span data-ttu-id="38ce2-289">Cosmos DB 是 Azure 云中完全托管的全局分布的 NoSQL 数据库服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-289">Cosmos DB is a fully managed, globally distributed NoSQL database service in the Azure cloud.</span></span> <span data-ttu-id="38ce2-290">它已被世界各地的许多大公司采用，包括可口可乐、Skype、埃克森美孚和自由互助。</span><span class="sxs-lookup"><span data-stu-id="38ce2-290">It has been adopted by many large companies across the world,  including Coca-Cola, Skype, ExxonMobil, and Liberty Mutual.</span></span>

<span data-ttu-id="38ce2-291">如果您的服务需要来自世界任何地方的快速响应、高可用性或弹性可扩展性，Cosmos DB 是一个很好的选择。</span><span class="sxs-lookup"><span data-stu-id="38ce2-291">If your services require fast response from anywhere in the world, high availability, or elastic scalability, Cosmos DB is a great choice.</span></span> <span data-ttu-id="38ce2-292">图 5-12 显示了宇宙 DB。</span><span class="sxs-lookup"><span data-stu-id="38ce2-292">Figure 5-12 shows Cosmos DB.</span></span>

![宇宙 DB 概述](./media/cosmos-db-overview.png)

<span data-ttu-id="38ce2-294">**图5-12**：宇宙DB概述</span><span class="sxs-lookup"><span data-stu-id="38ce2-294">**Figure 5-12**: Overview of Cosmos DB</span></span>

<span data-ttu-id="38ce2-295">上图显示了 Cosmos DB 中可用的许多内置云原生功能。</span><span class="sxs-lookup"><span data-stu-id="38ce2-295">The previous figure presents many of the built-in cloud-native capabilities available in Cosmos DB.</span></span> <span data-ttu-id="38ce2-296">在本节中，我们将仔细研究它们。</span><span class="sxs-lookup"><span data-stu-id="38ce2-296">In this section, we’ll take a closer look at them.</span></span>

### <a name="global-support"></a><span data-ttu-id="38ce2-297">全球支持</span><span class="sxs-lookup"><span data-stu-id="38ce2-297">Global support</span></span>

<span data-ttu-id="38ce2-298">云原生应用程序通常具有全球受众，需要全球扩展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-298">Cloud-native applications often have a global audience and require global scale.</span></span>

<span data-ttu-id="38ce2-299">您可以跨地区或在世界各地分发 Cosmos 数据库，将数据放在用户附近，缩短响应时间并减少延迟。</span><span class="sxs-lookup"><span data-stu-id="38ce2-299">You can distribute Cosmos databases across regions or around the world, placing data close to your users, improving response time, and reducing latency.</span></span> <span data-ttu-id="38ce2-300">您可以在不暂停或重新部署服务的情况下从区域添加或删除数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-300">You can add or remove a database from a region without pausing or redeploying your services.</span></span> <span data-ttu-id="38ce2-301">在后台，Cosmos DB 透明地将数据复制到每个配置的区域。</span><span class="sxs-lookup"><span data-stu-id="38ce2-301">In the background, Cosmos DB transparently replicates the data to each of the configured regions.</span></span>

<span data-ttu-id="38ce2-302">Cosmos DB 支持全局级别的[活动/主动](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/)群集，使您能够配置任何数据库区域以支持*写入和读取*。</span><span class="sxs-lookup"><span data-stu-id="38ce2-302">Cosmos DB supports [active/active](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/) clustering at the global level, enabling you to configure any of your database regions to support *both writes and reads*.</span></span>

<span data-ttu-id="38ce2-303">[多主协议](https://docs.microsoft.com/azure/cosmos-db/multi-master-benefits)是 Cosmos DB 中的一个重要功能，可实现以下功能：</span><span class="sxs-lookup"><span data-stu-id="38ce2-303">The [Multi-Master](https://docs.microsoft.com/azure/cosmos-db/multi-master-benefits) protocol is an important feature in Cosmos DB that enables the following functionality:</span></span>

- <span data-ttu-id="38ce2-304">无限弹性写入和读取可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-304">Unlimited elastic write and read scalability.</span></span>

- <span data-ttu-id="38ce2-305">在全球 99.999% 的读写可用性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-305">99.999% read and write availability all around the world.</span></span>

- <span data-ttu-id="38ce2-306">在 99% 的时间内，在 10 毫秒内为读写提供服务。</span><span class="sxs-lookup"><span data-stu-id="38ce2-306">Guaranteed reads and writes served in less than 10 milliseconds at the 99th percentile.</span></span>

<span data-ttu-id="38ce2-307">使用 Cosmos DB[多宿主 API，](https://docs.microsoft.com/azure/cosmos-db/distribute-data-globally)微服务会自动知道最近的 Azure 区域并向其发送请求。</span><span class="sxs-lookup"><span data-stu-id="38ce2-307">With the Cosmos DB [Multi-Homing APIs](https://docs.microsoft.com/azure/cosmos-db/distribute-data-globally), your microservice is automatically aware of the nearest Azure region and sends requests to it.</span></span> <span data-ttu-id="38ce2-308">最近的区域由 Cosmos DB 标识，无需进行任何配置更改。</span><span class="sxs-lookup"><span data-stu-id="38ce2-308">The nearest region is identified by Cosmos DB without any configuration changes.</span></span> <span data-ttu-id="38ce2-309">如果区域不可用，多宿主功能将自动将请求路由到下一个最近的可用区域。</span><span class="sxs-lookup"><span data-stu-id="38ce2-309">Should a region become unavailable, the Multi-Homing feature will automatically route requests to the next nearest available region.</span></span>

### <a name="multi-model-support"></a><span data-ttu-id="38ce2-310">多型号支持</span><span class="sxs-lookup"><span data-stu-id="38ce2-310">Multi-model support</span></span>

<span data-ttu-id="38ce2-311">将单片应用程序重新编程到云原生体系结构时，开发团队有时必须迁移开源 NoSQL 数据存储。</span><span class="sxs-lookup"><span data-stu-id="38ce2-311">When replatforming monolithic applications to a cloud-native architecture, development teams sometimes have to migrate open-source, NoSQL data stores.</span></span> <span data-ttu-id="38ce2-312">Cosmos DB 可帮助您通过其*多模型*数据平台在这些 NoSQL 数据存储中保留投资。</span><span class="sxs-lookup"><span data-stu-id="38ce2-312">Cosmos DB can help you preserve your investment in these NoSQL datastores with its *multi-model* data platform.</span></span> <span data-ttu-id="38ce2-313">图 5-13 显示了支持的 NoSQL[兼容性 API](https://www.wikiwand.com/en/Cosmos_DB)。</span><span class="sxs-lookup"><span data-stu-id="38ce2-313">Figure 5-13 shows the supported NoSQL [compatibility APIs](https://www.wikiwand.com/en/Cosmos_DB).</span></span>

![宇宙数据库提供程序](./media/cosmos-db-providers.png)

<span data-ttu-id="38ce2-315">**图 5-13**： 宇宙数据库提供程序</span><span class="sxs-lookup"><span data-stu-id="38ce2-315">**Figure 5-13**: Cosmos DB providers</span></span>

<span data-ttu-id="38ce2-316">开发团队可以将现有的蒙戈、格雷姆林或卡桑德拉数据库迁移到 Cosmos DB，只需对数据或代码进行最少的更改。</span><span class="sxs-lookup"><span data-stu-id="38ce2-316">Development teams can migrate existing Mongo, Gremlin, or Cassandra databases into Cosmos DB with minimal changes to data or code.</span></span> <span data-ttu-id="38ce2-317">对于新应用，开发团队可以选择开源选项或内置 SQL API 模型。</span><span class="sxs-lookup"><span data-stu-id="38ce2-317">For new apps, development teams can choose among open-source options or the built-in SQL API model.</span></span>

> <span data-ttu-id="38ce2-318">在内部，Cosmos 以由原始数据类型组成的简单结构格式存储数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-318">Internally, Cosmos stores the data in a simple struct format made up of primitive data types.</span></span> <span data-ttu-id="38ce2-319">对于每个请求，数据库引擎都会将原始数据转换为您选择的模型表示形式。</span><span class="sxs-lookup"><span data-stu-id="38ce2-319">For each request, the database engine translates the primitive data into the model representation you've selected.</span></span>

<span data-ttu-id="38ce2-320">在上图 5-13 中，请注意[表 API](https://docs.microsoft.com/azure/cosmos-db/table-introduction)选项。</span><span class="sxs-lookup"><span data-stu-id="38ce2-320">In the previous figure, 5-13, note the [Table API](https://docs.microsoft.com/azure/cosmos-db/table-introduction) option.</span></span> <span data-ttu-id="38ce2-321">此 API 是 Azure 表存储的演变。</span><span class="sxs-lookup"><span data-stu-id="38ce2-321">This API is an evolution of Azure Table Storage.</span></span> <span data-ttu-id="38ce2-322">两者共享相同的基础表模型，但 Cosmos DB 表 API 添加了 Azure 存储 API 中不可用的高级增强功能。</span><span class="sxs-lookup"><span data-stu-id="38ce2-322">Both share the same underlying table model, but the Cosmos DB Table API adds premium enhancements not available in the Azure Storage API.</span></span> <span data-ttu-id="38ce2-323">这些功能在图 5-4 中进行了对比。</span><span class="sxs-lookup"><span data-stu-id="38ce2-323">These features are contrasted in Figure 5-4.</span></span>

![Azure 表 API](media/azure-table-api.png)

<span data-ttu-id="38ce2-325">**图 5-14**： Azure 表 API 提供程序</span><span class="sxs-lookup"><span data-stu-id="38ce2-325">**Figure 5-14**: Azure Table API Providers</span></span>

<span data-ttu-id="38ce2-326">使用 Azure 表存储的微服务可以轻松地迁移到 Cosmos DB 表 API。</span><span class="sxs-lookup"><span data-stu-id="38ce2-326">Microservices that consume Azure Table storage can easily migrate to the Cosmos DB Table API.</span></span> <span data-ttu-id="38ce2-327">不需更改代码。</span><span class="sxs-lookup"><span data-stu-id="38ce2-327">No code changes are required.</span></span>

### <a name="tunable-consistency"></a><span data-ttu-id="38ce2-328">可调一致性</span><span class="sxs-lookup"><span data-stu-id="38ce2-328">Tunable consistency</span></span>

<span data-ttu-id="38ce2-329">在 *"关系与NoSQL"* 部分的早些时候，我们讨论了*数据一致性*的主题。</span><span class="sxs-lookup"><span data-stu-id="38ce2-329">Earlier in the *Relational vs. NoSQL* section, we discussed the subject of *data consistency*.</span></span> <span data-ttu-id="38ce2-330">数据一致性是指数据*的完整性*。</span><span class="sxs-lookup"><span data-stu-id="38ce2-330">Data consistency refers to the *integrity* of your data.</span></span> <span data-ttu-id="38ce2-331">具有分布式数据的云原生服务依赖于复制，必须在读取一致性、可用性和延迟之间做出根本性的权衡。</span><span class="sxs-lookup"><span data-stu-id="38ce2-331">Cloud-native services with distributed data rely on replication and must make a fundamental tradeoff between read consistency, availability, and latency.</span></span>

<span data-ttu-id="38ce2-332">大多数分布式数据库允许开发人员在两种一致性模型之间进行选择：强一致性和最终一致性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-332">Most distributed databases allow developers to choose between two consistency models: strong consistency and eventual consistency.</span></span> <span data-ttu-id="38ce2-333">*强一致性*是数据可编程性的黄金标准。</span><span class="sxs-lookup"><span data-stu-id="38ce2-333">*Strong consistency* is the gold standard of data programmability.</span></span> <span data-ttu-id="38ce2-334">它保证查询将始终返回最新的数据 - 即使系统必须产生延迟等待更新在所有数据库副本之间复制。</span><span class="sxs-lookup"><span data-stu-id="38ce2-334">It guarantees that a query will always return the most current data - even if the system must incur latency waiting for an update to replicate across all database copies.</span></span> <span data-ttu-id="38ce2-335">虽然为*最终一致性*配置的数据库将立即返回数据，即使该数据不是最新的副本。</span><span class="sxs-lookup"><span data-stu-id="38ce2-335">While a database configured for *eventual consistency* will return data immediately, even if that data isn't the most current copy.</span></span> <span data-ttu-id="38ce2-336">后一个选项可实现更高的可用性、更大的规模和更高的性能。</span><span class="sxs-lookup"><span data-stu-id="38ce2-336">The latter option enables higher availability, greater scale, and increased performance.</span></span>

<span data-ttu-id="38ce2-337">Azure Cosmos DB 提供了图 5-15 所示的五个定义良好的[一致性模型](https://docs.microsoft.com/azure/cosmos-db/consistency-levels)。</span><span class="sxs-lookup"><span data-stu-id="38ce2-337">Azure Cosmos DB offers five well-defined [consistency models](https://docs.microsoft.com/azure/cosmos-db/consistency-levels) shown in Figure 5-15.</span></span>

![宇宙 DB 一致性图](./media/cosmos-consistency-level-graph.png)

<span data-ttu-id="38ce2-339">**图 5-15**： 宇宙 DB 一致性级别</span><span class="sxs-lookup"><span data-stu-id="38ce2-339">**Figure 5-15**: Cosmos DB Consistency Levels</span></span>

 <span data-ttu-id="38ce2-340">这些选项使您能够对数据的一致性、可用性和性能做出精确的选择和精细权衡。</span><span class="sxs-lookup"><span data-stu-id="38ce2-340">These options enable you to make precise choices and granular tradeoffs for consistency, availability, and the performance for your data.</span></span> <span data-ttu-id="38ce2-341">图 5-16 描述了每个级别。</span><span class="sxs-lookup"><span data-stu-id="38ce2-341">Figure 5-16 describes each level.</span></span>

![宇宙数据库一致性级别](./media/cosmos-db-consistency-levels.png)

<span data-ttu-id="38ce2-343">**图 5-16**： 宇宙 DB 一致性级别描述</span><span class="sxs-lookup"><span data-stu-id="38ce2-343">**Figure 5-16**: Cosmos DB Consistency Level Description</span></span>

<span data-ttu-id="38ce2-344">在["9球背后：宇宙DB一致性水平解释"](https://blog.jeremylikness.com/blog/2018-03-23_getting-behind-the-9ball-cosmosdb-consistency-levels/)一文中，微软云开发者倡导者Jeremy Likeness对五种模型给出了极好的解释。</span><span class="sxs-lookup"><span data-stu-id="38ce2-344">In the article [Getting Behind the 9-Ball: Cosmos DB Consistency Levels Explained](https://blog.jeremylikness.com/blog/2018-03-23_getting-behind-the-9ball-cosmosdb-consistency-levels/), Microsoft Cloud Developer Advocate Jeremy Likeness provides an excellent explanation of the five models.</span></span>

### <a name="partitioning"></a><span data-ttu-id="38ce2-345">分区</span><span class="sxs-lookup"><span data-stu-id="38ce2-345">Partitioning</span></span>

<span data-ttu-id="38ce2-346">Azure Cosmos DB 采用自动[分区](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview)来扩展数据库以满足云原生服务的性能需求。</span><span class="sxs-lookup"><span data-stu-id="38ce2-346">Azure Cosmos DB embraces automatic [partitioning](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview) to scale a database to meet the performance needs of your cloud-native services.</span></span>

<span data-ttu-id="38ce2-347">通过创建数据库、容器和项来管理 Cosmos DB 数据中的数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-347">You manage data in Cosmos DB data by creating databases, containers, and items.</span></span>

<span data-ttu-id="38ce2-348">容器位于 Cosmos DB 数据库中，表示与架构无关的项目分组。</span><span class="sxs-lookup"><span data-stu-id="38ce2-348">Containers live in a Cosmos DB database and represent a schema-agnostic grouping of items.</span></span> <span data-ttu-id="38ce2-349">项是添加到容器中的数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-349">Items are the data that you add to the container.</span></span> <span data-ttu-id="38ce2-350">它们表示为文档、行、节点或边。</span><span class="sxs-lookup"><span data-stu-id="38ce2-350">They're represented as documents, rows, nodes, or edges.</span></span> <span data-ttu-id="38ce2-351">添加到容器的所有项目都将自动编制索引。</span><span class="sxs-lookup"><span data-stu-id="38ce2-351">All items added to a container are automatically indexed.</span></span>

<span data-ttu-id="38ce2-352">要对容器进行分区，项被划分为称为逻辑分区的不同子集。</span><span class="sxs-lookup"><span data-stu-id="38ce2-352">To partition the container, items are divided into distinct subsets called logical partitions.</span></span> <span data-ttu-id="38ce2-353">逻辑分区是根据与容器中的每个项关联的分区键的值填充的。</span><span class="sxs-lookup"><span data-stu-id="38ce2-353">Logical partitions are populated based on the value of a partition key that is associated with each item in a container.</span></span> <span data-ttu-id="38ce2-354">图 5-18 显示了两个容器，每个容器都有一个基于分区键值的逻辑分区。</span><span class="sxs-lookup"><span data-stu-id="38ce2-354">Figure 5-18 shows two containers each with a logical partition based on a partition key value.</span></span>

![宇宙数据库分区机制](./media/cosmos-db-partitioning.png)

<span data-ttu-id="38ce2-356">**图 5-18**： 宇宙 DB 分区机制</span><span class="sxs-lookup"><span data-stu-id="38ce2-356">**Figure 5-18**: Cosmos DB partitioning mechanics</span></span>

<span data-ttu-id="38ce2-357">请注意，在上图中，每个项目如何包含"城市"或"机场"的分区键。</span><span class="sxs-lookup"><span data-stu-id="38ce2-357">Note in the  previous figure how each item includes a partition key of either ‘city’ or ‘airport’.</span></span> <span data-ttu-id="38ce2-358">键确定项的逻辑分区。</span><span class="sxs-lookup"><span data-stu-id="38ce2-358">The key determines the item’s logical partition.</span></span> <span data-ttu-id="38ce2-359">带有城市代码的项目将分配给左侧的容器，以及带有机场代码的项目分配给右侧的容器。</span><span class="sxs-lookup"><span data-stu-id="38ce2-359">Items with a city code are assigned to the container on the left, and items with an airport code, to the container on the right.</span></span> <span data-ttu-id="38ce2-360">将分区键值与 ID 值合并将创建项的索引，该索引唯一地标识项。</span><span class="sxs-lookup"><span data-stu-id="38ce2-360">Combining the partition key value with the ID value creates an item's index, which uniquely identifies the item.</span></span>

<span data-ttu-id="38ce2-361">在内部，Cosmos DB 自动管理[物理分区上的逻辑分区](https://docs.microsoft.com/azure/cosmos-db/partition-data)放置，以满足容器的可伸缩性和性能需求。</span><span class="sxs-lookup"><span data-stu-id="38ce2-361">Internally, Cosmos DB automatically manages the placement of [logical partitions](https://docs.microsoft.com/azure/cosmos-db/partition-data) on physical partitions to satisfy the scalability and performance needs of the container.</span></span> <span data-ttu-id="38ce2-362">随着应用程序吞吐量和存储要求的提高，Azure Cosmos DB 会跨更多服务器重新分发逻辑分区。</span><span class="sxs-lookup"><span data-stu-id="38ce2-362">As application throughput and storage requirements  increase, Azure Cosmos DB redistributes logical partitions across a greater number of servers.</span></span> <span data-ttu-id="38ce2-363">重新分发操作由 Cosmos DB 管理，并在不中断或停机的情况下调用。</span><span class="sxs-lookup"><span data-stu-id="38ce2-363">Redistribution operations are managed by Cosmos DB and invoked without interruption or downtime.</span></span>

## <a name="newsql-databases"></a><span data-ttu-id="38ce2-364">新建 SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="38ce2-364">NewSQL databases</span></span>

<span data-ttu-id="38ce2-365">*NewSQL* 是一种新兴的数据库技术，它将 NoSQL 的分布式可扩展性与关系数据库的 ACID 保证相结合。</span><span class="sxs-lookup"><span data-stu-id="38ce2-365">*NewSQL* is an emerging database technology that combines the distributed scalability of NoSQL with the ACID guarantees of a relational database.</span></span> <span data-ttu-id="38ce2-366">NewSQL 数据库对于必须在分布式环境中处理大量数据的业务系统非常重要，这些系统具有完全的事务支持和 ACID 合规性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-366">NewSQL databases are important for business systems that must process high-volumes of data, across distributed environments, with full transactional support and ACID compliance.</span></span> <span data-ttu-id="38ce2-367">虽然 NoSQL 数据库可以提供海量可伸缩性，但它不能保证数据一致性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-367">While a NoSQL database can provide massive scalability, it does not guarantee data consistency.</span></span> <span data-ttu-id="38ce2-368">数据不一致的间歇性问题可能会给开发团队带来负担。</span><span class="sxs-lookup"><span data-stu-id="38ce2-368">Intermittent problems from inconsistent data can place a burden on the development team.</span></span> <span data-ttu-id="38ce2-369">开发人员必须在微服务代码中构造安全措施，以管理由不一致数据引起的问题。</span><span class="sxs-lookup"><span data-stu-id="38ce2-369">Developers must construct safeguards into their microservice code to manage problems caused by inconsistent data.</span></span>

<span data-ttu-id="38ce2-370">云原生计算基础 （CNCF） 具有多个新 SQL 数据库项目。</span><span class="sxs-lookup"><span data-stu-id="38ce2-370">The Cloud Native Computing Foundation (CNCF) features several NewSQL database projects.</span></span>

| <span data-ttu-id="38ce2-371">Project</span><span class="sxs-lookup"><span data-stu-id="38ce2-371">Project</span></span> | <span data-ttu-id="38ce2-372">特征</span><span class="sxs-lookup"><span data-stu-id="38ce2-372">Characteristics</span></span> |
| :-------- | :-------- |
| <span data-ttu-id="38ce2-373">蟑螂 DB</span><span class="sxs-lookup"><span data-stu-id="38ce2-373">Cockroach DB</span></span> |<span data-ttu-id="38ce2-374">符合 ACID 的、全局扩展的关系数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-374">An ACID compliant, relational database that scales globally.</span></span> <span data-ttu-id="38ce2-375">向群集添加新节点，而 CockroachDB 负责平衡跨实例和地理位置的数据。</span><span class="sxs-lookup"><span data-stu-id="38ce2-375">Add a new node to a cluster and CockroachDB takes care of balancing the data across instances and geographies.</span></span> <span data-ttu-id="38ce2-376">它创建、管理和分发副本以确保可靠性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-376">It creates, manages and distributes replicas to ensure reliability.</span></span> <span data-ttu-id="38ce2-377">它是开源的，免费提供。</span><span class="sxs-lookup"><span data-stu-id="38ce2-377">It’s open source and freely available.</span></span>  |
| <span data-ttu-id="38ce2-378">提亚布</span><span class="sxs-lookup"><span data-stu-id="38ce2-378">TiDB</span></span> | <span data-ttu-id="38ce2-379">支持混合事务和分析处理 （HTAP） 工作负载的开源数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-379">An open-source database that supports Hybrid Transactional and Analytical Processing (HTAP) workloads.</span></span> <span data-ttu-id="38ce2-380">它与 MySQL 兼容，具有水平可扩展性、强一致性和高可用性。</span><span class="sxs-lookup"><span data-stu-id="38ce2-380">It is MySQL-compatible and features horizontal scalability, strong consistency, and high availability.</span></span>  <span data-ttu-id="38ce2-381">TiDB 充当 MySQL 服务器。</span><span class="sxs-lookup"><span data-stu-id="38ce2-381">TiDB acts like a MySQL server.</span></span> <span data-ttu-id="38ce2-382">您可以继续使用现有的 MySQL 客户端库，而无需对应用程序进行大量代码更改。</span><span class="sxs-lookup"><span data-stu-id="38ce2-382">You can continue to use existing MySQL client libraries, without requiring extensive code changes to your application.</span></span> |
| <span data-ttu-id="38ce2-383">尤加字节开发银行</span><span class="sxs-lookup"><span data-stu-id="38ce2-383">YugabyteDB</span></span> | <span data-ttu-id="38ce2-384">开源、高性能、分布式 SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="38ce2-384">An open source, high-performance, distributed SQL database.</span></span> <span data-ttu-id="38ce2-385">它支持低查询延迟、抵御故障的弹性和全局数据分发。</span><span class="sxs-lookup"><span data-stu-id="38ce2-385">It supports low query latency, resilience against failures, and global data distribution.</span></span> <span data-ttu-id="38ce2-386">YugabyDB 与后回归 SQL 兼容，可处理横向扩展 RDBMS 和 Internet 规模 OLTP 工作负载。</span><span class="sxs-lookup"><span data-stu-id="38ce2-386">YugabyteDB is PostgressSQL-compatible and handles scale-out RDBMS and internet-scale OLTP workloads.</span></span> <span data-ttu-id="38ce2-387">该产品还支持NoSQL，并与卡桑德拉兼容。</span><span class="sxs-lookup"><span data-stu-id="38ce2-387">The product also support NoSQL and is compatible with Cassandra.</span></span> |
|<span data-ttu-id="38ce2-388">维特斯</span><span class="sxs-lookup"><span data-stu-id="38ce2-388">Vitess</span></span> | <span data-ttu-id="38ce2-389">ViTES 是一种数据库解决方案，用于部署、缩放和管理大型 MySQL 实例群集。</span><span class="sxs-lookup"><span data-stu-id="38ce2-389">Vitess is a database solution for deploying, scaling and managing large clusters of MySQL instances.</span></span> <span data-ttu-id="38ce2-390">它可以在公共或私有云体系结构中运行。</span><span class="sxs-lookup"><span data-stu-id="38ce2-390">It’s can run in a public or private cloud architecture.</span></span> <span data-ttu-id="38ce2-391">它结合了并扩展了许多重要的 MySQL 功能，并具有垂直和水平分片支持功能。</span><span class="sxs-lookup"><span data-stu-id="38ce2-391">It combines and extends many important MySQL features and features both vertical and horizontal sharding support.</span></span> <span data-ttu-id="38ce2-392">Vites源自YouTube，自2011年以来一直提供所有YouTube数据库流量。</span><span class="sxs-lookup"><span data-stu-id="38ce2-392">Originated by YouTube, Vitess has been serving all YouTube database traffic since 2011 .</span></span> |

<span data-ttu-id="38ce2-393">上图中的开源项目可从云原生计算基金会获得。</span><span class="sxs-lookup"><span data-stu-id="38ce2-393">The open-source projects in the previous figure are available from the Cloud Native Computing Foundation.</span></span> <span data-ttu-id="38ce2-394">其中三种产品是完整的数据库产品，其中包括 .NET Core 支持。</span><span class="sxs-lookup"><span data-stu-id="38ce2-394">Three of the offerings are full database products, which include .NET Core support.</span></span> <span data-ttu-id="38ce2-395">另一个 Vites 是一个数据库群集系统，它水平缩放 MySQL 实例的大型群集。</span><span class="sxs-lookup"><span data-stu-id="38ce2-395">The other, Vitess, is a database clustering system that horizontally scales large clusters of MySQL instances.</span></span>

<span data-ttu-id="38ce2-396">NewSQL 数据库的关键设计目标是利用平台的弹性和可扩展性，在 Kubernetes 中本机工作。</span><span class="sxs-lookup"><span data-stu-id="38ce2-396">A key design goal for NewSQL databases is to work natively in Kubernetes, taking advantage of the platform's resiliency and scalability.</span></span>

<span data-ttu-id="38ce2-397">NewSQL 数据库旨在在短暂的云环境中蓬勃发展，在临时云环境中，基础虚拟机可在接到通知后立即重新启动或重新安排。</span><span class="sxs-lookup"><span data-stu-id="38ce2-397">NewSQL databases are designed to thrive in ephemeral cloud environments where underlying virtual machines can be restarted or rescheduled at a moment’s notice.</span></span> <span data-ttu-id="38ce2-398">数据库旨在抵御节点故障，而不会丢失数据或停机。</span><span class="sxs-lookup"><span data-stu-id="38ce2-398">The databases are designed to survive node failures without data loss nor downtime.</span></span> <span data-ttu-id="38ce2-399">例如，CockroachDB 通过在群集中的节点上维护任何数据的三个一致副本，能够经受住计算机损失。</span><span class="sxs-lookup"><span data-stu-id="38ce2-399">CockroachDB, for example, is able to survive a machine loss by maintaining three consistent replicas of any data across the nodes in a cluster.</span></span>

<span data-ttu-id="38ce2-400">Kubernetes 使用*服务构造*允许客户端从单个 DNS 条目处理一组相同的 NewSQL 数据库进程。</span><span class="sxs-lookup"><span data-stu-id="38ce2-400">Kubernetes uses a *Services construct* to allow a client to address a group of identical NewSQL databases processes from a single DNS entry.</span></span> <span data-ttu-id="38ce2-401">通过将数据库实例与与其关联的服务地址分离，我们可以在不中断现有应用程序实例的情况下进行扩展。</span><span class="sxs-lookup"><span data-stu-id="38ce2-401">By decoupling the database instances from the address of the service with which it's associated, we can scale without disrupting existing application instances.</span></span> <span data-ttu-id="38ce2-402">在给定时间向任何服务发送请求将始终产生相同的结果。</span><span class="sxs-lookup"><span data-stu-id="38ce2-402">Sending a request to any service at a given time will always yield the same result.</span></span>

<span data-ttu-id="38ce2-403">在这种情况下，所有数据库实例都是相等的。</span><span class="sxs-lookup"><span data-stu-id="38ce2-403">In this scenario, all database instances are equal.</span></span> <span data-ttu-id="38ce2-404">没有主关系或次要关系。</span><span class="sxs-lookup"><span data-stu-id="38ce2-404">There are no primary or secondary relationships.</span></span> <span data-ttu-id="38ce2-405">在 CockroachDB 中找到*的协商一致复制*等技术允许任何数据库节点处理任何请求。</span><span class="sxs-lookup"><span data-stu-id="38ce2-405">Techniques like *consensus replication* found in CockroachDB allow any database node to handle any request.</span></span> <span data-ttu-id="38ce2-406">如果接收负载平衡请求的节点具有本地所需的数据，它将立即响应。</span><span class="sxs-lookup"><span data-stu-id="38ce2-406">If the node that receives a load-balanced request has the data it needs locally, it responds immediately.</span></span> <span data-ttu-id="38ce2-407">如果没有，节点将成为网关，并将请求转发到相应的节点以获得正确答案。</span><span class="sxs-lookup"><span data-stu-id="38ce2-407">If not, the node becomes a gateway and forwards the request to the appropriate nodes to get the correct answer.</span></span> <span data-ttu-id="38ce2-408">从客户端的角度来看，每个数据库节点都是一样的：它们显示为单个*逻辑*数据库，具有单机系统的一致性保证，尽管有数十个甚至数百个节点在幕后工作。</span><span class="sxs-lookup"><span data-stu-id="38ce2-408">From the client's perspective, every database node is the same: They appear as a single *logical* database with the consistency guarantees of a single-machine system, despite having dozens or even hundreds of nodes that are working behind the scenes.</span></span>

<span data-ttu-id="38ce2-409">有关 NewSQL 数据库背后的机制的详细信息，请参阅[DASH：库伯内斯-本机数据库的四个属性](https://thenewstack.io/dash-four-properties-of-kubernetes-native-databases/)一文。</span><span class="sxs-lookup"><span data-stu-id="38ce2-409">For a detailed look at the mechanics behind NewSQL databases, see the [DASH: Four Properties of Kubernetes-Native Databases](https://thenewstack.io/dash-four-properties-of-kubernetes-native-databases/) article.</span></span>

## <a name="data-migration-to-the-cloud"></a><span data-ttu-id="38ce2-410">数据迁移到云</span><span class="sxs-lookup"><span data-stu-id="38ce2-410">Data migration to the cloud</span></span>

<span data-ttu-id="38ce2-411">更耗时的任务之一是从一个数据平台将数据迁移到另一个数据平台。</span><span class="sxs-lookup"><span data-stu-id="38ce2-411">One of the more time-consuming tasks is migrating data from one data platform to another.</span></span> <span data-ttu-id="38ce2-412">[Azure 数据迁移服务](https://azure.microsoft.com/services/database-migration/)可帮助加快此类工作。</span><span class="sxs-lookup"><span data-stu-id="38ce2-412">The [Azure Data Migration Service](https://azure.microsoft.com/services/database-migration/) can help expedite such efforts.</span></span> <span data-ttu-id="38ce2-413">它可以将数据从多个外部数据库源迁移到 Azure 数据平台，但停机时间最少。</span><span class="sxs-lookup"><span data-stu-id="38ce2-413">It can migrate data from several external database sources into Azure Data platforms with minimal downtime.</span></span> <span data-ttu-id="38ce2-414">目标平台包括以下服务：</span><span class="sxs-lookup"><span data-stu-id="38ce2-414">Target platforms include the following services:</span></span>

- <span data-ttu-id="38ce2-415">Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="38ce2-415">Azure SQL Database</span></span>
- <span data-ttu-id="38ce2-416">Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="38ce2-416">Azure Database for MySQL</span></span>
- <span data-ttu-id="38ce2-417">Azure Database for MariaDB</span><span class="sxs-lookup"><span data-stu-id="38ce2-417">Azure Database for MariaDB</span></span>
- <span data-ttu-id="38ce2-418">Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="38ce2-418">Azure Database for PostgreSQL</span></span>
- <span data-ttu-id="38ce2-419">CosmosDB</span><span class="sxs-lookup"><span data-stu-id="38ce2-419">CosmosDB</span></span>
  
<span data-ttu-id="38ce2-420">该服务提供建议，指导您完成执行迁移所需的更改，无论是小还是大。</span><span class="sxs-lookup"><span data-stu-id="38ce2-420">The service provides recommendations to guide you through the changes required to execute a migration, both small or large.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="38ce2-421">[上一个](Database-per-microservice.md)
>[下一个](azure-caching.md)</span><span class="sxs-lookup"><span data-stu-id="38ce2-421">[Previous](Database-per-microservice.md)
[Next](azure-caching.md)</span></span>
