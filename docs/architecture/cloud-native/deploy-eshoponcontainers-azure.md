---
title: 将 eShopOnContainers 部署到 Azure
description: 使用 Azure Kubernetes 服务、Helm 和 DevSpaces 部署 eShopOnContainers 应用程序。
ms.date: 06/30/2019
ms.openlocfilehash: 21033cc904dc595193c69f3452ce2522740f8ff6
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/23/2019
ms.locfileid: "73840489"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="3e33e-103">将 eShopOnContainers 部署到 Azure</span><span class="sxs-lookup"><span data-stu-id="3e33e-103">Deploying eShopOnContainers to Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="3e33e-104">Azure 使用各种服务支持 eShopOnContainers 应用程序的逻辑。</span><span class="sxs-lookup"><span data-stu-id="3e33e-104">The logic supporting the eShopOnContainers application can be supported by Azure using a variety of services.</span></span> <span data-ttu-id="3e33e-105">推荐的方法是使用 Azure Kubernetes 服务（AKS）的 Kubernetes。</span><span class="sxs-lookup"><span data-stu-id="3e33e-105">The recommended approach is to leverage Kubernetes using Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="3e33e-106">这可以与 Helm 部署结合，以确保轻松地重复基础结构配置。</span><span class="sxs-lookup"><span data-stu-id="3e33e-106">This can be combined with Helm deployment to ensure easily repeated infrastructure configuration.</span></span> <span data-ttu-id="3e33e-107">或者，开发人员可以在开发过程中利用 Kubernetes Azure Dev Spaces。</span><span class="sxs-lookup"><span data-stu-id="3e33e-107">Optionally, developers can leverage Azure Dev Spaces for Kubernetes as part of their development process.</span></span> <span data-ttu-id="3e33e-108">另一种做法是使用 Azure 无服务器功能（如 Azure Functions 和 Azure 逻辑应用）承载应用程序的功能。</span><span class="sxs-lookup"><span data-stu-id="3e33e-108">Another option is to host the functionality of the app using Azure Serverless features like Azure Functions and Azure Logic Apps.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="3e33e-109">Azure Kubernetes 服务</span><span class="sxs-lookup"><span data-stu-id="3e33e-109">Azure Kubernetes Service</span></span>

<span data-ttu-id="3e33e-110">如果要在自己的 AKS 群集中托管 eShopOnContainers 应用程序，第一步是创建群集。</span><span class="sxs-lookup"><span data-stu-id="3e33e-110">If you'd like to host the eShopOnContainers application in your own AKS cluster, the first step is to create your cluster.</span></span> <span data-ttu-id="3e33e-111">你可以使用 Azure 门户执行此操作，该操作将引导你完成所需的步骤，或者可以使用 Azure CLI，请务必确保启用基于角色的访问控制（RBAC）和应用程序路由。</span><span class="sxs-lookup"><span data-stu-id="3e33e-111">You can do this using the Azure portal, which will walk you through the required steps, or you can use the Azure CLI, taking care to ensure you enable Role-Based Access Control (RBAC) and application routing when you do so.</span></span> <span data-ttu-id="3e33e-112">EShopOnContainers 文档介绍了创建你自己的 AKS 群集时所涉及的步骤。</span><span class="sxs-lookup"><span data-stu-id="3e33e-112">The eShopOnContainers' documentation describes the steps involved in creating your own AKS cluster.</span></span> <span data-ttu-id="3e33e-113">创建群集后，必须启用对 Kubernetes 仪表板的访问权限，此时你应该能够浏览到 Kubernetes 仪表板来管理群集。</span><span class="sxs-lookup"><span data-stu-id="3e33e-113">Once the cluster is created, you must enable access to the Kubernetes dashboard, at which point you should be able to browse to the Kubernetes dashboard to manage the cluster.</span></span>

<span data-ttu-id="3e33e-114">创建并配置群集后，可以使用 Helm 和 Tiller 将应用程序部署到该群集。</span><span class="sxs-lookup"><span data-stu-id="3e33e-114">Once the cluster has been created and configured, you can deploy the application to it using Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="3e33e-115">使用 Helm 部署到 Azure Kubernetes 服务</span><span class="sxs-lookup"><span data-stu-id="3e33e-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="3e33e-116">AKS 的基本部署可能使用自定义 CLI 脚本或简单的部署文件，但更复杂的应用程序应使用 Helm 等依赖项管理工具。</span><span class="sxs-lookup"><span data-stu-id="3e33e-116">Basic deployments to AKS may use custom CLI scripts or simple deployment files, but more complex applications should use a dependency management tool like Helm.</span></span> <span data-ttu-id="3e33e-117">Helm 由云本机计算基础维护，可帮助你定义、安装和升级 Kubernetes 应用程序。</span><span class="sxs-lookup"><span data-stu-id="3e33e-117">Helm is maintained by the Cloud-native Computing Foundation and helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="3e33e-118">Helm 由命令行客户端 Helm 使用，后者使用 Helm 图表和群集内组件 Tiller。</span><span class="sxs-lookup"><span data-stu-id="3e33e-118">Helm is composed of a command-line client, helm, which uses helm charts, and an in-cluster component, Tiller.</span></span> <span data-ttu-id="3e33e-119">Helm 图表使用标准 YAML 格式的文件来描述一组相关的 Kubernetes 资源，这些资源通常与它们所描述的应用程序进行版本控制。</span><span class="sxs-lookup"><span data-stu-id="3e33e-119">Helm Charts use standard YAML-formatted files to describe a related set of Kubernetes resources and are typically versioned alongside the application they describe.</span></span> <span data-ttu-id="3e33e-120">Helm 图的范围从简单到复杂，具体取决于它们所描述的安装的要求。</span><span class="sxs-lookup"><span data-stu-id="3e33e-120">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="3e33e-121">你将在/k8s/helm 文件夹中找到 eShopOnContainers helm 图。</span><span class="sxs-lookup"><span data-stu-id="3e33e-121">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="3e33e-122">图2-6 显示了如何将应用程序的不同组件组织到 helm 用于定义和管理部署的文件夹结构中。</span><span class="sxs-lookup"><span data-stu-id="3e33e-122">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="3e33e-123">![eShopOnContainers 体系结构](./media/eshoponcontainers-helm-folder.png)
**图 2-6**。</span><span class="sxs-lookup"><span data-stu-id="3e33e-123">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="3e33e-124">EShopOnContainers helm 文件夹。</span><span class="sxs-lookup"><span data-stu-id="3e33e-124">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="3e33e-125">使用 `helm install` 命令安装每个单独的组件。</span><span class="sxs-lookup"><span data-stu-id="3e33e-125">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="3e33e-126">这些命令易于编写脚本，eShopOnContainers 提供了一个 "部署全部" 脚本，该脚本可循环浏览不同的组件并使用各自的 helm 图表安装这些组件。</span><span class="sxs-lookup"><span data-stu-id="3e33e-126">These commands are easily scripted, and eShopOnContainers provides a "deploy all" script that loops through the different components and installs them using their respective helm charts.</span></span> <span data-ttu-id="3e33e-127">结果就是一个可重复执行的过程，该过程与源代码管理中的应用程序进行了版本控制，团队中的任何人都可以使用单行脚本命令将其部署到 AKS 群集。</span><span class="sxs-lookup"><span data-stu-id="3e33e-127">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span> <span data-ttu-id="3e33e-128">尤其是在与 Azure Dev Spaces 结合时，这使开发人员可以轻松地诊断和测试其对基于微服务的云本机应用程序所做的更改。</span><span class="sxs-lookup"><span data-stu-id="3e33e-128">Especially when combined with Azure Dev Spaces, this makes it easy for developers to diagnose and test their individual changes to their microservice-based cloud-native apps.</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="3e33e-129">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="3e33e-129">Azure Dev Spaces</span></span>

<span data-ttu-id="3e33e-130">Azure Dev Spaces 有助于各个开发人员在开发期间在 Azure 中托管自己的唯一 AKS 群集版本。</span><span class="sxs-lookup"><span data-stu-id="3e33e-130">Azure Dev Spaces helps individual developers host their own unique version of AKS clusters in Azure during development.</span></span> <span data-ttu-id="3e33e-131">这将最大程度地降低本地计算机要求，并允许团队成员快速查看其更改在实际 AKS 环境中的行为。</span><span class="sxs-lookup"><span data-stu-id="3e33e-131">This minimizes local machine requirements and allows team members to quickly see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="3e33e-132">Azure Dev Spaces 提供了一种 CLI，使开发人员可以使用它来管理其开发空间，并根据需要部署到特定的子开发人员空间。</span><span class="sxs-lookup"><span data-stu-id="3e33e-132">Azure Dev Spaces offers a CLI for developers to use to manage their dev spaces and to deploy to a specific child dev space as needed.</span></span> <span data-ttu-id="3e33e-133">每个子开发人员空间都使用唯一的 URL 子域进行引用，允许并行部署已修改的群集，以便各个开发人员可以避免相互冲突的正在进行中的工作。</span><span class="sxs-lookup"><span data-stu-id="3e33e-133">Each child dev space is referenced using a unique URL subdomain, allowing side-by-side deployments of modified clusters so that individual developers can avoid conflicting with each other's work in progress.</span></span> <span data-ttu-id="3e33e-134">在图2-7 中，可以看到开发人员 Susie 如何将她自己的自行车微服务版本部署到其开发人员空间。</span><span class="sxs-lookup"><span data-stu-id="3e33e-134">In Figure 2-7 you can see how developer Susie has deployed her own version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="3e33e-135">然后，她可以使用以她的空间名称（susie.s.dev.myapp.eus.azds.io）开头的自定义 URL 来测试她的更改。</span><span class="sxs-lookup"><span data-stu-id="3e33e-135">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="3e33e-136">![eShopOnContainers 体系结构](./media/azure-devspaces-one.png)
**图 2-7**。</span><span class="sxs-lookup"><span data-stu-id="3e33e-136">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="3e33e-137">开发人员 Susie 将部署自己的自行车微服务版本并对其进行测试。</span><span class="sxs-lookup"><span data-stu-id="3e33e-137">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="3e33e-138">同时，开发人员 John 正在自定义预订微服务，并需要对其更改进行测试。</span><span class="sxs-lookup"><span data-stu-id="3e33e-138">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="3e33e-139">他能够将自己的更改部署到自己的开发空间，而不会与 Susie 的更改发生冲突，如图2-8 所示。</span><span class="sxs-lookup"><span data-stu-id="3e33e-139">He's able to deploy his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="3e33e-140">他可以使用自己的 URL 测试其更改，该 URL 以其空间的名称作为前缀（john.s.dev.myapp.eus.azds.io）。</span><span class="sxs-lookup"><span data-stu-id="3e33e-140">He can test his changes using his own URL which is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="3e33e-141">![eShopOnContainers 体系结构](./media/azure-devspaces-two.png)
**图 2-8**。</span><span class="sxs-lookup"><span data-stu-id="3e33e-141">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="3e33e-142">开发人员 John 部署自己的保留版本微服务，并对其进行测试，而不会与其他开发人员发生冲突。</span><span class="sxs-lookup"><span data-stu-id="3e33e-142">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="3e33e-143">使用 Azure Dev Spaces，团队可以直接使用 AKS，同时对其更改进行单独的更改、部署和测试。</span><span class="sxs-lookup"><span data-stu-id="3e33e-143">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="3e33e-144">此方法减少了单独专用托管环境的需要，因为每个开发人员都有效地拥有自己的 AKS 环境。</span><span class="sxs-lookup"><span data-stu-id="3e33e-144">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="3e33e-145">开发人员可以使用其 CLI 来处理 Azure Dev Spaces 或启动其应用程序，以便直接从 Visual Studio Azure Dev Spaces。</span><span class="sxs-lookup"><span data-stu-id="3e33e-145">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="3e33e-146">了解有关 Azure Dev Spaces 工作和配置的详细信息。</span><span class="sxs-lookup"><span data-stu-id="3e33e-146">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="3e33e-147">Azure Functions 和逻辑应用（无服务器）</span><span class="sxs-lookup"><span data-stu-id="3e33e-147">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="3e33e-148">EShopOnContainers 示例包括对跟踪联机市场营销活动的支持。</span><span class="sxs-lookup"><span data-stu-id="3e33e-148">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="3e33e-149">Azure Function 用于请求给定市场活动 ID 的市场营销活动详细信息。</span><span class="sxs-lookup"><span data-stu-id="3e33e-149">An Azure Function is used to pull marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="3e33e-150">单个 Azure 函数终结点更简单、更充分，而不是出于此目的创建一个完整的 ASP.NET Core 应用程序。</span><span class="sxs-lookup"><span data-stu-id="3e33e-150">Rather than creating a complete ASP.NET Core application for this purpose, a single Azure Function endpoint is simpler and sufficient.</span></span> <span data-ttu-id="3e33e-151">Azure Functions 具有比完全 ASP.NET Core 应用程序更简单的生成和部署模型，尤其是在配置为在 Kubernetes 中运行时。</span><span class="sxs-lookup"><span data-stu-id="3e33e-151">Azure Functions have a much simpler build and deployment model than full ASP.NET Core applications, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="3e33e-152">部署函数的脚本使用 Azure 资源管理器（ARM）模板和 Azure CLI。</span><span class="sxs-lookup"><span data-stu-id="3e33e-152">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="3e33e-153">此市场活动详细信息微服务不是面向客户的，与在线商店没有相同的要求，因此它非常适合 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="3e33e-153">This campaign details microservice isn't customer-facing and doesn't have the same requirements as the online store, making it a good candidate for Azure Functions.</span></span> <span data-ttu-id="3e33e-154">函数需要某些配置才能正常工作，如数据库连接字符串数据和图像基 URI 设置。</span><span class="sxs-lookup"><span data-stu-id="3e33e-154">The function requires some configuration to work properly, such as database connection string data and image base URI settings.</span></span> <span data-ttu-id="3e33e-155">在 Azure 门户中配置 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="3e33e-155">You configure Azure Functions in the Azure Portal.</span></span>

## <a name="references"></a><span data-ttu-id="3e33e-156">参考</span><span class="sxs-lookup"><span data-stu-id="3e33e-156">References</span></span>

- <span data-ttu-id="3e33e-157">[eShopOnContainers：在 AKS 中创建 Kubernetes 群集](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="3e33e-157">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="3e33e-158">eShopOnContainers： Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="3e33e-158">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="3e33e-159">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="3e33e-159">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="3e33e-160">[上一页](map-eshoponcontainers-azure-services.md)
>[下一页](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="3e33e-160">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
