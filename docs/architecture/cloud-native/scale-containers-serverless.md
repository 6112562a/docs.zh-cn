---
title: 缩放容器和无服务器应用程序
description: 使用 Azure Kubernetes 服务缩放云本机应用程序，通过增加单个计算机资源来满足用户需求，或增加应用程序群集中的计算机数。
ms.date: 09/23/2019
ms.openlocfilehash: 2d0537fb3ed56beb4eccbf9b8c34a5d87793413b
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/23/2019
ms.locfileid: "73841011"
---
# <a name="scaling-containers-and-serverless-applications"></a><span data-ttu-id="c324a-103">缩放容器和无服务器应用程序</span><span class="sxs-lookup"><span data-stu-id="c324a-103">Scaling containers and serverless applications</span></span>

<span data-ttu-id="c324a-104">缩放应用程序的方法有两种：向上缩放和向外缩放。前者是指向一个主机添加功能，而后者是指向主机的总数添加。</span><span class="sxs-lookup"><span data-stu-id="c324a-104">There are two typical ways to scale an application: scaling up and scaling out. The former refers to adding capabilities to one host, while the latter refers to adding to the total number of hosts.</span></span> <span data-ttu-id="c324a-105">用于考虑这种情况的一个常见类比就是如何使自己和某些朋友遍布城镇。</span><span class="sxs-lookup"><span data-stu-id="c324a-105">A common analogy to use to think about this is how to get yourself and some friends across town.</span></span> <span data-ttu-id="c324a-106">如果它只是一个朋友，则可以跳转到两位赛车。</span><span class="sxs-lookup"><span data-stu-id="c324a-106">If it's just one friend, you could hop into your two-seat race car.</span></span> <span data-ttu-id="c324a-107">但如果它是三个或四个，则可能需要获取 SUVs 或 minivan 之一，增加容量以增加容量。</span><span class="sxs-lookup"><span data-stu-id="c324a-107">But if it's three or four, you might need to take one of your SUVs or a minivan, scaling up to increase capacity.</span></span> <span data-ttu-id="c324a-108">不过，如果总数量达到了数个或更多，则可能需要采用多个车辆（除非有人驱动某个总线），这就是通过添加更多实例（在本例中为更多车辆）来进行扩展的概念。</span><span class="sxs-lookup"><span data-stu-id="c324a-108">When your total number jumps up to a dozen or more, though, you probably need to take multiple vehicles (unless someone drives a bus), which demonstrates the concept of scaling out by adding more instances (in this case, more vehicles).</span></span> <span data-ttu-id="c324a-109">让我们看看这如何适用于我们的应用程序。</span><span class="sxs-lookup"><span data-stu-id="c324a-109">Let's see how this applies to our applications.</span></span>

## <a name="the-simple-solution-scaling-up"></a><span data-ttu-id="c324a-110">简单的解决方案：向上缩放</span><span class="sxs-lookup"><span data-stu-id="c324a-110">The simple solution: scaling up</span></span>

<span data-ttu-id="c324a-111">升级现有服务器以使其更多资源（CPU、内存、磁盘 i/o 速度、网络 i/o 速度）的过程称为 "*向上缩放*"。</span><span class="sxs-lookup"><span data-stu-id="c324a-111">The process of upgrading existing servers to give them more resources (CPU, memory, disk I/O speed, network I/O speed) is known as *scaling up*.</span></span> <span data-ttu-id="c324a-112">在云本机应用程序中，纵向扩展并不是指在物理计算机上购买和安装实际硬件，这与从可用的选项列表中选择功能更强大的计划更多。</span><span class="sxs-lookup"><span data-stu-id="c324a-112">In cloud-native applications, scaling up doesn't typically refer to purchasing and installing actual hardware on physical machines so much as choosing a more capable plan from a list of options available.</span></span> <span data-ttu-id="c324a-113">通常，通过修改用于宿主 Kubernetes 节点池中各个节点的虚拟机（VM）大小来扩展云本机应用。</span><span class="sxs-lookup"><span data-stu-id="c324a-113">Cloud-native apps typically scale up by modifying the virtual machine (VM) size used to host the individual nodes in their Kubernetes node pool.</span></span> <span data-ttu-id="c324a-114">[下一节](leverage-containers-orchestrators.md)中进一步介绍了 Kubernetes 的概念，如节点、群集和 pod。</span><span class="sxs-lookup"><span data-stu-id="c324a-114">Kubernetes concepts like nodes, clusters, and pods are described further in [the next section](leverage-containers-orchestrators.md).</span></span> <span data-ttu-id="c324a-115">Azure 支持各种虚拟机大小，同时运行[Windows](https://docs.microsoft.com/azure/virtual-machines/windows/sizes?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)和[Linux](https://docs.microsoft.com/azure/virtual-machines/linux/sizes)。</span><span class="sxs-lookup"><span data-stu-id="c324a-115">Azure supports a wide variety of VM sizes running both [Windows](https://docs.microsoft.com/azure/virtual-machines/windows/sizes?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) and [Linux](https://docs.microsoft.com/azure/virtual-machines/linux/sizes).</span></span> <span data-ttu-id="c324a-116">若要对应用程序进行垂直缩放，请创建具有更大节点 VM 大小的新节点池，并将工作负荷迁移到新池。</span><span class="sxs-lookup"><span data-stu-id="c324a-116">To vertically scale your application, create a new node pool with a larger node VM size and then migrate workloads to the new pool.</span></span> <span data-ttu-id="c324a-117">这需要[AKS 群集的多个节点池](https://docs.microsoft.com/azure/aks/use-multiple-node-pools)，这是目前处于预览阶段的一项功能。</span><span class="sxs-lookup"><span data-stu-id="c324a-117">This requires [multiple node pools for your AKS cluster](https://docs.microsoft.com/azure/aks/use-multiple-node-pools), a feature that is currently in preview.</span></span> <span data-ttu-id="c324a-118">无服务器应用通过选择[高级计划](https://docs.microsoft.com/azure/azure-functions/functions-scale)和高级实例大小，或选择其他专用应用服务计划进行扩展。</span><span class="sxs-lookup"><span data-stu-id="c324a-118">Serverless apps scale up by choosing a [premium plan](https://docs.microsoft.com/azure/azure-functions/functions-scale) and premium instance sizes or by choosing a different dedicated app service plan.</span></span>

## <a name="scaling-out-cloud-native-apps"></a><span data-ttu-id="c324a-119">向外扩展云本机应用</span><span class="sxs-lookup"><span data-stu-id="c324a-119">Scaling out cloud-native apps</span></span>

<span data-ttu-id="c324a-120">云本机应用支持向服务请求添加其他节点或盒向外扩展。</span><span class="sxs-lookup"><span data-stu-id="c324a-120">Cloud-native apps support scaling out by adding additional nodes or pods to service requests.</span></span> <span data-ttu-id="c324a-121">可以通过调整应用的配置设置（例如，[缩放节点池](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#scale-a-node-pool-manually)）或通过自动*缩放*来手动完成此操作。</span><span class="sxs-lookup"><span data-stu-id="c324a-121">This can be accomplished manually by adjusting configuration settings for the app (for example, [scaling a node pool](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#scale-a-node-pool-manually)), or through *autoscaling*.</span></span> <span data-ttu-id="c324a-122">自动缩放会调整应用程序使用的资源，以响应需求，类似于恒温器如何通过拨打额外加热或冷却来响应温度。</span><span class="sxs-lookup"><span data-stu-id="c324a-122">Autoscaling adjusts the resources used by an app in order to respond to demand, similar to how a thermostat responds to temperature by calling for additional heating or cooling.</span></span> <span data-ttu-id="c324a-123">使用自动缩放时，将禁用手动缩放。</span><span class="sxs-lookup"><span data-stu-id="c324a-123">When using autoscaling, manual scaling is disabled.</span></span>

<span data-ttu-id="c324a-124">AKS 群集可通过以下两种方式之一进行缩放：</span><span class="sxs-lookup"><span data-stu-id="c324a-124">AKS clusters can scale in one of two ways:</span></span>

- <span data-ttu-id="c324a-125">由于资源限制，无法在节点上计划的[群集自动缩放程序](https://docs.microsoft.com/azure/aks/cluster-autoscaler)监视。</span><span class="sxs-lookup"><span data-stu-id="c324a-125">The [cluster autoscaler](https://docs.microsoft.com/azure/aks/cluster-autoscaler) watches for pods that can't be scheduled on nodes because of resource constraints.</span></span> <span data-ttu-id="c324a-126">它根据需要添加其他节点。</span><span class="sxs-lookup"><span data-stu-id="c324a-126">It adds additional nodes as required.</span></span>
- <span data-ttu-id="c324a-127">**横向 pod 自动缩放程序**使用 Kubernetes 群集中的指标服务器来监视 pod 的资源需求。</span><span class="sxs-lookup"><span data-stu-id="c324a-127">The **horizontal pod autoscaler** uses the Metrics Server in a Kubernetes cluster to monitor the resource demands of pods.</span></span> <span data-ttu-id="c324a-128">如果某个服务需要更多的资源，则自动缩放程序会增加盒的数目。</span><span class="sxs-lookup"><span data-stu-id="c324a-128">If a service needs more resources, the autoscaler increases the number of pods.</span></span>

<span data-ttu-id="c324a-129">图3-13 显示了这两个缩放服务之间的关系。</span><span class="sxs-lookup"><span data-stu-id="c324a-129">Figure 3-13 shows the relationship between these two scaling services.</span></span>

![向外扩展应用服务计划。](./media/aks-cluster-autoscaler.png)

<span data-ttu-id="c324a-131">**图 3-13**。</span><span class="sxs-lookup"><span data-stu-id="c324a-131">**Figure 3-13**.</span></span> <span data-ttu-id="c324a-132">向外扩展应用服务计划。</span><span class="sxs-lookup"><span data-stu-id="c324a-132">Scaling out an App Service plan.</span></span>

<span data-ttu-id="c324a-133">这些服务还可以根据需要减少 pod 或节点的数量。</span><span class="sxs-lookup"><span data-stu-id="c324a-133">These services can also reduce the number of pods or nodes as needed.</span></span> <span data-ttu-id="c324a-134">这两个服务可以一起使用，并且通常一起部署到群集中。</span><span class="sxs-lookup"><span data-stu-id="c324a-134">These two services can work together and are often deployed together in a cluster.</span></span> <span data-ttu-id="c324a-135">组合后，横向 pod 自动缩放程序侧重于运行满足应用程序需求所需的 pod 数。</span><span class="sxs-lookup"><span data-stu-id="c324a-135">When combined, the horizontal pod autoscaler is focused on running the number of pods required to meet application demand.</span></span> <span data-ttu-id="c324a-136">群集自动缩放程序侧重于运行支持计划箱所需的节点数。</span><span class="sxs-lookup"><span data-stu-id="c324a-136">The cluster autoscaler is focused on running the number of nodes required to support the scheduled pods.</span></span>

### <a name="scaling-azure-functions"></a><span data-ttu-id="c324a-137">缩放 Azure Functions</span><span class="sxs-lookup"><span data-stu-id="c324a-137">Scaling Azure Functions</span></span>

<span data-ttu-id="c324a-138">Azure Functions 自动支持向外扩展。默认消耗计划根据传入的触发事件数动态添加（和删除）资源。</span><span class="sxs-lookup"><span data-stu-id="c324a-138">Azure Functions automatically supports scaling out. The default consumption plan adds (and removes) resources dynamically based on the number of triggering events coming in.</span></span> <span data-ttu-id="c324a-139">仅根据执行次数、执行时间和所使用的内存，对正在使用的计算资源付费。</span><span class="sxs-lookup"><span data-stu-id="c324a-139">You're only charged for compute resources being used when your functions are running based on the number of executions, execution time, and memory used.</span></span> <span data-ttu-id="c324a-140">使用高级计划，你可以获得这些相同的功能，但你也可以控制所使用的实例大小、已准备好的实例（以避免冷启动延迟），并配置要在其上运行函数的专用 Vm。</span><span class="sxs-lookup"><span data-stu-id="c324a-140">Using the premium plan, you get these same features but you can also control the instance sizes that are used, have instances already warmed up (to avoid cold start delays), and configure dedicated VMs on which to run your functions.</span></span> <span data-ttu-id="c324a-141">尽管默认配置应为大多数应用提供经济实惠且可缩放的解决方案，但 "高级" 选项使开发人员可以灵活地满足自定义 Azure Functions 要求。</span><span class="sxs-lookup"><span data-stu-id="c324a-141">While the default configuration should provide an economical and scalable solution for most apps, the premium option allows developers flexibility for custom Azure Functions requirements.</span></span>

## <a name="references"></a><span data-ttu-id="c324a-142">reference</span><span class="sxs-lookup"><span data-stu-id="c324a-142">References</span></span>

- [<span data-ttu-id="c324a-143">AKS 多节点池</span><span class="sxs-lookup"><span data-stu-id="c324a-143">AKS Multiple Node Pools</span></span>](https://docs.microsoft.com/azure/aks/use-multiple-node-pools)
- [<span data-ttu-id="c324a-144">AKS 群集自动缩放程序</span><span class="sxs-lookup"><span data-stu-id="c324a-144">AKS Cluster Autoscaler</span></span>](https://docs.microsoft.com/azure/aks/cluster-autoscaler)
- [<span data-ttu-id="c324a-145">教程：在 AKS 中缩放应用程序</span><span class="sxs-lookup"><span data-stu-id="c324a-145">Tutorial: Scale applications in AKS</span></span>](https://docs.microsoft.com/azure/aks/tutorial-kubernetes-scale)
- [<span data-ttu-id="c324a-146">Azure Functions 缩放和托管</span><span class="sxs-lookup"><span data-stu-id="c324a-146">Azure Functions scale and hosting</span></span>](https://docs.microsoft.com/azure/azure-functions/functions-scale)

>[!div class="step-by-step"]
><span data-ttu-id="c324a-147">[上一页](deploy-containers-azure.md)
>[下一页](other-deployment-options.md)</span><span class="sxs-lookup"><span data-stu-id="c324a-147">[Previous](deploy-containers-azure.md)
[Next](other-deployment-options.md)</span></span>
