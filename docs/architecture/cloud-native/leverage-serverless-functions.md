---
title: 利用无服务器函数
description: 在云本机应用程序中利用无服务器和 Azure Functions
ms.date: 06/30/2019
ms.openlocfilehash: 77ddef0eb8844ea1b55cd2fc5ec8aa12593c8631
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/30/2019
ms.locfileid: "73841743"
---
# <a name="leveraging-serverless-functions"></a><span data-ttu-id="cf011-103">利用无服务器函数</span><span class="sxs-lookup"><span data-stu-id="cf011-103">Leveraging serverless functions</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="cf011-104">在管理要利用云功能的完整计算机和操作系统的各种领域，无服务器生活在极端的最终位置，即你的代码，你只需在代码运行时付费。</span><span class="sxs-lookup"><span data-stu-id="cf011-104">In the spectrum of managing full machines and operating systems to leveraging cloud capabilities, serverless lives at the extreme end where the only thing you're responsible for is your code, and you only pay when your code runs.</span></span> <span data-ttu-id="cf011-105">Azure Functions 提供了一种将无服务器功能构建到应用程序中的方法。</span><span class="sxs-lookup"><span data-stu-id="cf011-105">Azure Functions provides a way to build serverless capabilities into your applications.</span></span>

## <a name="what-is-serverless"></a><span data-ttu-id="cf011-106">什么是无服务器？</span><span class="sxs-lookup"><span data-stu-id="cf011-106">What is serverless?</span></span>

<span data-ttu-id="cf011-107">无服务器计算并不意味着在运行应用程序时不涉及到服务器-代码仍在某个服务器上运行。</span><span class="sxs-lookup"><span data-stu-id="cf011-107">Serverless computing doesn't mean there isn't a server involved in running your application - the code still runs on a server somewhere.</span></span> <span data-ttu-id="cf011-108">不同之处在于，应用程序开发团队不再需要关注管理服务器基础结构。</span><span class="sxs-lookup"><span data-stu-id="cf011-108">The distinction is that the application development team no longer needs to concern themselves with managing server infrastructure.</span></span> <span data-ttu-id="cf011-109">无服务器计算解决方案，如 Azure Functions 帮助团队提高其工作效率，并使组织能够优化其资源并专注于交付解决方案。</span><span class="sxs-lookup"><span data-stu-id="cf011-109">Serverless computing solutions like Azure Functions help teams increase their productivity and allow organizations to optimize their resources and focus on delivering solutions.</span></span>

<span data-ttu-id="cf011-110">无服务器计算使用事件触发的无状态容器来承载应用程序或应用程序的一部分。</span><span class="sxs-lookup"><span data-stu-id="cf011-110">Serverless computing uses event-triggered stateless containers to host your application or part of your application.</span></span> <span data-ttu-id="cf011-111">无服务器平台可以横向扩展和扩展，以满足需求。</span><span class="sxs-lookup"><span data-stu-id="cf011-111">Serverless platforms can scale out and in to meet demand as-needed.</span></span> <span data-ttu-id="cf011-112">Azure Functions 的平台可以轻松直接访问其他 Azure 服务（如队列、事件和存储）。</span><span class="sxs-lookup"><span data-stu-id="cf011-112">Platforms like Azure Functions have easy direct access to other Azure services like queues, events, and storage.</span></span>

## <a name="what-challenges-are-solved-by-serverless"></a><span data-ttu-id="cf011-113">无服务器解决了哪些问题？</span><span class="sxs-lookup"><span data-stu-id="cf011-113">What challenges are solved by serverless?</span></span>

<span data-ttu-id="cf011-114">无服务器是运行自己的硬件的终极抽象。</span><span class="sxs-lookup"><span data-stu-id="cf011-114">Serverless is the ultimate abstraction away from running your own hardware.</span></span> <span data-ttu-id="cf011-115">开发人员可以专注于编写代码来解决业务问题，而无需考虑在托管您自己的服务器时可能已经需要的以下任何任务：</span><span class="sxs-lookup"><span data-stu-id="cf011-115">Developers can focus exclusively on writing code to solve business problems, without concern for any of the following tasks that might have been necessary when hosting your own servers:</span></span>

- <span data-ttu-id="cf011-116">购买计算机和软件许可证</span><span class="sxs-lookup"><span data-stu-id="cf011-116">Purchasing machines and software licenses</span></span>
- <span data-ttu-id="cf011-117">承载、保护、配置和维护计算机及其网络、电源和/C 要求</span><span class="sxs-lookup"><span data-stu-id="cf011-117">Housing, securing, configuring, and maintaining the machines and their networking, power, and A/C requirements</span></span>
- <span data-ttu-id="cf011-118">修补和升级操作系统和软件</span><span class="sxs-lookup"><span data-stu-id="cf011-118">Patching and upgrading operating systems and software</span></span>
- <span data-ttu-id="cf011-119">将 web 服务器或计算机服务配置为托管应用程序软件</span><span class="sxs-lookup"><span data-stu-id="cf011-119">Configuring web servers or machine services to host application software</span></span>
- <span data-ttu-id="cf011-120">在其平台中配置应用程序软件</span><span class="sxs-lookup"><span data-stu-id="cf011-120">Configuring application software within its platform</span></span>

<span data-ttu-id="cf011-121">许多公司都使用几十个员工并分配大量预算来支持这些硬件基础结构问题。</span><span class="sxs-lookup"><span data-stu-id="cf011-121">Many companies employ dozens of staff members and allocate large budgets to support these hardware infrastructure concerns.</span></span> <span data-ttu-id="cf011-122">只需迁移到云即可消除其中一些问题;将应用程序切换到无服务器的所有方法均可消除其余部分。</span><span class="sxs-lookup"><span data-stu-id="cf011-122">Simply moving to the cloud eliminates some of these concerns; shifting applications all the way to serverless will eliminate the rest.</span></span>

## <a name="what-scenarios-are-appropriate-for-serverless"></a><span data-ttu-id="cf011-123">哪些方案适用于无服务器？</span><span class="sxs-lookup"><span data-stu-id="cf011-123">What scenarios are appropriate for serverless?</span></span>

<span data-ttu-id="cf011-124">无服务器使用为响应某些触发器而调用的单独的短时间运行的函数。</span><span class="sxs-lookup"><span data-stu-id="cf011-124">Serverless uses individual short-running functions that are called in response to some trigger.</span></span> <span data-ttu-id="cf011-125">这使它们非常适合用于处理后台任务。</span><span class="sxs-lookup"><span data-stu-id="cf011-125">This makes them ideal for processing background tasks.</span></span>

<span data-ttu-id="cf011-126">例如，应用程序可能需要在处理请求的过程中发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="cf011-126">For example, an application might need to send an email as part of processing a request.</span></span> <span data-ttu-id="cf011-127">不是在处理 web 请求的过程中发送电子邮件，而是将电子邮件的详细信息放置到队列中，而 Azure 函数可用于提取邮件并发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="cf011-127">Instead of sending the email as part of handling the web request, the details of the email could be placed onto a queue and an Azure Function could be used to pick up the message and send the email.</span></span> <span data-ttu-id="cf011-128">应用程序的许多不同部分甚至许多应用程序都可以利用这一相同的 Azure 功能，为应用程序提供改进的性能和可伸缩性，并使用[基于队列的负载调节](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling)来避免与发送电子邮件相关的瓶颈。</span><span class="sxs-lookup"><span data-stu-id="cf011-128">Many different parts of the application, or even many applications, could leverage this same Azure Function, providing improved performance and scalability for the applications and using [queue-based load leveling](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling) to avoid bottlenecks related to sending the emails.</span></span>

<span data-ttu-id="cf011-129">尽管应用程序和 Azure Functions 之间的[发行者/订户模式](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber)是最常见的模式，但也可以使用其他模式。</span><span class="sxs-lookup"><span data-stu-id="cf011-129">Although a [Publisher/Subscriber pattern](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) between applications and Azure Functions is the most common pattern, other patterns are possible.</span></span> <span data-ttu-id="cf011-130">其他事件（如对 Azure Blob 存储的更改）可以触发 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="cf011-130">Azure Functions can be triggered by other events, such as changes to Azure Blob Storage.</span></span> <span data-ttu-id="cf011-131">支持图像上传的应用程序可能有一个 Azure 函数负责创建缩略图图像，或者将上传的图像大小调整为一致的维度，或者优化图像大小。</span><span class="sxs-lookup"><span data-stu-id="cf011-131">An application that supported image uploads could have an Azure Function responsible for creating thumbnail images, or resizing uploaded images to consistent dimensions, or optimizing image size.</span></span> <span data-ttu-id="cf011-132">所有此功能都可通过插入到 Azure Blob 存储直接触发，使复杂性和工作负荷超出应用程序本身。</span><span class="sxs-lookup"><span data-stu-id="cf011-132">All of this functionality could be triggered directly by inserts to Azure Blob Storage, keeping the complexity and the workload out of the application itself.</span></span>

<span data-ttu-id="cf011-133">许多应用程序将长时间运行的进程作为工作流的一部分。</span><span class="sxs-lookup"><span data-stu-id="cf011-133">Many applications have long-running processes as part of their workflows.</span></span> <span data-ttu-id="cf011-134">通常，这些任务在用户与应用程序交互的过程中完成，并强制用户等待并对其体验产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="cf011-134">Often these tasks are done as part of the user's interaction with the application, forcing the user to wait and negatively impacting their experience.</span></span> <span data-ttu-id="cf011-135">无服务器计算提供在用户交互循环之外执行缓慢任务的极佳方法，这些任务可轻松地按需求进行缩放，而无需整个应用程序进行缩放。</span><span class="sxs-lookup"><span data-stu-id="cf011-135">Serverless computing provides a great way to perform slower tasks outside of the user interaction loop, and these tasks can easily scale with demand without requiring the entire application to scale.</span></span>

## <a name="when-should-you-avoid-serverless"></a><span data-ttu-id="cf011-136">何时应避免无服务器服务器？</span><span class="sxs-lookup"><span data-stu-id="cf011-136">When should you avoid serverless?</span></span>

<span data-ttu-id="cf011-137">对于不阻止用户界面的任务，最好使用无服务器计算。</span><span class="sxs-lookup"><span data-stu-id="cf011-137">Serverless computing is best-used for tasks that don't block the user interface.</span></span> <span data-ttu-id="cf011-138">这意味着它们并不适合直接托管 web 应用程序或 web Api。</span><span class="sxs-lookup"><span data-stu-id="cf011-138">This means they're not ideal for hosting web applications or web APIs directly.</span></span> <span data-ttu-id="cf011-139">导致这种情况的主要原因是，无服务器解决方案按需预配和缩放。</span><span class="sxs-lookup"><span data-stu-id="cf011-139">The main reason for this is that serverless solutions are provisioned and scaled on demand.</span></span> <span data-ttu-id="cf011-140">如果需要函数的新实例（称为*冷启动*），则需要花时间进行设置。</span><span class="sxs-lookup"><span data-stu-id="cf011-140">When a new instance of a function is needed, referred to as a *cold start*, it takes time to provision.</span></span> <span data-ttu-id="cf011-141">此时间通常是几秒钟，但可能会更长，具体取决于各种因素。</span><span class="sxs-lookup"><span data-stu-id="cf011-141">This time is typically a few seconds, but can be longer depending on a variety of factors.</span></span> <span data-ttu-id="cf011-142">单个实例经常会无限期地保持活动状态（例如，通过定期向其发出请求），但如果需要增加实例的数量，则会保留冷启动问题。</span><span class="sxs-lookup"><span data-stu-id="cf011-142">A single instance can often be kept alive indefinitely (for instance, by periodically making a request to it), but the cold start issue remains if the number of instances ever needs to scale up.</span></span>

<span data-ttu-id="cf011-143">![冷启动](./media/cold-start-warm-start.png)
**图 3-10**。</span><span class="sxs-lookup"><span data-stu-id="cf011-143">![Cold versus warm start](./media/cold-start-warm-start.png)
**Figure 3-10**.</span></span> <span data-ttu-id="cf011-144">冷启动和热启动。</span><span class="sxs-lookup"><span data-stu-id="cf011-144">Cold start versus warm start.</span></span>

<span data-ttu-id="cf011-145">如果需要完全避免冷启动，可以选择从[消耗计划切换到专用计划](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)。</span><span class="sxs-lookup"><span data-stu-id="cf011-145">If you need to avoid cold starts entirely, you can choose to switch from a [consumption plan to a dedicated plan](https://azure.microsoft.com/blog/understanding-serverless-cold-start/).</span></span> <span data-ttu-id="cf011-146">你还可以[配置一个或多个](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances)具有高级计划的预准备好实例，因此，当你需要添加另一个实例时，该实例已准备就绪，可以继续。</span><span class="sxs-lookup"><span data-stu-id="cf011-146">You can also [configure one or more pre-warmed instances](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances) with the premium plan so when you need to add another instance, it's already up and ready to go.</span></span> <span data-ttu-id="cf011-147">这些选项可以减少与无服务器计算相关的关键问题之一。</span><span class="sxs-lookup"><span data-stu-id="cf011-147">These options can mitigate one of the key concerns associated with serverless computing.</span></span>

<span data-ttu-id="cf011-148">对于长时间运行的任务，通常还应避免无服务器。</span><span class="sxs-lookup"><span data-stu-id="cf011-148">You should also typically avoid serverless for long-running tasks.</span></span> <span data-ttu-id="cf011-149">它们最适用于可以快速完成的小型工作。</span><span class="sxs-lookup"><span data-stu-id="cf011-149">They're best for small pieces of work that can be completed quickly.</span></span> <span data-ttu-id="cf011-150">大多数无服务器平台需要在几分钟内完成单个功能。</span><span class="sxs-lookup"><span data-stu-id="cf011-150">Most serverless platforms require individual functions to complete within a few minutes.</span></span> <span data-ttu-id="cf011-151">Azure Functions 默认为5分钟的超时持续时间（最多可以配置10分钟）。</span><span class="sxs-lookup"><span data-stu-id="cf011-151">Azure Functions defaults to a 5-minute time-out duration (can be configured up to 10 minutes).</span></span> <span data-ttu-id="cf011-152">Azure Functions 高级计划还可以缓解此问题，默认情况下超时为30分钟，并允许配置无限大限制。</span><span class="sxs-lookup"><span data-stu-id="cf011-152">The Azure Functions premium plan can mitigate this issue as well, defaulting time outs to 30 minutes and allowing an unbounded higher limit to be configured.</span></span>

<span data-ttu-id="cf011-153">最后，为应用程序中的某些任务利用无服务器，增加了复杂性。</span><span class="sxs-lookup"><span data-stu-id="cf011-153">Finally, leveraging serverless for certain tasks within your application adds complexity.</span></span> <span data-ttu-id="cf011-154">通常情况下，最好先以模块化、松散耦合的方式构建应用程序，然后确定是否有无服务器可提供的好处，这使得额外的复杂性更值得。</span><span class="sxs-lookup"><span data-stu-id="cf011-154">It's often best to architect your application in a modular, loosely coupled manner first, and then identify if there are benefits serverless would offer that make the additional complexity worthwhile.</span></span> <span data-ttu-id="cf011-155">许多较小的应用程序在单一单一部署中运行良好，无需分布式应用程序体系结构的无服务器计算要求。</span><span class="sxs-lookup"><span data-stu-id="cf011-155">Many smaller applications will run perfectly well in a single monolithic deployment, without the need for the distributed application architecture serverless computing requires.</span></span>

## <a name="references"></a><span data-ttu-id="cf011-156">参考</span><span class="sxs-lookup"><span data-stu-id="cf011-156">References</span></span>

- [<span data-ttu-id="cf011-157">了解无服务器冷启动</span><span class="sxs-lookup"><span data-stu-id="cf011-157">Understanding serverless cold start</span></span>](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)
- [<span data-ttu-id="cf011-158">准备好 Azure Functions 实例</span><span class="sxs-lookup"><span data-stu-id="cf011-158">Pre-warmed Azure Functions instances</span></span>](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances)
- [<span data-ttu-id="cf011-159">在 Linux 上使用自定义映像创建函数</span><span class="sxs-lookup"><span data-stu-id="cf011-159">Create a function on Linux using a custom image</span></span>](https://docs.microsoft.com/azure/azure-functions/functions-create-function-linux-custom-image)

>[!div class="step-by-step"]
><span data-ttu-id="cf011-160">[上一页](leverage-containers-orchestrators.md)
>[下一页](combine-containers-serverless-approaches.md)</span><span class="sxs-lookup"><span data-stu-id="cf011-160">[Previous](leverage-containers-orchestrators.md)
[Next](combine-containers-serverless-approaches.md)</span></span>
