---
title: Azure 中的数据存储
description: 构建适用于 Azure 的云本机 .NET 应用 |Azure 中的数据存储
ms.date: 06/30/2019
ms.openlocfilehash: 1a86cecf005c6dbdfda5cf4cacfafaad4711c076
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/30/2019
ms.locfileid: "73841893"
---
# <a name="data-storage-in-azure"></a><span data-ttu-id="6c9a0-103">Azure 中的数据存储</span><span class="sxs-lookup"><span data-stu-id="6c9a0-103">Data storage in Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="6c9a0-104">正如我们在本书中看到的那样，云正在改变应用程序的设计、部署和管理方式。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-104">As we've seen throughout this book, the cloud is changing the way applications are designed, deployed, and managed.</span></span> <span data-ttu-id="6c9a0-105">迁移到云时，重要的问题是如何移动数据？</span><span class="sxs-lookup"><span data-stu-id="6c9a0-105">When moving to the cloud, a critical question is how do you move your data?</span></span> <span data-ttu-id="6c9a0-106">幸运的是，Azure 云提供了许多选项。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-106">Fortunately, the Azure cloud offers many options.</span></span>

<span data-ttu-id="6c9a0-107">只需预配 Azure 虚拟机并安装所选的数据库即可。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-107">You could just provision an Azure virtual machine and install your database of choice.</span></span> <span data-ttu-id="6c9a0-108">这称为[基础结构即服务（IaaS）](https://www.techopedia.com/definition/141/infrastructure-as-a-service-iaas)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-108">This is known as [Infrastructure as a Service (IaaS)](https://www.techopedia.com/definition/141/infrastructure-as-a-service-iaas).</span></span> <span data-ttu-id="6c9a0-109">此方法简化了将本地数据库迁移到云中的工作，但又将管理虚拟机和数据库的负担转移到了你。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-109">This approach simplifies moving an on-premises database to the cloud, as-is, but shifts the burden of managing the virtual machine and the database to you.</span></span>

<span data-ttu-id="6c9a0-110">相反，完全托管的[数据库即服务（DBaaS）](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/)是一个更好的选择。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-110">Instead, a fully managed [Database as a Service (DBaaS)](https://www.stratoscale.com/blog/dbaas/what-is-database-as-a-service/) is a better option.</span></span> <span data-ttu-id="6c9a0-111">你获取了许多内置功能，而托管、维护和授权由 Microsoft 管理。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-111">You get many built-in features while the hosting, maintenance, and licensing are managed by Microsoft.</span></span> <span data-ttu-id="6c9a0-112">Azure 具有不同种类的完全托管的数据存储选项，每个选项都有特定的优点。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-112">Azure features different kinds of fully managed data storage options, each with specific benefits.</span></span> <span data-ttu-id="6c9a0-113">它们都支持实时容量和即用即付模型。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-113">They all support just-in-time capacity and a pay-as-you-go model.</span></span>

<span data-ttu-id="6c9a0-114">接下来，我们将了解 Azure 中提供的 DBaaS 选项。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-114">We'll next look at DBaaS options available in Azure.</span></span> <span data-ttu-id="6c9a0-115">你将了解 Microsoft 如何继续为 Azure 提供 "开放平台"，为许多开源关系和 NoSQL 数据库提供托管支持，并为活动成员提供对各种开源基础的关键贡献。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-115">You'll see how Microsoft continues is commitment to keeping Azure an “open platform,” offering managed support for many open-source relational and NoSQL databases and making key contributions to the various open-source foundations as an active member.</span></span>

## <a name="azure-sql-database"></a><span data-ttu-id="6c9a0-116">Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="6c9a0-116">Azure SQL Database</span></span>

<span data-ttu-id="6c9a0-117">[AZURE SQL 数据库](https://docs.microsoft.com/azure/sql-database/)是一种功能丰富的通用关系数据库即服务（DBaaS），基于 Microsoft SQL Server 数据库引擎。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-117">[Azure SQL Database](https://docs.microsoft.com/azure/sql-database/) is a feature-rich, general-purpose relational database-as-a-service (DBaaS) based on the Microsoft SQL Server Database Engine.</span></span> <span data-ttu-id="6c9a0-118">它完全由 Microsoft 管理，并且是高性能、可靠且安全的云数据库。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-118">It's fully managed by Microsoft and is a high-performance, reliable, and secure cloud database.</span></span> <span data-ttu-id="6c9a0-119">该服务共享 SQL Server 的本地版本中发现的许多功能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-119">The service shares many of the features found in the on-premises version of SQL Server.</span></span>

<span data-ttu-id="6c9a0-120">你可以在几分钟内预配 SQL 数据库服务器和数据库。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-120">You can provision a SQL Database server and database in minutes.</span></span> <span data-ttu-id="6c9a0-121">当你的应用程序的需求从几个客户增长到数百万个时，Azure SQL 数据库会动态缩放，并且停机时间最短。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-121">When demand for your application grows from a handful of customers to millions, Azure SQL Database scales on-the-fly with minimal downtime.</span></span> <span data-ttu-id="6c9a0-122">可以动态添加或删除资源，包括 CPU 能力、内存、IO 吞吐量和分配给数据库的存储空间。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-122">You can dynamically add or remove resources, including CPU power, memory, IO throughput, and storage allocated to your databases.</span></span>

<span data-ttu-id="6c9a0-123">图5-12 显示了 Azure SQL 数据库的部署选项。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-123">Figure 5-12 shows the deployment options for Azure SQL Database.</span></span>

![Azure SQL 部署选项](./media/azure-sql-database-deployment-options.png)

<span data-ttu-id="6c9a0-125">**图 5-12**。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-125">**Figure 5-12**.</span></span> <span data-ttu-id="6c9a0-126">Azure SQL 部署选项</span><span class="sxs-lookup"><span data-stu-id="6c9a0-126">Azure SQL deployment options</span></span>

<span data-ttu-id="6c9a0-127">部署 SQL 数据库时，请注意上图中的替代项：</span><span class="sxs-lookup"><span data-stu-id="6c9a0-127">Note the alternatives in the previous figure when deploying a SQL Database:</span></span>

- <span data-ttu-id="6c9a0-128">[单个数据库](https://docs.microsoft.com/azure/sql-database/sql-database-single-database) 包含由[SQL 数据库服务器](https://docs.microsoft.com/azure/sql-database/sql-database-servers)管理的一组资源。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-128">A [Single database](https://docs.microsoft.com/azure/sql-database/sql-database-single-database) with its own set of resources managed by a [SQL Database server](https://docs.microsoft.com/azure/sql-database/sql-database-servers).</span></span> <span data-ttu-id="6c9a0-129">单个数据库类似于在本地 SQL Server 部署中  [包含的数据库](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-129">A single database is similar to a [contained database](https://docs.microsoft.com/sql/relational-databases/databases/contained-databases) in an on-premises SQL Server deployment.</span></span>

- <span data-ttu-id="6c9a0-130">一种[弹性池](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-pool)，其中的 sql 数据库集合按固定价格共享一个 sql 数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-130">An [Elastic pool](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-pool) in which a collection of SQL Databases share a single SQL Database server at a set price.</span></span> <span data-ttu-id="6c9a0-131">可以根据需要将单个数据库移入和移出弹性池，以优化一组数据库的价格性能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-131">Single databases can be moved in and out of an elastic pool as needed to optimize the price performance for a group of databases.</span></span>

- <span data-ttu-id="6c9a0-132">一个[托管实例](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance)，它是系统和用户数据库的集合，提供与本地 SQL Server 近乎100% 的兼容性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-132">A [Managed Instance](https://docs.microsoft.com/azure/sql-database/sql-database-managed-instance) in which is a collection of system and user databases provide near-100% compatibility with an on-premises SQL Server.</span></span> <span data-ttu-id="6c9a0-133">此选项支持较大的数据库，最大可达 35 TB，并将其放在[Azure 虚拟网络](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview)中，以便更好地进行隔离。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-133">This option supports larger databases, up to 35 TB and is placed in an [Azure Virtual Network](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) for better isolation.</span></span>

<span data-ttu-id="6c9a0-134">Azure SQL 数据库是一种完全托管的[平台即服务（PaaS）数据库引擎](https://docs.microsoft.com/azure/sql-database/sql-database-paas)，无需用户干预即可处理升级、修补、备份和监视。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-134">Azure SQL Database is a fully managed [Platform as a Service (PaaS) Database Engine](https://docs.microsoft.com/azure/sql-database/sql-database-paas) that handles upgrading, patching, backups, and monitoring without user involvement.</span></span> <span data-ttu-id="6c9a0-135">它始终运行 SQL Server 的最新稳定版本数据库引擎和修补的操作系统，保证99.99% 的可用性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-135">It always runs the latest stable version of the SQL Server Database Engine and patched OS and guarantees 99.99% availability.</span></span> <span data-ttu-id="6c9a0-136">一项功能，[活动异地复制](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication)可让你在相同或不同的 Azure 数据中心内创建可读的辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-136">One feature, [active geo-replication](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication), lets you create readable secondary databases in the same or a different Azure data center.</span></span> <span data-ttu-id="6c9a0-137">发生故障时，可以启动到辅助数据库的故障转移。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-137">Upon failure, a failover to a secondary database can be initiated.</span></span> <span data-ttu-id="6c9a0-138">此时，其他辅助数据库会自动链接到新的主副本。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-138">At that point, the other secondaries automatically link to the new primary.</span></span> <span data-ttu-id="6c9a0-139">同一区域或不同区域中最多支持四个辅助副本，这些辅助副本也可用于只读访问查询。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-139">Up to four secondary replicas are supported in either the same or in different regions, and these secondaries can also be used for read-only access queries.</span></span>

<span data-ttu-id="6c9a0-140">Azure SQL 数据库包括[内置的监视和智能优化](https://docs.microsoft.com/azure/sql-database/sql-database-monitoring-tuning-index)功能，可帮助你最大限度地提高性能和降低运营成本。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-140">Azure SQL Database includes [built-in monitoring and intelligent tuning](https://docs.microsoft.com/azure/sql-database/sql-database-monitoring-tuning-index) features that can help you maximize performance and reduce operational costs.</span></span> <span data-ttu-id="6c9a0-141">例如，[自动优化](https://docs.microsoft.com/azure/sql-database/sql-database-automatic-tuning)功能基于 AI 和机器学习提供持续的性能优化。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-141">For example, the [Automatic Tuning](https://docs.microsoft.com/azure/sql-database/sql-database-automatic-tuning) feature provides continuous performance tuning based on AI and machine learning.</span></span> <span data-ttu-id="6c9a0-142">该服务从正在运行的工作负荷中学习，并可应用优化建议。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-142">The service learns from your running workloads and can apply tuning recommendations.</span></span> <span data-ttu-id="6c9a0-143">Azure SQL 数据库在启用自动优化的情况下运行的时间越长，性能就越好。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-143">The longer an Azure SQL Database runs with automatic tuning enabled, the better it performs.</span></span>

<span data-ttu-id="6c9a0-144">[AZURE SQL 数据库无服务器](https://docs.microsoft.com/azure/sql-database/sql-database-serverless)（在撰写本书时可用于预览）是单个数据库的计算层，可根据工作负荷需求自动缩放，并按每秒使用的计算量进行计费。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-144">[Azure SQL Database serverless](https://docs.microsoft.com/azure/sql-database/sql-database-serverless) (available for preview at time of the writing of this book) is a compute tier for single databases that automatically scales based on workload demand, and bills for the amount of compute used per second.</span></span> <span data-ttu-id="6c9a0-145">无服务器计算层还会在非活动期间自动暂停数据库，以便只对存储费用收费。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-145">The serverless compute tier also automatically pauses databases during inactive periods so that only storage charges are billed.</span></span> <span data-ttu-id="6c9a0-146">当活动返回时，它将自动恢复。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-146">It automatically resumes when activity returns.</span></span>

<span data-ttu-id="6c9a0-147">最后，还提供了新的[AZURE SQL Database 超大规模](https://azure.microsoft.com/services/sql-database/)定价层。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-147">Finally, there's the new [Azure SQL Database Hyperscale](https://azure.microsoft.com/services/sql-database/) pricing tier.</span></span><span data-ttu-id="6c9a0-148"> 它由高度可扩展的存储体系结构提供支持，并使数据库可根据需要增长，从而无需预配存储资源。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-148"> It's powered by a highly scalable storage architecture and enables your database to grow as needed, eliminating the need to pre-provision storage resources.</span></span> <span data-ttu-id="6c9a0-149">你可以独立缩放计算和存储资源，为每个工作负荷提供优化性能的灵活性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-149">You can scale compute and storage resources independently, providing the flexibility to optimize performance for each workload.</span></span> <span data-ttu-id="6c9a0-150">Azure SQL Database 超大规模针对[OLTP](https://en.wikipedia.org/wiki/Online_transaction_processing)处理和高吞吐量分析工作负荷进行了优化，存储最大为 100 TB。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-150">Azure SQL Database Hyperscale is optimized for [OLTP](https://en.wikipedia.org/wiki/Online_transaction_processing) processing and high throughput analytic workloads with storage up to 100 TB.</span></span><span data-ttu-id="6c9a0-151">  使用读取密集型工作负荷时，超大规模可以根据需要预配额外的读取副本，以卸载读取工作负荷。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-151">  With read-intensive workloads, Hyperscale provides rapid scale-out by provisioning additional read replicas as needed for offloading read workloads.</span></span>

<span data-ttu-id="6c9a0-152">除了传统的 Microsoft SQL Server 堆栈以外，Azure 还提供多个常用开源数据库的托管版本。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-152">In addition to the traditional Microsoft SQL Server stack, Azure also features managed versions of several popular open-source databases.</span></span>

## <a name="azure-database-for-mysql"></a><span data-ttu-id="6c9a0-153">Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="6c9a0-153">Azure Database for MySQL</span></span>

<span data-ttu-id="6c9a0-154">[MySQL](https://en.wikipedia.org/wiki/MySQL) 是 [开源](https://en.wikipedia.org/wiki/Open-source_software) [关系数据库](https://en.wikipedia.org/wiki/Relational_database_management_system)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-154">[MySQL](https://en.wikipedia.org/wiki/MySQL) is an [open-source](https://en.wikipedia.org/wiki/Open-source_software) [relational database](https://en.wikipedia.org/wiki/Relational_database_management_system).</span></span> <span data-ttu-id="6c9a0-155">它是[灯泡软件堆栈](https://en.wikipedia.org/wiki/LAMP_(software_bundle))中的一个组件，由许多大型组织（包括 Facebook、Twitter 和 YouTube）使用。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-155">It's a component in the [LAMP software stack](https://en.wikipedia.org/wiki/LAMP_(software_bundle)) and used by many large organizations, including Facebook, Twitter, and YouTube.</span></span> <span data-ttu-id="6c9a0-156">社区版免费提供，enterprise edition 需要购买许可证。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-156">The community edition is available for free and the enterprise edition requires a license purchase.</span></span> <span data-ttu-id="6c9a0-157">此产品最初是在1995中创建的，它是由的 2008 Sun 购买的，由 Oracle 在2010中获取。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-157">Originally created in 1995, the product was purchased by Sun Microsystems in 2008, which was acquired by Oracle in 2010.</span></span>

<span data-ttu-id="6c9a0-158">[Azure Database for MySQL](https://azure.microsoft.com/services/mysql/)是一项完全托管的企业就绪关系数据库服务，它基于开源 MySQL 服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-158">[Azure Database for MySQL](https://azure.microsoft.com/services/mysql/) is a fully managed, enterprise-ready relational database service based on the open-source MySQL Server engine.</span></span> <span data-ttu-id="6c9a0-159">实现 MySQL 社区版包含以下 PaaS 功能，无需额外付费：</span><span class="sxs-lookup"><span data-stu-id="6c9a0-159">Implementing the MySQL Community edition, it includes the following PaaS capabilities at no additional cost:</span></span>

- <span data-ttu-id="6c9a0-160">内置的[高可用性](https://docs.microsoft.com/azure/mysql/concepts-high-availability)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-160">Built-in [high availability](https://docs.microsoft.com/azure/mysql/concepts-high-availability).</span></span>

- <span data-ttu-id="6c9a0-161">使用非独占即用即[付定价](https://docs.microsoft.com/azure/mysql/concepts-pricing-tiers)可预测的性能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-161">Predictable performance, using inclusive [pay-as-you-go pricing](https://docs.microsoft.com/azure/mysql/concepts-pricing-tiers).</span></span>

- <span data-ttu-id="6c9a0-162">在几秒内根据需要进行[缩放](https://docs.microsoft.com/azure/mysql/concepts-high-availability)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-162">[Scale](https://docs.microsoft.com/azure/mysql/concepts-high-availability) as needed within seconds.</span></span>

- <span data-ttu-id="6c9a0-163">保护以保护静态和动态敏感数据。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-163">Secured to protect sensitive data at-rest and in-motion.</span></span>

- <span data-ttu-id="6c9a0-164">[自动备份](https://docs.microsoft.com/azure/mysql/concepts-backup)和[时间点还原](https://docs.microsoft.com/azure/mysql/concepts-backup)最多35天。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-164">[Automatic backups](https://docs.microsoft.com/azure/mysql/concepts-backup) and [point-in-time-restore](https://docs.microsoft.com/azure/mysql/concepts-backup) for up to 35 days.</span></span>

- <span data-ttu-id="6c9a0-165">企业级安全性和符合性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-165">Enterprise-grade security and compliance.</span></span>

<span data-ttu-id="6c9a0-166">这些内置的 PaaS 功能对于在其数据中心拥有数百个 "战术性" （非战略）数据库的组织非常重要，但没有资源来执行修补、备份、安全和性能监视。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-166">These built-in PaaS features are important for organizations who have hundreds of “tactical" (non-strategic) databases in their data centers, but don't have the resources to perform patching, backup, security, and performance monitoring.</span></span>

<span data-ttu-id="6c9a0-167">此外， [Azure 数据迁移服务](https://azure.microsoft.com/services/database-migration/)可将来自多个数据库源的数据迁移到 Azure 数据平台，并且停机时间最短。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-167">Additionally, the [Azure Data Migration Service](https://azure.microsoft.com/services/database-migration/) can migrate data from multiple database sources to Azure Data platforms with minimal downtime.</span></span> <span data-ttu-id="6c9a0-168">服务将生成评估报告，并提供建议，指导你完成执行迁移所需的更改，这两种情况都很小或大。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-168">The service generates assessment reports and provides recommendations to guide you through the changes required to performing a migration, both small or large.</span></span>

<span data-ttu-id="6c9a0-169">托管的[Azure MySQL 服务器](https://docs.microsoft.com/azure/mysql/concepts-servers)是服务的中心管理点。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-169">The managed [Azure MySQL server](https://docs.microsoft.com/azure/mysql/concepts-servers) is the central administrative point for the service.</span></span> <span data-ttu-id="6c9a0-170">它是用于本地部署的相同 MySQL 服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-170">It's the same MySQL server engine used for on-premises deployments.</span></span> <span data-ttu-id="6c9a0-171">使用它，你可以为每个服务器创建一个数据库来使用所有资源，或者为每个服务器创建多个数据库来共享资源。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-171">With it, you can create a single database per server to consume all resources or create multiple databases per server to share resources.</span></span> <span data-ttu-id="6c9a0-172">你的团队可以继续通过你选择的开源工具和平台来开发应用程序，而无需学习新技能或管理虚拟机和基础结构。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-172">Your team can continue to develop applications with the open-source tools and platform of your choice without having to learn new skills or manage virtual machines and infrastructure.</span></span>

## <a name="azure-database-for-mariadb"></a><span data-ttu-id="6c9a0-173">Azure Database for MariaDB</span><span class="sxs-lookup"><span data-stu-id="6c9a0-173">Azure Database for MariaDB</span></span>

<span data-ttu-id="6c9a0-174">[MariaDB](https://mariadb.com/)服务器是另一个受欢迎的开源数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-174">[MariaDB](https://mariadb.com/) Server is another popular open-source database server.</span></span> <span data-ttu-id="6c9a0-175">它在 Oracle 最初开发的 mysql 开发人员（其拥有 MySQL 的 Sun Microsystems）上创建为 MySQL 的分叉。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-175">It was created as a fork of MySQL by the original developers of MySQL at the time that Oracle purchased Sun Microsystems who owned MySQL.</span></span> <span data-ttu-id="6c9a0-176">目的是确保 MariaDB 保持开源。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-176">The intent was to ensure that MariaDB remained open-source.</span></span>

<span data-ttu-id="6c9a0-177">由于 MariaDB 是[MySQL 的分叉](https://blog.panoply.io/a-comparative-vmariadb-vs-mysql)，因此，数据和表定义是兼容的，客户端协议、结构和 api 是编织的。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-177">Since MariaDB is a [fork of MySQL](https://blog.panoply.io/a-comparative-vmariadb-vs-mysql), the data and table definitions are compatible, and the client protocols, structures, and APIs, are close-knit.</span></span> <span data-ttu-id="6c9a0-178">MySQL 数据连接器无需修改即可 MariaDB 工作。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-178">MySQL data connectors will work MariaDB without modification.</span></span>

<span data-ttu-id="6c9a0-179">MariaDB 具有强大的功能，由许多大型企业使用。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-179">MariaDB has a strong following and is used by many large enterprises.</span></span> <span data-ttu-id="6c9a0-180">尽管 Oracle 继续维护、增强和支持 MySQL，但 MariaDB 由 MariaDB 基础进行管理，允许对产品和文档公开贡献。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-180">While Oracle continues to maintain, enhance and support MySQL, MariaDB is managed by the MariaDB Foundation allowing public contributions to the product and documentation.</span></span>

<span data-ttu-id="6c9a0-181">[Azure Database for MariaDB](https://azure.microsoft.com/services/mariadb/)是 Azure 云中完全托管的数据库即服务。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-181">[Azure Database for MariaDB](https://azure.microsoft.com/services/mariadb/) is a fully managed database as a service in the Azure cloud.</span></span> <span data-ttu-id="6c9a0-182">它基于 [MariaDB 社区版](https://mariadb.org/download/)服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-182">It's based on the [MariaDB community edition](https://mariadb.org/download/) server engine.</span></span> <span data-ttu-id="6c9a0-183">它可以处理具有可预测性能和动态可伸缩性的任务关键型工作负荷。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-183">It can handle mission-critical workloads with predictable performance and dynamic scalability.</span></span> <span data-ttu-id="6c9a0-184">类似于其他 Azure 数据库平台，它包含许多平台即服务功能，无需额外付费：</span><span class="sxs-lookup"><span data-stu-id="6c9a0-184">Similar to the other Azure Database platforms, it includes many Platform-as-a-Service capabilities at no additional cost:</span></span>

- <span data-ttu-id="6c9a0-185">内置的[高可用性](https://docs.microsoft.com/azure/mariadb/concepts-high-availability)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-185">Built-in [high availability](https://docs.microsoft.com/azure/mariadb/concepts-high-availability).</span></span>

- <span data-ttu-id="6c9a0-186">使用非独占即用即[付定价](https://docs.microsoft.com/azure/mariadb/concepts-pricing-tiers)可预测的性能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-186">Predictable performance, using inclusive [pay-as-you-go pricing](https://docs.microsoft.com/azure/mariadb/concepts-pricing-tiers).</span></span>

- <span data-ttu-id="6c9a0-187">在几秒内根据需要进行[缩放](https://docs.microsoft.com/azure/mariadb/concepts-high-availability)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-187">[Scaling](https://docs.microsoft.com/azure/mariadb/concepts-high-availability) as needed within seconds.</span></span>

- <span data-ttu-id="6c9a0-188">保护静态和动态敏感数据的安全。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-188">Secured protection of sensitive data at rest and in-motion.</span></span>

- <span data-ttu-id="6c9a0-189">[自动备份](https://docs.microsoft.com/azure/mariadb/concepts-backup)和[时间点还原](https://docs.microsoft.com/azure/mariadb/concepts-backup)最多35天。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-189">[Automatic backups](https://docs.microsoft.com/azure/mariadb/concepts-backup) and [point-in-time-restore](https://docs.microsoft.com/azure/mariadb/concepts-backup) for up to 35 days.</span></span>

- <span data-ttu-id="6c9a0-190">企业级安全性和符合性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-190">Enterprise-grade security and compliance.</span></span>

## <a name="azure-database-for-postgresql"></a><span data-ttu-id="6c9a0-191">Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="6c9a0-191">Azure Database for PostgreSQL</span></span>

<span data-ttu-id="6c9a0-192">[PostgreSQL](https://www.postgresql.org/)是另一个流行的开源关系数据库，具有30年以上的活动开发。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-192">[PostgreSQL](https://www.postgresql.org/) is another popular, open-source relational database with over 30 years of active development.</span></span> <span data-ttu-id="6c9a0-193">这是一个常规用途和对象关系数据库管理系统。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-193">It's a general purpose and object-relational database management system.</span></span> <span data-ttu-id="6c9a0-194">它的许可被认为是 "自由" 的，产品可免费使用、修改和分发任何形式。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-194">Its licensing is considered to be “liberal” and the product is free to use, modify, and distribute in any form.</span></span> <span data-ttu-id="6c9a0-195">许多大型企业（包括 Apple、Red Hat 和 Fujitsu）都使用 PostgreSQL 构建了产品。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-195">Many large enterprises including Apple, Red Hat, and Fujitsu have built products using PostgreSQL.</span></span>

<span data-ttu-id="6c9a0-196">[Azure Database for PostgreSQL](https://azure.microsoft.com/services/postgresql/)是一项完全托管的关系数据库服务，它基于开源 Postgres 数据库引擎。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-196">[Azure Database for PostgreSQL](https://azure.microsoft.com/services/postgresql/) is a fully managed relational database service, based on the open-source Postgres database engine.</span></span> <span data-ttu-id="6c9a0-197">它可以处理任务关键型工作负荷，并提供可预测的性能、安全性、高可用性和动态可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-197">It can handle mission-critical workloads with predictable performance, security, high availability, and dynamic scalability.</span></span> <span data-ttu-id="6c9a0-198">它支持多种开源框架和语言，包括C++、Java、Python、Node、C\#和 PHP。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-198">It supports several open-source frameworks and languages—including C++, Java, Python, Node, C\#, and PHP.</span></span> <span data-ttu-id="6c9a0-199">它通过命令行接口或[Azure 数据迁移服务](https://azure.microsoft.com/services/database-migration/)实现 PostgreSQL 数据库的[迁移](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-199">It enables [migration](https://datamigration.microsoft.com/scenario/postgresql-to-azurepostgresql?step=1) of PostgreSQL databases through a command-line interface or the [Azure Data Migration Service](https://azure.microsoft.com/services/database-migration/).</span></span>

<span data-ttu-id="6c9a0-200">该服务包含的[内置智能](https://docs.microsoft.com/azure/postgresql/concepts-monitoring)可研究您独特的数据库模式，并提供自定义的建议和见解，帮助您最大程度地提高 PostgreSQL 数据库的性能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-200">The service includes [built-in intelligence](https://docs.microsoft.com/azure/postgresql/concepts-monitoring) that studies your unique database patterns and provides customized recommendations and insights to help you maximize the performance of your PostgreSQL database.</span></span> <span data-ttu-id="6c9a0-201">[高级威胁防护](https://docs.microsoft.com/azure/postgresql/concepts-data-access-and-security-threat-protection)会围绕时钟监视数据库，检测潜在的恶意活动，并在检测时发出警报，以便你可以立即进行干预。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-201">[Advanced Threat Protection](https://docs.microsoft.com/azure/postgresql/concepts-data-access-and-security-threat-protection) monitors your database around the clock and detects potential malicious activities, alerting you upon detection so you can intervene right away.</span></span>

<span data-ttu-id="6c9a0-202">Azure Database for PostgreSQL 提供了两个部署选项：单一服务器和超大规模（Citus），可在本书撰写时预览</span><span class="sxs-lookup"><span data-stu-id="6c9a0-202">Azure Database for PostgreSQL is available as two deployment options: Single Server and Hyperscale (Citus), available for preview at time of the writing of this book</span></span>

- <span data-ttu-id="6c9a0-203">[单服务器](https://docs.microsoft.com/azure/postgresql/concepts-servers)部署选项是多个数据库的中心管理点。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-203">The [Single Server](https://docs.microsoft.com/azure/postgresql/concepts-servers) deployment option is a central administrative point for multiple databases.</span></span> <span data-ttu-id="6c9a0-204">它是可用于本地部署的相同 PostgreSQL 服务器引擎。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-204">It's the same PostgreSQL server engine available for on-premises deployments.</span></span> <span data-ttu-id="6c9a0-205">使用它，你可以为每个服务器创建一个数据库来使用所有资源，或创建多个数据库来共享资源。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-205">With it, you can create a single database per server to consume all resources or create multiple databases to share the resources.</span></span> <span data-ttu-id="6c9a0-206">根据内核和存储，定价按服务器进行组织。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-206">The pricing is structured per-server based upon cores and storage.</span></span>

- <span data-ttu-id="6c9a0-207">[超大规模（Citus）选项](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/)由 [Citus Data](https://www.citusdata.com/) 技术提供支持。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-207">The [Hyperscale (Citus) option](https://azure.microsoft.com/blog/get-high-performance-scaling-for-your-azure-database-workloads-with-hyperscale/) is powered by [Citus Data](https://www.citusdata.com/) technology.</span></span> <span data-ttu-id="6c9a0-208">它通过水平缩放数百个节点上的单个数据库来实现高性能缩放，以提供超快的快速性能和缩放性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-208">It enables high-performance scaling by horizontally scaling a single database across hundreds of nodes to deliver blazingly fast performance and scale.</span></span> <span data-ttu-id="6c9a0-209">此选项允许引擎在内存中容纳更多数据、跨数百个节点进行并行化查询，并更快地为数据编制索引。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-209">This option allows the engine to fit more data in memory, parallelize queries across hundreds of nodes, and index data faster.</span></span> <span data-ttu-id="6c9a0-210">超大规模功能与 PostgreSQL 的最新创新、版本和工具兼容，因此你可以利用现有的 PostgreSQL 专业知识。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-210">The Hyperscale feature is compatible with the latest innovations, versions, and tools for PostgreSQL, so you can leverage your existing PostgreSQL expertise.</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="6c9a0-211">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="6c9a0-211">Cosmos DB</span></span>

<span data-ttu-id="6c9a0-212">Azure Cosmos DB 是一种完全托管的全球分布式 NoSQL 数据库服务，旨在提供低延迟、弹性可伸缩性、托管数据一致性和高可用性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-212">Azure Cosmos DB is a fully managed, globally distributed NoSQL database service that's designed to provide low latency, elastic scalability, managed data consistency, and high availability.</span></span> <span data-ttu-id="6c9a0-213">简而言之，如果你的应用程序需要在世界各地的任何地方保证快速响应时间，则如果需要始终处于联机状态并且需要吞吐量和存储的无限制和弹性可伸缩性，则 Cosmos DB 是一项很好的选择。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-213">In short, if your application needs guaranteed fast response time anywhere in the world, if it's required to be always online and needs unlimited and elastic scalability of throughput and storage, Cosmos DB is a great choice.</span></span> <span data-ttu-id="6c9a0-214">图5-13 显示了 Cosmos DB 的高级概述。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-214">Figure 5-13 shows a high-level overview of Cosmos DB.</span></span>

![Cosmos DB 概述](./media/cosmos-db-overview.png)

<span data-ttu-id="6c9a0-216">**图 5-13**： Cosmos DB 概述</span><span class="sxs-lookup"><span data-stu-id="6c9a0-216">**Figure 5-13**: Overview of Cosmos DB</span></span>

<span data-ttu-id="6c9a0-217">请注意，在图5-13 中，如何 Cosmos DB 是一种功能强大、高度多样的数据库服务，具有许多内置的云本机功能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-217">Note in the Figure 5-13 how Cosmos DB is a robust and highly versatile database service with many built-in cloud-native capabilities.</span></span> <span data-ttu-id="6c9a0-218">在本部分中，我们将详细介绍它们。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-218">In this section, we’ll take a closer look at them.</span></span>

### <a name="global-support"></a><span data-ttu-id="6c9a0-219">全球支持</span><span class="sxs-lookup"><span data-stu-id="6c9a0-219">Global Support</span></span>

<span data-ttu-id="6c9a0-220">你可以在世界各地跨所有 Azure 区域全局分发 Cosmos 数据库，将数据放置到用户附近，缩短响应时间并减少延迟。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-220">You can globally distribute Cosmos databases across all Azure regions across the world, placing data close to your users, improving response time, and reducing latency.</span></span> <span data-ttu-id="6c9a0-221">无需暂停或重新部署应用程序，即可在区域中添加或删除数据库。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-221">You can add or remove a database from a region without pausing or redeploying your application.</span></span> <span data-ttu-id="6c9a0-222">在后台，Cosmos DB 以透明方式将数据复制到所有已配置的区域。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-222">In the background, Cosmos DB transparently replicates the data to all of the configured regions.</span></span>

<span data-ttu-id="6c9a0-223">Cosmos DB 支持全局级别的[主动/主动](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/)群集，使你能够将任何或所有数据库区域配置为支持写入和读取。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-223">Cosmos DB supports [active/active](https://kemptechnologies.com/white-papers/unfog-confusion-active-passive-activeactive-load-balancing/) clustering at the global level, enabling you to configure any or all your database regions to support both writes and reads.</span></span>

<span data-ttu-id="6c9a0-224">Cosmos DB 中的[多主机](https://docs.microsoft.com/azure/cosmos-db/how-to-multi-master)协议功能可实现以下功能：</span><span class="sxs-lookup"><span data-stu-id="6c9a0-224">The [Multi-Master](https://docs.microsoft.com/azure/cosmos-db/how-to-multi-master) protocol feature in Cosmos DB enables the following functionality:</span></span>

- <span data-ttu-id="6c9a0-225">无限制弹性写入和读取可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-225">Unlimited elastic write and read scalability.</span></span>

- <span data-ttu-id="6c9a0-226">99.999 读写所有世界各地的可用性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-226">99.999% read and write availability all around the world.</span></span>

- <span data-ttu-id="6c9a0-227">有保证的读取和写入在99% 百分位的时间不到10毫秒。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-227">Guaranteed reads and writes served in less than 10 milliseconds at the 99th percentile.</span></span>

<span data-ttu-id="6c9a0-228">在内部，Cosmos DB 处理具有一致性级别保证和财务支持的服务级别协议的区域之间的数据复制。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-228">Internally, Cosmos DB handles data replication between regions with consistency level guarantees and financially backed service level agreements.</span></span>

<span data-ttu-id="6c9a0-229">利用 Cosmos DB[多宿主 api](https://docs.microsoft.com/azure/cosmos-db/distribute-data-globally)，你的应用程序可以自动识别最近的 Azure 区域并向其发送请求。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-229">With the Cosmos DB [Multi-Homing APIs](https://docs.microsoft.com/azure/cosmos-db/distribute-data-globally), your application can automatically become aware of the nearest Azure region and send requests to it.</span></span> <span data-ttu-id="6c9a0-230">最近的区域由 Cosmos DB 标识，无需进行任何配置更改。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-230">The nearest region is identified by Cosmos DB without any configuration changes.</span></span> <span data-ttu-id="6c9a0-231">如果某个区域变得不可用，Cosmos DB 支持自动故障转移，并且多宿主功能会自动将请求路由到下一个最近的可用区域。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-231">Should a region become unavailable, Cosmos DB supports automatic failover, and the Multi-Homing feature will automatically route your request to the next nearest available region.</span></span>

### <a name="multi-model-support"></a><span data-ttu-id="6c9a0-232">多模型支持</span><span class="sxs-lookup"><span data-stu-id="6c9a0-232">Multi-Model Support</span></span>

<span data-ttu-id="6c9a0-233">Cosmos DB 是一种*多模型数据平台*，可让你使用多种受支持的 NoSQL 模型与数据进行交互，包括文档、键/值对、宽列和图形表示。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-233">Cosmos DB is a *multi-model data platform* enabling you to interact with your data using a number of supported NoSQL models, including documents, key-value pairs, wide-column, and graph representations.</span></span> <span data-ttu-id="6c9a0-234">在内部，数据以由基元数据类型（包括字符串、布尔和数字）组成的简单[结构](https://docs.microsoft.com/dotnet/csharp/programming-guide/classes-and-structs/using-structs)格式存储。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-234">Internally, data is stored in a simple [struct](https://docs.microsoft.com/dotnet/csharp/programming-guide/classes-and-structs/using-structs) format made up of primitive data types, including strings, bools, and numbers.</span></span> <span data-ttu-id="6c9a0-235">对于每个请求，数据库引擎将数据转换为所选的模型表示形式。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-235">For each request, the database engine translates data into the model representation you have selected.</span></span> <span data-ttu-id="6c9a0-236">可以从基于 SQL 的 Cosmos DB 专有 API 或图5-14 中所示的任何[兼容性 api](https://www.wikiwand.com/en/Cosmos_DB)中进行选择。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-236">You can choose from a proprietary Cosmos DB SQL-based API or any of the [compatibility APIs](https://www.wikiwand.com/en/Cosmos_DB) shown in Figure 5-14.</span></span>

![Cosmos DB 提供程序](./media/cosmos-db-providers.png)

<span data-ttu-id="6c9a0-238">**图 5-14**： Cosmos DB 提供程序</span><span class="sxs-lookup"><span data-stu-id="6c9a0-238">**Figure 5-14**: Cosmos DB providers</span></span>

<span data-ttu-id="6c9a0-239">请注意，如图5-14 如何支持[表存储](https://azure.microsoft.com/services/storage/tables/)Cosmos DB。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-239">Note in Figure 5-14 how Cosmos DB supports [Table Storage](https://azure.microsoft.com/services/storage/tables/).</span></span> <span data-ttu-id="6c9a0-240">Cosmos DB 和[Azure 表存储](https://docs.microsoft.com/azure/cosmos-db/table-storage-overview)共享同一个基础表模型并公开了许多相同的表操作。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-240">Both Cosmos DB and [Azure Table Storage](https://docs.microsoft.com/azure/cosmos-db/table-storage-overview) share the same underlying table model and expose many of the same table operations.</span></span> <span data-ttu-id="6c9a0-241">但是， [Cosmos DB 表 API](https://docs.microsoft.com/azure/cosmos-db/table-introduction)提供了许多在 AZURE 存储 API 中不可用的高级增强功能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-241">However, the [Cosmos DB Table API](https://docs.microsoft.com/azure/cosmos-db/table-introduction) provides many premium enhancements not available in the Azure Storage API.</span></span> <span data-ttu-id="6c9a0-242">这些功能在图5-15 中是相对的。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-242">These features are contrasted in Figure 5-15.</span></span>

![Azure 表 API](./media/azure-table-api.png)

<span data-ttu-id="6c9a0-244">**图 5-15**： Azure 表 API</span><span class="sxs-lookup"><span data-stu-id="6c9a0-244">**Figure 5-15**: Azure Table API</span></span>

<span data-ttu-id="6c9a0-245">为 Azure 表存储编写的应用程序可以使用表 API 迁移到 Azure Cosmos DB，而无任何代码更改。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-245">Applications written for Azure Table storage can migrate to Azure Cosmos DB by using the Table API with no code changes.</span></span>

<span data-ttu-id="6c9a0-246">在[要重建 mqtt](https://en.wikipedia.org/wiki/Brownfield_(software_development))应用程序方案中，开发团队可以将现有的 Mongo、Gremlin 或 Cassandra 数据库迁移到 Cosmos DB，对现有数据或应用程序代码进行少量更改。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-246">In [Brownfield](https://en.wikipedia.org/wiki/Brownfield_(software_development)) application scenarios, development teams can migrate existing Mongo, Gremlin, or Cassandra databases into Cosmos DB with minimal changes to the existing data or application code.</span></span> <span data-ttu-id="6c9a0-247">对于[领域](https://en.wikipedia.org/wiki/Greenfield_project)方案，开发团队可以选择最符合其要求和首选项的数据模型，包括 MongoDB、Cassandra 和 Gremlin 平台的完全受支持的开源选项。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-247">For [Greenfield](https://en.wikipedia.org/wiki/Greenfield_project) scenarios, development teams can choose the data model that best meets their requirements and preferences, including fully supported open-source options for the MongoDB, Cassandra, and Gremlin platforms.</span></span>

### <a name="consistency-models"></a><span data-ttu-id="6c9a0-248">一致性模型</span><span class="sxs-lookup"><span data-stu-id="6c9a0-248">Consistency Models</span></span>

<span data-ttu-id="6c9a0-249">在*关系与 NoSQL*部分的前面部分中，我们讨论了*数据一致性*的主题，这是一个表示数据完整性的术语。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-249">Earlier in the *Relational versus NoSQL* section, we discussed the subject of *data consistency*, which is a term that refers to the integrity of your data.</span></span> <span data-ttu-id="6c9a0-250">依赖于复制以实现高可用性和/或低延迟的分布式数据库必须在读取一致性、可用性和延迟之间做出根本性的权衡。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-250">Distributed databases that rely on replication for high availability, low latency, or both, must make a fundamental tradeoff between read consistency, availability, and latency.</span></span>

<span data-ttu-id="6c9a0-251">大多数分布式数据库允许开发人员在两种一致性模型之间进行选择： [强一致性](https://en.wikipedia.org/wiki/Strong_consistency)和 [最终一致性](https://en.wikipedia.org/wiki/Eventual_consistency)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-251">Most distributed databases allow developers to choose between two consistency models: [strong consistency](https://en.wikipedia.org/wiki/Strong_consistency) and [eventual consistency](https://en.wikipedia.org/wiki/Eventual_consistency).</span></span> <span data-ttu-id="6c9a0-252">*强一致性*是数据可编程性的黄金标准。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-252">*Strong consistency* is the gold standard of data programmability.</span></span> <span data-ttu-id="6c9a0-253">它保证查询结果将始终返回最新的数据，即使系统必须在等待更新复制到所有数据库副本时产生延迟。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-253">It guarantees that a query result will always return the most current data, even if  the system must incur latency waiting for an update to replicate across all database copies.</span></span> <span data-ttu-id="6c9a0-254">另一方面，配置为*最终一致性*的系统会立即返回数据，即使该数据不是最新的副本。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-254">On the other hand, a system configured for *eventual consistency* will return data immediately, even if that data isn't the most current copy.</span></span> <span data-ttu-id="6c9a0-255">此选项可实现更高的可用性、更高的规模和更高的性能。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-255">This option enables higher availability, greater scale, and increased performance.</span></span>

<span data-ttu-id="6c9a0-256">Azure Cosmos DB 提供了一系列[定义完善的一致性模型](https://docs.microsoft.com/azure/cosmos-db/consistency-levels)，如图5-16 所示。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-256">Azure Cosmos DB offers a spectrum of [five well-defined consistency models](https://docs.microsoft.com/azure/cosmos-db/consistency-levels) shown in Figure 5-16.</span></span> <span data-ttu-id="6c9a0-257">这些选项使你能够根据应用程序的需要，对可用性和性能做出精确的选择和精细的权衡。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-257">These options enable you to make precise choices and granular tradeoffs with respect to availability and performance based on the needs of your application.</span></span> <span data-ttu-id="6c9a0-258">这些模型由服务级别协议（Sla）定义完善、直观且受支持。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-258">These models are well-defined, intuitive, and backed by the service level agreements (SLAs).</span></span>

![Cosmos DB 一致性级别](./media/cosmos-db-consistency-levels.png)

<span data-ttu-id="6c9a0-260">**图 5-16**： Cosmos DB 一致性级别</span><span class="sxs-lookup"><span data-stu-id="6c9a0-260">**Figure 5-16**: Cosmos DB Consistency Levels</span></span>

### <a name="partitioning"></a><span data-ttu-id="6c9a0-261">分区</span><span class="sxs-lookup"><span data-stu-id="6c9a0-261">Partitioning</span></span>

<span data-ttu-id="6c9a0-262">Azure Cosmos DB 使用自动[分区](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview)来缩放数据库，以满足应用程序的性能需求。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-262">Azure Cosmos DB uses automatic [partitioning](https://docs.microsoft.com/azure/cosmos-db/partitioning-overview) to scale the database to meet the performance needs of your application.</span></span>

<span data-ttu-id="6c9a0-263">可以通过创建[数据库、容器和项](https://docs.microsoft.com/azure/cosmos-db/databases-containers-items)（如图5-17 所示）来管理 Cosmos DB 数据中的数据。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-263">You manage data in Cosmos DB data by creating [databases, containers, and items](https://docs.microsoft.com/azure/cosmos-db/databases-containers-items), shown in Figure 5-17.</span></span>

![Cosmos DB 实体](./media/cosmos-db-entities.png)

<span data-ttu-id="6c9a0-265">**图 5-17**： Cosmos DB 实体的层次结构</span><span class="sxs-lookup"><span data-stu-id="6c9a0-265">**Figure 5-17**: Hierarchy of Cosmos DB entities</span></span>

<span data-ttu-id="6c9a0-266">请注意，在图5-17 中，如何从在数据库帐户内创建 Cosmos DB 数据库着手。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-266">Note in Figure 5-17 how you start by creating a Cosmos DB database inside of a database account.</span></span> <span data-ttu-id="6c9a0-267">该数据库成为一组容器的管理单元。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-267">That database becomes the unit of management for a set of containers.</span></span> <span data-ttu-id="6c9a0-268">容器是项的架构无关分组，可根据所选的 API 提供程序（前面的部分中所述）表示为集合、表或关系图。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-268">A container is a schema-agnostic grouping of items that can be expressed as a collection, table, or graph, based on your selected API provider (discussed in the prior section).</span></span> <span data-ttu-id="6c9a0-269">项是添加到容器中的数据，表示为文档、行、节点或边缘。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-269">Items are the data that you add to the container and are represented as documents, rows, nodes, or edges.</span></span> <span data-ttu-id="6c9a0-270">默认情况下，你添加到容器中的所有项都将自动编制索引，而无需显式索引或架构管理。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-270">By default, all items that you add to a container are automatically indexed without requiring explicit index or schema management.</span></span>

<span data-ttu-id="6c9a0-271">若要将容器分区，项被分为称为 [逻辑分区](https://docs.microsoft.com/azure/cosmos-db/partition-data)的不同子集。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-271">To partition the container, items are divided into distinct subsets called [logical partitions](https://docs.microsoft.com/azure/cosmos-db/partition-data).</span></span> <span data-ttu-id="6c9a0-272">逻辑分区是根据与容器中每一项关联的分区键的值创建的。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-272">Logical partitions are created based on the value of a partition key that is associated with each item in a container.</span></span> <span data-ttu-id="6c9a0-273">图5-18 显示了逻辑分区中的所有项如何具有相同的分区键值。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-273">Figure 5-18 shows how all items in a logical partition have the same partition key value.</span></span>

![Cosmos DB 分区机制](./media/cosmos-db-partitioning.png)

<span data-ttu-id="6c9a0-275">**图 5-18**： Cosmos DB 分区机制</span><span class="sxs-lookup"><span data-stu-id="6c9a0-275">**Figure 5-18**: Cosmos DB partitioning mechanics</span></span>

<span data-ttu-id="6c9a0-276">请注意，在图5-18 中，每个项都包含 "city" 或 "机场" 的分区键。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-276">Note in Figure 5-18 how each item includes a partition key of either ‘city’ or ‘airport’.</span></span> <span data-ttu-id="6c9a0-277">此分区键确定项的逻辑分区。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-277">This partition key determines the item’s logical partition.</span></span> <span data-ttu-id="6c9a0-278">每个城市代码都将分配给左侧容器中的一个逻辑分区，并将具有机场代码的逻辑分区分配给右侧的容器。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-278">Each city code is assigned to a logical partition in the container on the left-side and those with an airport code to the container on the right.</span></span> <span data-ttu-id="6c9a0-279">将分区键值与项的 ID 值组合将创建项的索引，该索引唯一标识该项。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-279">Combining the partition key value with an item's ID value creates the item's index, which uniquely identifies the item.</span></span>

<span data-ttu-id="6c9a0-280">在内部，Cosmos DB 自动管理[物理分区](https://docs.microsoft.com/azure/cosmos-db/partition-data)上的[逻辑分区](https://docs.microsoft.com/azure/cosmos-db/partition-data)位置，以有效地满足容器的可伸缩性和性能需求。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-280">Internally, Cosmos DB automatically manages the placement of [logical partitions](https://docs.microsoft.com/azure/cosmos-db/partition-data) on [physical partitions](https://docs.microsoft.com/azure/cosmos-db/partition-data) to efficiently satisfy the scalability and performance needs of the container.</span></span> <span data-ttu-id="6c9a0-281">随着应用程序的吞吐量和存储要求的增加，Azure Cosmos DB 会移动逻辑分区，以便在更多的服务器之间重新分发负载。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-281">As the throughput and storage requirements of an application increase, Azure Cosmos DB moves logical partitions to redistribute the load across a greater number of servers.</span></span> <span data-ttu-id="6c9a0-282">这些再分发操作由 Cosmos DB 管理，并在没有任何中断或停机时间的情况下执行。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-282">These redistribution operations are managed by Cosmos DB and are performed without any interruption or downtime.</span></span>

## <a name="azure-redis-cache"></a><span data-ttu-id="6c9a0-283">Azure Redis 缓存</span><span class="sxs-lookup"><span data-stu-id="6c9a0-283">Azure Redis Cache</span></span>

<span data-ttu-id="6c9a0-284">充分了解缓存的优点，提高性能和伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-284">The benefits of caching to improve performance and scalability are well understood.</span></span>

<span data-ttu-id="6c9a0-285">对于云本机应用程序，添加缓存的一个常见位置是在 API 网关中。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-285">For a cloud-native application, a common location to add caching is inside the API Gateway.</span></span> <span data-ttu-id="6c9a0-286">该网关充当所有传入请求的前端。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-286">The gateway serves as a front end for all incoming requests.</span></span> <span data-ttu-id="6c9a0-287">通过添加缓存，可以通过返回缓存的数据，避免到本地数据库或下游服务的往返，提高性能和响应能力。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-287">By adding caching, you can increase performance and responsiveness by returning cached data and avoiding round-trips to a local database or downstream service.</span></span> <span data-ttu-id="6c9a0-288">图5-19 显示了云本机应用程序的缓存体系结构。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-288">Figure 5-19 shows a caching architecture for a cloud-native application.</span></span>

![在云本机应用中缓存](./media/caching-in-a-cloud-native-app.png)

<span data-ttu-id="6c9a0-290">**图 5-19**：在云本机应用中进行缓存</span><span class="sxs-lookup"><span data-stu-id="6c9a0-290">**Figure 5-19**: Caching in a cloud-native app</span></span>

<span data-ttu-id="6c9a0-291">常见的缓存模式是[缓存的模式](https://docs.microsoft.com/azure/architecture/patterns/cache-aside)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-291">A common caching pattern is the [cache-aside pattern](https://docs.microsoft.com/azure/architecture/patterns/cache-aside).</span></span> <span data-ttu-id="6c9a0-292">对于传入请求，先查询缓存中的响应，如图5-19 中的步骤 #1 所示。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-292">For an incoming request, you first query the cache for the response, shown in step #1 in Figure 5-19.</span></span> <span data-ttu-id="6c9a0-293">如果找到，则立即返回数据。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-293">If found, the data is returned immediately.</span></span> <span data-ttu-id="6c9a0-294">如果缓存中不存在数据（称为[缓存未命中](https://www.techopedia.com/definition/6308/cache-miss)），则会从本地数据库或下游服务（步骤 #2）中检索数据，并将其写入缓存供将来请求（步骤 #3），并返回给调用方。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-294">If the data doesn't exist in the cache (known as a [cache miss](https://www.techopedia.com/definition/6308/cache-miss)), it's retrieved from the local database or downstream service (step #2), written to the cache for future requests (step #3), and returned to the caller.</span></span> <span data-ttu-id="6c9a0-295">务必要定期逐出缓存的数据，以便系统保持一致且准确。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-295">Care must be taken to periodically evict cached data so that the system remains consistent and accurate.</span></span>

<span data-ttu-id="6c9a0-296">此外，请注意，图5-19 中的缓存未在服务边界内本地实现，而是作为基于云的支持服务使用，如第1章所述。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-296">Additionally, note in Figure 5-19 how the cache isn't implemented locally within the boundaries of the service, but instead is consumed as a cloud-based backing service, as discussed in Chapter 1.</span></span>

<span data-ttu-id="6c9a0-297">[Azure Redis 缓存](https://azure.microsoft.com/services/cache/)是一种数据缓存和消息代理服务。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-297">[Azure Redis Cache](https://azure.microsoft.com/services/cache/) is a data caching and messaging broker service.</span></span> <span data-ttu-id="6c9a0-298">它为应用程序提供高吞吐量和低延迟的数据访问。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-298">It provides high throughput and low-latency access to data for applications.</span></span> <span data-ttu-id="6c9a0-299">它完全由 Microsoft 托管，托管在 Azure 中，并且可供 Azure 内部或外部的任何应用程序访问。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-299">It's fully managed by Microsoft, hosted within Azure, and accessible to any application within or outside of Azure.</span></span>

<span data-ttu-id="6c9a0-300">在内部，Redis 的 Azure 缓存由开源[Redis 服务器](https://redis.io/)提供支持，并以本机方式支持数据结构，例如[字符串](https://redis.io/topics/data-types#strings)、[哈希](https://redis.io/topics/data-types#hashes)、[列表](https://redis.io/topics/data-types#sets)、[集](https://redis.io/topics/data-types#sets)和[排序集](https://redis.io/topics/data-types#sorted-sets)。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-300">Internally, Azure Cache for Redis is backed by the open-source [Redis server](https://redis.io/) and natively supports data structures such as [strings](https://redis.io/topics/data-types#strings), [hashes](https://redis.io/topics/data-types#hashes), [lists](https://redis.io/topics/data-types#sets), [sets](https://redis.io/topics/data-types#sets), and [sorted sets](https://redis.io/topics/data-types#sorted-sets).</span></span> <span data-ttu-id="6c9a0-301">如果你的应用程序使用 Redis，则它将按原样使用 Azure Cache for Redis。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-301">If your application uses Redis, it will work as-is with Azure Cache for Redis.</span></span>

<span data-ttu-id="6c9a0-302">适用于 Redis 的 Azure 缓存还可用作内存中数据缓存、分布式非关系数据库和消息代理。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-302">Azure Cache for Redis can also be used as an in-memory data cache, a distributed non-relational database, and a message broker.</span></span> <span data-ttu-id="6c9a0-303">它在三个不同的定价层中提供。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-303">It's available in three different pricing tiers.</span></span> <span data-ttu-id="6c9a0-304">高级层的功能包括多种企业级功能，如群集、数据持久性、异地复制，以及虚拟网络安全性和隔离性。</span><span class="sxs-lookup"><span data-stu-id="6c9a0-304">The Premium tier features many enterprise-level features such as clustering, data persistence, geo-replication, and Virtual-network security and isolation.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="6c9a0-305">[上一页](data-patterns.md)
>[下一页](resiliency.md)</span><span class="sxs-lookup"><span data-stu-id="6c9a0-305">[Previous](data-patterns.md)
[Next](resiliency.md)</span></span>
