---
title: SQL Server Express 用户实例
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 00c12376-cb26-4317-86ad-e6e9c089be57
ms.openlocfilehash: f76b1f0a09be2f745156437919f43ebaa8840519
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/22/2019
ms.locfileid: "69938481"
---
# <a name="sql-server-express-user-instances"></a><span data-ttu-id="cc5d7-102">SQL Server Express 用户实例</span><span class="sxs-lookup"><span data-stu-id="cc5d7-102">SQL Server Express User Instances</span></span>
<span data-ttu-id="cc5d7-103">Microsoft SQL Server 学习版 (SQL Server Express) 支持用户实例功能，只有在使用用于 SQL Server 的 .NET Framework 数据提供程序 (`SqlClient`) 时该功能才可用。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-103">Microsoft SQL Server Express Edition (SQL Server Express) supports the user instance feature, which is only available when using the .NET Framework Data Provider for SQL Server (`SqlClient`).</span></span> <span data-ttu-id="cc5d7-104">用户实例是 SQL Server Express 数据库引擎的单独实例，该单独实例由父实例生成。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-104">A user instance is a separate instance of the SQL Server Express Database Engine that is generated by a parent instance.</span></span> <span data-ttu-id="cc5d7-105">不是其本地计算机的管理员的用户可以将用户实例附加和连接到 SQL Server Express 数据库。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-105">User instances allow users who are not administrators on their local computers to attach and connect to SQL Server Express databases.</span></span> <span data-ttu-id="cc5d7-106">在每个用户一个实例的基础上，每个实例在单个用户的安全上下文中运行。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-106">Each instance runs under the security context of the individual user, on a one-instance-per-user basis.</span></span>  
  
## <a name="user-instance-capabilities"></a><span data-ttu-id="cc5d7-107">用户实例功能</span><span class="sxs-lookup"><span data-stu-id="cc5d7-107">User Instance Capabilities</span></span>  
 <span data-ttu-id="cc5d7-108">用户实例对于在最小特权的用户帐户 (LUA) 下运行 Windows 的用户很有用，因为每个用户对在其计算机上运行的实例拥有 SQL Server 系统管理员 (`sysadmin`) 特权，而不必还以 Windows 管理员运行。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-108">User instances are useful for users who are running Windows under a least-privilege user account (LUA) because each user has SQL Server system administrator (`sysadmin`) privileges over the instance running on her computer without needing to run as a Windows administrator as well.</span></span> <span data-ttu-id="cc5d7-109">对具有有限权限的用户实例执行的软件无法进行系统范围的更改，因为 SQL Server Express 的实例在用户的非管理员 Windows 帐户下运行，而不是作为服务运行。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-109">Software executing on a user instance with limited permissions cannot make system-wide changes because the instance of SQL Server Express is running under the non-administrator Windows account of the user, not as a service.</span></span> <span data-ttu-id="cc5d7-110">每个用户实例均独立于其父实例和在同一计算机上运行的其他任何用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-110">Each user instance is isolated from its parent instance and from any other user instances running on the same computer.</span></span> <span data-ttu-id="cc5d7-111">对用户实例运行的数据库仅以单用户模式打开，而多个用户则无法连接到在用户实例上运行的数据库，</span><span class="sxs-lookup"><span data-stu-id="cc5d7-111">Databases running on a user instance are opened in single-user mode only, and it is not possible for multiple users to connect to databases running on a user instance.</span></span> <span data-ttu-id="cc5d7-112">而且还将对用户实例禁用复制和分布式查询。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-112">Replication and distributed queries are also disabled for user instances.</span></span>  
  
 <span data-ttu-id="cc5d7-113">有关更多信息，请参见 SQL Server 2005 联机丛书中的“用户实例”。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-113">For more information, see "User Instances" in SQL Server Books Online.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-114">对于已经是其各自计算机的管理员的用户不需要用户实例，而且对于涉及多个数据库用户的方案也不需要用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-114">User instances are not needed for users who are already administrators on their own computers, or for scenarios involving multiple database users.</span></span>  
  
## <a name="enabling-user-instances"></a><span data-ttu-id="cc5d7-115">启用用户实例</span><span class="sxs-lookup"><span data-stu-id="cc5d7-115">Enabling User Instances</span></span>  
 <span data-ttu-id="cc5d7-116">若要生成用户实例，必须运行 SQL Server Express 的父实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-116">To generate user instances, a parent instance of SQL Server Express must be running.</span></span> <span data-ttu-id="cc5d7-117">默认情况下, 用户实例在安装 SQL Server Express 时处于启用状态, 并且可以由在父实例上执行**sp_configure**系统存储过程的系统管理员显式启用或禁用用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-117">User instances are enabled by default when SQL Server Express is installed, and they can be explicitly enabled or disabled by a system administrator executing the **sp_configure** system stored procedure on the parent instance.</span></span>  
  
```  
-- Enable user instances.  
sp_configure 'user instances enabled','1'   
  
-- Disable user instances.  
sp_configure 'user instances enabled','0'  
```  
  
 <span data-ttu-id="cc5d7-118">用于用户实例的网络协议必须为本地命名管道。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-118">The network protocol for user instances must be local Named Pipes.</span></span> <span data-ttu-id="cc5d7-119">无法对 SQL Server 的远程实例启动用户实例，且不允许使用 SQL Server 登录名。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-119">A user instance cannot be started on a remote instance of SQL Server, and SQL Server logins are not allowed.</span></span>  
  
## <a name="connecting-to-a-user-instance"></a><span data-ttu-id="cc5d7-120">连接到用户实例</span><span class="sxs-lookup"><span data-stu-id="cc5d7-120">Connecting to a User Instance</span></span>  
 <span data-ttu-id="cc5d7-121">`User Instance`和`AttachDBFilename` 关键字允许<xref:System.Data.SqlClient.SqlConnection>连接到用户实例。 <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A></span><span class="sxs-lookup"><span data-stu-id="cc5d7-121">The `User Instance` and `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> keywords allow a <xref:System.Data.SqlClient.SqlConnection> to connect to a user instance.</span></span> <span data-ttu-id="cc5d7-122"><xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` 和 `AttachDBFilename` 属性也支持用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-122">User instances are also supported by the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` and `AttachDBFilename` properties.</span></span>  
  
 <span data-ttu-id="cc5d7-123">请注意如下所示的有关连接字符串示例的内容：</span><span class="sxs-lookup"><span data-stu-id="cc5d7-123">Note the following about the sample connection string shown below:</span></span>  
  
- <span data-ttu-id="cc5d7-124">`Data Source` 关键字是指生成用户实例的 SQL Server Express 的父实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-124">The `Data Source` keyword refers to the parent instance of SQL Server Express that is generating the user instance.</span></span> <span data-ttu-id="cc5d7-125">默认实例为 .\sqlexpress。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-125">The default instance is .\sqlexpress.</span></span>  
  
- <span data-ttu-id="cc5d7-126">将 `Integrated Security` 设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-126">`Integrated Security` is set to `true`.</span></span> <span data-ttu-id="cc5d7-127">若要连接到用户实例，需要 Windows 身份验证；不支持 SQL Server 登录名。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-127">To connect to a user instance, Windows Authentication is required; SQL Server logins are not supported.</span></span>  
  
- <span data-ttu-id="cc5d7-128">`User Instance` 设置为 `true`，这样就可调用用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-128">The `User Instance` is set to `true`, which invokes a user instance.</span></span> <span data-ttu-id="cc5d7-129">（默认值为 `false`。）</span><span class="sxs-lookup"><span data-stu-id="cc5d7-129">(The default is `false`.)</span></span>  
  
- <span data-ttu-id="cc5d7-130">`AttachDbFileName` 连接字符串关键字用于附加主数据库文件 (.mdf)，该文件必须包含完整路径名。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-130">The `AttachDbFileName` connection string keyword is used to attach the primary database file (.mdf), which must include the full path name.</span></span> <span data-ttu-id="cc5d7-131">`AttachDbFileName` 还与 <xref:System.Data.SqlClient.SqlConnection> 连接字符串中的“extended properties”和“initial file name”键相对应。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-131">`AttachDbFileName` also corresponds to the "extended properties" and "initial file name" keys within a <xref:System.Data.SqlClient.SqlConnection> connection string.</span></span>  
  
- <span data-ttu-id="cc5d7-132">包含在管道符号中的 `|DataDirectory|` 替代字符串是指打开连接的应用程序的数据目录，该字符串提供指示 .mdf 和 .ldf 数据库以及日志文件位置的相对路径。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-132">The `|DataDirectory|` substitution string enclosed in the pipe symbols refers to the data directory of the application opening the connection and provides a relative path indicating the location of the .mdf and .ldf database and log files.</span></span> <span data-ttu-id="cc5d7-133">如果要在其他位置查找这些文件，则必须提供这些文件的完整路径。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-133">If you want to locate these files elsewhere, you must provide the full path to the files.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;AttachDBFilename=|DataDirectory|\InstanceDB.mdf;  
Initial Catalog=InstanceDB;  
```  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-134">您也可以使用 <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> 和 <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> 属性在运行时构建连接字符串。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-134">You can also use the <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> properties to build a connection string at run time.</span></span>  
  
### <a name="using-the-124datadirectory124-substitution-string"></a><span data-ttu-id="cc5d7-135">使用&#124;DataDirectory&#124;替换字符串</span><span class="sxs-lookup"><span data-stu-id="cc5d7-135">Using the &#124;DataDirectory&#124; Substitution String</span></span>  
 <span data-ttu-id="cc5d7-136">在 ADO.NET 2.0 中，随着 `AttachDbFileName`（包含在管道符号中）替代字符串的引入，对 `|DataDirectory|` 进行了扩展。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-136">`AttachDbFileName` was extended in ADO.NET 2.0 with the introduction of the `|DataDirectory|` (enclosed in pipe symbols) substitution string.</span></span> <span data-ttu-id="cc5d7-137">`DataDirectory` 与 `AttachDbFileName` 结合使用可指示数据文件的相对路径，从而允许开发人员创建基于数据源的相对路径（而无需指定完整路径）的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-137">`DataDirectory` is used in conjunction with `AttachDbFileName` to indicate a relative path to a data file, allowing developers to create connection strings that are based on a relative path to the data source instead of being required to specify a full path.</span></span>  
  
 <span data-ttu-id="cc5d7-138">`DataDirectory` 点的物理位置取决于应用程序的类型。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-138">The physical location that `DataDirectory` points to depends on the type of application.</span></span> <span data-ttu-id="cc5d7-139">在此示例中，要附加的 Northwind.mdf 文件位于应用程序的 \app_data 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-139">In this example, the Northwind.mdf file to be attached is located in the application's \app_data folder.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;  
AttachDBFilename=|DataDirectory|\app_data\Northwind.mdf;  
Initial Catalog=Northwind;  
```  
  
 <span data-ttu-id="cc5d7-140">使用 `DataDirectory` 时，目录结构中的结果文件的路径不能高于替代字符串指向的目录。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-140">When `DataDirectory` is used, the resulting file path cannot be higher in the directory structure than the directory pointed to by the substitution string.</span></span> <span data-ttu-id="cc5d7-141">例如，如果完全展开的 `DataDirectory` 为 C:\AppDirectory\app_data，则上面显示的示例连接字符串有效，因为它在 c:\AppDirectory 之下。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-141">For example, if the fully expanded `DataDirectory` is C:\AppDirectory\app_data, then the sample connection string shown above works because it is below c:\AppDirectory.</span></span> <span data-ttu-id="cc5d7-142">但是，如果尝试将 `DataDirectory` 指定为 `|DataDirectory|\..\data`，将会产生一个错误，因为 \data 不是 \AppDirectory 的子目录。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-142">However, attempting to specify `DataDirectory` as `|DataDirectory|\..\data` will result in an error because \data is not a subdirectory of \AppDirectory.</span></span>  
  
 <span data-ttu-id="cc5d7-143">如果连接字符串的替代字符串格式不正确，将会引发 <xref:System.ArgumentException>。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-143">If the connection string has an improperly formatted substitution string, an <xref:System.ArgumentException> will be thrown.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-144"><xref:System.Data.SqlClient> 会将替代字符串解析为本地计算机文件系统的完整路径。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-144"><xref:System.Data.SqlClient> resolves the substitution strings into full paths against the local computer file system.</span></span> <span data-ttu-id="cc5d7-145">因此，不支持远程服务器、HTTP 和 UNC 路径名。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-145">Therefore, remote server, HTTP, and UNC path names are not supported.</span></span> <span data-ttu-id="cc5d7-146">如果在服务器未在本地计算机上的情况下打开连接，会引发异常。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-146">An exception is thrown when the connection is opened if the server is not located on the local computer.</span></span>  
  
 <span data-ttu-id="cc5d7-147">打开 <xref:System.Data.SqlClient.SqlConnection> 时，会将其从默认 SQL Server Express 实例重定向到在调用方帐户下运行的已启动运行时的实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-147">When the <xref:System.Data.SqlClient.SqlConnection> is opened, it is redirected from the default SQL Server Express instance to a run-time initiated instance running under the caller's account.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-148">可能需要增大 <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> 值，因为加载用户实例所用时间可能比常规实例所用时间要长。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-148">It may be necessary to increase the <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> value since user instances may take longer to load than regular instances.</span></span>  
  
 <span data-ttu-id="cc5d7-149">以下代码段打开新的 `SqlConnection`，在控制台窗口中显示连接字符串，然后在退出 `using` 代码块时关闭连接。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-149">The following code fragment opens a new `SqlConnection`, displays the connection string in the console window, and then closes the connection when exiting the `using` code block.</span></span>  
  
```vb  
Private Sub OpenSqlConnection()  
    ' Retrieve the connection string.  
    Dim connectionString As String = GetConnectionString()  
  
    Using connection As New SqlConnection(connectionString)  
        connection.Open()  
        Console.WriteLine("ConnectionString: {0}", _  
           connection.ConnectionString)  
    End Using  
End Sub  
```  
  
```csharp  
private static void OpenSqlConnection()  
{  
    // Retrieve the connection string.  
    string connectionString = GetConnectionString();  
  
    using (SqlConnection connection =   
        new SqlConnection(connectionString))  
    {  
        connection.Open();  
        Console.WriteLine("ConnectionString: {0}",   
             connection.ConnectionString);  
    }  
}  
```  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-150">在 SQL Server 内运行的公共语言运行库 (CLR) 代码中不支持用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-150">User instances are not supported in common language runtime (CLR) code that is running inside of SQL Server.</span></span> <span data-ttu-id="cc5d7-151">如果对在连接字符串中具有 <xref:System.InvalidOperationException> 的 `Open` 调用 <xref:System.Data.SqlClient.SqlConnection>，则会引发 `User Instance=true`。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-151">An <xref:System.InvalidOperationException> is thrown if `Open` is called on a <xref:System.Data.SqlClient.SqlConnection> that has `User Instance=true` in the connection string.</span></span>  
  
## <a name="lifetime-of-a-user-instance-connection"></a><span data-ttu-id="cc5d7-152">用户实例连接的生存期</span><span class="sxs-lookup"><span data-stu-id="cc5d7-152">Lifetime of a User Instance Connection</span></span>  
 <span data-ttu-id="cc5d7-153">与作为服务运行的其他 SQL Server 版本不同，SQL Server Express 实例不需要手动启动和停止。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-153">Unlike versions of SQL Server that run as a service, SQL Server Express instances do not need to be manually started and stopped.</span></span> <span data-ttu-id="cc5d7-154">每次用户登录和连接到用户实例时，如果该用户实例尚未运行，则会启动该用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-154">Each time a user logs in and connects to a user instance, the user instance is started if it is not already running.</span></span> <span data-ttu-id="cc5d7-155">用户实例数据库设置 `AutoClose` 选项，这样数据库就会在一段非活动期后自动关闭。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-155">User instance databases have the `AutoClose` option set so that the database is automatically shut down after a period of inactivity.</span></span> <span data-ttu-id="cc5d7-156">已启动的 sqlservr.exe 进程会在实例的上一次连接关闭后的有限超时期限内继续运行，因此，如果在超时过期之前打开了另一连接，则不需要重新启动 sqlservr.exe 进程。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-156">The sqlservr.exe process that is started is kept running for a limited time-out period after the last connection to the instance is closed, so it does not need to be restarted if another connection is opened before the time-out has expired.</span></span> <span data-ttu-id="cc5d7-157">如果在超时过期之前没有打开新连接，则用户实例将自动关闭。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-157">The user instance automatically shuts down if no new connection opens before that time-out period has expired.</span></span> <span data-ttu-id="cc5d7-158">父实例上的系统管理员可以使用**sp_configure**更改**用户实例超时**选项来设置用户实例的超时时间。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-158">A system administrator on the parent instance can set the duration of the time-out period for a user instance by using **sp_configure** to change the **user instance timeout** option.</span></span> <span data-ttu-id="cc5d7-159">默认值为 60 分钟。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-159">The default is 60 minutes.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-160">如果 `Min Pool Size` 用于其值大于 0 的连接字符串中，则连接池将始终保持几个打开的连接，且用户实例将不会自动关闭。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-160">If `Min Pool Size` is used in the connection string with a value greater than zero, the connection pooler will always maintain a few opened connections, and the user instance will not automatically shut down.</span></span>  
  
## <a name="how-user-instances-work"></a><span data-ttu-id="cc5d7-161">用户实例工作方式</span><span class="sxs-lookup"><span data-stu-id="cc5d7-161">How User Instances Work</span></span>  
 <span data-ttu-id="cc5d7-162">首次为每个用户生成用户实例时, **master**和**msdb**系统数据库将从模板数据文件夹复制到用户的本地应用程序数据存储库目录下的路径, 以供用户实例独占使用。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-162">The first time a user instance is generated for each user, the **master** and **msdb** system databases are copied from the Template Data folder to a path under the user's local application data repository directory for exclusive use by the user instance.</span></span> <span data-ttu-id="cc5d7-163">此路径通常为 `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-163">This path is typically `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span></span> <span data-ttu-id="cc5d7-164">启动用户实例时, **tempdb**、日志和跟踪文件也会写入此目录。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-164">When a user instance starts up, the **tempdb**, log, and trace files are also written to this directory.</span></span> <span data-ttu-id="cc5d7-165">将为该实例生成一个名称，且保证此名称对每个用户均是唯一的。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-165">A name is generated for the instance, which is guaranteed to be unique for each user.</span></span>  
  
 <span data-ttu-id="cc5d7-166">默认情况下，会授予 Windows Builtin\Users 组的所有成员在本地实例上连接的权限，以及对 SQL Server 二进制文件进行读取和执行的权限。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-166">By default all members of the Windows Builtin\Users group are granted permissions to connect on the local instance as well as read and execute permissions on the SQL Server binaries.</span></span> <span data-ttu-id="cc5d7-167">验证持有用户实例的调用用户的凭据后，该用户就会成为该实例的 `sysadmin`。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-167">Once the credentials of the calling user hosting the user instance have been verified, that user becomes the `sysadmin` on that instance.</span></span> <span data-ttu-id="cc5d7-168">只为用户实例启用共享内存，这意味着只能对本地计算机执行操作。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-168">Only shared memory is enabled for user instances, which means that only operations on the local machine are possible.</span></span>  
  
 <span data-ttu-id="cc5d7-169">必须授予用户对连接字符串中指定的 .mdf 和 .ldf 文件的读写权限。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-169">Users must be granted both read and write permissions on the .mdf and .ldf files specified in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cc5d7-170">.mdf 和 .ldf 文件分别表示数据库和日志文件。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-170">The .mdf and .ldf files represent the database and log files, respectively.</span></span> <span data-ttu-id="cc5d7-171">这两个文件为一个匹配集，因此在备份和还原操作期间必须小心谨慎。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-171">These two files are a matched set, so care must be taken during backup and restore operations.</span></span> <span data-ttu-id="cc5d7-172">数据库文件包含有关日志文件确切版本的信息，如果数据库与错误的日志文件耦合，则该数据库打不开。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-172">The database file contains information about the exact version of the log file, and the database will not open if it is coupled with the wrong log file.</span></span>  
  
 <span data-ttu-id="cc5d7-173">若要避免数据损坏，则应使用独占访问权打开用户实例中的数据库。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-173">To avoid data corruption, a database in the user instance is opened with exclusive access.</span></span> <span data-ttu-id="cc5d7-174">如果两个不同的用户实例共享同一计算机上的同一个数据库，则第一个实例上的用户必须在关闭该数据库后，才能在第二个实例中打开该数据库。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-174">If two different user instances share the same database on the same computer, the user on the first instance must close the database before it can be opened in a second instance.</span></span>  
  
## <a name="user-instance-scenarios"></a><span data-ttu-id="cc5d7-175">用户实例方案</span><span class="sxs-lookup"><span data-stu-id="cc5d7-175">User Instance Scenarios</span></span>  
 <span data-ttu-id="cc5d7-176">用户实例向数据库应用程序开发人员提供 SQL Server 数据存储区，该数据存储区不依赖于在开发计算机上拥有管理员帐户的开发人员。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-176">User instances provide developers of database applications with a SQL Server data store that does not depend on developers having administrative accounts on their development computers.</span></span> <span data-ttu-id="cc5d7-177">用户实例基于 Access/Jet 模型，在该模型中，数据库应用程序仅连接到某个文件，且用户会自动拥有对所有数据库对象的完全权限，而无需系统管理员干预来授予权限。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-177">User instances are based on the Access/Jet model, where the database application simply connects to a file, and the user automatically has full permissions on all of the database objects without needing the intervention of a system administrator to grant permissions.</span></span> <span data-ttu-id="cc5d7-178">用户实例应在以下情形中工作：用户在最小特权的用户帐户 (LUA) 下运行，没有对服务器或本地计算机的管理员权限，但需要创建数据库对象和应用程序。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-178">It is intended to work in situations where the user is running under a least-privilege user account (LUA) and does not have administrative privileges on the server or local machine, yet needs to create database objects and applications.</span></span> <span data-ttu-id="cc5d7-179">用户实例允许用户在运行时创建在用户自己的安全上下文中运行的实例，而不是在较大权限系统服务的安全上下文中运行的实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-179">User instances allow users to create instances at run time that run under the user's own security context, and not in the security context of a more privileged system service.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="cc5d7-180">仅当所有使用应用程序均完全受信任时，才应使用用户实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-180">User instances should only be used in scenarios where all the applications using it are fully trusted.</span></span>  
  
 <span data-ttu-id="cc5d7-181">用户实例方案包括：</span><span class="sxs-lookup"><span data-stu-id="cc5d7-181">User instance scenarios include:</span></span>  
  
- <span data-ttu-id="cc5d7-182">不需要共享数据的任何单用户应用程序。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-182">Any single-user application where sharing data is not required.</span></span>  
  
- <span data-ttu-id="cc5d7-183">ClickOnce 部署。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-183">ClickOnce deployment.</span></span> <span data-ttu-id="cc5d7-184">如果 .NET Framework 2.0（或更高版本）和 SQL Server Express 已安装在目标计算机上，则可以由非管理员用户安装并使用通过 ClickOnce 操作而下载的安装程序包。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-184">If the .NET Framework 2.0 (or later) and SQL Server Express are already installed on the target computer, the installation package downloaded as a result of a ClickOnce action can be installed and used by non-administrator users.</span></span> <span data-ttu-id="cc5d7-185">请注意，如果 SQL Server Express 为安装程序的一部分，则管理员必须安装 SQL Server Express。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-185">Note that an administrator must install SQL Server Express if that is part of the setup.</span></span> <span data-ttu-id="cc5d7-186">有关详细信息, 请参阅[ClickOnce Deployment for Windows 窗体](../../../winforms/clickonce-deployment-for-windows-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-186">For more information, see [ClickOnce Deployment for Windows Forms](../../../winforms/clickonce-deployment-for-windows-forms.md).</span></span>
  
- <span data-ttu-id="cc5d7-187">使用 Windows 身份验证的专用 ASP.NET 宿主。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-187">Dedicated ASP.NET hosting using Windows Authentication.</span></span> <span data-ttu-id="cc5d7-188">Intranet 上可以承载单个 SQL Server Express 实例。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-188">A single SQL Server Express instance can be hosted on an intranet.</span></span> <span data-ttu-id="cc5d7-189">应用程序使用 ASPNET Windows 帐户进行连接，而不是使用模拟进行连接。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-189">The application connects using the ASPNET Windows account, not by using impersonation.</span></span> <span data-ttu-id="cc5d7-190">用户实例不应用于第三方或共享宿主方案中，在这样的方案中，所有应用程序将共享同一用户实例，而不再保持彼此独立。</span><span class="sxs-lookup"><span data-stu-id="cc5d7-190">User instances should not be used for third-party or shared hosting scenarios where all applications would share the same user instance and would no longer remain isolated from each other.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cc5d7-191">请参阅</span><span class="sxs-lookup"><span data-stu-id="cc5d7-191">See also</span></span>

- [<span data-ttu-id="cc5d7-192">SQL Server 和 ADO.NET</span><span class="sxs-lookup"><span data-stu-id="cc5d7-192">SQL Server and ADO.NET</span></span>](../../../../../docs/framework/data/adonet/sql/index.md)
- [<span data-ttu-id="cc5d7-193">连接字符串</span><span class="sxs-lookup"><span data-stu-id="cc5d7-193">Connection Strings</span></span>](../../../../../docs/framework/data/adonet/connection-strings.md)
- [<span data-ttu-id="cc5d7-194">连接到数据源</span><span class="sxs-lookup"><span data-stu-id="cc5d7-194">Connecting to a Data Source</span></span>](../../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)
- [<span data-ttu-id="cc5d7-195">ADO.NET 托管提供程序和数据集开发人员中心</span><span class="sxs-lookup"><span data-stu-id="cc5d7-195">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
