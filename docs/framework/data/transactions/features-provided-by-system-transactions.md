---
title: 由 System.Transactions 提供的功能
ms.date: 03/30/2017
ms.assetid: e458cef9-63b5-4401-b448-1536dcd9d9e5
ms.openlocfilehash: 75277090652cd439d3466a307790f4b918ddb090
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "64645717"
---
# <a name="features-provided-by-systemtransactions"></a><span data-ttu-id="6fb17-102">由 System.Transactions 提供的功能</span><span class="sxs-lookup"><span data-stu-id="6fb17-102">Features Provided by System.Transactions</span></span>
<span data-ttu-id="6fb17-103">本节描述如何使用 <xref:System.Transactions> 命名空间所提供的功能编写您自己的事务应用程序和资源管理器。</span><span class="sxs-lookup"><span data-stu-id="6fb17-103">This section describes how you can use the features provided by the <xref:System.Transactions> namespace to write your own transactional application and resource manager.</span></span> <span data-ttu-id="6fb17-104">具体来说，本节介绍如何创建事务（本地或分布式事务）并与一个或多个参与者一起参与该事务。</span><span class="sxs-lookup"><span data-stu-id="6fb17-104">Specifically, this section covers how to create and participate in a transaction (local or distributed) with one or multiple participants.</span></span>  
  
## <a name="overview-of-systemtransactions"></a><span data-ttu-id="6fb17-105">System.Transactions 概述</span><span class="sxs-lookup"><span data-stu-id="6fb17-105">Overview of System.Transactions</span></span>  
 <span data-ttu-id="6fb17-106"><xref:System.Transactions> 命名空间中的类所提供的基础结构通过支持在 SQL Server、ADO.NET、消息队列 (MSMQ) 和 Microsoft 分布式事务协调器 (MSDTC) 中启动的事务，使事务编程变得简单和高效。</span><span class="sxs-lookup"><span data-stu-id="6fb17-106">The infrastructure provided by the classes in the <xref:System.Transactions> namespace makes transactional programming simple and efficient by supporting transactions initiated in SQL Server, ADO.NET, Message Queuing (MSMQ), and the Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="6fb17-107"><xref:System.Transactions> 命名空间提供基于 <xref:System.Transactions.Transaction> 类的显式编程模型和使用 <xref:System.Transactions.TransactionScope> 类的隐式编程模型，在后一种模型中，事务由该基础结构自动管理。</span><span class="sxs-lookup"><span data-stu-id="6fb17-107">The <xref:System.Transactions> namespace provides both an explicit programming model based on the <xref:System.Transactions.Transaction> class, as well as an implicit programming model using the <xref:System.Transactions.TransactionScope> class, in which transactions are automatically managed by the infrastructure.</span></span> <span data-ttu-id="6fb17-108">有关如何创建事务应用程序使用这两种模型的详细信息，请参阅[编写事务应用程序](../../../../docs/framework/data/transactions/writing-a-transactional-application.md)。</span><span class="sxs-lookup"><span data-stu-id="6fb17-108">For more information on how to create a transactional application using these two models, see [Writing a Transactional Application](../../../../docs/framework/data/transactions/writing-a-transactional-application.md).</span></span>  
  
 <span data-ttu-id="6fb17-109">此外，<xref:System.Transactions> 命名空间还提供了用于实现资源管理器的类型。</span><span class="sxs-lookup"><span data-stu-id="6fb17-109">The <xref:System.Transactions> namespace also provides types for you to implement a resource manager.</span></span> <span data-ttu-id="6fb17-110">资源管理器管理事务中使用的持久或可变数据，并与事务管理器协调工作，共同为应用程序提供了原子性和隔离性的保证。</span><span class="sxs-lookup"><span data-stu-id="6fb17-110">A resource manager manages durable or volatile data used in a transaction, and work in cooperation with the transaction manager to provide the application with a guarantee of atomicity and isolation.</span></span> <span data-ttu-id="6fb17-111">由 <xref:System.Transactions> 基础结构提供的事务管理器支持的事务可涉及到多个可变资源或单个持久资源。</span><span class="sxs-lookup"><span data-stu-id="6fb17-111">The transaction manager that is provided by the <xref:System.Transactions> infrastructure supports transactions involving multiple volatile resources or a single durable resource.</span></span> <span data-ttu-id="6fb17-112">有关实现资源管理器的详细信息，请参阅[实现资源管理器](../../../../docs/framework/data/transactions/implementing-a-resource-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="6fb17-112">For more information on implementing a resource manager, see [Implementing a Resource Manager](../../../../docs/framework/data/transactions/implementing-a-resource-manager.md).</span></span>  
  
 <span data-ttu-id="6fb17-113">此外，事务管理器还通过与基于磁盘的事务管理器（如 DTC）进行协调，透明地将本地事务升级为分布式事务，此时另一个持久资源管理器会将自身登记到事务中。</span><span class="sxs-lookup"><span data-stu-id="6fb17-113">The transaction manager also transparently escalates local transactions to distributed transactions by coordinating with a disk-based transaction manager like the DTC, when an additional durable resource manager enlists itself with a transaction.</span></span> <span data-ttu-id="6fb17-114"><xref:System.Transactions> 基础结构提供增强性能的关键方式有两种。</span><span class="sxs-lookup"><span data-stu-id="6fb17-114">There are two key ways that the <xref:System.Transactions> infrastructure provides enhanced performance.</span></span>  
  
- <span data-ttu-id="6fb17-115">动态升级，它可确保事务跨多个分布式资源时 <xref:System.Transactions> 基础结构仅使用 MSDTC。</span><span class="sxs-lookup"><span data-stu-id="6fb17-115">Dynamic Escalation, which ensures that the <xref:System.Transactions> infrastructure only engages the MSDTC when a transaction spans across multiple distributed resources.</span></span> <span data-ttu-id="6fb17-116">有关动态升级的更多信息。</span><span class="sxs-lookup"><span data-stu-id="6fb17-116">For more information about dynamic escalation.</span></span> <span data-ttu-id="6fb17-117">请参阅[Transaction Management Escalation](../../../../docs/framework/data/transactions/transaction-management-escalation.md)主题。</span><span class="sxs-lookup"><span data-stu-id="6fb17-117">see [Transaction Management Escalation](../../../../docs/framework/data/transactions/transaction-management-escalation.md) topic.</span></span>  
  
- <span data-ttu-id="6fb17-118">可提升的登记，如果某个资源是参与事务的唯一实体，则允许该资源（如数据库）取得事务的所有权。</span><span class="sxs-lookup"><span data-stu-id="6fb17-118">Promotable Enlistments, which allows a resource, such as a database, to take ownership of the transaction if it is the only entity participating in the transaction.</span></span> <span data-ttu-id="6fb17-119">以后在需要时，<xref:System.Transactions> 基础结构仍然可以将事务管理升级到 MSDTC。</span><span class="sxs-lookup"><span data-stu-id="6fb17-119">Later, if needed, the <xref:System.Transactions> infrastructure can still escalate the management of the transaction to the MSDTC.</span></span> <span data-ttu-id="6fb17-120">这样进一步减少了使用 MSDTC 的机会。</span><span class="sxs-lookup"><span data-stu-id="6fb17-120">This further reduces the chance of using the MSDTC.</span></span> <span data-ttu-id="6fb17-121">在本主题中的深度中详细介绍了可提升登记[优化使用 Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md)。</span><span class="sxs-lookup"><span data-stu-id="6fb17-121">Promotable Enlistments are covered in depth in the topic[Optimization using Single Phase Commit and Promotable Single Phase Notification](../../../../docs/framework/data/transactions/optimization-spc-and-promotable-spn.md).</span></span>  
  
 <span data-ttu-id="6fb17-122"><xref:System.Transactions> 命名空间定义了三种限制访问它所公开的资源类型的信任级别：AllowPartiallyTrustedCallers (APTCA)、DistributedTransactionPermission(DTP) 和完全信任。</span><span class="sxs-lookup"><span data-stu-id="6fb17-122">The <xref:System.Transactions> namespace defines three levels of trust - AllowPartiallyTrustedCallers (APTCA), DistributedTransactionPermission(DTP) and full trust - that restrict access to the types of resources it exposes.</span></span> <span data-ttu-id="6fb17-123">有关详细信息的各种信任级别，请参阅[中访问资源的安全信任级别](../../../../docs/framework/data/transactions/security-trust-levels-in-accessing-resources.md)。</span><span class="sxs-lookup"><span data-stu-id="6fb17-123">For more information on the various trust levels, see [Security Trust Levels in Accessing Resources](../../../../docs/framework/data/transactions/security-trust-levels-in-accessing-resources.md).</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="6fb17-124">本节内容</span><span class="sxs-lookup"><span data-stu-id="6fb17-124">In this section</span></span>  
  
### <a name="writing-a-transactional-application"></a><span data-ttu-id="6fb17-125">编写事务应用程序</span><span class="sxs-lookup"><span data-stu-id="6fb17-125">Writing A Transactional Application</span></span>  
 <span data-ttu-id="6fb17-126"><xref:System.Transactions> 命名空间提供了两种用于创建事务应用程序的模型。</span><span class="sxs-lookup"><span data-stu-id="6fb17-126">The <xref:System.Transactions> namespace provides two models for creating transactional applications.</span></span> <span data-ttu-id="6fb17-127">[实现隐式事务使用事务作用域](../../../../docs/framework/data/transactions/implementing-an-implicit-transaction-using-transaction-scope.md)介绍了如何<xref:System.Transactions>命名空间支持创建隐式事务使用<xref:System.Transactions.TransactionScope>类。</span><span class="sxs-lookup"><span data-stu-id="6fb17-127">[Implementing an Implicit Transaction using Transaction Scope](../../../../docs/framework/data/transactions/implementing-an-implicit-transaction-using-transaction-scope.md) describes how the <xref:System.Transactions> namespace supports creating implicit transactions using the <xref:System.Transactions.TransactionScope> class.</span></span>  
  
 <span data-ttu-id="6fb17-128">[使用 committabletransaction 执行显式事务](../../../../docs/framework/data/transactions/implementing-an-explicit-transaction-using-committabletransaction.md)介绍了如何<xref:System.Transactions>命名空间支持创建显式事务使用<xref:System.Transactions.CommittableTransaction>类。</span><span class="sxs-lookup"><span data-stu-id="6fb17-128">[Implementing an Explicit Transaction using CommittableTransaction](../../../../docs/framework/data/transactions/implementing-an-explicit-transaction-using-committabletransaction.md) describes how the <xref:System.Transactions> namespace supports creating explicit transactions using the <xref:System.Transactions.CommittableTransaction> class.</span></span>  
  
 <span data-ttu-id="6fb17-129">有关介绍事务应用程序编写的其他主题，请参阅[编写事务应用程序](../../../../docs/framework/data/transactions/writing-a-transactional-application.md)。</span><span class="sxs-lookup"><span data-stu-id="6fb17-129">For additional topics covering writing a transactional application, see [Writing a Transactional Application](../../../../docs/framework/data/transactions/writing-a-transactional-application.md).</span></span>  
  
### <a name="implementing-a-resource-manager"></a><span data-ttu-id="6fb17-130">实现资源管理器</span><span class="sxs-lookup"><span data-stu-id="6fb17-130">Implementing A Resource Manager</span></span>  
 <span data-ttu-id="6fb17-131">若要在事务中实现可参与的资源管理器，请参阅[实现资源管理器](../../../../docs/framework/data/transactions/implementing-a-resource-manager.md)。</span><span class="sxs-lookup"><span data-stu-id="6fb17-131">To implement a resource manager that can participate in a transaction, see [Implementing a Resource Manager](../../../../docs/framework/data/transactions/implementing-a-resource-manager.md).</span></span> <span data-ttu-id="6fb17-132">该节将介绍资源登记、事务提交、故障后恢复以及最佳优化实践。</span><span class="sxs-lookup"><span data-stu-id="6fb17-132">This section covers the enlistment of a resource, committing a transaction, recovery after failure, and optimization best practices.</span></span>
