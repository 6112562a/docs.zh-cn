---
title: WCF 数据服务的安全
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: 0fd966d696e08c74185dc2c3859fd74d90933296
ms.sourcegitcommit: d2ccb199ae6bc5787b4762e9ea6d3f6fe88677af
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/12/2019
ms.locfileid: "56092691"
---
# <a name="securing-wcf-data-services"></a><span data-ttu-id="d9271-102">WCF 数据服务的安全</span><span class="sxs-lookup"><span data-stu-id="d9271-102">Securing WCF Data Services</span></span>
<span data-ttu-id="d9271-103">本主题介绍开发、部署和运行访问支持 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] 的服务的 [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)]和应用程序的特定安全注意事项。</span><span class="sxs-lookup"><span data-stu-id="d9271-103">This topic describes security considerations that are specific to developing, deploying, and running [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] and applications that access services that support the [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)].</span></span> <span data-ttu-id="d9271-104">除此之外，您还应遵循有关创建安全的 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 应用程序的建议。</span><span class="sxs-lookup"><span data-stu-id="d9271-104">You should also follow recommendations for creating secure [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications.</span></span>  
  
 <span data-ttu-id="d9271-105">在计划如何保证基于 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]的 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] 服务的安全时，必须同时解决身份验证和授权问题，前者是发现和验证主体身份的过程，后者是确定是否允许经过身份验证的主体访问所请求资源的过程。</span><span class="sxs-lookup"><span data-stu-id="d9271-105">When planning how to secure a [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]-based [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service, you must address both authentication, the process of discovering and verifying the identity of a principal, and authorization, the process of determining whether an authenticated principal is allowed to access the requested resources.</span></span> <span data-ttu-id="d9271-106">还应当考虑是否使用 SSL 来加密消息。</span><span class="sxs-lookup"><span data-stu-id="d9271-106">You should also consider whether to encrypt the message by using SSL.</span></span>  
  
## <a name="authenticating-client-requests"></a><span data-ttu-id="d9271-107">对客户端请求进行身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-107">Authenticating Client Requests</span></span>  
 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]<span data-ttu-id="d9271-108">本身不实现任何类型的身份验证，而是依赖数据服务宿主的身份验证设置。</span><span class="sxs-lookup"><span data-stu-id="d9271-108">does not implement any kind of authentication of its own, but rather relies on the authentication provisions of the data service host.</span></span> <span data-ttu-id="d9271-109">这意味着服务将假定它接收到的任何请求已由网络主机进行了身份验证，并且该主机通过 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]提供的相应接口正确识别了请求的主体。</span><span class="sxs-lookup"><span data-stu-id="d9271-109">This means that the service assumes that any request that it receives has already been authenticated by the network host and that the host has correctly identified the principle for the request appropriately via the interfaces provided by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span></span> <span data-ttu-id="d9271-110">中详细介绍了这些身份验证选项和方法[OData 和身份验证系列](https://go.microsoft.com/fwlink/?LinkId=200381)。</span><span class="sxs-lookup"><span data-stu-id="d9271-110">These authentication options and approaches are detailed in [OData and Authentication series](https://go.microsoft.com/fwlink/?LinkId=200381).</span></span>  
  
### <a name="authentication-options-for-a-wcf-data-service"></a><span data-ttu-id="d9271-111">WCF 数据服务的身份验证选项</span><span class="sxs-lookup"><span data-stu-id="d9271-111">Authentication Options for a WCF Data Service</span></span>  
 <span data-ttu-id="d9271-112">下表列出了一些可用来对发向 WCF 数据服务的请求进行身份验证的身份验证机制。</span><span class="sxs-lookup"><span data-stu-id="d9271-112">The following table lists some of the authentication mechanisms that are available to help you authenticate requests to a WCF Data Service.</span></span>  
  
|<span data-ttu-id="d9271-113">身份验证选项</span><span class="sxs-lookup"><span data-stu-id="d9271-113">Authentication Options</span></span>|<span data-ttu-id="d9271-114">描述</span><span class="sxs-lookup"><span data-stu-id="d9271-114">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="d9271-115">匿名身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-115">Anonymous authentication</span></span>|<span data-ttu-id="d9271-116">启用 HTTP 匿名身份验证时，任何主体都能连接到数据服务。</span><span class="sxs-lookup"><span data-stu-id="d9271-116">When HTTP anonymous authentication is enabled, any principle is able to connect to the data service.</span></span> <span data-ttu-id="d9271-117">匿名访问无需凭据。</span><span class="sxs-lookup"><span data-stu-id="d9271-117">Credentials are not required for anonymous access.</span></span> <span data-ttu-id="d9271-118">仅当希望允许任何人访问数据服务时，才使用此选项。</span><span class="sxs-lookup"><span data-stu-id="d9271-118">Use this option only when you want to allow anyone to access the data service.</span></span>|  
|<span data-ttu-id="d9271-119">基本和摘要式身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-119">Basic and digest authentication</span></span>|<span data-ttu-id="d9271-120">需要由用户名和密码组成的凭据以进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-120">Credentials consisting of a user name and password are required for authentication.</span></span> <span data-ttu-id="d9271-121">支持非 Windows 客户端的身份验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-121">Supports authentication of non-Windows clients.</span></span> <span data-ttu-id="d9271-122">**安全说明：** 基本身份验证凭据（用户名和密码）以明文形式发送，会被截取。</span><span class="sxs-lookup"><span data-stu-id="d9271-122">**Security Note:**  Basic authentication credentials (user name and password) are sent in the clear and can be intercepted.</span></span> <span data-ttu-id="d9271-123">摘要式身份验证基于所提供的凭据发送一个哈希值，因而比基本身份验证更安全。</span><span class="sxs-lookup"><span data-stu-id="d9271-123">Digest authentication sends a hash based-on the supplied credentials, which makes it more secure than basic authentication.</span></span> <span data-ttu-id="d9271-124">这两者都容易受到中间人攻击。</span><span class="sxs-lookup"><span data-stu-id="d9271-124">Both are susceptible to man-in-the-middle attacks.</span></span> <span data-ttu-id="d9271-125">使用这些身份验证方法时，应考虑使用安全套接字层 (SSL) 加密客户端与数据服务之间的通信。</span><span class="sxs-lookup"><span data-stu-id="d9271-125">When using these authentication methods, you should consider encrypting communication between client and the data service by using the Secure Sockets Layer (SSL).</span></span> <br /><br /> <span data-ttu-id="d9271-126">Microsoft Internet Information Services (IIS) 为 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 应用程序中的 HTTP 请求提供了一种同时包含基本和摘要式身份验证的实现。</span><span class="sxs-lookup"><span data-stu-id="d9271-126">Microsoft Internet Information Services (IIS) provides an implementation of both basic and digest authentication for HTTP requests in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="d9271-127">该 Windows 身份验证提供程序实现允许 .NET Framework 客户端应用程序在发给数据服务的请求的 HTTP 标头中提供凭据，以无缝协商 Windows 用户的身份验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-127">This Windows Authentication Provider implementation enables a .NET Framework client application to supply credentials in the HTTP header of the request to the data service to seamlessly negotiate authentication of a Windows user.</span></span> <span data-ttu-id="d9271-128">有关详细信息，请参阅[摘要式身份验证技术参考](https://go.microsoft.com/fwlink/?LinkId=200408)。</span><span class="sxs-lookup"><span data-stu-id="d9271-128">For more information, see [Digest Authentication Technical Reference](https://go.microsoft.com/fwlink/?LinkId=200408).</span></span><br /><br /> <span data-ttu-id="d9271-129">如果希望使数据服务使用基于某种自定义身份验证服务的基本身份验证，而不是 Windows 凭据，则必须为身份验证实现一个自定义 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] HTTP 模块。</span><span class="sxs-lookup"><span data-stu-id="d9271-129">When you want to have your data service use basic authentication based on some custom authentication service and not Windows credentials, you must implement a custom [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] HTTP Module for authentication.</span></span><br /><br /> <span data-ttu-id="d9271-130">有关如何使用自定义的基本身份验证方案的示例[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]，请参阅上的帖子[自定义基本身份验证](https://go.microsoft.com/fwlink/?LinkID=200388)中[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]和身份验证系列。</span><span class="sxs-lookup"><span data-stu-id="d9271-130">For an example of how to use a custom basic authentication scheme with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Custom Basic Authentication](https://go.microsoft.com/fwlink/?LinkID=200388) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="d9271-131">Windows 身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-131">Windows authentication</span></span>|<span data-ttu-id="d9271-132">基于 Windows 的凭据使用 NTLM 或 Kerberos 进行交换。</span><span class="sxs-lookup"><span data-stu-id="d9271-132">Windows-based credentials are exchanged by using NTLM or Kerberos.</span></span> <span data-ttu-id="d9271-133">该机制比基本或摘要式身份验证更安全，但它要求客户端是基于 Windows 的应用程序。</span><span class="sxs-lookup"><span data-stu-id="d9271-133">This mechanism is more secure than basic or digest authentication, but it requires that the client be a Windows-based application.</span></span> <span data-ttu-id="d9271-134">IIS 也为 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 应用程序中的 HTTP 请求提供了一种 Windows 身份验证的实现。</span><span class="sxs-lookup"><span data-stu-id="d9271-134">IIS also provides an implementation of Windows authentication for HTTP requests in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="d9271-135">有关详细信息，请参阅[ASP.NET 窗体身份验证概述](https://docs.microsoft.com/previous-versions/aspnet/7t6b43z4(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="d9271-135">For more information, see [ASP.NET Forms Authentication Overview](https://docs.microsoft.com/previous-versions/aspnet/7t6b43z4(v=vs.100)).</span></span><br /><br /> <span data-ttu-id="d9271-136">有关如何使用 Windows 身份验证的示例[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]，请参阅上的帖子[Windows 身份验证](https://go.microsoft.com/fwlink/?LinkID=200384)中[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]和身份验证系列。</span><span class="sxs-lookup"><span data-stu-id="d9271-136">For an example of how to use Windows authentication with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Windows Authentication](https://go.microsoft.com/fwlink/?LinkID=200384) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] <span data-ttu-id="d9271-137">Forms 身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-137">forms authentication</span></span>|<span data-ttu-id="d9271-138">Forms 身份验证使您可以使用自己的代码对用户进行身份验证，然后将身份验证标记保留在 Cookie 或页的 URL 中。</span><span class="sxs-lookup"><span data-stu-id="d9271-138">Forms authentication lets you authenticate users by using your own code and then maintain an authentication token in a cookie or in the page URL.</span></span> <span data-ttu-id="d9271-139">您使用自己创建的登录窗体对用户的用户名和密码进行验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-139">You authenticate the user name and password of your users using a login form that you create.</span></span> <span data-ttu-id="d9271-140">未经过身份验证的请求被重定向到登录页，用户在该页上提供凭据和提交窗体。</span><span class="sxs-lookup"><span data-stu-id="d9271-140">Unauthenticated requests are redirected to a login page, where the user provides credentials and submits the form.</span></span> <span data-ttu-id="d9271-141">如果应用程序对请求进行了验证，系统会颁发一个票证，该票证包含用于重建后续请求的标识的密钥。</span><span class="sxs-lookup"><span data-stu-id="d9271-141">If the application authenticates the request, the system issues a ticket that contains a key for reestablishing the identity for subsequent requests.</span></span> <span data-ttu-id="d9271-142">有关详细信息，请参阅[窗体身份验证提供程序](https://docs.microsoft.com/previous-versions/aspnet/9wff0kyh(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="d9271-142">For more information, see [Forms Authentication Provider](https://docs.microsoft.com/previous-versions/aspnet/9wff0kyh(v=vs.100)).</span></span> <span data-ttu-id="d9271-143">**安全说明：** 默认情况下，在 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web 应用程序中使用 Forms 身份验证时，包含 Forms 身份验证票证的 Cookie 并未进行安全保护。</span><span class="sxs-lookup"><span data-stu-id="d9271-143">**Security Note:**  By default, the cookie that contains the forms authentication ticket is not secured when you use forms authentication in a [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web application.</span></span> <span data-ttu-id="d9271-144">应考虑要求使用 SSL 以保护身份验证票证和初始登录凭据。</span><span class="sxs-lookup"><span data-stu-id="d9271-144">You should consider requiring SSL to protect both the authentication ticket and the initial login credentials.</span></span> <br /><br /> <span data-ttu-id="d9271-145">为举例说明如何使用窗体的身份验证[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]，请参阅上的帖子[窗体身份验证](https://go.microsoft.com/fwlink/?LinkID=200389)中[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]和身份验证系列。</span><span class="sxs-lookup"><span data-stu-id="d9271-145">For an example of how to use forms authentication with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Forms Authentication](https://go.microsoft.com/fwlink/?LinkID=200389) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="d9271-146">基于声明的身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-146">Claims-based authentication</span></span>|<span data-ttu-id="d9271-147">在基于声明的身份验证，数据服务依赖于用户进行身份验证的受信任的"第三方"标识提供程序服务。</span><span class="sxs-lookup"><span data-stu-id="d9271-147">In claims-based authentication, the data service relies on a trusted "third-party" identity provider service to authenticate the user.</span></span> <span data-ttu-id="d9271-148">该标识提供程序对请求访问数据服务资源的用户进行肯定的身份验证并发出一个标记，授予对所请求资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="d9271-148">The identity provider positively authenticates the user that is requesting access to data service resources and issues a token that grants access to the requested resources.</span></span> <span data-ttu-id="d9271-149">该标记随后提供给数据服务，后者基于与发出访问权限标记的标识服务的信任关系授予用户访问权限。</span><span class="sxs-lookup"><span data-stu-id="d9271-149">This token is then presented to the data service, which then grants access to the user based on the trust relationship with the identity service that issued the access token.</span></span><br /><br /> <span data-ttu-id="d9271-150">使用基于声明的身份验证提供程序的优点是它们可用于跨越信任域对各种类型的客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-150">The benefit of using a claims-based authentication provider is that they can be used to authenticate various types of clients across trust domains.</span></span> <span data-ttu-id="d9271-151">通过采用这样一种第三方提供程序，数据服务可以不必维护用户并对其进行身份验证，从而减轻了负担。</span><span class="sxs-lookup"><span data-stu-id="d9271-151">By employing such a third-party provider, a data service can offload the requirements of maintaining and authenticating users.</span></span> <span data-ttu-id="d9271-152">OAuth 2.0 是一个基于声明的身份验证协议，作为一项服务受到 Microsoft Azure AppFabric Access Control 的支持以进行联盟授权。</span><span class="sxs-lookup"><span data-stu-id="d9271-152">OAuth 2.0 is a claims-based authentication protocol that is supported by Windows Azure AppFabric Access Control for federated authorization as a service.</span></span> <span data-ttu-id="d9271-153">此协议支持基于 REST 的服务。</span><span class="sxs-lookup"><span data-stu-id="d9271-153">This protocol supports REST-based services.</span></span> <span data-ttu-id="d9271-154">有关如何使用 OAuth 2.0 的示例[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]，请参阅上的帖子[OData 和 OAuth](https://go.microsoft.com/fwlink/?LinkId=200514)中[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]和身份验证系列。</span><span class="sxs-lookup"><span data-stu-id="d9271-154">For an example of how to use OAuth 2.0 with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [OData and OAuth](https://go.microsoft.com/fwlink/?LinkId=200514) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
  
<a name="clientAuthentication"></a>   
### <a name="authentication-in-the-client-library"></a><span data-ttu-id="d9271-155">客户端库中的身份验证</span><span class="sxs-lookup"><span data-stu-id="d9271-155">Authentication in the Client Library</span></span>  
 <span data-ttu-id="d9271-156">默认情况下，[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]客户端库在请求 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] 服务时不提供凭据。</span><span class="sxs-lookup"><span data-stu-id="d9271-156">By default, the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library does not supply credentials when making a request to an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service.</span></span> <span data-ttu-id="d9271-157">如果数据服务需要登录凭据以进行用户身份验证，可以在 <xref:System.Net.NetworkCredential>（可通过 <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> 的 <xref:System.Data.Services.Client.DataServiceContext> 属性访问）中提供凭据，如下例所示：</span><span class="sxs-lookup"><span data-stu-id="d9271-157">When login credentials are required by the data service to authenticate a user, these credentials can be supplied in a <xref:System.Net.NetworkCredential> accessed from the <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, as in the following example:</span></span>  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 <span data-ttu-id="d9271-158">有关详细信息，请参阅[如何：数据服务请求指定客户端凭据](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="d9271-158">For more information, see [How to: Specify Client Credentials for a Data Service Request](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md).</span></span>  
  
 <span data-ttu-id="d9271-159">如果数据服务需要的登录凭据不能通过使用 <xref:System.Net.NetworkCredential> 对象（如基于声明的标记或 Cookie）指定，则必须在 HTTP 请求中手动设置标头，通常是 `Authorization` 和 `Cookie` 标头。</span><span class="sxs-lookup"><span data-stu-id="d9271-159">When the data service requires login credentials that cannot be specified by using a <xref:System.Net.NetworkCredential> object, such as a claims-based token or cookie, you must manually set headers in the HTTP request, usually the `Authorization` and `Cookie` headers.</span></span> <span data-ttu-id="d9271-160">有关这种身份验证方案的详细信息，请参阅文章[OData 和身份验证：客户端的挂钩](https://go.microsoft.com/fwlink/?LinkID=200385)。</span><span class="sxs-lookup"><span data-stu-id="d9271-160">For more information about this kind of authentication scenario, see the post [OData and Authentication: Client-Side Hooks](https://go.microsoft.com/fwlink/?LinkID=200385).</span></span> <span data-ttu-id="d9271-161">有关如何在请求消息中设置 HTTP 标头的示例，请参阅[如何：设置客户端请求中的标头](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d9271-161">For an example of how to set HTTP headers in a request message, see [How to: Set Headers in the Client Request](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md).</span></span>  
  
## <a name="impersonation"></a><span data-ttu-id="d9271-162">Impersonation</span><span class="sxs-lookup"><span data-stu-id="d9271-162">Impersonation</span></span>  
 <span data-ttu-id="d9271-163">通常，数据服务使用承载数据服务的工作进程的凭据访问所需资源，如服务器上的文件或数据库。</span><span class="sxs-lookup"><span data-stu-id="d9271-163">Generally, the data service accesses required resources, such as files on the server or a database, by using the credentials of the worker process that is hosting the data service.</span></span> <span data-ttu-id="d9271-164">使用模拟时，[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 应用程序可以用发出请求的用户的 Windows 标识（用户帐户）执行。</span><span class="sxs-lookup"><span data-stu-id="d9271-164">When using impersonation, [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications can execute with the Windows identity (user account) of the user making the request.</span></span> <span data-ttu-id="d9271-165">模拟通常用在依赖 IIS 进行用户身份验证的应用程序中，并使用该主体的凭据访问所需资源。</span><span class="sxs-lookup"><span data-stu-id="d9271-165">Impersonation is commonly used in applications that rely on IIS to authenticate the user, and the credentials of this principle are used to access the required resources.</span></span> <span data-ttu-id="d9271-166">有关详细信息，请参阅[ASP.NET 模拟](https://docs.microsoft.com/previous-versions/aspnet/xh507fc5(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="d9271-166">For more information, see [ASP.NET Impersonation](https://docs.microsoft.com/previous-versions/aspnet/xh507fc5(v=vs.100)).</span></span>  
  
## <a name="configuring-data-service-authorization"></a><span data-ttu-id="d9271-167">配置数据服务授权</span><span class="sxs-lookup"><span data-stu-id="d9271-167">Configuring Data Service Authorization</span></span>  
 <span data-ttu-id="d9271-168">授权是基于之前的成功身份验证为所识别的主体或进程授予应用程序资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="d9271-168">Authorization is the granting of access to application resources to a principle or process that is identified based on a previously successful authentication.</span></span> <span data-ttu-id="d9271-169">作为一种通行做法，只应当为数据服务的用户授予刚好足够的权限以执行客户端应用程序所需的操作。</span><span class="sxs-lookup"><span data-stu-id="d9271-169">As a general practice, you should only grant sufficient rights to users of the data service to perform the operations required by client applications.</span></span>  
  
### <a name="restrict-access-to-data-service-resources"></a><span data-ttu-id="d9271-170">限制对数据服务资源的访问</span><span class="sxs-lookup"><span data-stu-id="d9271-170">Restrict Access to Data Service Resources</span></span>  
 <span data-ttu-id="d9271-171">默认情况下，[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]允许为能够访问数据服务的任何用户授予数据服务资源（实体集和服务操作）的常用读取和写入访问权限。</span><span class="sxs-lookup"><span data-stu-id="d9271-171">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] enables you to grant common read and write access against data service resources (entity set and service operations) to any user that is able to access the data service.</span></span> <span data-ttu-id="d9271-172">可以为数据服务公开的每个实体集分别定义用于定义读取和写入访问权限的规则。</span><span class="sxs-lookup"><span data-stu-id="d9271-172">Rules that define read and write access can be defined separately for each entity set exposed by the data service, as well as to any service operations.</span></span> <span data-ttu-id="d9271-173">我们建议将读取和写入访问权限仅限于客户端应用程序所需的资源。</span><span class="sxs-lookup"><span data-stu-id="d9271-173">We recommend limiting both read and write access to only the resources required by the client application.</span></span> <span data-ttu-id="d9271-174">有关详细信息，请参阅[最低资源访问要求](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements)。</span><span class="sxs-lookup"><span data-stu-id="d9271-174">For more information, see [Minimum Resource Access Requirements](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements).</span></span>  
  
### <a name="implement-role-based-interceptors"></a><span data-ttu-id="d9271-175">实现基于角色的侦听器</span><span class="sxs-lookup"><span data-stu-id="d9271-175">Implement Role-Based Interceptors</span></span>  
 <span data-ttu-id="d9271-176">侦听器可用于在数据服务对数据服务资源采取操作之前截取对它们的请求。</span><span class="sxs-lookup"><span data-stu-id="d9271-176">Interceptors enable you to intercept requests against data service resources before they are acted on by the data service.</span></span> <span data-ttu-id="d9271-177">有关详细信息，请参阅[侦听器](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d9271-177">For more information, see [Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md).</span></span> <span data-ttu-id="d9271-178">拦截器可让您基于发出请求的已进行身份验证的用户作出授权决策。</span><span class="sxs-lookup"><span data-stu-id="d9271-178">Interceptors enable you to make authorization decisions based the authenticated user that is making the request.</span></span> <span data-ttu-id="d9271-179">有关如何限制对基于经过身份验证的用户标识的数据服务资源的访问的示例，请参阅[如何：截获数据服务消息](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d9271-179">For an example of how to restrict access to data service resources based on an authenticated user identity, see [How to: Intercept Data Service Messages](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md).</span></span>  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a><span data-ttu-id="d9271-180">限制对持久数据存储区和本地资源的访问</span><span class="sxs-lookup"><span data-stu-id="d9271-180">Restrict Access to the Persisted Data Store and Local Resources</span></span>  
 <span data-ttu-id="d9271-181">用于访问持久存储区的帐户应仅授予刚好足够的数据库或文件系统权限以支持数据服务的要求。</span><span class="sxs-lookup"><span data-stu-id="d9271-181">The accounts that are used to access the persisted store should be granted only enough rights in a database or the file system to support the requirements of the data service.</span></span> <span data-ttu-id="d9271-182">在使用匿名身份验证时，这是用于运行宿主应用程序的帐户。</span><span class="sxs-lookup"><span data-stu-id="d9271-182">When anonymous authentication is used, this is the account used to run the hosting application.</span></span> <span data-ttu-id="d9271-183">有关详细信息，请参阅[如何：开发在 IIS 上运行的 WCF 数据服务](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md)。</span><span class="sxs-lookup"><span data-stu-id="d9271-183">For more information, see [How to: Develop a WCF Data Service Running on IIS](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md).</span></span> <span data-ttu-id="d9271-184">使用模拟时，必须为经过身份验证的用户授予这些资源的访问权限，通常是作为 Windows 组的一部分。</span><span class="sxs-lookup"><span data-stu-id="d9271-184">When impersonation is used, authenticated users must be granted access to these resources, usually as part of a Windows group.</span></span>  
  
## <a name="other-security-considerations"></a><span data-ttu-id="d9271-185">其他安全注意事项</span><span class="sxs-lookup"><span data-stu-id="d9271-185">Other Security Considerations</span></span>  
  
### <a name="secure-the-data-in-the-payload"></a><span data-ttu-id="d9271-186">负载中的数据安全</span><span class="sxs-lookup"><span data-stu-id="d9271-186">Secure the Data in the Payload</span></span>  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] <span data-ttu-id="d9271-187">以 HTTP 协议为基础。</span><span class="sxs-lookup"><span data-stu-id="d9271-187">is based on the HTTP protocol.</span></span> <span data-ttu-id="d9271-188">在 HTTP 消息中，标头可能包含重要的用户凭据，具体取决于数据服务实现的身份验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-188">In an HTTP message, the header may contain valuable user credentials, depending on the authentication implemented by the data service.</span></span> <span data-ttu-id="d9271-189">消息正文还可能包含必须予以保护的重要客户数据。</span><span class="sxs-lookup"><span data-stu-id="d9271-189">The message body may also contain valuable customer data that must be protected.</span></span> <span data-ttu-id="d9271-190">在这两种情况下，我们建议使用 SSL 在网络上保护此信息。</span><span class="sxs-lookup"><span data-stu-id="d9271-190">In both of these cases, we recommend that you use SSL to protect this information over the wire.</span></span>  
  
### <a name="ignored-message-headers-and-cookies"></a><span data-ttu-id="d9271-191">忽略的消息标头和 Cookie</span><span class="sxs-lookup"><span data-stu-id="d9271-191">Ignored Message Headers and Cookies</span></span>  
 <span data-ttu-id="d9271-192">除了声明内容类型和资源位置以外的 HTTP 请求标头将被忽略，数据服务永远不会设置它们。</span><span class="sxs-lookup"><span data-stu-id="d9271-192">HTTP request headers, other than those that declare content types and resource locations, are ignored and are never set by the data service.</span></span>  
  
 <span data-ttu-id="d9271-193">Cookie 可用作身份验证方案的一部分，例如在 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Forms 身份验证中。</span><span class="sxs-lookup"><span data-stu-id="d9271-193">Cookies can be used as part of an authentication scheme, such as with [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Forms Authentication.</span></span> <span data-ttu-id="d9271-194">但是，[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]会忽略传入请求上设置的任何 HTTP Cookie。</span><span class="sxs-lookup"><span data-stu-id="d9271-194">However, any HTTP cookies set on an incoming request are ignored by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span></span> <span data-ttu-id="d9271-195">数据服务的宿主可能会处理该 Cookie，但 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]运行时永远不会分析或返回 Cookie。</span><span class="sxs-lookup"><span data-stu-id="d9271-195">The host of a data service may process the cookie, but the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime never analyzes or returns cookies.</span></span> <span data-ttu-id="d9271-196">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]客户端库也不会处理在响应中发送的 Cookie。</span><span class="sxs-lookup"><span data-stu-id="d9271-196">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library also does not process cookies sent in the response.</span></span>  
  
### <a name="custom-hosting-requirements"></a><span data-ttu-id="d9271-197">自定义承载要求</span><span class="sxs-lookup"><span data-stu-id="d9271-197">Custom Hosting Requirements</span></span>  
 <span data-ttu-id="d9271-198">默认情况下，[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]将创建为一个承载于 IIS 中的 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 应用程序。</span><span class="sxs-lookup"><span data-stu-id="d9271-198">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] is created as an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application hosted in IIS.</span></span> <span data-ttu-id="d9271-199">这样数据服务便可以利用该平台的安全行为。</span><span class="sxs-lookup"><span data-stu-id="d9271-199">This enables the data service to leverage the secure behaviors of this platform.</span></span> <span data-ttu-id="d9271-200">可以定义由自定义宿主承载的 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d9271-200">You can define [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] that are hosted by a custom host.</span></span> <span data-ttu-id="d9271-201">有关详细信息，请参阅[承载数据服务](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d9271-201">For more information, see [Hosting the Data Service](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="d9271-202">承载数据服务的组件和平台还必须确保以下安全行为以防范对数据服务的攻击：</span><span class="sxs-lookup"><span data-stu-id="d9271-202">The components and platform hosting a data service must ensure the following security behaviors to prevent attacks on the data service:</span></span>  
  
-   <span data-ttu-id="d9271-203">限制针对所有可能操作的数据服务请求中接受的 URI 的长度。</span><span class="sxs-lookup"><span data-stu-id="d9271-203">Limit the length of the URI accepted in a data service request for all possible operations.</span></span>  
  
-   <span data-ttu-id="d9271-204">限制传入和传出 HTTP 消息的大小。</span><span class="sxs-lookup"><span data-stu-id="d9271-204">Limit the size of both incoming and outgoing HTTP messages.</span></span>  
  
-   <span data-ttu-id="d9271-205">限制任何给定时间点的未完成请求的总数。</span><span class="sxs-lookup"><span data-stu-id="d9271-205">Limit the total number of outstanding requests at any given time.</span></span>  
  
-   <span data-ttu-id="d9271-206">限制 HTTP 标头及其值的大小，并提供对数据标头的 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]访问。</span><span class="sxs-lookup"><span data-stu-id="d9271-206">Limit the size of HTTP headers and their values, and provide [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] access to header data.</span></span>  
  
-   <span data-ttu-id="d9271-207">检测和计数已知攻击，如 TCP SYN 和消息重播攻击。</span><span class="sxs-lookup"><span data-stu-id="d9271-207">Detect and counter known attacks, such as TCP SYN and message replay attacks.</span></span>  
  
### <a name="values-are-not-further-encoded"></a><span data-ttu-id="d9271-208">值不进一步编码</span><span class="sxs-lookup"><span data-stu-id="d9271-208">Values Are Not Further Encoded</span></span>  
 <span data-ttu-id="d9271-209">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]运行时不对发送到数据服务的属性值进行进一步编码。</span><span class="sxs-lookup"><span data-stu-id="d9271-209">Property values sent to the data service are not further encoded by the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime.</span></span> <span data-ttu-id="d9271-210">例如，当某个实体的字符串属性包含带格式的 HTML 内容时，数据服务不对标记进行 HTML 编码。</span><span class="sxs-lookup"><span data-stu-id="d9271-210">For example, when a string property of an entity contains formatted HTML content, the tags are not HTML encoded by the data service.</span></span> <span data-ttu-id="d9271-211">数据服务也不会在响应中对属性值进行进一步编码。</span><span class="sxs-lookup"><span data-stu-id="d9271-211">The data service also does not further encode property values in the response.</span></span> <span data-ttu-id="d9271-212">客户端库也不会执行任何其他编码。</span><span class="sxs-lookup"><span data-stu-id="d9271-212">The client library also does not perform any additional encoding.</span></span>  
  
### <a name="considerations-for-client-applications"></a><span data-ttu-id="d9271-213">客户端应用程序的注意事项</span><span class="sxs-lookup"><span data-stu-id="d9271-213">Considerations for Client Applications</span></span>  
 <span data-ttu-id="d9271-214">以下安全注意事项适用于使用 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]客户端访问 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] 服务的应用程序：</span><span class="sxs-lookup"><span data-stu-id="d9271-214">The following security considerations apply to applications that use the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client to access [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] services:</span></span>  
  
-   <span data-ttu-id="d9271-215">客户端库假定用于访问数据服务的协议提供了适当安全级别。</span><span class="sxs-lookup"><span data-stu-id="d9271-215">The client library assumes that the protocols used to access the data service provide an appropriate level of security.</span></span>  
  
-   <span data-ttu-id="d9271-216">客户端库使用基础平台提供的传输堆栈的超时和分析选项的全部默认值。</span><span class="sxs-lookup"><span data-stu-id="d9271-216">The client library uses all the default values for timeouts and parsing options of the underlying platform-provided transport stacks.</span></span>  
  
-   <span data-ttu-id="d9271-217">客户端库不从应用程序配置文件中读取任何设置。</span><span class="sxs-lookup"><span data-stu-id="d9271-217">The client library does not read any settings from application configuration files.</span></span>  
  
-   <span data-ttu-id="d9271-218">客户端库不实现任何跨域访问机制，</span><span class="sxs-lookup"><span data-stu-id="d9271-218">The client library does not implement any cross domain access mechanisms.</span></span> <span data-ttu-id="d9271-219">而是依赖于基础 HTTP 堆栈提供的机制。</span><span class="sxs-lookup"><span data-stu-id="d9271-219">Instead, it relies on the mechanisms provided by the underlying HTTP stack.</span></span>  
  
-   <span data-ttu-id="d9271-220">客户端库没有用户界面元素，并且它从不尝试显示或呈现它所接收或发送的数据。</span><span class="sxs-lookup"><span data-stu-id="d9271-220">The client library has no user interface elements, and it never tries to display or render the data that it receives or sends.</span></span>  
  
-   <span data-ttu-id="d9271-221">我们建议客户端应用程序始终对用户输入以及接受自非信任服务的数据进行验证。</span><span class="sxs-lookup"><span data-stu-id="d9271-221">We recommend that client applications always validate user input as well as data accepted from untrusted services.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d9271-222">请参阅</span><span class="sxs-lookup"><span data-stu-id="d9271-222">See also</span></span>
- [<span data-ttu-id="d9271-223">定义 WCF Data Services</span><span class="sxs-lookup"><span data-stu-id="d9271-223">Defining WCF Data Services</span></span>](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)
- [<span data-ttu-id="d9271-224">WCF Data Services 客户端库</span><span class="sxs-lookup"><span data-stu-id="d9271-224">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
