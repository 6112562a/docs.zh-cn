---
title: Windows 窗体 DataGridView 控件中的虚拟模式
ms.date: 03/30/2017
helpviewer_keywords:
- DataGridView control [Windows Forms], virtual mode
ms.assetid: feae5d43-2848-4b1a-8ea7-77085dc415b5
ms.openlocfilehash: f284835578221ad1fe859f260e37bb829cd64b2d
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "62009131"
---
# <a name="virtual-mode-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="5dfc8-102">Windows 窗体 DataGridView 控件中的虚拟模式</span><span class="sxs-lookup"><span data-stu-id="5dfc8-102">Virtual Mode in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="5dfc8-103">虚拟模式下，你可以管理之间的交互<xref:System.Windows.Forms.DataGridView>控件和自定义数据缓存。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-103">With virtual mode, you can manage the interaction between the <xref:System.Windows.Forms.DataGridView> control and a custom data cache.</span></span> <span data-ttu-id="5dfc8-104">若要实现虚拟模式下，设置<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性设置为`true`并处理一个或多个本主题中所述的事件。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-104">To implement virtual mode, set the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property to `true` and handle one or more of the events described in this topic.</span></span> <span data-ttu-id="5dfc8-105">通常会处理至少`CellValueNeeded`事件，它使数据缓存中的值查找的控件。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-105">You will typically handle at least the `CellValueNeeded` event, which enables the control look up values in the data cache.</span></span>  
  
## <a name="bound-mode-and-virtual-mode"></a><span data-ttu-id="5dfc8-106">绑定的模式和虚拟模式</span><span class="sxs-lookup"><span data-stu-id="5dfc8-106">Bound Mode and Virtual Mode</span></span>  
 <span data-ttu-id="5dfc8-107">仅在需要以补充或替代绑定的模式时，才需要虚拟模式。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-107">Virtual mode is necessary only when you need to supplement or replace bound mode.</span></span> <span data-ttu-id="5dfc8-108">绑定模式下，在您设置<xref:System.Windows.Forms.DataGridView.DataSource%2A>属性和控件自动从指定的源加载数据，并提交用户更改返回到它。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-108">In bound mode, you set the <xref:System.Windows.Forms.DataGridView.DataSource%2A> property and the control automatically loads the data from the specified source and submits user changes back to it.</span></span> <span data-ttu-id="5dfc8-109">您可以控制显示哪些绑定列和数据源本身通常会处理操作，如排序。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-109">You can control which of the bound columns are displayed, and the data source itself typically handles operations such as sorting.</span></span>  
  
## <a name="supplementing-bound-mode"></a><span data-ttu-id="5dfc8-110">补充绑定的模式</span><span class="sxs-lookup"><span data-stu-id="5dfc8-110">Supplementing Bound Mode</span></span>  
 <span data-ttu-id="5dfc8-111">你可以通过显示未绑定的列绑定的列以及补充绑定的模式。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-111">You can supplement bound mode by displaying unbound columns along with the bound columns.</span></span> <span data-ttu-id="5dfc8-112">这有时称为"混合的模式"，并可用于显示某些操作，如计算出的值或用户界面 (UI) 控件。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-112">This is sometimes called "mixed mode" and is useful for displaying things like calculated values or user-interface (UI) controls.</span></span>  
  
 <span data-ttu-id="5dfc8-113">由于未绑定的列是外部数据源，它们将忽略数据源的排序操作。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-113">Because unbound columns are outside the data source, they are ignored by the data source's sorting operations.</span></span> <span data-ttu-id="5dfc8-114">因此，如果启用排序在混合模式下，您必须管理在本地缓存中的未绑定的数据并实现虚拟模式以使<xref:System.Windows.Forms.DataGridView>控件与之进行交互。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-114">Therefore, when you enable sorting in mixed mode, you must manage the unbound data in a local cache and implement virtual mode to let the <xref:System.Windows.Forms.DataGridView> control interact with it.</span></span>  
  
 <span data-ttu-id="5dfc8-115">有关使用虚拟模式下维护未绑定列中的值的详细信息，请参阅中的示例<xref:System.Windows.Forms.DataGridViewCheckBoxColumn.ThreeState%2A?displayProperty=nameWithType>属性和<xref:System.Windows.Forms.DataGridViewComboBoxColumn?displayProperty=nameWithType>类参考主题。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-115">For more information about using virtual mode to maintain the values in unbound columns, see the examples in the <xref:System.Windows.Forms.DataGridViewCheckBoxColumn.ThreeState%2A?displayProperty=nameWithType> property and <xref:System.Windows.Forms.DataGridViewComboBoxColumn?displayProperty=nameWithType> class reference topics.</span></span>  
  
## <a name="replacing-bound-mode"></a><span data-ttu-id="5dfc8-116">替换绑定的模式</span><span class="sxs-lookup"><span data-stu-id="5dfc8-116">Replacing Bound Mode</span></span>  
 <span data-ttu-id="5dfc8-117">如果绑定的模式不满足性能需求，你可以管理通过虚拟模式事件处理程序的自定义缓存中的所有数据。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-117">If bound mode does not meet your performance needs, you can manage all your data in a custom cache through virtual-mode event handlers.</span></span> <span data-ttu-id="5dfc8-118">例如，可以使用的虚拟模式实现在实时数据加载机制，以仅检索数量的数据从联网的数据库必须以获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-118">For example, you can use virtual mode to implement a just-in-time data loading mechanism that retrieves only as much data from a networked database as is necessary for optimal performance.</span></span> <span data-ttu-id="5dfc8-119">此方案中使用大量的数据通过慢速网络连接或具有有限的数量的 RAM 或存储空间的客户端计算机时特别有用。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-119">This scenario is particularly useful when working with large amounts of data over a slow network connection or with client machines that have a limited amount of RAM or storage space.</span></span>  
  
 <span data-ttu-id="5dfc8-120">有关在实时方案中使用的虚拟模式的详细信息，请参阅[实时数据加载 Windows 窗体 DataGridView 控件中实现虚拟模式](implementing-virtual-mode-jit-data-loading-in-the-datagrid.md)。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-120">For more information about using virtual mode in a just-in-time scenario, see [Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control](implementing-virtual-mode-jit-data-loading-in-the-datagrid.md).</span></span>  
  
## <a name="virtual-mode-events"></a><span data-ttu-id="5dfc8-121">虚拟模式事件</span><span class="sxs-lookup"><span data-stu-id="5dfc8-121">Virtual-Mode Events</span></span>  
 <span data-ttu-id="5dfc8-122">如果你的数据是只读的`CellValueNeeded`事件可能是您将需要处理的唯一事件。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-122">If your data is read-only, the `CellValueNeeded` event may be the only event you will need to handle.</span></span> <span data-ttu-id="5dfc8-123">其他虚拟模式事件使您可以启用特定功能，例如用户编辑、 添加行和删除和行级事务。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-123">Additional virtual-mode events let you enable specific functionality like user edits, row addition and deletion, and row-level transactions.</span></span>  
  
 <span data-ttu-id="5dfc8-124">一些标准<xref:System.Windows.Forms.DataGridView>事件 （如用户添加或删除行，或单元格时的值时发生的事件进行编辑、 分析、 验证，或格式） 均处于虚拟模式非常有用。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-124">Some standard <xref:System.Windows.Forms.DataGridView> events (such as events that occur when users add or delete rows, or when cell values are edited, parsed, validated, or formatted) are useful in virtual mode, as well.</span></span> <span data-ttu-id="5dfc8-125">此外可以处理事件，可维护通常不存储在绑定的数据源，例如单元格工具提示文本、 单元格和行错误文本、 单元格和行的快捷菜单数据和行高度数据中的值。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-125">You can also handle events that let you maintain values not typically stored in a bound data source, such as cell ToolTip text, cell and row error text, cell and row shortcut menu data, and row height data.</span></span>  
  
 <span data-ttu-id="5dfc8-126">有关实现虚拟模式来管理具有行级别的提交作用域的读/写数据的详细信息，请参阅[演练：在 Windows 中实现虚拟模式窗体 DataGridView 控件](implementing-virtual-mode-wf-datagridview-control.md)。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-126">For more information about implementing virtual mode to manage read/write data with a row-level commit scope, see [Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control](implementing-virtual-mode-wf-datagridview-control.md).</span></span>  
  
 <span data-ttu-id="5dfc8-127">实现虚拟模式的单元格级提交作用域的示例，请参阅<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性参考主题。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-127">For an example that implements virtual mode with a cell-level commit scope, see the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property reference topic.</span></span>  
  
 <span data-ttu-id="5dfc8-128">仅将发生以下事件时<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-128">The following events occur only when the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property is set to `true`.</span></span>  
  
|<span data-ttu-id="5dfc8-129">Event</span><span class="sxs-lookup"><span data-stu-id="5dfc8-129">Event</span></span>|<span data-ttu-id="5dfc8-130">描述</span><span class="sxs-lookup"><span data-stu-id="5dfc8-130">Description</span></span>|  
|-----------|-----------------|  
|<xref:System.Windows.Forms.DataGridView.CellValueNeeded>|<span data-ttu-id="5dfc8-131">该控件用于从显示的数据缓存中检索的单元值。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-131">Used by the control to retrieve a cell value from the data cache for display.</span></span> <span data-ttu-id="5dfc8-132">仅对未绑定的列中的单元格时发生此事件。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-132">This event occurs only for cells in unbound columns.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.CellValuePushed>|<span data-ttu-id="5dfc8-133">该控件用于将用户输入的单元格提交到数据缓存。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-133">Used by the control to commit user input for a cell to the data cache.</span></span> <span data-ttu-id="5dfc8-134">仅对未绑定的列中的单元格时发生此事件。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-134">This event occurs only for cells in unbound columns.</span></span><br /><br /> <span data-ttu-id="5dfc8-135">调用<xref:System.Windows.Forms.DataGridView.UpdateCellValue%2A>方法时更改缓存的值之外的<xref:System.Windows.Forms.DataGridView.CellValuePushed>事件处理程序以确保在控件中显示的当前值并应用当前有效的任何自动调整大小模式。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-135">Call the <xref:System.Windows.Forms.DataGridView.UpdateCellValue%2A> method when changing a cached value outside of a <xref:System.Windows.Forms.DataGridView.CellValuePushed> event handler to ensure that the current value is displayed in the control and to apply any automatic sizing modes currently in effect.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.NewRowNeeded>|<span data-ttu-id="5dfc8-136">该控件用于指示要使用的数据缓存中的新行。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-136">Used by the control to indicate the need for a new row in the data cache.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.RowDirtyStateNeeded>|<span data-ttu-id="5dfc8-137">该控件用于确定行是否有任何未提交的更改。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-137">Used by the control to determine whether a row has any uncommitted changes.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.CancelRowEdit>|<span data-ttu-id="5dfc8-138">该控件用于指示行应恢复为其缓存的值。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-138">Used by the control to indicate that a row should revert to its cached values.</span></span>|  
  
 <span data-ttu-id="5dfc8-139">以下事件可在虚拟模式下，但可以使用而不考虑<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性设置。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-139">The following events are useful in virtual mode, but can be used regardless of the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property setting.</span></span>  
  
|<span data-ttu-id="5dfc8-140">事件</span><span class="sxs-lookup"><span data-stu-id="5dfc8-140">Events</span></span>|<span data-ttu-id="5dfc8-141">描述</span><span class="sxs-lookup"><span data-stu-id="5dfc8-141">Description</span></span>|  
|------------|-----------------|  
|<xref:System.Windows.Forms.DataGridView.UserDeletingRow><br /><br /> <xref:System.Windows.Forms.DataGridView.UserDeletedRow><br /><br /> <xref:System.Windows.Forms.DataGridView.RowsRemoved><br /><br /> <xref:System.Windows.Forms.DataGridView.RowsAdded>|<span data-ttu-id="5dfc8-142">该控件用于指示当行被删除或添加，从而相应地更新数据缓存。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-142">Used by the control to indicate when rows are deleted or added, letting you update the data cache accordingly.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.CellFormatting><br /><br /> <xref:System.Windows.Forms.DataGridView.CellParsing><br /><br /> <xref:System.Windows.Forms.DataGridView.CellValidating><br /><br /> <xref:System.Windows.Forms.DataGridView.CellValidated><br /><br /> <xref:System.Windows.Forms.DataGridView.RowValidating><br /><br /> <xref:System.Windows.Forms.DataGridView.RowValidated>|<span data-ttu-id="5dfc8-143">用于通过格式单元格的值的控件用于显示和分析和验证用户输入。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-143">Used by the control to format cell values for display and to parse and validate user input.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.CellToolTipTextNeeded>|<span data-ttu-id="5dfc8-144">该控件用于检索单元格工具提示文本时<xref:System.Windows.Forms.DataGridView.DataSource%2A>属性设置或<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性是`true`。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-144">Used by the control to retrieve cell ToolTip text when the <xref:System.Windows.Forms.DataGridView.DataSource%2A> property is set or the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property is `true`.</span></span><br /><br /> <span data-ttu-id="5dfc8-145">显示单元格工具提示时，才<xref:System.Windows.Forms.DataGridView.ShowCellToolTips%2A>属性值是`true`。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-145">Cell ToolTips are displayed only when the <xref:System.Windows.Forms.DataGridView.ShowCellToolTips%2A> property value is `true`.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.CellErrorTextNeeded><br /><br /> <xref:System.Windows.Forms.DataGridView.RowErrorTextNeeded>|<span data-ttu-id="5dfc8-146">该控件用于检索单元格或行错误文本时<xref:System.Windows.Forms.DataGridView.DataSource%2A>属性设置或<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性是`true`。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-146">Used by the control to retrieve cell or row error text when the <xref:System.Windows.Forms.DataGridView.DataSource%2A> property is set or the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property is `true`.</span></span><br /><br /> <span data-ttu-id="5dfc8-147">调用<xref:System.Windows.Forms.DataGridView.UpdateCellErrorText%2A>方法或<xref:System.Windows.Forms.DataGridView.UpdateRowErrorText%2A>方法时更改单元格或行错误文本，以确保在控件中显示的当前值。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-147">Call the <xref:System.Windows.Forms.DataGridView.UpdateCellErrorText%2A> method or the <xref:System.Windows.Forms.DataGridView.UpdateRowErrorText%2A> method when you change the cell or row error text to ensure that the current value is displayed in the control.</span></span><br /><br /> <span data-ttu-id="5dfc8-148">显示单元格和行错误标志符号时<xref:System.Windows.Forms.DataGridView.ShowCellErrors%2A>并<xref:System.Windows.Forms.DataGridView.ShowRowErrors%2A>属性的值为`true`。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-148">Cell and row error glyphs are displayed when the <xref:System.Windows.Forms.DataGridView.ShowCellErrors%2A> and <xref:System.Windows.Forms.DataGridView.ShowRowErrors%2A> property values are `true`.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.CellContextMenuStripNeeded><br /><br /> <xref:System.Windows.Forms.DataGridView.RowContextMenuStripNeeded>|<span data-ttu-id="5dfc8-149">该控件用于检索单元格或行<xref:System.Windows.Forms.ContextMenuStrip>时该控件<xref:System.Windows.Forms.DataGridView.DataSource%2A>属性设置或<xref:System.Windows.Forms.DataGridView.VirtualMode%2A>属性是`true`。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-149">Used by the control to retrieve a cell or row <xref:System.Windows.Forms.ContextMenuStrip> when the control <xref:System.Windows.Forms.DataGridView.DataSource%2A> property is set or the <xref:System.Windows.Forms.DataGridView.VirtualMode%2A> property is `true`.</span></span>|  
|<xref:System.Windows.Forms.DataGridView.RowHeightInfoNeeded><br /><br /> <xref:System.Windows.Forms.DataGridView.RowHeightInfoPushed>|<span data-ttu-id="5dfc8-150">由该控件用于检索或存储的数据缓存中的行的高度信息。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-150">Used by the control to retrieve or store row height information in the data cache.</span></span> <span data-ttu-id="5dfc8-151">调用<xref:System.Windows.Forms.DataGridView.UpdateRowHeightInfo%2A>方法时更改之外的缓存的行高度信息<xref:System.Windows.Forms.DataGridView.RowHeightInfoPushed>事件处理程序以确保在控件的显示中使用的当前值。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-151">Call the <xref:System.Windows.Forms.DataGridView.UpdateRowHeightInfo%2A> method when changing the cached row height information outside of a <xref:System.Windows.Forms.DataGridView.RowHeightInfoPushed> event handler to ensure that the current value is used in the display of the control.</span></span>|  
  
## <a name="best-practices-in-virtual-mode"></a><span data-ttu-id="5dfc8-152">处于虚拟模式下的最佳实践</span><span class="sxs-lookup"><span data-stu-id="5dfc8-152">Best Practices in Virtual Mode</span></span>  
 <span data-ttu-id="5dfc8-153">为了有效地使用大量的数据，要实现虚拟模式下，如果您还需要确保与你也会有效地工作<xref:System.Windows.Forms.DataGridView>控件本身。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-153">If you are implementing virtual mode in order to work efficiently with large amounts of data, you will also want to ensure that you are working efficiently with the <xref:System.Windows.Forms.DataGridView> control itself.</span></span> <span data-ttu-id="5dfc8-154">有关有效地使用的单元格样式、 自动调整大小、 选择以及行共享的详细信息，请参阅[缩放 Windows 窗体 DataGridView 控件的最佳做法](best-practices-for-scaling-the-windows-forms-datagridview-control.md)。</span><span class="sxs-lookup"><span data-stu-id="5dfc8-154">For more information about the efficient use of cell styles, automatic sizing, selections, and row sharing, see [Best Practices for Scaling the Windows Forms DataGridView Control](best-practices-for-scaling-the-windows-forms-datagridview-control.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5dfc8-155">请参阅</span><span class="sxs-lookup"><span data-stu-id="5dfc8-155">See also</span></span>

- <xref:System.Windows.Forms.DataGridView>
- <xref:System.Windows.Forms.DataGridView.VirtualMode%2A>
- [<span data-ttu-id="5dfc8-156">Windows 窗体 DataGridView 控件中的性能调整</span><span class="sxs-lookup"><span data-stu-id="5dfc8-156">Performance Tuning in the Windows Forms DataGridView Control</span></span>](performance-tuning-in-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="5dfc8-157">有关缩放 Windows 窗体 DataGridView 控件的最佳做法</span><span class="sxs-lookup"><span data-stu-id="5dfc8-157">Best Practices for Scaling the Windows Forms DataGridView Control</span></span>](best-practices-for-scaling-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="5dfc8-158">演练：在 Windows 窗体 DataGridView 控件中实现虚拟模式</span><span class="sxs-lookup"><span data-stu-id="5dfc8-158">Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control</span></span>](implementing-virtual-mode-wf-datagridview-control.md)
- [<span data-ttu-id="5dfc8-159">在 Windows 窗体 DataGridView 控件中实现实时数据加载的虚拟模式</span><span class="sxs-lookup"><span data-stu-id="5dfc8-159">Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>](implementing-virtual-mode-jit-data-loading-in-the-datagrid.md)
