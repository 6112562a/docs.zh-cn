---
title: 用户输入验证
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
ms.openlocfilehash: eafbf54552566011fef9d2dbeb5e9f9fa3facabd
ms.sourcegitcommit: 62285ec11fa8e8424bab00511a90760c60e63c95
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/20/2020
ms.locfileid: "81646302"
---
# <a name="user-input-validation-in-windows-forms"></a><span data-ttu-id="f85f3-102">Windows 窗体中的用户输入验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-102">User Input Validation in Windows Forms</span></span>
<span data-ttu-id="f85f3-103">当用户在应用程序中输入数据时，您可能希望在应用程序使用数据之前验证数据是否有效。</span><span class="sxs-lookup"><span data-stu-id="f85f3-103">When users enter data into your application, you may want to verify that the data is valid before your application uses it.</span></span> <span data-ttu-id="f85f3-104">您可以要求某些文本字段不是零长度，字段必须格式化为电话号码或其他类型的格式良好的数据，或者字符串不包含任何可能用于危害数据库安全性的不安全字符。</span><span class="sxs-lookup"><span data-stu-id="f85f3-104">You may require that certain text fields not be zero-length, that a field be formatted as a telephone number or other type of well-formed data, or that a string not contain any unsafe characters that could be used to compromise the security of a database.</span></span> <span data-ttu-id="f85f3-105">Windows 窗体提供了几种验证应用程序中输入的方法。</span><span class="sxs-lookup"><span data-stu-id="f85f3-105">Windows Forms provides several ways for you to validate input in your application.</span></span>  
  
## <a name="validation-with-the-maskedtextbox-control"></a><span data-ttu-id="f85f3-106">使用蒙版文本框控件进行验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-106">Validation with the MaskedTextBox Control</span></span>  
 <span data-ttu-id="f85f3-107">如果需要要求用户以定义良好的格式（如电话号码或部件号）输入数据，则可以使用<xref:System.Windows.Forms.MaskedTextBox>控件快速且使用最少的代码完成此任务。</span><span class="sxs-lookup"><span data-stu-id="f85f3-107">If you need to require users to enter data in a well-defined format, such as a telephone number or a part number, you can accomplish this quickly and with minimal code by using the <xref:System.Windows.Forms.MaskedTextBox> control.</span></span> <span data-ttu-id="f85f3-108">*蒙版*是由掩蔽语言中的字符组成的字符串，用于指定可以在文本框中的任何给定位置输入哪些字符。</span><span class="sxs-lookup"><span data-stu-id="f85f3-108">A *mask* is a string made up of characters from a masking language that specifies which characters can be entered at any given position in the text box.</span></span> <span data-ttu-id="f85f3-109">该控件向用户显示一组提示。</span><span class="sxs-lookup"><span data-stu-id="f85f3-109">The control displays a set of prompts to the user.</span></span> <span data-ttu-id="f85f3-110">如果用户键入不正确的条目，例如，当用户在需要数字时键入字母，控件将自动拒绝输入。</span><span class="sxs-lookup"><span data-stu-id="f85f3-110">If the user types an incorrect entry, for example, the user types a letter when a digit is required, the control will automatically reject the input.</span></span>  
  
 <span data-ttu-id="f85f3-111">所使用的掩蔽语言<xref:System.Windows.Forms.MaskedTextBox>非常灵活。</span><span class="sxs-lookup"><span data-stu-id="f85f3-111">The masking language that is used by <xref:System.Windows.Forms.MaskedTextBox> is very flexible.</span></span> <span data-ttu-id="f85f3-112">它允许您指定所需的字符、可选字符、字面字符（如连字符和括号、货币字符和日期分隔符）。</span><span class="sxs-lookup"><span data-stu-id="f85f3-112">It allows you to specify required characters, optional characters, literal characters, such as hyphens and parentheses, currency characters, and date separators.</span></span> <span data-ttu-id="f85f3-113">绑定到数据源时，该控件也工作正常。</span><span class="sxs-lookup"><span data-stu-id="f85f3-113">The control also works well when bound to a data source.</span></span> <span data-ttu-id="f85f3-114">数据<xref:System.Windows.Forms.Binding.Format>绑定上的事件可用于重格式化传入数据以符合掩码，该<xref:System.Windows.Forms.Binding.Parse>事件可用于重格式化传出数据以符合数据字段的规范。</span><span class="sxs-lookup"><span data-stu-id="f85f3-114">The <xref:System.Windows.Forms.Binding.Format> event on a data binding can be used to reformat incoming data to comply with the mask, and the <xref:System.Windows.Forms.Binding.Parse> event can be used to reformat outgoing data to comply with the specifications of the data field.</span></span>  
  
 <span data-ttu-id="f85f3-115">有关详细信息，请参阅[蒙版文本框控件](./controls/maskedtextbox-control-windows-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="f85f3-115">For more information, see [MaskedTextBox Control](./controls/maskedtextbox-control-windows-forms.md).</span></span>  
  
## <a name="event-driven-validation"></a><span data-ttu-id="f85f3-116">事件驱动验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-116">Event-Driven Validation</span></span>  
 <span data-ttu-id="f85f3-117">如果要对验证进行完全编程控制，或者需要执行复杂的验证检查，则应使用大多数 Windows 窗体控件中内置的验证事件。</span><span class="sxs-lookup"><span data-stu-id="f85f3-117">If you want full programmatic control over validation, or need to perform complex validation checks, you should use the validation events built into most Windows Forms controls.</span></span> <span data-ttu-id="f85f3-118">接受自由格式用户输入的每个控件都有一个<xref:System.Windows.Forms.Control.Validating>事件，该事件将在控件需要数据验证时发生。</span><span class="sxs-lookup"><span data-stu-id="f85f3-118">Each control that accepts free-form user input has a <xref:System.Windows.Forms.Control.Validating> event that will occur whenever the control requires data validation.</span></span> <span data-ttu-id="f85f3-119">在<xref:System.Windows.Forms.Control.Validating>事件处理方法中，您可以通过多种方式验证用户输入。</span><span class="sxs-lookup"><span data-stu-id="f85f3-119">In the <xref:System.Windows.Forms.Control.Validating> event-handling method, you can validate user input in several ways.</span></span> <span data-ttu-id="f85f3-120">例如，如果您有一个必须包含邮政编码的文本框，则可以通过以下方式执行验证：</span><span class="sxs-lookup"><span data-stu-id="f85f3-120">For example, if you have a text box that must contain a postal code, you can perform the validation in the following ways:</span></span>  
  
- <span data-ttu-id="f85f3-121">如果邮政编码必须属于特定的邮政编码组，则可以对输入执行字符串比较，以验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-121">If the postal code must belong to a specific group of zip codes, you can perform a string comparison on the input to validate the data entered by the user.</span></span> <span data-ttu-id="f85f3-122">例如，如果邮政编码必须位于集 {10001、10002、10003}中，则可以使用字符串比较来验证数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-122">For example, if the postal code must be in the set {10001, 10002, 10003}, then you can use a string comparison to validate the data.</span></span>  
  
- <span data-ttu-id="f85f3-123">如果邮政编码必须采用特定形式，则可以使用正则表达式来验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-123">If the postal code must be in a specific form you can use regular expressions to validate the data entered by the user.</span></span> <span data-ttu-id="f85f3-124">例如，要验证窗体`#####`或`#####-####`，可以使用正则表达式`^(\d{5})(-\d{4})?$`。</span><span class="sxs-lookup"><span data-stu-id="f85f3-124">For example, to validate the form `#####` or `#####-####`, you can use the regular expression `^(\d{5})(-\d{4})?$`.</span></span> <span data-ttu-id="f85f3-125">要验证窗体`A#A #A#`，可以使用正则表达式`[A-Z]\d[A-Z] \d[A-Z]\d`。</span><span class="sxs-lookup"><span data-stu-id="f85f3-125">To validate the form `A#A #A#`, you can use the regular expression `[A-Z]\d[A-Z] \d[A-Z]\d`.</span></span> <span data-ttu-id="f85f3-126">有关正则表达式的详细信息，请参阅[.NET 框架正则表达式](../../standard/base-types/regular-expressions.md)和[正则表达式示例](../../standard/base-types/regular-expression-example-scanning-for-hrefs.md)。</span><span class="sxs-lookup"><span data-stu-id="f85f3-126">For more information about regular expressions, see [.NET Framework Regular Expressions](../../standard/base-types/regular-expressions.md) and [Regular Expression Examples](../../standard/base-types/regular-expression-example-scanning-for-hrefs.md).</span></span>  
  
- <span data-ttu-id="f85f3-127">如果邮政编码必须是有效的美国邮政编码，您可以调用邮政编码 Web 服务来验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-127">If the postal code must be a valid United States Zip code, you could call a Zip code Web service to validate the data entered by the user.</span></span>  
  
 <span data-ttu-id="f85f3-128">事件<xref:System.Windows.Forms.Control.Validating>提供类型的对象<xref:System.ComponentModel.CancelEventArgs>。</span><span class="sxs-lookup"><span data-stu-id="f85f3-128">The <xref:System.Windows.Forms.Control.Validating> event is supplied an object of type <xref:System.ComponentModel.CancelEventArgs>.</span></span> <span data-ttu-id="f85f3-129">如果确定控件的数据无效，则可以通过将此对象的属性<xref:System.Windows.Forms.Control.Validating><xref:System.ComponentModel.CancelEventArgs.Cancel%2A>设置为`true`取消事件。</span><span class="sxs-lookup"><span data-stu-id="f85f3-129">If you determine that the control's data is not valid, you can cancel the <xref:System.Windows.Forms.Control.Validating> event by setting this object's <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `true`.</span></span> <span data-ttu-id="f85f3-130">如果不设置属性，Windows<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>窗体将假定该控件的验证成功，并引发该<xref:System.Windows.Forms.Control.Validated>事件。</span><span class="sxs-lookup"><span data-stu-id="f85f3-130">If you do not set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property, Windows Forms will assume that validation succeeded for that control, and raise the <xref:System.Windows.Forms.Control.Validated> event.</span></span>  
  
 <span data-ttu-id="f85f3-131">有关验证 中的电子邮件地址的代码示例，<xref:System.Windows.Controls.TextBox>请参阅<xref:System.Windows.Forms.Control.Validating>。</span><span class="sxs-lookup"><span data-stu-id="f85f3-131">For a code example that validates an email address in a <xref:System.Windows.Controls.TextBox>, see <xref:System.Windows.Forms.Control.Validating>.</span></span>  
  
### <a name="data-binding-and-event-driven-validation"></a><span data-ttu-id="f85f3-132">数据绑定和事件驱动验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-132">Data Binding and Event-Driven Validation</span></span>  
 <span data-ttu-id="f85f3-133">当您将控件绑定到数据源（如数据库表）时，验证非常有用。</span><span class="sxs-lookup"><span data-stu-id="f85f3-133">Validation is very useful when you have bound your controls to a data source, such as a database table.</span></span> <span data-ttu-id="f85f3-134">通过使用验证，可以确保控件的数据满足数据源所需的格式，并且不包含任何可能不安全的特殊字符，如引号和斜杠。</span><span class="sxs-lookup"><span data-stu-id="f85f3-134">By using validation, you can make sure that your control's data satisfies the format required by the data source, and that it does not contain any special characters such as quotation marks and back slashes that might be unsafe.</span></span>  
  
 <span data-ttu-id="f85f3-135">使用数据绑定时，控件中的数据在执行<xref:System.Windows.Forms.Control.Validating>事件期间会与数据源同步。</span><span class="sxs-lookup"><span data-stu-id="f85f3-135">When you use data binding, the data in your control is synchronized with the data source during execution of the <xref:System.Windows.Forms.Control.Validating> event.</span></span> <span data-ttu-id="f85f3-136">如果取消该<xref:System.Windows.Forms.Control.Validating>事件，数据将不会与数据源同步。</span><span class="sxs-lookup"><span data-stu-id="f85f3-136">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the data will not be synchronized with the data source.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="f85f3-137">如果<xref:System.Windows.Forms.Control.Validating>具有在事件发生后进行的自定义验证，则不会影响数据绑定。</span><span class="sxs-lookup"><span data-stu-id="f85f3-137">If you have custom validation that takes place after the <xref:System.Windows.Forms.Control.Validating> event, it will not affect the data binding.</span></span> <span data-ttu-id="f85f3-138">例如，如果<xref:System.Windows.Forms.Control.Validated>尝试取消数据绑定的事件有代码，则数据绑定仍将发生。</span><span class="sxs-lookup"><span data-stu-id="f85f3-138">For example, if you have code in a <xref:System.Windows.Forms.Control.Validated> event that attempts to cancel the data binding, the data binding will still occur.</span></span> <span data-ttu-id="f85f3-139">在这种情况下，要<xref:System.Windows.Forms.Control.Validated>在事件中执行验证，请将控件的**数据源更新模式**属性（**下（数据绑定）（**\\**高级）** 从**On验证**更改为**从不**，并将*控制*`.DataBindings["`*\<YOURFIELD>*`"].WriteValue()`添加到验证代码中。</span><span class="sxs-lookup"><span data-stu-id="f85f3-139">In this case, to perform validation in the <xref:System.Windows.Forms.Control.Validated> event, change the control's **Data Source Update Mode** property (**under (Databindings)**\\ **(Advanced)**) from **OnValidation** to **Never**, and add *Control*`.DataBindings["`*\<YOURFIELD>*`"].WriteValue()` to your validation code.</span></span>  
  
### <a name="implicit-and-explicit-validation"></a><span data-ttu-id="f85f3-140">隐式和显式验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-140">Implicit and Explicit Validation</span></span>  
 <span data-ttu-id="f85f3-141">那么，控件的数据何时得到验证？</span><span class="sxs-lookup"><span data-stu-id="f85f3-141">So when does a control's data get validated?</span></span> <span data-ttu-id="f85f3-142">这由您，开发人员决定。</span><span class="sxs-lookup"><span data-stu-id="f85f3-142">This is up to you, the developer.</span></span> <span data-ttu-id="f85f3-143">您可以根据应用程序的需求使用隐式或显式验证。</span><span class="sxs-lookup"><span data-stu-id="f85f3-143">You can use either implicit or explicit validation, depending on the needs of your application.</span></span>  
  
#### <a name="implicit-validation"></a><span data-ttu-id="f85f3-144">隐式验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-144">Implicit Validation</span></span>  
 <span data-ttu-id="f85f3-145">隐式验证方法在用户输入数据时验证数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-145">The implicit validation approach validates data as the user enters it.</span></span> <span data-ttu-id="f85f3-146">通过在按下键时读取数据输入数据时验证数据，或者当用户将输入焦点从一个控件移开并移动到下一个控件时，更常见的验证数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-146">You can validate the data as the data is entered in a control by reading the keys as they are pressed, or more commonly whenever the user takes the input focus away from one control and moves to the next.</span></span> <span data-ttu-id="f85f3-147">当您希望向用户提供有关数据工作时的即时反馈时，此方法非常有用。</span><span class="sxs-lookup"><span data-stu-id="f85f3-147">This approach is useful when you want to give the user immediate feedback about the data as they are working.</span></span>  
  
 <span data-ttu-id="f85f3-148">如果要对控件使用隐式验证，则必须将该控件的属性<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>设置为<xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>或<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>。</span><span class="sxs-lookup"><span data-stu-id="f85f3-148">If you want to use implicit validation for a control, you must set that control's <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property to <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> or <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>.</span></span> <span data-ttu-id="f85f3-149">如果取消该<xref:System.Windows.Forms.Control.Validating>事件，控件的行为将由分配给 的值决定<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>。</span><span class="sxs-lookup"><span data-stu-id="f85f3-149">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the behavior of the control will be determined by what value that you assigned to <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.</span></span> <span data-ttu-id="f85f3-150">如果分配<xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>，取消事件将导致<xref:System.Windows.Forms.Control.Validated>事件不会发生。</span><span class="sxs-lookup"><span data-stu-id="f85f3-150">If you assigned <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, canceling the event will cause the <xref:System.Windows.Forms.Control.Validated> event not to occur.</span></span> <span data-ttu-id="f85f3-151">输入焦点将保留在当前控件上，直到用户将数据更改为有效输入。</span><span class="sxs-lookup"><span data-stu-id="f85f3-151">Input focus will remain on the current control until the user changes the data to a valid input.</span></span> <span data-ttu-id="f85f3-152">如果分配<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>了<xref:System.Windows.Forms.Control.Validated>，则取消事件时不会发生事件，但焦点仍将更改为下一个控件。</span><span class="sxs-lookup"><span data-stu-id="f85f3-152">If you assigned <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, the <xref:System.Windows.Forms.Control.Validated> event will not occur when you cancel the event, but focus will still change to the next control.</span></span>  
  
 <span data-ttu-id="f85f3-153">分配给<xref:System.Windows.Forms.AutoValidate.Disable>属性<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>可完全防止隐式验证。</span><span class="sxs-lookup"><span data-stu-id="f85f3-153">Assigning <xref:System.Windows.Forms.AutoValidate.Disable> to the <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property prevents implicit validation altogether.</span></span> <span data-ttu-id="f85f3-154">要验证控件，必须使用显式验证。</span><span class="sxs-lookup"><span data-stu-id="f85f3-154">To validate your controls, you will have to use explicit validation.</span></span>  
  
#### <a name="explicit-validation"></a><span data-ttu-id="f85f3-155">显式验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-155">Explicit Validation</span></span>  
 <span data-ttu-id="f85f3-156">显式验证方法一次验证数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-156">The explicit validation approach validates data at one time.</span></span> <span data-ttu-id="f85f3-157">您可以验证数据以响应用户操作，例如单击"保存"按钮或"下一步"链接。</span><span class="sxs-lookup"><span data-stu-id="f85f3-157">You can validate the data in response to a user action, such as clicking a Save button or a Next link.</span></span> <span data-ttu-id="f85f3-158">发生用户操作时，可以通过以下方式之一触发显式验证：</span><span class="sxs-lookup"><span data-stu-id="f85f3-158">When the user action occurs, you can trigger explicit validation in one of the following ways:</span></span>  
  
- <span data-ttu-id="f85f3-159">调用<xref:System.Windows.Forms.ContainerControl.Validate%2A>以验证最后一个控件失去焦点。</span><span class="sxs-lookup"><span data-stu-id="f85f3-159">Call <xref:System.Windows.Forms.ContainerControl.Validate%2A> to validate the last control to have lost focus.</span></span>  
  
- <span data-ttu-id="f85f3-160">调用<xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A>以验证窗体或容器控件中的所有子控件。</span><span class="sxs-lookup"><span data-stu-id="f85f3-160">Call <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> to validate all child controls in a form or container control.</span></span>  
  
- <span data-ttu-id="f85f3-161">调用自定义方法以手动验证控件中的数据。</span><span class="sxs-lookup"><span data-stu-id="f85f3-161">Call a custom method to validate the data in the controls manually.</span></span>  
  
#### <a name="default-implicit-validation-behavior-for-windows-forms-controls"></a><span data-ttu-id="f85f3-162">Windows 窗体控件的默认隐式验证行为</span><span class="sxs-lookup"><span data-stu-id="f85f3-162">Default Implicit Validation Behavior for Windows Forms Controls</span></span>  
 <span data-ttu-id="f85f3-163">不同的 Windows 窗体控件对其<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>属性具有不同的默认值。</span><span class="sxs-lookup"><span data-stu-id="f85f3-163">Different Windows Forms controls have different defaults for their <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property.</span></span> <span data-ttu-id="f85f3-164">下表显示了最常见的控件及其默认值。</span><span class="sxs-lookup"><span data-stu-id="f85f3-164">The following table shows the most common controls and their defaults.</span></span>  
  
|<span data-ttu-id="f85f3-165">控制</span><span class="sxs-lookup"><span data-stu-id="f85f3-165">Control</span></span>|<span data-ttu-id="f85f3-166">默认验证行为</span><span class="sxs-lookup"><span data-stu-id="f85f3-166">Default Validation Behavior</span></span>|  
|-------------|---------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
|<xref:System.Windows.Forms.PropertyGrid>|<span data-ttu-id="f85f3-167">未在视觉工作室中公开的属性</span><span class="sxs-lookup"><span data-stu-id="f85f3-167">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.ToolStripContainer>|<span data-ttu-id="f85f3-168">未在视觉工作室中公开的属性</span><span class="sxs-lookup"><span data-stu-id="f85f3-168">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
  
## <a name="closing-the-form-and-overriding-validation"></a><span data-ttu-id="f85f3-169">关闭窗体和覆盖验证</span><span class="sxs-lookup"><span data-stu-id="f85f3-169">Closing the Form and Overriding Validation</span></span>  
 <span data-ttu-id="f85f3-170">当控件由于它包含的数据无效而保持焦点时，不可能以通常的方式之一关闭父窗体：</span><span class="sxs-lookup"><span data-stu-id="f85f3-170">When a control maintains focus because the data it contains is invalid, it is impossible to close the parent form in one of the usual ways:</span></span>  
  
- <span data-ttu-id="f85f3-171">通过单击"**关闭**"按钮。</span><span class="sxs-lookup"><span data-stu-id="f85f3-171">By clicking the **Close** button.</span></span>  
  
- <span data-ttu-id="f85f3-172">通过在 **"系统**"菜单中选择 **"关闭**"。</span><span class="sxs-lookup"><span data-stu-id="f85f3-172">By selecting **Close** in the **System** menu.</span></span>  
  
- <span data-ttu-id="f85f3-173">通过以编程<xref:System.Windows.Forms.Form.Close%2A>方式调用方法。</span><span class="sxs-lookup"><span data-stu-id="f85f3-173">By calling the <xref:System.Windows.Forms.Form.Close%2A> method programmatically.</span></span>  
  
 <span data-ttu-id="f85f3-174">但是，在某些情况下，您可能希望让用户关闭窗体，而不管控件中的值是否有效。</span><span class="sxs-lookup"><span data-stu-id="f85f3-174">However, in some cases, you might want to let the user close the form regardless of whether the values in the controls are valid.</span></span> <span data-ttu-id="f85f3-175">您可以通过为窗体<xref:System.Windows.Forms.Form.FormClosing>的事件创建处理程序来覆盖验证并关闭仍包含无效数据的窗体。</span><span class="sxs-lookup"><span data-stu-id="f85f3-175">You can override validation and close a form that still contains invalid data by creating a handler for the form's <xref:System.Windows.Forms.Form.FormClosing> event.</span></span> <span data-ttu-id="f85f3-176">在这种情况下，将<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>属性设置为`false`。</span><span class="sxs-lookup"><span data-stu-id="f85f3-176">In the event, set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `false`.</span></span> <span data-ttu-id="f85f3-177">这将强制窗体关闭。</span><span class="sxs-lookup"><span data-stu-id="f85f3-177">This forces the form to close.</span></span> <span data-ttu-id="f85f3-178">有关详细信息及示例，请参阅<xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="f85f3-178">For more information and an example, see <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="f85f3-179">如果强制以这种方式关闭窗体，则窗体控件中尚未保存的任何数据都将丢失。</span><span class="sxs-lookup"><span data-stu-id="f85f3-179">If you force the form to close in this manner, any data in the form's controls that has not already been saved is lost.</span></span> <span data-ttu-id="f85f3-180">此外，模态窗体在关闭控件时不会验证它们的内容。</span><span class="sxs-lookup"><span data-stu-id="f85f3-180">In addition, modal forms do not validate the contents of controls when they are closed.</span></span> <span data-ttu-id="f85f3-181">您仍可以使用控件验证将焦点锁定到控件，但不必担心与关闭窗体相关的行为。</span><span class="sxs-lookup"><span data-stu-id="f85f3-181">You can still use control validation to lock focus to a control, but you do not have to be concerned about the behavior associated with closing the form.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f85f3-182">另请参阅</span><span class="sxs-lookup"><span data-stu-id="f85f3-182">See also</span></span>

- <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>
- <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>
- <xref:System.Windows.Forms.FormClosingEventArgs?displayProperty=nameWithType>
- [<span data-ttu-id="f85f3-183">MaskedTextBox 控件</span><span class="sxs-lookup"><span data-stu-id="f85f3-183">MaskedTextBox Control</span></span>](./controls/maskedtextbox-control-windows-forms.md)
- [<span data-ttu-id="f85f3-184">正则表达式示例</span><span class="sxs-lookup"><span data-stu-id="f85f3-184">Regular Expression Examples</span></span>](../../standard/base-types/regular-expression-example-scanning-for-hrefs.md)
