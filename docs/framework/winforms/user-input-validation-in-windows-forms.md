---
title: Windows 窗体中的用户输入验证
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
ms.openlocfilehash: c8a40706df4274728b438cff2539173a0e94b767
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/18/2019
ms.locfileid: "59076674"
---
# <a name="user-input-validation-in-windows-forms"></a><span data-ttu-id="ea4cb-102">Windows 窗体中的用户输入验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-102">User Input Validation in Windows Forms</span></span>
<span data-ttu-id="ea4cb-103">当用户输入到你的应用程序数据时，你可以验证数据有效，然后再在应用程序将使用它。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-103">When users enter data into your application, you may want to verify that the data is valid before your application uses it.</span></span> <span data-ttu-id="ea4cb-104">可能需要某些文本字段不为零长度、 字段将格式化为电话号码或其他类型的格式正确的数据，或字符串不包含任何不安全字符无法用于危及安全的数据库。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-104">You may require that certain text fields not be zero-length, that a field be formatted as a telephone number or other type of well-formed data, or that a string not contain any unsafe characters that could be used to compromise the security of a database.</span></span> <span data-ttu-id="ea4cb-105">Windows 窗体提供了几种方法，以验证你的应用程序中的输入。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-105">Windows Forms provides several ways for you to validate input in your application.</span></span>  
  
## <a name="validation-with-the-maskedtextbox-control"></a><span data-ttu-id="ea4cb-106">使用 MaskedTextBox 控件进行验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-106">Validation with the MaskedTextBox Control</span></span>  
 <span data-ttu-id="ea4cb-107">如果你需要要求用户输入数据中的定义完善的格式，如电话号码或部分数字，你可以完成此操作速度快、 最少的代码使用<xref:System.Windows.Forms.MaskedTextBox>控件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-107">If you need to require users to enter data in a well-defined format, such as a telephone number or a part number, you can accomplish this quickly and with minimal code by using the <xref:System.Windows.Forms.MaskedTextBox> control.</span></span> <span data-ttu-id="ea4cb-108">一个*掩码*是指定可以在任何给定位置在文本框中输入的字符的掩码语言的字符组成的字符串。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-108">A *mask* is a string made up of characters from a masking language that specifies which characters can be entered at any given position in the text box.</span></span> <span data-ttu-id="ea4cb-109">控件向用户显示一组提示。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-109">The control displays a set of prompts to the user.</span></span> <span data-ttu-id="ea4cb-110">如果用户键入的不正确的条目，例如，在用户键入字母数字时所需，该控件将自动拒绝输入。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-110">If the user types an incorrect entry, for example, the user types a letter when a digit is required, the control will automatically reject the input.</span></span>  
  
 <span data-ttu-id="ea4cb-111">使用的掩码语言<xref:System.Windows.Forms.MaskedTextBox>非常灵活。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-111">The masking language that is used by <xref:System.Windows.Forms.MaskedTextBox> is very flexible.</span></span> <span data-ttu-id="ea4cb-112">它允许您指定所需的字符、 可选的字符、 原义字符，如连字符和括号，货币字符和日期分隔符。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-112">It allows you to specify required characters, optional characters, literal characters, such as hyphens and parentheses, currency characters, and date separators.</span></span> <span data-ttu-id="ea4cb-113">该控件也适用于良好时绑定到数据源。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-113">The control also works well when bound to a data source.</span></span> <span data-ttu-id="ea4cb-114"><xref:System.Windows.Forms.Binding.Format>上的数据绑定事件可用于重新设置格式传入的数据以符合掩码和<xref:System.Windows.Forms.Binding.Parse>事件可用于重新格式化传出的数据以遵守与数据字段的规范。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-114">The <xref:System.Windows.Forms.Binding.Format> event on a data binding can be used to reformat incoming data to comply with the mask, and the <xref:System.Windows.Forms.Binding.Parse> event can be used to reformat outgoing data to comply with the specifications of the data field.</span></span>  
  
 <span data-ttu-id="ea4cb-115">有关详细信息，请参阅[MaskedTextBox 控件](./controls/maskedtextbox-control-windows-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-115">For more information, see [MaskedTextBox Control](./controls/maskedtextbox-control-windows-forms.md).</span></span>  
  
## <a name="event-driven-validation"></a><span data-ttu-id="ea4cb-116">事件驱动的验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-116">Event-Driven Validation</span></span>  
 <span data-ttu-id="ea4cb-117">如果您想要完整的编程控制验证，或需要执行复杂的验证检查，则应使用大多数 Windows 窗体控件中内置的验证事件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-117">If you want full programmatic control over validation, or need to perform complex validation checks, you should use the validation events built into most Windows Forms controls.</span></span> <span data-ttu-id="ea4cb-118">接受自由的用户输入的每个控件具有<xref:System.Windows.Forms.Control.Validating>每当该控件所需数据验证时将发生的事件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-118">Each control that accepts free-form user input has a <xref:System.Windows.Forms.Control.Validating> event that will occur whenever the control requires data validation.</span></span> <span data-ttu-id="ea4cb-119">在<xref:System.Windows.Forms.Control.Validating>事件处理方法，可以验证用户输入以下几种方式。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-119">In the <xref:System.Windows.Forms.Control.Validating> event-handling method, you can validate user input in several ways.</span></span> <span data-ttu-id="ea4cb-120">例如，如果您有必须包含邮政编码的文本框中，您可以按以下方式来执行验证：</span><span class="sxs-lookup"><span data-stu-id="ea4cb-120">For example, if you have a text box that must contain a postal code, you can perform the validation in the following ways:</span></span>  
  
-   <span data-ttu-id="ea4cb-121">如果邮政编码必须属于特定组的邮政编码，您可以对要验证用户输入的数据的输入执行字符串比较。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-121">If the postal code must belong to a specific group of zip codes, you can perform a string comparison on the input to validate the data entered by the user.</span></span> <span data-ttu-id="ea4cb-122">例如，如果邮政编码必须为 {10001、 10002，10003} 集中，然后可以使用字符串比较来验证数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-122">For example, if the postal code must be in the set {10001, 10002, 10003}, then you can use a string comparison to validate the data.</span></span>  
  
-   <span data-ttu-id="ea4cb-123">如果邮政编码必须为特定窗体中您可以使用正则表达式验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-123">If the postal code must be in a specific form you can use regular expressions to validate the data entered by the user.</span></span> <span data-ttu-id="ea4cb-124">例如，若要验证的表单`#####`或`#####-####`，可以使用正则表达式`^(\d{5})(-\d{4})?$`。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-124">For example, to validate the form `#####` or `#####-####`, you can use the regular expression `^(\d{5})(-\d{4})?$`.</span></span> <span data-ttu-id="ea4cb-125">若要验证的表单`A#A #A#`，可以使用正则表达式`[A-Z]\d[A-Z] \d[A-Z]\d`。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-125">To validate the form `A#A #A#`, you can use the regular expression `[A-Z]\d[A-Z] \d[A-Z]\d`.</span></span> <span data-ttu-id="ea4cb-126">有关正则表达式的详细信息，请参阅[.NET Framework 正则表达式](../../standard/base-types/regular-expressions.md)并[正则表达式示例](../../standard/base-types/regular-expression-examples.md)。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-126">For more information about regular expressions, see [.NET Framework Regular Expressions](../../standard/base-types/regular-expressions.md) and [Regular Expression Examples](../../standard/base-types/regular-expression-examples.md).</span></span>  
  
-   <span data-ttu-id="ea4cb-127">如果邮政编码必须是有效的美国邮政编码，则可以调用邮政编码 Web 服务，以便验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-127">If the postal code must be a valid United States Zip code, you could call a Zip code Web service to validate the data entered by the user.</span></span>  
  
 <span data-ttu-id="ea4cb-128"><xref:System.Windows.Forms.Control.Validating>提供事件类型的对象<xref:System.ComponentModel.CancelEventArgs>。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-128">The <xref:System.Windows.Forms.Control.Validating> event is supplied an object of type <xref:System.ComponentModel.CancelEventArgs>.</span></span> <span data-ttu-id="ea4cb-129">如果您确定控件的数据无效，则可以取消<xref:System.Windows.Forms.Control.Validating>通过设置此对象的事件<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-129">If you determine that the control's data is not valid, you can cancel the <xref:System.Windows.Forms.Control.Validating> event by setting this object's <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `true`.</span></span> <span data-ttu-id="ea4cb-130">如果未设置<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>属性，Windows 窗体将假定该验证已成功为该控件，并引发<xref:System.Windows.Forms.Control.Validated>事件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-130">If you do not set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property, Windows Forms will assume that validation succeeded for that control, and raise the <xref:System.Windows.Forms.Control.Validated> event.</span></span>  
  
 <span data-ttu-id="ea4cb-131">有关验证电子邮件地址中的代码示例<xref:System.Windows.Controls.TextBox>，请参阅<xref:System.Windows.Forms.Control.Validating>。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-131">For a code example that validates an email address in a <xref:System.Windows.Controls.TextBox>, see <xref:System.Windows.Forms.Control.Validating>.</span></span>  
  
### <a name="data-binding-and-event-driven-validation"></a><span data-ttu-id="ea4cb-132">数据绑定和事件驱动的验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-132">Data Binding and Event-Driven Validation</span></span>  
 <span data-ttu-id="ea4cb-133">将控件绑定到数据源，例如数据库表时，验证会非常有用。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-133">Validation is very useful when you have bound your controls to a data source, such as a database table.</span></span> <span data-ttu-id="ea4cb-134">通过使用验证，你可以确保控件的数据满足所需的数据源的格式和它不包含任何特殊字符如引号和备份正斜杠可能不安全。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-134">By using validation, you can make sure that your control's data satisfies the format required by the data source, and that it does not contain any special characters such as quotation marks and back slashes that might be unsafe.</span></span>  
  
 <span data-ttu-id="ea4cb-135">如果使用数据绑定，在控件中的数据与同步数据源执行期间<xref:System.Windows.Forms.Control.Validating>事件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-135">When you use data binding, the data in your control is synchronized with the data source during execution of the <xref:System.Windows.Forms.Control.Validating> event.</span></span> <span data-ttu-id="ea4cb-136">如果您取消<xref:System.Windows.Forms.Control.Validating>事件，不会与数据源同步数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-136">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the data will not be synchronized with the data source.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="ea4cb-137">如果您有后会发生的自定义验证<xref:System.Windows.Forms.Control.Validating>事件，它将不会影响数据绑定。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-137">If you have custom validation that takes place after the <xref:System.Windows.Forms.Control.Validating> event, it will not affect the data binding.</span></span> <span data-ttu-id="ea4cb-138">例如，如果您的代码<xref:System.Windows.Forms.Control.Validated>尝试取消数据绑定的事件，仍会发生数据绑定。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-138">For example, if you have code in a <xref:System.Windows.Forms.Control.Validated> event that attempts to cancel the data binding, the data binding will still occur.</span></span> <span data-ttu-id="ea4cb-139">在此情况下，若要执行中的验证<xref:System.Windows.Forms.Control.Validated>事件，更改控件的**数据源更新模式**属性 (**在 (Databindings) 下**\\ **（高级）**) 从**OnValidation**到**从不**，并添加*控制*`.DataBindings["`*\<YOURFIELD >* `"].WriteValue()`到您的验证代码。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-139">In this case, to perform validation in the <xref:System.Windows.Forms.Control.Validated> event, change the control's **Data Source Update Mode** property (**under (Databindings)**\\ **(Advanced)**) from **OnValidation** to **Never**, and add *Control*`.DataBindings["`*\<YOURFIELD>*`"].WriteValue()` to your validation code.</span></span>  
  
### <a name="implicit-and-explicit-validation"></a><span data-ttu-id="ea4cb-140">隐式和显式验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-140">Implicit and Explicit Validation</span></span>  
 <span data-ttu-id="ea4cb-141">因此何时控件的数据验证？</span><span class="sxs-lookup"><span data-stu-id="ea4cb-141">So when does a control's data get validated?</span></span> <span data-ttu-id="ea4cb-142">这是取决于您，开发人员。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-142">This is up to you, the developer.</span></span> <span data-ttu-id="ea4cb-143">可以使用隐式或显式验证，具体取决于应用程序的需求。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-143">You can use either implicit or explicit validation, depending on the needs of your application.</span></span>  
  
#### <a name="implicit-validation"></a><span data-ttu-id="ea4cb-144">隐式验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-144">Implicit Validation</span></span>  
 <span data-ttu-id="ea4cb-145">当用户输入其会隐式验证方法验证数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-145">The implicit validation approach validates data as the user enters it.</span></span> <span data-ttu-id="ea4cb-146">为通常只要用户将输入的焦点离开控件并移动到下一步中通过读取密钥，因为它们被按下，控件或多个输入数据后，可以验证数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-146">You can validate the data as the data is entered in a control by reading the keys as they are pressed, or more commonly whenever the user takes the input focus away from one control and moves to the next.</span></span> <span data-ttu-id="ea4cb-147">当您希望他们正在为用户有关的数据的即时反馈，此方法非常有用。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-147">This approach is useful when you want to give the user immediate feedback about the data as they are working.</span></span>  
  
 <span data-ttu-id="ea4cb-148">如果你想要使用的控件的隐式验证，则必须设置该控件的<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-148">If you want to use implicit validation for a control, you must set that control's <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property to `true`.</span></span> <span data-ttu-id="ea4cb-149">如果您取消<xref:System.Windows.Forms.Control.Validating>事件，该控件的行为将由你分配给的值<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-149">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the behavior of the control will be determined by what value that you assigned to <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.</span></span> <span data-ttu-id="ea4cb-150">如果您分配<xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>，取消该事件将导致<xref:System.Windows.Forms.Control.Validated>事件不发生。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-150">If you assigned <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, canceling the event will cause the <xref:System.Windows.Forms.Control.Validated> event not to occur.</span></span> <span data-ttu-id="ea4cb-151">输入的焦点将保留在当前控件，直到用户将数据更改为有效的输入。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-151">Input focus will remain on the current control until the user changes the data to a valid input.</span></span> <span data-ttu-id="ea4cb-152">如果您分配<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>，则<xref:System.Windows.Forms.Control.Validated>时取消该事件，但焦点仍将更改到下一个控件，不会出现事件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-152">If you assigned <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, the <xref:System.Windows.Forms.Control.Validated> event will not occur when you cancel the event, but focus will still change to the next control.</span></span>  
  
 <span data-ttu-id="ea4cb-153">将分配<xref:System.Windows.Forms.AutoValidate.Disable>到<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>属性会完全阻止隐式验证。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-153">Assigning <xref:System.Windows.Forms.AutoValidate.Disable> to the <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property prevents implicit validation altogether.</span></span> <span data-ttu-id="ea4cb-154">若要验证您的控件，您将需要使用显式验证。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-154">To validate your controls, you will have to use explicit validation.</span></span>  
  
#### <a name="explicit-validation"></a><span data-ttu-id="ea4cb-155">显式验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-155">Explicit Validation</span></span>  
 <span data-ttu-id="ea4cb-156">显式验证方法验证一次数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-156">The explicit validation approach validates data at one time.</span></span> <span data-ttu-id="ea4cb-157">可以验证响应用户操作，例如单击保存按钮或下一个链接中的数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-157">You can validate the data in response to a user action, such as clicking a Save button or a Next link.</span></span> <span data-ttu-id="ea4cb-158">当用户执行任何操作发生时，可以通过以下方式之一来触发显式验证：</span><span class="sxs-lookup"><span data-stu-id="ea4cb-158">When the user action occurs, you can trigger explicit validation in one of the following ways:</span></span>  
  
-   <span data-ttu-id="ea4cb-159">调用<xref:System.Windows.Forms.ContainerControl.Validate%2A>来验证失去焦点的最后一个控件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-159">Call <xref:System.Windows.Forms.ContainerControl.Validate%2A> to validate the last control to have lost focus.</span></span>  
  
-   <span data-ttu-id="ea4cb-160">调用<xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A>来验证窗体或容器控件中的所有子控件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-160">Call <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> to validate all child controls in a form or container control.</span></span>  
  
-   <span data-ttu-id="ea4cb-161">调用自定义的方法来手动验证控件中的数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-161">Call a custom method to validate the data in the controls manually.</span></span>  
  
#### <a name="default-implicit-validation-behavior-for-windows-forms-controls"></a><span data-ttu-id="ea4cb-162">默认隐式验证行为的 Windows 窗体控件</span><span class="sxs-lookup"><span data-stu-id="ea4cb-162">Default Implicit Validation Behavior for Windows Forms Controls</span></span>  
 <span data-ttu-id="ea4cb-163">不同的 Windows 窗体控件具有不同的默认值为其<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-163">Different Windows Forms controls have different defaults for their <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property.</span></span> <span data-ttu-id="ea4cb-164">下表显示了最常用的控件和各自的默认值。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-164">The following table shows the most common controls and their defaults.</span></span>  
  
|<span data-ttu-id="ea4cb-165">控件</span><span class="sxs-lookup"><span data-stu-id="ea4cb-165">Control</span></span>|<span data-ttu-id="ea4cb-166">默认验证行为</span><span class="sxs-lookup"><span data-stu-id="ea4cb-166">Default Validation Behavior</span></span>|  
|-------------|---------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
|<xref:System.Windows.Forms.PropertyGrid>|<span data-ttu-id="ea4cb-167">Visual Studio 中未公开的属性</span><span class="sxs-lookup"><span data-stu-id="ea4cb-167">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.ToolStripContainer>|<span data-ttu-id="ea4cb-168">Visual Studio 中未公开的属性</span><span class="sxs-lookup"><span data-stu-id="ea4cb-168">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
  
## <a name="closing-the-form-and-overriding-validation"></a><span data-ttu-id="ea4cb-169">关闭该窗体和重写验证</span><span class="sxs-lookup"><span data-stu-id="ea4cb-169">Closing the Form and Overriding Validation</span></span>  
 <span data-ttu-id="ea4cb-170">当控件保持焦点，因为它包含的数据无效时，就无法关闭父窗体中的常用方法之一：</span><span class="sxs-lookup"><span data-stu-id="ea4cb-170">When a control maintains focus because the data it contains is invalid, it is impossible to close the parent form in one of the usual ways:</span></span>  
  
-   <span data-ttu-id="ea4cb-171">通过单击**关闭**按钮。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-171">By clicking the **Close** button.</span></span>  
  
-   <span data-ttu-id="ea4cb-172">通过选择**关闭**中**系统**菜单。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-172">By selecting **Close** in the **System** menu.</span></span>  
  
-   <span data-ttu-id="ea4cb-173">通过调用<xref:System.Windows.Forms.Form.Close%2A>方法以编程方式。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-173">By calling the <xref:System.Windows.Forms.Form.Close%2A> method programmatically.</span></span>  
  
 <span data-ttu-id="ea4cb-174">但是，在某些情况下，你可能想要让用户关闭该窗体而不考虑在控件中的值是否有效。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-174">However, in some cases, you might want to let the user close the form regardless of whether the values in the controls are valid.</span></span> <span data-ttu-id="ea4cb-175">您可以重写验证并关闭仍通过创建窗体的一个处理程序中包含无效数据的窗体<xref:System.Windows.Forms.Form.Closing>事件。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-175">You can override validation and close a form that still contains invalid data by creating a handler for the form's <xref:System.Windows.Forms.Form.Closing> event.</span></span> <span data-ttu-id="ea4cb-176">在事件中，设置<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>属性设置为`false`。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-176">In the event, set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `false`.</span></span> <span data-ttu-id="ea4cb-177">这会强制关闭该窗体。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-177">This forces the form to close.</span></span> <span data-ttu-id="ea4cb-178">有关详细信息及示例，请参阅<xref:System.Windows.Forms.Form.Closing?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-178">For more information and an example, see <xref:System.Windows.Forms.Form.Closing?displayProperty=nameWithType>.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ea4cb-179">如果强制以这种方式关闭该窗体时，会丢失尚未保存的窗体的控件中的任何数据。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-179">If you force the form to close in this manner, any data in the form's controls that has not already been saved is lost.</span></span> <span data-ttu-id="ea4cb-180">此外，有模式窗体关闭时不会验证的控件的内容。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-180">In addition, modal forms do not validate the contents of controls when they are closed.</span></span> <span data-ttu-id="ea4cb-181">您仍可以使用控件验证锁定焦点设置到一个控件，但不是需要关心如何与关闭该窗体关联的行为。</span><span class="sxs-lookup"><span data-stu-id="ea4cb-181">You can still use control validation to lock focus to a control, but you do not have to be concerned about the behavior associated with closing the form.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ea4cb-182">请参阅</span><span class="sxs-lookup"><span data-stu-id="ea4cb-182">See also</span></span>

- <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>
- <xref:System.Windows.Forms.Form.Closing?displayProperty=nameWithType>
- <xref:System.ComponentModel.CancelEventArgs?displayProperty=nameWithType>
- [<span data-ttu-id="ea4cb-183">MaskedTextBox 控件</span><span class="sxs-lookup"><span data-stu-id="ea4cb-183">MaskedTextBox Control</span></span>](./controls/maskedtextbox-control-windows-forms.md)
- [<span data-ttu-id="ea4cb-184">正则表达式示例</span><span class="sxs-lookup"><span data-stu-id="ea4cb-184">Regular Expression Examples</span></span>](../../standard/base-types/regular-expression-examples.md)
