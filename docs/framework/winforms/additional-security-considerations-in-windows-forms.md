---
title: Windows 窗体中额外的安全注意事项
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Forms, secure calls to Windows API
- security [Windows Forms]
- security [Windows Forms], calling APIs
- Clipboard [Windows Forms], securing access
ms.assetid: 15abda8b-0527-47c7-aedb-77ab595f2bf1
ms.openlocfilehash: 2d7f5bfc1532775d092fbee1ef9cdc3c7ed5efc6
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2019
ms.locfileid: "54496652"
---
# <a name="additional-security-considerations-in-windows-forms"></a><span data-ttu-id="5fc5b-102">Windows 窗体中额外的安全注意事项</span><span class="sxs-lookup"><span data-stu-id="5fc5b-102">Additional Security Considerations in Windows Forms</span></span>
[!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] <span data-ttu-id="5fc5b-103">安全设置可能导致应用程序在部分信任环境中运行与在本地计算机上运行有所不同。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-103">security settings might cause your application to run differently in a partial trust environment than on your local computer.</span></span> <span data-ttu-id="5fc5b-104">[!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 限制对关键本地资源的访问，如文件系统、网络和非托管 API 等。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-104">The [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] restricts access to such critical local resources as the file system, network, and unmanaged APIs, among other things.</span></span> <span data-ttu-id="5fc5b-105">安全设置会影响对安全系统无法验证的 Microsoft Win32 API 或其他 API 进行调用的能力。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-105">The security settings affect the ability to call the Microsoft Win32 API or other APIs that cannot be verified by the security system.</span></span> <span data-ttu-id="5fc5b-106">安全性还会影响应用程序的其他方面，包括文件和数据访问以及打印。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-106">Security also affects other aspects of your application, including file and data access, and printing.</span></span> <span data-ttu-id="5fc5b-107">有关在部分信任环境中访问文件和数据的详细信息，请参阅 [Windows 窗体中更加安全的文件和数据访问](../../../docs/framework/winforms/more-secure-file-and-data-access-in-windows-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-107">For more information about file and data access in a partial trust environment, see [More Secure File and Data Access in Windows Forms](../../../docs/framework/winforms/more-secure-file-and-data-access-in-windows-forms.md).</span></span> <span data-ttu-id="5fc5b-108">有关在部分信任环境中进行打印的详细信息，请参阅 [Windows 窗体中更加安全的打印](../../../docs/framework/winforms/more-secure-printing-in-windows-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-108">For more information about printing in a partial trust environment, see [More Secure Printing in Windows Forms](../../../docs/framework/winforms/more-secure-printing-in-windows-forms.md).</span></span>  
  
 <span data-ttu-id="5fc5b-109">以下各节讨论从在部分信任环境下运行的应用程序中，如何使用剪贴板，如何执行窗口操作以及如何调用 Win32 API。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-109">The following sections discuss how to work with the Clipboard, perform window manipulation, and call the Win32 API from applications that are running in a partial trust environment.</span></span>  
  
## <a name="clipboard-access"></a><span data-ttu-id="5fc5b-110">剪贴板访问</span><span class="sxs-lookup"><span data-stu-id="5fc5b-110">Clipboard Access</span></span>  
 <span data-ttu-id="5fc5b-111"><xref:System.Security.Permissions.UIPermission>类控制对剪贴板，并显示关联的访问<xref:System.Security.Permissions.UIPermissionClipboard>枚举值指示的访问级别。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-111">The <xref:System.Security.Permissions.UIPermission> class controls access to the Clipboard, and the associated <xref:System.Security.Permissions.UIPermissionClipboard> enumeration value indicates the level of access.</span></span> <span data-ttu-id="5fc5b-112">下表显示可能的权限级别。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-112">The following table shows the possible permission levels.</span></span>  
  
|<span data-ttu-id="5fc5b-113">UIPermissionClipboard 值</span><span class="sxs-lookup"><span data-stu-id="5fc5b-113">UIPermissionClipboard value</span></span>|<span data-ttu-id="5fc5b-114">描述</span><span class="sxs-lookup"><span data-stu-id="5fc5b-114">Description</span></span>|  
|---------------------------------|-----------------|  
|<xref:System.Security.Permissions.UIPermissionClipboard.AllClipboard>|<span data-ttu-id="5fc5b-115">可以不受限制地使用剪贴板。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-115">The Clipboard can be used without restriction.</span></span>|  
|<xref:System.Security.Permissions.UIPermissionClipboard.OwnClipboard>|<span data-ttu-id="5fc5b-116">使用剪贴板时有某些限制。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-116">The Clipboard can be used with some restrictions.</span></span> <span data-ttu-id="5fc5b-117">将数据放置到剪贴板中的能力（“复制”或“剪切”命令操作）是不受限制的。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-117">The ability to put data on the Clipboard (Copy or Cut command operations) is unrestricted.</span></span> <span data-ttu-id="5fc5b-118">接受粘贴的固有控件（例如文本框）可接受剪贴板数据，但用户控件无法以编程方式从剪贴板读取数据。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-118">Intrinsic controls that accept paste, such as a text box, can accept Clipboard data, but user controls cannot programmatically read from the Clipboard.</span></span>|  
|<xref:System.Security.Permissions.UIPermissionClipboard.NoClipboard>|<span data-ttu-id="5fc5b-119">不能使用剪贴板。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-119">The Clipboard cannot be used.</span></span>|  
  
 <span data-ttu-id="5fc5b-120">默认情况下，本地 Intranet 区域接收<xref:System.Security.Permissions.UIPermissionClipboard.AllClipboard>访问权限和 Internet 区域接收<xref:System.Security.Permissions.UIPermissionClipboard.OwnClipboard>访问。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-120">By default, the Local Intranet zone receives <xref:System.Security.Permissions.UIPermissionClipboard.AllClipboard> access and the Internet zone receives <xref:System.Security.Permissions.UIPermissionClipboard.OwnClipboard> access.</span></span> <span data-ttu-id="5fc5b-121">这意味着，应用程序可以将数据复制到剪贴板，但无法通过编程方式进行粘贴或从剪贴板进行读取。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-121">This means that the application can copy data to the Clipboard, but the application cannot programmatically paste to or read from the Clipboard.</span></span> <span data-ttu-id="5fc5b-122">这些限制可以防止不完全受信任的程序读取另一应用程序复制到剪贴板的内容。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-122">These restrictions prevent programs without full trust from reading content copied to the Clipboard by another application.</span></span> <span data-ttu-id="5fc5b-123">如果应用程序需要完全的剪贴板访问权限，但你又不具有这些权限，则必须提升应用程序的权限。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-123">If your application requires full Clipboard access but you do not have the permissions, you will have to elevate the permissions for your application.</span></span> <span data-ttu-id="5fc5b-124">有关提升权限的详细信息，请参阅[常规安全策略管理](https://msdn.microsoft.com/library/5121fe35-f0e3-402c-94ab-4f35b0a87b4b)。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-124">For more information about elevating permissions, see [General Security Policy Administration](https://msdn.microsoft.com/library/5121fe35-f0e3-402c-94ab-4f35b0a87b4b).</span></span>  
  
## <a name="window-manipulation"></a><span data-ttu-id="5fc5b-125">窗口操作</span><span class="sxs-lookup"><span data-stu-id="5fc5b-125">Window Manipulation</span></span>  
 <span data-ttu-id="5fc5b-126"><xref:System.Security.Permissions.UIPermission>类还控制执行窗口操作和其他与 UI 相关的操作，和关联的权限<xref:System.Security.Permissions.UIPermissionWindow>枚举值指示的访问级别。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-126">The <xref:System.Security.Permissions.UIPermission> class also controls permission to perform window manipulation and other UI-related actions, and the associated <xref:System.Security.Permissions.UIPermissionWindow> enumeration value indicates the level of access.</span></span> <span data-ttu-id="5fc5b-127">下表显示可能的权限级别。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-127">The following table shows the possible permission levels.</span></span>  
  
 <span data-ttu-id="5fc5b-128">默认情况下，本地 Intranet 区域接收<xref:System.Security.Permissions.UIPermissionWindow.AllWindows>访问权限和 Internet 区域接收<xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows>访问。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-128">By default, the Local Intranet zone receives <xref:System.Security.Permissions.UIPermissionWindow.AllWindows> access and the Internet zone receives <xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows> access.</span></span> <span data-ttu-id="5fc5b-129">这意味着，在“Internet”区域中，应用程序可以执行大多数窗口操作和 UI 操作，但窗口的外观将被修改。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-129">This means that in the Internet zone, the application can perform most windowing and UI actions, but the window's appearance will be modified.</span></span> <span data-ttu-id="5fc5b-130">修改后的窗口在第一次运行时会显示一条气球状通知，包含修改的标题栏文本，并需要标题栏上有一个关闭按钮。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-130">The modified window displays a balloon notification when first run, contains modified title bar text, and requires a close button on the title bar.</span></span> <span data-ttu-id="5fc5b-131">气球状通知和标题栏会向应用程序的用户指示：应用程序正在部分信任环境下运行。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-131">The balloon notification and the title bar identify to the user of the application that the application is running under partial trust.</span></span>  
  
|<span data-ttu-id="5fc5b-132">UIPermissionWindow 值</span><span class="sxs-lookup"><span data-stu-id="5fc5b-132">UIPermissionWindow value</span></span>|<span data-ttu-id="5fc5b-133">描述</span><span class="sxs-lookup"><span data-stu-id="5fc5b-133">Description</span></span>|  
|------------------------------|-----------------|  
|<xref:System.Security.Permissions.UIPermissionWindow.AllWindows>|<span data-ttu-id="5fc5b-134">用户可以不受限制地使用所有窗口和用户输入事件。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-134">Users can use all windows and user input events without restriction.</span></span>|  
|<xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows>|<span data-ttu-id="5fc5b-135">用户只能使用较安全的顶级窗口和子窗口进行绘制，并且只能在这些顶级窗口和子窗口中使用用户界面的用户输入事件。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-135">Users can use only safer top-level windows and safer subwindows for drawing, and can use only user input events for the user interface within those top-level windows and subwindows.</span></span> <span data-ttu-id="5fc5b-136">这些较安全窗口具有明显的标签，并具有最小化和最大化限制。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-136">These safer windows are clearly labeled and have minimum and maximum size restrictions.</span></span> <span data-ttu-id="5fc5b-137">限制防止潜在的有害欺骗攻击，例如模拟系统登录屏幕或系统桌面，并将限制编程访问以父窗口、 与焦点相关的 Api 和使用<xref:System.Windows.Forms.ToolTip>控件，</span><span class="sxs-lookup"><span data-stu-id="5fc5b-137">The restrictions prevent potentially harmful spoofing attacks, such as imitating system logon screens or the system desktop, and restricts programmatic access to parent windows, focus-related APIs, and use of the <xref:System.Windows.Forms.ToolTip> control,</span></span>|  
|<xref:System.Security.Permissions.UIPermissionWindow.SafeSubWindows>|<span data-ttu-id="5fc5b-138">用户只能使用较安全子窗口进行绘制，并且只能在该子窗口中使用用户界面的用户输入事件。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-138">Users can use only safer subwindows for drawing, and can use only user input events for the user interface within that subwindow.</span></span> <span data-ttu-id="5fc5b-139">浏览器中显示的控件就是一个较安全子窗口的示例。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-139">A control displayed within a browser is an example of a safer subwindow.</span></span>|  
|<xref:System.Security.Permissions.UIPermissionWindow.NoWindows>|<span data-ttu-id="5fc5b-140">用户不能使用任何窗口或用户界面事件。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-140">Users cannot use any windows or user interface events.</span></span> <span data-ttu-id="5fc5b-141">不能使用任何用户界面。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-141">No user interface can be used.</span></span>|  
  
 <span data-ttu-id="5fc5b-142">由标识每个权限级别<xref:System.Security.Permissions.UIPermissionWindow>枚举允许其上面的级别比更少的操作。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-142">Each permission level identified by the <xref:System.Security.Permissions.UIPermissionWindow> enumeration allows fewer actions than the level above it.</span></span> <span data-ttu-id="5fc5b-143">以下各表指示受限制的操作<xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows>和<xref:System.Security.Permissions.UIPermissionWindow.SafeSubWindows>值。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-143">The following tables indicate the actions that are restricted by the <xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows> and <xref:System.Security.Permissions.UIPermissionWindow.SafeSubWindows> values.</span></span> <span data-ttu-id="5fc5b-144">有关每个成员所需的确切权限，请参阅 .NET Framework 类库文档中有关该成员的参考资料。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-144">For exact permissions that are required for each member, see the reference for that member in the .NET Framework class library documentation.</span></span>  
  
 <span data-ttu-id="5fc5b-145"><xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows> 权限限制下表中列出的操作。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-145"><xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows> permission restricts the actions listed in the following table.</span></span>  
  
|<span data-ttu-id="5fc5b-146">组件</span><span class="sxs-lookup"><span data-stu-id="5fc5b-146">Component</span></span>|<span data-ttu-id="5fc5b-147">受限制的操作</span><span class="sxs-lookup"><span data-stu-id="5fc5b-147">Restricted actions</span></span>|  
|---------------|------------------------|  
|<xref:System.Windows.Forms.Application>|<span data-ttu-id="5fc5b-148">-   设置 <xref:System.Windows.Forms.Application.SafeTopLevelCaptionFormat%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-148">-   Setting the <xref:System.Windows.Forms.Application.SafeTopLevelCaptionFormat%2A> property.</span></span>|  
|<xref:System.Windows.Forms.Control>|<span data-ttu-id="5fc5b-149">-获取<xref:System.Windows.Forms.Control.Parent%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-149">-   Getting the <xref:System.Windows.Forms.Control.Parent%2A> property.</span></span><br /><span data-ttu-id="5fc5b-150">-   设置 `Region` 属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-150">-   Setting the `Region` property.</span></span><br /><span data-ttu-id="5fc5b-151">-调用<xref:System.Windows.Forms.Control.FindForm%2A>， <xref:System.Windows.Forms.Control.Focus%2A>，<xref:System.Windows.Forms.Control.FromChildHandle%2A>并<xref:System.Windows.Forms.Control.FromHandle%2A>， <xref:System.Windows.Forms.Control.PreProcessMessage%2A>， <xref:System.Windows.Forms.Control.ReflectMessage%2A>，或<xref:System.Windows.Forms.Control.SetTopLevel%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-151">-   Calling the <xref:System.Windows.Forms.Control.FindForm%2A> , <xref:System.Windows.Forms.Control.Focus%2A>, <xref:System.Windows.Forms.Control.FromChildHandle%2A> and <xref:System.Windows.Forms.Control.FromHandle%2A>, <xref:System.Windows.Forms.Control.PreProcessMessage%2A>, <xref:System.Windows.Forms.Control.ReflectMessage%2A>, or <xref:System.Windows.Forms.Control.SetTopLevel%2A> method.</span></span><br /><span data-ttu-id="5fc5b-152">-调用<xref:System.Windows.Forms.Control.GetChildAtPoint%2A>方法如果返回的控件不是调用控件的子级。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-152">-   Calling the <xref:System.Windows.Forms.Control.GetChildAtPoint%2A> method if the control returned is not a child of the calling control.</span></span><br /><span data-ttu-id="5fc5b-153">-   修改容器控件内部的控件焦点。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-153">-   Modify control focus inside a container control.</span></span>|  
|<xref:System.Windows.Forms.Cursor>|<span data-ttu-id="5fc5b-154">-   设置 <xref:System.Windows.Forms.Cursor.Clip%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-154">-   Setting the <xref:System.Windows.Forms.Cursor.Clip%2A> property.</span></span><br /><span data-ttu-id="5fc5b-155">-调用<xref:System.Windows.Forms.Control.Hide%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-155">-   Calling the <xref:System.Windows.Forms.Control.Hide%2A> method.</span></span>|  
|<xref:System.Windows.Forms.DataGrid>|<span data-ttu-id="5fc5b-156">-调用<xref:System.Windows.Forms.ContainerControl.ProcessTabKey%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-156">-   Calling the <xref:System.Windows.Forms.ContainerControl.ProcessTabKey%2A> method.</span></span>|  
|<xref:System.Windows.Forms.Form>|<span data-ttu-id="5fc5b-157">-获取<xref:System.Windows.Forms.Form.ActiveForm%2A>或<xref:System.Windows.Forms.Form.MdiParent%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-157">-   Getting the <xref:System.Windows.Forms.Form.ActiveForm%2A> or <xref:System.Windows.Forms.Form.MdiParent%2A> property.</span></span><br /><span data-ttu-id="5fc5b-158">-设置<xref:System.Windows.Forms.Form.ControlBox%2A>， <xref:System.Windows.Forms.Form.ShowInTaskbar%2A>，或<xref:System.Windows.Forms.Form.TopMost%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-158">-   Setting the <xref:System.Windows.Forms.Form.ControlBox%2A>, <xref:System.Windows.Forms.Form.ShowInTaskbar%2A>, or <xref:System.Windows.Forms.Form.TopMost%2A> property.</span></span><br /><span data-ttu-id="5fc5b-159">-设置<xref:System.Windows.Forms.Form.Opacity%2A>低于 50%的属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-159">-   Setting the <xref:System.Windows.Forms.Form.Opacity%2A> property below 50%.</span></span><br /><span data-ttu-id="5fc5b-160">-设置<xref:System.Windows.Forms.Form.WindowState%2A>属性设置为<xref:System.Windows.Forms.FormWindowState.Minimized>以编程方式。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-160">-   Setting the <xref:System.Windows.Forms.Form.WindowState%2A> property to <xref:System.Windows.Forms.FormWindowState.Minimized> programmatically.</span></span><br /><span data-ttu-id="5fc5b-161">-调用<xref:System.Windows.Forms.Form.Activate%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-161">-   Calling the <xref:System.Windows.Forms.Form.Activate%2A> method.</span></span><br /><span data-ttu-id="5fc5b-162">-使用<xref:System.Windows.Forms.FormBorderStyle.None>， <xref:System.Windows.Forms.FormBorderStyle.FixedToolWindow>，并<xref:System.Windows.Forms.FormBorderStyle.SizableToolWindow><xref:System.Windows.Forms.FormBorderStyle>枚举值。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-162">-   Using the <xref:System.Windows.Forms.FormBorderStyle.None>, <xref:System.Windows.Forms.FormBorderStyle.FixedToolWindow>, and <xref:System.Windows.Forms.FormBorderStyle.SizableToolWindow><xref:System.Windows.Forms.FormBorderStyle> enumeration values.</span></span>|  
|<xref:System.Windows.Forms.NotifyIcon>|<span data-ttu-id="5fc5b-163">-使用<xref:System.Windows.Forms.NotifyIcon>组件是完全受限制。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-163">-   Using the <xref:System.Windows.Forms.NotifyIcon> component is completely restricted.</span></span>|  
  
 <span data-ttu-id="5fc5b-164"><xref:System.Security.Permissions.UIPermissionWindow.SafeSubWindows>在以下表中，除了限制到列出的操作<xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows>值。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-164">The <xref:System.Security.Permissions.UIPermissionWindow.SafeSubWindows> value restricts the actions listed in the following table, in addition to the restrictions placed by the <xref:System.Security.Permissions.UIPermissionWindow.SafeTopLevelWindows> value.</span></span>  
  
|<span data-ttu-id="5fc5b-165">组件</span><span class="sxs-lookup"><span data-stu-id="5fc5b-165">Component</span></span>|<span data-ttu-id="5fc5b-166">受限制的操作</span><span class="sxs-lookup"><span data-stu-id="5fc5b-166">Restricted actions</span></span>|  
|---------------|------------------------|  
|<xref:System.Windows.Forms.CommonDialog>|<span data-ttu-id="5fc5b-167">-显示一个对话框派生自<xref:System.Windows.Forms.CommonDialog>类。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-167">-   Showing a dialog box derived from the <xref:System.Windows.Forms.CommonDialog> class.</span></span>|  
|<xref:System.Windows.Forms.Control>|<span data-ttu-id="5fc5b-168">-调用<xref:System.Windows.Forms.Control.CreateGraphics%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-168">-   Calling the <xref:System.Windows.Forms.Control.CreateGraphics%2A> method.</span></span><br /><span data-ttu-id="5fc5b-169">-   设置 <xref:System.Windows.Forms.Control.Cursor%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-169">-   Setting the <xref:System.Windows.Forms.Control.Cursor%2A> property.</span></span>|  
|<xref:System.Windows.Forms.Control.Cursor%2A>|<span data-ttu-id="5fc5b-170">-   设置 <xref:System.Windows.Forms.Cursor.Current%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-170">-   Setting the <xref:System.Windows.Forms.Cursor.Current%2A> property.</span></span>|  
|<xref:System.Windows.Forms.MessageBox>|<span data-ttu-id="5fc5b-171">-调用<xref:System.Windows.Forms.Form.Show%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-171">-   Calling the <xref:System.Windows.Forms.Form.Show%2A> method.</span></span>|  
  
### <a name="hosting-third-party-controls"></a><span data-ttu-id="5fc5b-172">承载第三方控件</span><span class="sxs-lookup"><span data-stu-id="5fc5b-172">Hosting Third-Party Controls</span></span>  
 <span data-ttu-id="5fc5b-173">如果窗体承载第三方控件，可能会发生另一种窗口操作。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-173">Another kind of window manipulation can occur if your forms host third-party controls.</span></span> <span data-ttu-id="5fc5b-174">第三方控件是任何自定义<xref:System.Windows.Forms.UserControl>不具有自己开发和编译。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-174">A third-party control is any custom <xref:System.Windows.Forms.UserControl> that you have not developed and compiled yourself.</span></span> <span data-ttu-id="5fc5b-175">尽管承载方案难以侵入，但第三方控件理论上仍有可能扩展其呈现图面以覆盖整个窗体区域。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-175">Although the hosting scenario is hard to exploit, it is theoretically possible for a third-party control to expand its rendering surface to cover the entire area of your form.</span></span> <span data-ttu-id="5fc5b-176">此控件随后即可模仿关键对话框，并从你的用户那里请求用户名/密码组合或银行帐号等信息。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-176">This control could then mimic a critical dialog box, and request information such as username/password combinations or bank account numbers from your users.</span></span>  
  
 <span data-ttu-id="5fc5b-177">若要限制这种潜在风险，应仅使用来自可信任的供应商的第三方控件。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-177">To limit this potential risk, use third-party controls only from vendors you can trust.</span></span> <span data-ttu-id="5fc5b-178">如果所使用的第三方控件是从无法验证的源下载的，则建议检查源代码是否有潜在侵入风险。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-178">If you use third-party controls you have downloaded from an unverifiable source, we recommend that you review the source code for potential exploits.</span></span> <span data-ttu-id="5fc5b-179">确认源无恶意后，应自己编译程序集以确保源与程序集匹配。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-179">After you've verified that the source is non-malicious, you should compile the assembly yourself to ensure that the source matches the assembly.</span></span>  
  
## <a name="win32-api-calls"></a><span data-ttu-id="5fc5b-180">Win32 API 调用</span><span class="sxs-lookup"><span data-stu-id="5fc5b-180">Win32 API Calls</span></span>  
 <span data-ttu-id="5fc5b-181">如果应用程序设计要求从 Win32 API 调用函数，则表示你正在访问非托管代码。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-181">If your application design requires calling a function from the Win32 API, you are accessing unmanaged code.</span></span> <span data-ttu-id="5fc5b-182">在这种情况下，当使用 Win32 API 调用或值时，无法确定代码将对窗口或操作系统执行的操作。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-182">In this case the code's actions to the window or operating system cannot be determined when you are working with Win32 API calls or values.</span></span> <span data-ttu-id="5fc5b-183"><xref:System.Security.Permissions.SecurityPermission>类和<xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode>的值<xref:System.Security.Permissions.SecurityPermissionFlag>枚举控制对非托管代码的访问。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-183">The <xref:System.Security.Permissions.SecurityPermission> class and the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> value of the <xref:System.Security.Permissions.SecurityPermissionFlag> enumeration control access to unmanaged code.</span></span> <span data-ttu-id="5fc5b-184">应用程序可以访问非托管的代码，仅当向其授予<xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode>权限。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-184">An application can access unmanaged code only when it is granted the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission.</span></span> <span data-ttu-id="5fc5b-185">默认情况下，只有本地运行的应用程序才能调用非托管代码。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-185">By default, only applications that are running locally can call unmanaged code.</span></span>  
  
 <span data-ttu-id="5fc5b-186">某些 Windows 窗体成员提供需要的非托管的访问<xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode>权限。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-186">Some Windows Forms members provide unmanaged access that requires the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission.</span></span> <span data-ttu-id="5fc5b-187">下表列出了中的成员<xref:System.Windows.Forms>需要权限的命名空间。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-187">The following table lists the members in the <xref:System.Windows.Forms> namespace that require the permission.</span></span> <span data-ttu-id="5fc5b-188">有关各个成员所需权限的详细信息，请参阅 .NET Framework 类库文档。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-188">For more information about the permissions that are required for a member, see the .NET Framework class library documentation.</span></span>  
  
|<span data-ttu-id="5fc5b-189">组件</span><span class="sxs-lookup"><span data-stu-id="5fc5b-189">Component</span></span>|<span data-ttu-id="5fc5b-190">成员</span><span class="sxs-lookup"><span data-stu-id="5fc5b-190">Member</span></span>|  
|---------------|------------|  
|<xref:System.Windows.Forms.Application>|<span data-ttu-id="5fc5b-191">-   <xref:System.Windows.Forms.Application.AddMessageFilter%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-191">-   <xref:System.Windows.Forms.Application.AddMessageFilter%2A> method</span></span><br /><span data-ttu-id="5fc5b-192">-   <xref:System.Windows.Forms.Application.CurrentInputLanguage%2A> 属性</span><span class="sxs-lookup"><span data-stu-id="5fc5b-192">-   <xref:System.Windows.Forms.Application.CurrentInputLanguage%2A> property</span></span><br /><span data-ttu-id="5fc5b-193">-   `Exit` 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-193">-   `Exit` method</span></span><br /><span data-ttu-id="5fc5b-194">-   <xref:System.Windows.Forms.Application.ExitThread%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-194">-   <xref:System.Windows.Forms.Application.ExitThread%2A> method</span></span><br /><span data-ttu-id="5fc5b-195">-   <xref:System.Windows.Forms.Application.ThreadException> 事件</span><span class="sxs-lookup"><span data-stu-id="5fc5b-195">-   <xref:System.Windows.Forms.Application.ThreadException> event</span></span>|  
|<xref:System.Windows.Forms.CommonDialog>|<span data-ttu-id="5fc5b-196">-   <xref:System.Windows.Forms.CommonDialog.HookProc%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-196">-   <xref:System.Windows.Forms.CommonDialog.HookProc%2A> method</span></span><br /><span data-ttu-id="5fc5b-197">-   <xref:System.Windows.Forms.CommonDialog.OwnerWndProc%2A>\ 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-197">-   <xref:System.Windows.Forms.CommonDialog.OwnerWndProc%2A>\ method</span></span><br /><span data-ttu-id="5fc5b-198">-   <xref:System.Windows.Forms.CommonDialog.Reset%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-198">-   <xref:System.Windows.Forms.CommonDialog.Reset%2A> method</span></span><br /><span data-ttu-id="5fc5b-199">-   <xref:System.Windows.Forms.CommonDialog.RunDialog%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-199">-   <xref:System.Windows.Forms.CommonDialog.RunDialog%2A> method</span></span>|  
|<xref:System.Windows.Forms.Control>|<span data-ttu-id="5fc5b-200">-   <xref:System.Windows.Forms.Control.CreateParams%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-200">-   <xref:System.Windows.Forms.Control.CreateParams%2A> method</span></span><br /><span data-ttu-id="5fc5b-201">-   <xref:System.Windows.Forms.Control.DefWndProc%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-201">-   <xref:System.Windows.Forms.Control.DefWndProc%2A> method</span></span><br /><span data-ttu-id="5fc5b-202">-   <xref:System.Windows.Forms.Control.DestroyHandle%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-202">-   <xref:System.Windows.Forms.Control.DestroyHandle%2A> method</span></span><br /><span data-ttu-id="5fc5b-203">-   <xref:System.Windows.Forms.Control.WndProc%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-203">-   <xref:System.Windows.Forms.Control.WndProc%2A> method</span></span>|  
|<xref:System.Windows.Forms.Help>|<span data-ttu-id="5fc5b-204">-   <xref:System.Windows.Forms.Help.ShowHelp%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-204">-   <xref:System.Windows.Forms.Help.ShowHelp%2A> methods</span></span><br /><span data-ttu-id="5fc5b-205">-   <xref:System.Windows.Forms.Help.ShowHelpIndex%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-205">-   <xref:System.Windows.Forms.Help.ShowHelpIndex%2A> method</span></span>|  
|<xref:System.Windows.Forms.NativeWindow>|<span data-ttu-id="5fc5b-206">-   <xref:System.Windows.Forms.NativeWindow> 类</span><span class="sxs-lookup"><span data-stu-id="5fc5b-206">-   <xref:System.Windows.Forms.NativeWindow> class</span></span>|  
|<xref:System.Windows.Forms.Screen>|<span data-ttu-id="5fc5b-207">-   <xref:System.Windows.Forms.Screen.FromHandle%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-207">-   <xref:System.Windows.Forms.Screen.FromHandle%2A> method</span></span>|  
|<xref:System.Windows.Forms.SendKeys>|<span data-ttu-id="5fc5b-208">-   <xref:System.Windows.Forms.SendKeys.Send%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-208">-   <xref:System.Windows.Forms.SendKeys.Send%2A> method</span></span><br /><span data-ttu-id="5fc5b-209">-   <xref:System.Windows.Forms.SendKeys.SendWait%2A> 方法</span><span class="sxs-lookup"><span data-stu-id="5fc5b-209">-   <xref:System.Windows.Forms.SendKeys.SendWait%2A> method</span></span>|  
  
 <span data-ttu-id="5fc5b-210">如果你的应用程序无权调用非托管的代码，你的应用程序必须请求<xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode>权限，或者您必须考虑实现这些功能的其他方法; 在许多情况下，Windows 窗体提供了 Win32 API 的托管替代方法函数。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-210">If your application does not have permission to call unmanaged code, your application must request <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission, or you must consider alternative ways of implementing features; in many cases, Windows Forms provides a managed alternative to Win32 API functions.</span></span> <span data-ttu-id="5fc5b-211">如果不存在任何备选方法并且应用程序必须访问非托管代码，则必须提升应用程序的权限。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-211">If no alternative means exist and the application must access unmanaged code, you will have to elevate the permissions for the application.</span></span>  
  
 <span data-ttu-id="5fc5b-212">调用非托管代码的权限使应用程序几乎可以执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-212">Permission to call unmanaged code allows an application to perform most anything.</span></span> <span data-ttu-id="5fc5b-213">因此，应该只向来自于受信任源的应用程序授予调用非托管代码的权限。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-213">Therefore, permission to call unmanaged code should only be granted for applications that come from a trusted source.</span></span> <span data-ttu-id="5fc5b-214">另外，根据应用程序的不同，调用非托管代码的应用程序功能块可以是可选的，或者只在完全受信任的环境中启用。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-214">Alternatively, depending on the application, the piece of application functionality that makes the call to unmanaged code could be optional, or enabled in the full trust environment only.</span></span> <span data-ttu-id="5fc5b-215">有关危险权限的详细信息，请参阅[危险权限和策略管理](../../../docs/framework/misc/dangerous-permissions-and-policy-administration.md)。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-215">For more information about dangerous permissions, see [Dangerous Permissions and Policy Administration](../../../docs/framework/misc/dangerous-permissions-and-policy-administration.md).</span></span> <span data-ttu-id="5fc5b-216">有关提升权限的详细信息，请参阅[NIB:常规安全策略管理](https://msdn.microsoft.com/library/5121fe35-f0e3-402c-94ab-4f35b0a87b4b)。</span><span class="sxs-lookup"><span data-stu-id="5fc5b-216">For more information about elevating permissions, see [NIB: General Security Policy Administration](https://msdn.microsoft.com/library/5121fe35-f0e3-402c-94ab-4f35b0a87b4b).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5fc5b-217">请参阅</span><span class="sxs-lookup"><span data-stu-id="5fc5b-217">See also</span></span>
- [<span data-ttu-id="5fc5b-218">在 Windows 窗体中提高文件和数据访问的安全性</span><span class="sxs-lookup"><span data-stu-id="5fc5b-218">More Secure File and Data Access in Windows Forms</span></span>](../../../docs/framework/winforms/more-secure-file-and-data-access-in-windows-forms.md)
- [<span data-ttu-id="5fc5b-219">Windows 窗体中更加安全的打印</span><span class="sxs-lookup"><span data-stu-id="5fc5b-219">More Secure Printing in Windows Forms</span></span>](../../../docs/framework/winforms/more-secure-printing-in-windows-forms.md)
- [<span data-ttu-id="5fc5b-220">Windows 窗体中的安全性概述</span><span class="sxs-lookup"><span data-stu-id="5fc5b-220">Security in Windows Forms Overview</span></span>](../../../docs/framework/winforms/security-in-windows-forms-overview.md)
- [<span data-ttu-id="5fc5b-221">Windows 窗体安全</span><span class="sxs-lookup"><span data-stu-id="5fc5b-221">Windows Forms Security</span></span>](../../../docs/framework/winforms/windows-forms-security.md)
- [<span data-ttu-id="5fc5b-222">保护 ClickOnce 应用程序</span><span class="sxs-lookup"><span data-stu-id="5fc5b-222">Securing ClickOnce Applications</span></span>](/visualstudio/deployment/securing-clickonce-applications)
