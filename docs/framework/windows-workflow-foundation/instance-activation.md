---
title: 实例激活
ms.date: 03/30/2017
ms.assetid: 134c3f70-5d4e-46d0-9d49-469a6643edd8
ms.openlocfilehash: 088722ba19a1f38e8a341e34a8344963021f1113
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2019
ms.locfileid: "64584917"
---
# <a name="instance-activation"></a><span data-ttu-id="f85c0-102">实例激活</span><span class="sxs-lookup"><span data-stu-id="f85c0-102">Instance Activation</span></span>
<span data-ttu-id="f85c0-103">SQL 工作流实例存储运行一个内部任务，该任务将定期唤醒并检测持久性数据库中是否有可运行或可激活的工作流实例。</span><span class="sxs-lookup"><span data-stu-id="f85c0-103">The SQL Workflow Instance Store runs an internal task that periodically wakes up and detects runnable or activatable workflow instances in the persistence database.</span></span> <span data-ttu-id="f85c0-104">如果找到可运行的工作流实例，SQL 工作流实例存储将通知能够激活该实例的工作流主机。</span><span class="sxs-lookup"><span data-stu-id="f85c0-104">If it finds a runnable workflow instance, it notifies the workflow host that is capable of activating the instance.</span></span> <span data-ttu-id="f85c0-105">如果实例存储找到可激活的工作流实例，它将通知用于激活工作流主机的泛型主机，而泛型主机将运行此工作流实例。</span><span class="sxs-lookup"><span data-stu-id="f85c0-105">If the instance store finds an activatable workflow instance, it notifies a generic host that activates a workflow host, which in turn runs the workflow instance.</span></span> <span data-ttu-id="f85c0-106">本主题的以下各节详细说明了实例激活过程。</span><span class="sxs-lookup"><span data-stu-id="f85c0-106">The following sections in this topic explain the instance activation process in detail.</span></span>  
  
## <a name="RunnableSection"></a> <span data-ttu-id="f85c0-107">检测和激活可运行工作流实例</span><span class="sxs-lookup"><span data-stu-id="f85c0-107">Detecting and Activating Runnable Workflow Instances</span></span>  
 <span data-ttu-id="f85c0-108">SQL 工作流实例存储将工作流实例视为*可运行*如果实例未处于挂起的状态或已完成的状态并且满足以下条件：</span><span class="sxs-lookup"><span data-stu-id="f85c0-108">The SQL Workflow Instance Store considers a workflow instance *runnable* if the instance is not in the suspended state or the completed state and satisfies the following conditions:</span></span>  
  
- <span data-ttu-id="f85c0-109">实例处于解除锁定状态，并且具有已过期的挂起计时器。</span><span class="sxs-lookup"><span data-stu-id="f85c0-109">The instance is unlocked and has a pending timer that has expired.</span></span>  
  
- <span data-ttu-id="f85c0-110">实例上的锁已过期。</span><span class="sxs-lookup"><span data-stu-id="f85c0-110">The instance has an expired lock on it.</span></span>  
  
- <span data-ttu-id="f85c0-111">对实例进行解锁且其状态为**Executing**。</span><span class="sxs-lookup"><span data-stu-id="f85c0-111">The instance is unlocked and its status is **Executing**.</span></span>  
  
 <span data-ttu-id="f85c0-112">当 SQL 工作流实例存储找到可运行的实例时，将引发 <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent>。</span><span class="sxs-lookup"><span data-stu-id="f85c0-112">The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> when it finds a runnable instance.</span></span> <span data-ttu-id="f85c0-113">此后，SqlWorkflowInstanceStore 将停止监视，直到在该存储上调用一次 <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand>。</span><span class="sxs-lookup"><span data-stu-id="f85c0-113">After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> is called once on the store.</span></span>  
  
 <span data-ttu-id="f85c0-114">已订阅 <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> 且能够加载该实例的工作流主机将针对实例存储执行 <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand>，以将该实例加载到内存中。</span><span class="sxs-lookup"><span data-stu-id="f85c0-114">A workflow host that has subscribed for the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> and capable of loading the instance executes the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> against the instance store to load the instance into memory.</span></span> <span data-ttu-id="f85c0-115">工作流主机被视为能够加载工作流实例，如果主机和实例元数据属性**WorkflowServiceType**设置为相同值。</span><span class="sxs-lookup"><span data-stu-id="f85c0-115">A workflow host is considered capable of loading a workflow instance if the host and the instance have metadata property **WorkflowServiceType** set to the same value.</span></span>  
  
## <a name="detecting-and-activating-activatable-workflow-instances"></a><span data-ttu-id="f85c0-116">检测和激活可激活的工作流实例</span><span class="sxs-lookup"><span data-stu-id="f85c0-116">Detecting and Activating Activatable Workflow Instances</span></span>  
 <span data-ttu-id="f85c0-117">工作流实例被视为*可激活*没有能够加载该实例的工作流主机是否可运行，并且没有正在运行的计算机上。</span><span class="sxs-lookup"><span data-stu-id="f85c0-117">A workflow instance is considered *activatable* if the instance is runnable and there is no workflow host that is capable of loading the instance is running on the computer.</span></span> <span data-ttu-id="f85c0-118">有关可运行的工作流实例的定义，请参见上面的“检测和激活可运行的工作流实例”。</span><span class="sxs-lookup"><span data-stu-id="f85c0-118">See Detecting and Activating Runnable Workflow Instances above for the definition of a runnable workflow instance.</span></span>  
  
 <span data-ttu-id="f85c0-119">当 SQL 工作流实例存储在数据库中找到可激活的工作流实例时，将引发 <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent>。</span><span class="sxs-lookup"><span data-stu-id="f85c0-119">The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> when it finds an activatable workflow instance in the database.</span></span> <span data-ttu-id="f85c0-120">此后，SqlWorkflowInstanceStore 将停止监视，直到在该存储上调用一次 <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand>。</span><span class="sxs-lookup"><span data-stu-id="f85c0-120">After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> is called once on the store.</span></span>  
  
 <span data-ttu-id="f85c0-121">当已订阅 <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> 的泛型主机接收到此事件时，它将针对实例存储执行 <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> 以获取创建工作流主机所需的激活参数。</span><span class="sxs-lookup"><span data-stu-id="f85c0-121">When a generic host that has subscribed for the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> receives the event, it executes the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> against the instance store to obtain activation parameters required to create a workflow host.</span></span> <span data-ttu-id="f85c0-122">泛型主机使用这些激活参数来创建工作流主机，后者又依次加载并运行可运行的服务实例。</span><span class="sxs-lookup"><span data-stu-id="f85c0-122">The generic host uses these activation parameters to create a workflow host, which in turn loads and runs the runnable service instance.</span></span>  
  
## <a name="generic-hosts"></a><span data-ttu-id="f85c0-123">泛型主机</span><span class="sxs-lookup"><span data-stu-id="f85c0-123">Generic Hosts</span></span>  
 <span data-ttu-id="f85c0-124">泛型主机是元数据属性的值与主机**WorkflowServiceType**对于泛型主机将设置为**WorkflowServiceType.Any**以指示它可以处理任何工作流类型。</span><span class="sxs-lookup"><span data-stu-id="f85c0-124">A generic host is a host with the value of the metadata property **WorkflowServiceType** for generic hosts is set to **WorkflowServiceType.Any** to indicate that it can handle any workflow type.</span></span> <span data-ttu-id="f85c0-125">泛型主机采用名为的 XName 参数**ActivationType**。</span><span class="sxs-lookup"><span data-stu-id="f85c0-125">A generic host has an XName parameter named **ActivationType**.</span></span>  
  
 <span data-ttu-id="f85c0-126">目前，SQL 工作流实例存储支持 ActivationType 参数设置为值的泛型主机**WAS**。</span><span class="sxs-lookup"><span data-stu-id="f85c0-126">Currently, the SQL Workflow Instance Store supports generic hosts with value of the ActivationType parameter set to **WAS**.</span></span> <span data-ttu-id="f85c0-127">如果未将 ActivationType 设置为 WAS，SQL 工作流实例存储将引发 <xref:System.Runtime.DurableInstancing.InstancePersistenceException>。</span><span class="sxs-lookup"><span data-stu-id="f85c0-127">If the ActivationType is not set to WAS, the SQL Workflow Instance Store throws an <xref:System.Runtime.DurableInstancing.InstancePersistenceException>.</span></span> <span data-ttu-id="f85c0-128">Workflow Management Service 附带[!INCLUDE[dublin](../../../includes/dublin-md.md)]是设置为将激活类型的泛型主机**WAS**。</span><span class="sxs-lookup"><span data-stu-id="f85c0-128">The Workflow Management Service that ships with the [!INCLUDE[dublin](../../../includes/dublin-md.md)] is a generic host that has the activation type set to **WAS**.</span></span>  
  
 <span data-ttu-id="f85c0-129">为了实现 WAS 激活，泛型主机需要一组激活参数来派生激活新主机所在的终结点地址。</span><span class="sxs-lookup"><span data-stu-id="f85c0-129">For WAS activation, a generic host requires a set of activation parameters to derive the endpoint address at which new hosts can be activated.</span></span> <span data-ttu-id="f85c0-130">用于 WAS 激活的激活参数包括：站点名称、应用程序路径（相对于站点）和服务路径（相对于应用程序）。</span><span class="sxs-lookup"><span data-stu-id="f85c0-130">The activation parameters for WAS activation are name of the site, path to the application relative to the site, and path to the service relative to the application.</span></span> <span data-ttu-id="f85c0-131">SQL 工作流实例存储在执行 <xref:System.Activities.DurableInstancing.SaveWorkflowCommand> 期间存储这些激活参数。</span><span class="sxs-lookup"><span data-stu-id="f85c0-131">The SQL Workflow Instance Store stores these activation parameters during the execution of the <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>.</span></span>  
  
## <a name="runnable-instances-detection-period"></a><span data-ttu-id="f85c0-132">可运行实例的检测周期</span><span class="sxs-lookup"><span data-stu-id="f85c0-132">Runnable Instances Detection Period</span></span>  
 <span data-ttu-id="f85c0-133">**可运行实例的检测周期**SQL 工作流实例存储的属性指定的时间段后将 SQL 工作流实例存储运行一个检测任务，以检测任何可运行或可激活的工作流上一检测周期后持久性数据库中的实例。</span><span class="sxs-lookup"><span data-stu-id="f85c0-133">The **Runnable Instances Detection Period** property of the SQL Workflow Instance Store specifies the time period after which the SQL Workflow Instance Store runs a detection task to detect any runnable or activatable workflow instances in the persistence database after the previous detection cycle.</span></span> <span data-ttu-id="f85c0-134">请参阅[可运行实例的检测周期](runnable-instances-detection-period.md)有关此属性的详细信息。</span><span class="sxs-lookup"><span data-stu-id="f85c0-134">See [Runnable Instances Detection Period](runnable-instances-detection-period.md) for more details on this property.</span></span>
