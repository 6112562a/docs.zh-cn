---
title: 使用活动委托
ms.date: 03/30/2017
ms.assetid: e33cf876-8979-440b-9b23-4a12d1139960
ms.openlocfilehash: 8c9d82f47f709a89455f41691526b6ac9718a01f
ms.sourcegitcommit: 438919211260bb415fc8f96ca3eabc33cf2d681d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/16/2019
ms.locfileid: "59610829"
---
# <a name="using-activity-delegates"></a><span data-ttu-id="0a75e-102">使用活动委托</span><span class="sxs-lookup"><span data-stu-id="0a75e-102">Using Activity Delegates</span></span>
<span data-ttu-id="0a75e-103">通过活动委托，活动作者可以公开具有特定签名的回调，活动的用户可为其提供基于活动的处理程序。</span><span class="sxs-lookup"><span data-stu-id="0a75e-103">Activity delegates enable activity authors to expose callbacks with specific signatures, for which users of the activity can provide activity-based handlers.</span></span> <span data-ttu-id="0a75e-104">可以使用两种类型的活动委托：<xref:System.Activities.ActivityAction%601> 用于定义没有返回值的活动委托，<xref:System.Activities.ActivityFunc%601> 用于定义有返回值的活动委托。</span><span class="sxs-lookup"><span data-stu-id="0a75e-104">Two types of activity delegates are available: <xref:System.Activities.ActivityAction%601> is used to define activity delegates that do not have a return value, and <xref:System.Activities.ActivityFunc%601> is used to define activity delegates that do have a return value.</span></span>

<span data-ttu-id="0a75e-105">在必须对子活动进行限制，使其包含特定签名的情况下，活动委托非常有用。</span><span class="sxs-lookup"><span data-stu-id="0a75e-105">Activity delegates are useful in scenarios where a child activity must be constrained to having a certain signature.</span></span> <span data-ttu-id="0a75e-106">例如，<xref:System.Activities.Statements.While> 活动可包含任何类型的无约束子活动，但 <xref:System.Activities.Statements.ForEach%601> 活动的主体是一个 <xref:System.Activities.ActivityAction%601>，并且 <xref:System.Activities.Statements.ForEach%601> 最终执行的子活动必须具有 <xref:System.Activities.InArgument%601> 与 <xref:System.Activities.Statements.ForEach%601> 所枚举的集合成员相同的类型。</span><span class="sxs-lookup"><span data-stu-id="0a75e-106">For example, a <xref:System.Activities.Statements.While> activity can contain any type of child activity with no constraints, but the body of a <xref:System.Activities.Statements.ForEach%601> activity is an <xref:System.Activities.ActivityAction%601>, and the child activity that is ultimately executed by <xref:System.Activities.Statements.ForEach%601> must have an <xref:System.Activities.InArgument%601> that is the same type of the members of the collection that the <xref:System.Activities.Statements.ForEach%601> enumerates.</span></span>

## <a name="using-activityaction"></a><span data-ttu-id="0a75e-107">使用 ActivityAction</span><span class="sxs-lookup"><span data-stu-id="0a75e-107">Using ActivityAction</span></span>

<span data-ttu-id="0a75e-108">一些 [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] 活动将使用活动操作，如 <xref:System.Activities.Statements.Catch> 活动和 <xref:System.Activities.Statements.ForEach%601> 活动。</span><span class="sxs-lookup"><span data-stu-id="0a75e-108">Several [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] activities use activity actions, such as the <xref:System.Activities.Statements.Catch> activity and the <xref:System.Activities.Statements.ForEach%601> activity.</span></span> <span data-ttu-id="0a75e-109">在每种情况下，活动操作都表示一个位置，当使用这些活动之一构造工作流时，工作流作者在此处指定一个活动来提供所需的行为。</span><span class="sxs-lookup"><span data-stu-id="0a75e-109">In each case, the activity action represents a location where the workflow author specifies an activity to provide the desired behavior when composing a workflow using one of these activities.</span></span> <span data-ttu-id="0a75e-110">在下面的示例中，使用 <xref:System.Activities.Statements.ForEach%601> 活动来向控制台窗口显示文本。</span><span class="sxs-lookup"><span data-stu-id="0a75e-110">In the following example, a <xref:System.Activities.Statements.ForEach%601> activity is used to display text to the console window.</span></span> <span data-ttu-id="0a75e-111">使用一个与 <xref:System.Activities.Statements.ForEach%601> 的类型（此处为 string）相匹配的 <xref:System.Activities.ActivityAction%601> 来指定 <xref:System.Activities.Statements.ForEach%601> 的主体。</span><span class="sxs-lookup"><span data-stu-id="0a75e-111">The body of the <xref:System.Activities.Statements.ForEach%601> is specified by using an <xref:System.Activities.ActivityAction%601> that matches the type of the <xref:System.Activities.Statements.ForEach%601> which is string.</span></span> <span data-ttu-id="0a75e-112">在 <xref:System.Activities.Statements.WriteLine> 中指定的 <xref:System.Activities.ActivityDelegate.Handler%2A> 活动将它的 <xref:System.Activities.Statements.WriteLine.Text%2A> 自变量绑定到 <xref:System.Activities.Statements.ForEach%601> 活动迭代的集合中的字符串值。</span><span class="sxs-lookup"><span data-stu-id="0a75e-112">The <xref:System.Activities.Statements.WriteLine> activity specified in the <xref:System.Activities.ActivityDelegate.Handler%2A> has its <xref:System.Activities.Statements.WriteLine.Text%2A> argument bound to the string values in the collection that the <xref:System.Activities.Statements.ForEach%601> activity iterates.</span></span>

[!code-csharp[CFX_ActivityExample#6](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#6)]

<span data-ttu-id="0a75e-113">actionArgument 用于将集合中的各个项流到 WriteLine。</span><span class="sxs-lookup"><span data-stu-id="0a75e-113">The actionArgument is used to flow the individual items in the collection to the WriteLine.</span></span> <span data-ttu-id="0a75e-114">在调用工作流时，将下面的输出显示到控制台。</span><span class="sxs-lookup"><span data-stu-id="0a75e-114">When the workflow is invoked, the following output is displayed to the console.</span></span>

```
HelloWorld.
```

<span data-ttu-id="0a75e-115">本主题中的示例使用对象初始化语法。</span><span class="sxs-lookup"><span data-stu-id="0a75e-115">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="0a75e-116">对于用代码创建工作流定义而言，对象初始化语法非常有用，因为它为工作流中的活动提供了分层视图，可以显示活动之间的关系。</span><span class="sxs-lookup"><span data-stu-id="0a75e-116">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="0a75e-117">通过编程方式创建工作流时，不要求必须使用对象初始化语法。</span><span class="sxs-lookup"><span data-stu-id="0a75e-117">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="0a75e-118">下面的示例与前面的示例在功能上是等效的。</span><span class="sxs-lookup"><span data-stu-id="0a75e-118">The following example is functionally equivalent to the previous example.</span></span>

[!code-csharp[CFX_ActivityExample#7](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#7)]

<span data-ttu-id="0a75e-119">有关对象初始值设定项的详细信息，请参阅[如何：而不会调用构造函数初始化对象 (C#编程指南)](https://go.microsoft.com/fwlink/?LinkId=161015)并[如何：使用对象初始值设定项声明对象](https://go.microsoft.com/fwlink/?LinkId=161016)。</span><span class="sxs-lookup"><span data-stu-id="0a75e-119">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](https://go.microsoft.com/fwlink/?LinkId=161015) and [How to: Declare an Object by Using an Object Initializer](https://go.microsoft.com/fwlink/?LinkId=161016).</span></span>

<span data-ttu-id="0a75e-120">在下面的示例中，在工作流中使用一个 <xref:System.Activities.Statements.TryCatch> 活动。</span><span class="sxs-lookup"><span data-stu-id="0a75e-120">In the following example, a <xref:System.Activities.Statements.TryCatch> activity is used in a workflow.</span></span> <span data-ttu-id="0a75e-121">该工作流引发一个 <xref:System.ApplicationException>，并由 <xref:System.Activities.Statements.Catch%601> 活动对其进行处理。</span><span class="sxs-lookup"><span data-stu-id="0a75e-121">An <xref:System.ApplicationException> is thrown by the workflow, and is handled by a <xref:System.Activities.Statements.Catch%601> activity.</span></span> <span data-ttu-id="0a75e-122">处理程序<xref:System.Activities.Statements.Catch%601>活动的活动执行任何操作<xref:System.Activities.Statements.WriteLine>活动和异常详细信息流动到使用其`ex` <xref:System.Activities.DelegateInArgument%601>。</span><span class="sxs-lookup"><span data-stu-id="0a75e-122">The handler for the <xref:System.Activities.Statements.Catch%601> activity's activity action is a <xref:System.Activities.Statements.WriteLine> activity, and the exception detail is flowed through to it using the `ex` <xref:System.Activities.DelegateInArgument%601>.</span></span>

[!code-csharp[CFX_WorkflowApplicationExample#33](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]

<span data-ttu-id="0a75e-123">创建定义 <xref:System.Activities.ActivityAction%601> 的自定义活动时，使用 <xref:System.Activities.Statements.InvokeAction%601> 来建立调用该 <xref:System.Activities.ActivityAction%601> 的模型。</span><span class="sxs-lookup"><span data-stu-id="0a75e-123">When creating a custom activity that defines an <xref:System.Activities.ActivityAction%601>, use an <xref:System.Activities.Statements.InvokeAction%601> to model the invocation of that <xref:System.Activities.ActivityAction%601>.</span></span> <span data-ttu-id="0a75e-124">在本示例中，定义了自定义 `WriteLineWithNotification` 活动。</span><span class="sxs-lookup"><span data-stu-id="0a75e-124">In this example, a custom `WriteLineWithNotification` activity is defined.</span></span> <span data-ttu-id="0a75e-125">此活动由一个 <xref:System.Activities.Statements.Sequence> 组成，它包含一个 <xref:System.Activities.Statements.WriteLine> 活动，该活动后面是一个调用接收一个字符串参数的 <xref:System.Activities.Statements.InvokeAction%601> 的 <xref:System.Activities.ActivityAction%601>。</span><span class="sxs-lookup"><span data-stu-id="0a75e-125">This activity is composed of a <xref:System.Activities.Statements.Sequence> that contains a <xref:System.Activities.Statements.WriteLine> activity followed by an <xref:System.Activities.Statements.InvokeAction%601> that invokes an <xref:System.Activities.ActivityAction%601> that takes one string argument.</span></span>

[!code-csharp[CFX_ActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#1)]

<span data-ttu-id="0a75e-126">使用 `WriteLineWithNotification` 活动创建工作流时，工作流作者在活动操作的 <xref:System.Activities.ActivityDelegate.Handler%2A> 中指定所需的自定义逻辑。</span><span class="sxs-lookup"><span data-stu-id="0a75e-126">When a workflow is created by using the `WriteLineWithNotification` activity, the workflow author specifies the desired custom logic in the activity action’s <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span> <span data-ttu-id="0a75e-127">在本示例中，创建一个使用 `WriteLineWithNotification` 活动的工作流，并将 <xref:System.Activities.Statements.WriteLine> 活动用作 <xref:System.Activities.ActivityDelegate.Handler%2A>。</span><span class="sxs-lookup"><span data-stu-id="0a75e-127">In this example, a workflow is created that use the `WriteLineWithNotification` activity, and a <xref:System.Activities.Statements.WriteLine> activity is used as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#2)]

<span data-ttu-id="0a75e-128"><xref:System.Activities.Statements.InvokeAction%601> 有多个泛型版本，提供 <xref:System.Activities.ActivityAction%601> 用于传递一个或多个自变量。</span><span class="sxs-lookup"><span data-stu-id="0a75e-128">There are multiple generic versions of <xref:System.Activities.Statements.InvokeAction%601> and <xref:System.Activities.ActivityAction%601> provided for passing one or more arguments.</span></span>

## <a name="using-activityfunc"></a><span data-ttu-id="0a75e-129">使用 ActivityFunc</span><span class="sxs-lookup"><span data-stu-id="0a75e-129">Using ActivityFunc</span></span>

<span data-ttu-id="0a75e-130">当活动中没有结果值时，<xref:System.Activities.ActivityAction%601> 将很有用，当返回结果值时，将使用 <xref:System.Activities.ActivityFunc%601>。</span><span class="sxs-lookup"><span data-stu-id="0a75e-130"><xref:System.Activities.ActivityAction%601> is useful when there is no result value from the activity, and <xref:System.Activities.ActivityFunc%601> is used when a result value is returned.</span></span> <span data-ttu-id="0a75e-131">创建定义 <xref:System.Activities.ActivityFunc%601> 的自定义活动时，使用 <xref:System.Activities.Expressions.InvokeFunc%601> 来建立调用该 <xref:System.Activities.ActivityFunc%601> 的模型。</span><span class="sxs-lookup"><span data-stu-id="0a75e-131">When creating a custom activity that defines an <xref:System.Activities.ActivityFunc%601>, use an <xref:System.Activities.Expressions.InvokeFunc%601> to model the invocation of that <xref:System.Activities.ActivityFunc%601>.</span></span> <span data-ttu-id="0a75e-132">下面的示例定义了一个 `WriteFillerText` 活动。</span><span class="sxs-lookup"><span data-stu-id="0a75e-132">In the following example, a `WriteFillerText` activity is defined.</span></span> <span data-ttu-id="0a75e-133">为了提供填充符文本，将指定一个 <xref:System.Activities.Expressions.InvokeFunc%601>，它接收一个整数参数并具有一个字符串结果。</span><span class="sxs-lookup"><span data-stu-id="0a75e-133">To supply the filler text, an <xref:System.Activities.Expressions.InvokeFunc%601> is specified that takes an integer argument and has a string result.</span></span> <span data-ttu-id="0a75e-134">在检索填充符文本之后，将会使用 <xref:System.Activities.Statements.WriteLine> 活动将其显示到控制台中。</span><span class="sxs-lookup"><span data-stu-id="0a75e-134">Once the filler text is retrieved, it is displayed to the console using a <xref:System.Activities.Statements.WriteLine> activity.</span></span>

[!code-csharp[CFX_ActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#3)]

<span data-ttu-id="0a75e-135">若要提供文本，必须使用接收一个 `int` 自变量并具有一个字符串结果的活动。</span><span class="sxs-lookup"><span data-stu-id="0a75e-135">To supply the text, an activity must be used that takes one `int` argument and has a string result.</span></span> <span data-ttu-id="0a75e-136">本示例演示满足这些需求的 `TextGenerator` 活动。</span><span class="sxs-lookup"><span data-stu-id="0a75e-136">This example shows a `TextGenerator` activity that meets these requirements.</span></span>

[!code-csharp[CFX_ActivityExample#4](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#4)]

<span data-ttu-id="0a75e-137">若要将 `TextGenerator` 活动和 `WriteFillerText` 活动一起使用，应将前者指定为 <xref:System.Activities.ActivityDelegate.Handler%2A>。</span><span class="sxs-lookup"><span data-stu-id="0a75e-137">To use the `TextGenerator` activity with the `WriteFillerText` activity, specify it as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#5](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#5)]
