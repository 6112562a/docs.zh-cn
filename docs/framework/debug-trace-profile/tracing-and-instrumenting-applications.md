---
title: 跟踪应用程序和在应用程序中插入检测点
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tracing [.NET Framework]
- debugging [.NET Framework], instrumentation
- performance monitoring, instrumentation
- instrumentation, about instrumentation
- tracing [.NET Framework], about tracing
- performance monitoring, tracing code
- Trace class, instrumentation for .NET applications
ms.assetid: 773b6fc4-9013-4322-b728-5dec7a72e743
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 4e97bc5f9846757e02f9e55de31bee96a9d24c2f
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/08/2019
ms.locfileid: "59219208"
---
# <a name="tracing-and-instrumenting-applications"></a><span data-ttu-id="0141f-102">跟踪应用程序和在应用程序中插入检测点</span><span class="sxs-lookup"><span data-stu-id="0141f-102">Tracing and Instrumenting Applications</span></span>
<span data-ttu-id="0141f-103">跟踪是指应用程序正在运行时监视其执行情况的方式。</span><span class="sxs-lookup"><span data-stu-id="0141f-103">Tracing is a way for you to monitor the execution of your application while it is running.</span></span> <span data-ttu-id="0141f-104">可在开发 .NET Framework 应用程序时向其添加跟踪和调试检测，也可在开发应用程序时或在部署此应用程序之后使用此检测。</span><span class="sxs-lookup"><span data-stu-id="0141f-104">You can add tracing and debugging instrumentation to your .NET Framework application when you develop it, and you can use that instrumentation both while you are developing the application and after you have deployed it.</span></span> <span data-ttu-id="0141f-105">可使用 <xref:System.Diagnostics.Trace?displayProperty=nameWithType>、<xref:System.Diagnostics.Debug?displayProperty=nameWithType>和 <xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> 类将错误和应用程序执行的相关信息记录在日志、文本文件或其他设备中，以供将来分析。</span><span class="sxs-lookup"><span data-stu-id="0141f-105">You can use the <xref:System.Diagnostics.Trace?displayProperty=nameWithType>, <xref:System.Diagnostics.Debug?displayProperty=nameWithType>, and <xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> classes to record information about errors and application execution in logs, text files, or other devices for later analysis.</span></span>  
  
 <span data-ttu-id="0141f-106">术语“检测”是指监视或测量产品的性能级别和诊断错误的功能。</span><span class="sxs-lookup"><span data-stu-id="0141f-106">The term *instrumentation* refers to an ability to monitor or measure the level of a product's performance and to diagnose errors.</span></span> <span data-ttu-id="0141f-107">在编程中，即指应用程序合并以下功能的能力：</span><span class="sxs-lookup"><span data-stu-id="0141f-107">In programming, this means the ability of an application to incorporate:</span></span>  
  
-   <span data-ttu-id="0141f-108">代码跟踪 - 接收运行时有关应用程序执行的信息性消息。</span><span class="sxs-lookup"><span data-stu-id="0141f-108">**Code tracing** - Receiving informative messages about the execution of an application at run time.</span></span>  
  
-   <span data-ttu-id="0141f-109">调试 - 跟踪并修复开发中的应用程序的编程错误。</span><span class="sxs-lookup"><span data-stu-id="0141f-109">**Debugging** - Tracking down and fixing programming errors in an application under development.</span></span> <span data-ttu-id="0141f-110">有关详细信息，请参阅[调试](/visualstudio/debugger/debugging-in-visual-studio)。</span><span class="sxs-lookup"><span data-stu-id="0141f-110">For more information, see [Debugging](/visualstudio/debugger/debugging-in-visual-studio).</span></span>  
  
-   <span data-ttu-id="0141f-111">性能计数器 - 可用于跟踪应用程序性能的组件。</span><span class="sxs-lookup"><span data-stu-id="0141f-111">**Performance counters** - Components that allow you to track the performance of your application.</span></span> <span data-ttu-id="0141f-112">有关更多信息，请参阅[性能计数器](../../../docs/framework/debug-trace-profile/performance-counters.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-112">For more information, see [Performance Counters](../../../docs/framework/debug-trace-profile/performance-counters.md).</span></span>  
  
-   <span data-ttu-id="0141f-113">事件日志 - 可用于接收和跟踪应用程序执行过程中重要事件的组件。</span><span class="sxs-lookup"><span data-stu-id="0141f-113">**Event logs** - Components that allow you receive and track major events in the execution of your application.</span></span> <span data-ttu-id="0141f-114">有关更多信息，请参见 <xref:System.Diagnostics.EventLog> 类。</span><span class="sxs-lookup"><span data-stu-id="0141f-114">For more information, see the <xref:System.Diagnostics.EventLog> class.</span></span>  
  
 <span data-ttu-id="0141f-115">通过将跟踪语句置于代码中的关键位置来检测应用程序非常适合分布式应用程序。</span><span class="sxs-lookup"><span data-stu-id="0141f-115">Instrumenting your application by placing trace statements at strategic locations in your code is especially useful for distributed applications.</span></span> <span data-ttu-id="0141f-116">通过使用跟踪语句，可检测应用程序，从而在出现故障时显示相关信息并监视应用程序的运行情况。</span><span class="sxs-lookup"><span data-stu-id="0141f-116">By using trace statements you can instrument an application not only to display information when things go wrong, but also to monitor how well the application is performing.</span></span>  
  
 <span data-ttu-id="0141f-117"><xref:System.Diagnostics.TraceSource> 类提供了增强的跟踪功能，可用来代替较旧的 <xref:System.Diagnostics.Trace> 和 <xref:System.Diagnostics.Debug> 跟踪类的静态方法。</span><span class="sxs-lookup"><span data-stu-id="0141f-117">The <xref:System.Diagnostics.TraceSource> class provides enhanced tracing features and can be used in place of the static methods of the older <xref:System.Diagnostics.Trace> and <xref:System.Diagnostics.Debug> tracing classes.</span></span> <span data-ttu-id="0141f-118">常见的 <xref:System.Diagnostics.Trace> 和 <xref:System.Diagnostics.Debug> 类仍然使用广泛，但建议对新的跟踪命令（如 <xref:System.Diagnostics.TraceSource.TraceEvent%2A> 和 <xref:System.Diagnostics.TraceSource.TraceData%2A>）使用 <xref:System.Diagnostics.TraceSource> 类。</span><span class="sxs-lookup"><span data-stu-id="0141f-118">The familiar <xref:System.Diagnostics.Trace> and <xref:System.Diagnostics.Debug> classes are still widely used, but the <xref:System.Diagnostics.TraceSource> class is recommended for new tracing commands, such as <xref:System.Diagnostics.TraceSource.TraceEvent%2A> and <xref:System.Diagnostics.TraceSource.TraceData%2A>.</span></span>  
  
 <span data-ttu-id="0141f-119"><xref:System.Diagnostics.Trace> 和 <xref:System.Diagnostics.Debug> 类相同，只不过 <xref:System.Diagnostics.Trace> 类的过程和函数默认编译为发布版本，<xref:System.Diagnostics.Debug> 类的并非如此。</span><span class="sxs-lookup"><span data-stu-id="0141f-119">The <xref:System.Diagnostics.Trace> and <xref:System.Diagnostics.Debug> classes are identical, except that procedures and functions of the <xref:System.Diagnostics.Trace> class are compiled by default into release builds, but those of the <xref:System.Diagnostics.Debug> class are not.</span></span>  
  
 <span data-ttu-id="0141f-120"><xref:System.Diagnostics.Trace> 和 <xref:System.Diagnostics.Debug> 类提供了在开发期间或部署之后监视和检查应用程序性能的方法。</span><span class="sxs-lookup"><span data-stu-id="0141f-120">The <xref:System.Diagnostics.Trace> and <xref:System.Diagnostics.Debug> classes provide the means to monitor and examine application performance either during development or after deployment.</span></span> <span data-ttu-id="0141f-121">例如，您可以使用 <xref:System.Diagnostics.Trace> 类跟踪在已部署的应用程序中发生的特定类型的操作（例如新建数据库连接），因而可以监视该应用程序的效率。</span><span class="sxs-lookup"><span data-stu-id="0141f-121">For example, you can use the <xref:System.Diagnostics.Trace> class to track particular types of actions in a deployed application as they occur (for example, creation of new database connections), and can therefore monitor the application's efficiency.</span></span>  
  
## <a name="code-tracing-and-debugging"></a><span data-ttu-id="0141f-122">代码跟踪和调试</span><span class="sxs-lookup"><span data-stu-id="0141f-122">Code Tracing and Debugging</span></span>  
 <span data-ttu-id="0141f-123">在开发过程中，使用 <xref:System.Diagnostics.Debug> 类的输出方法，可以在 Visual Studio 集成开发环境 (IDE) 的“输出”窗口中显示消息。</span><span class="sxs-lookup"><span data-stu-id="0141f-123">During development, you can use the output methods of the <xref:System.Diagnostics.Debug> class to display messages in the Output window of the Visual Studio integrated development environment (IDE).</span></span> <span data-ttu-id="0141f-124">例如：</span><span class="sxs-lookup"><span data-stu-id="0141f-124">For example:</span></span>  
  
```vb  
Trace.WriteLine("Hello World!")  
Debug.WriteLine("Hello World!")  
```  
  
```csharp  
System.Diagnostics.Trace.WriteLine("Hello World!");  
System.Diagnostics.Debug.WriteLine("Hello World!");  
```  
  
 <span data-ttu-id="0141f-125">上述每个示例将在“输出窗口”中显示“Hello World!”</span><span class="sxs-lookup"><span data-stu-id="0141f-125">Each of these examples will display "Hello World!"</span></span> <span data-ttu-id="0141f-126">当应用程序在调试器中运行时。</span><span class="sxs-lookup"><span data-stu-id="0141f-126">in the Output window when the application is run in the debugger.</span></span>  
  
 <span data-ttu-id="0141f-127">由此，你可以根据应用程序在测试环境中的行为对它进行调试并优化其性能。</span><span class="sxs-lookup"><span data-stu-id="0141f-127">This enables you to debug your applications and optimize their performance based on their behavior in your test environment.</span></span> <span data-ttu-id="0141f-128">在调试版本中调试应用程序时，可以打开 <xref:System.Diagnostics.Debug> 条件特性，以便接收所有调试输出。</span><span class="sxs-lookup"><span data-stu-id="0141f-128">You can debug your application in your debug build with the <xref:System.Diagnostics.Debug> conditional attribute turned on so that you receive all debugging output.</span></span> <span data-ttu-id="0141f-129">当您的应用程序准备好发布时，可以在关闭 <xref:System.Diagnostics.Debug> 条件特性的情况下编译您的发布版本，使编译器不会在最终可执行文件中包含调试代码。</span><span class="sxs-lookup"><span data-stu-id="0141f-129">When your application is ready for release, you can compile your release build without turning on the <xref:System.Diagnostics.Debug> conditional attribute, so that the compiler will not include your debugging code in the final executable.</span></span> <span data-ttu-id="0141f-130">有关详细信息，请参阅[如何：使用跟踪和调试执行有条件编译](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-130">For more information, see [How to: Compile Conditionally with Trace and Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md).</span></span> <span data-ttu-id="0141f-131">有关应用程序的不同生成配置的详细信息，请参阅[编译和生成](/visualstudio/ide/compiling-and-building-in-visual-studio)。</span><span class="sxs-lookup"><span data-stu-id="0141f-131">For more information on different build configurations for your application, see [Compiling and Building](/visualstudio/ide/compiling-and-building-in-visual-studio).</span></span>  
  
 <span data-ttu-id="0141f-132">你也可以使用 <xref:System.Diagnostics.Trace> 类的方法来跟踪已安装的应用程序中的代码执行情况。</span><span class="sxs-lookup"><span data-stu-id="0141f-132">You can also trace code execution in an installed application, using methods of the <xref:System.Diagnostics.Trace> class.</span></span> <span data-ttu-id="0141f-133">通过将[跟踪开关](../../../docs/framework/debug-trace-profile/trace-switches.md)置于代码中，可控制是否执行跟踪以及执行的范围。</span><span class="sxs-lookup"><span data-stu-id="0141f-133">By placing [Trace Switches](../../../docs/framework/debug-trace-profile/trace-switches.md) in your code, you can control whether tracing occurs and how extensive it is.</span></span> <span data-ttu-id="0141f-134">这使你可以监视应用程序在生产环境中的状态。</span><span class="sxs-lookup"><span data-stu-id="0141f-134">This lets you monitor the status of your application in a production environment.</span></span> <span data-ttu-id="0141f-135">对使用在多台计算机上运行的多个组件的业务应用程序而言，这一点尤其重要。</span><span class="sxs-lookup"><span data-stu-id="0141f-135">This is especially important in a business application that uses multiple components running on multiple computers.</span></span> <span data-ttu-id="0141f-136">可通过配置文件控制如何在部署后使用开关。</span><span class="sxs-lookup"><span data-stu-id="0141f-136">You can control how the switches are used after deployment through the configuration file.</span></span> <span data-ttu-id="0141f-137">有关详细信息，请参阅[如何：创建、 初始化和配置跟踪开关](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-137">For more information, see [How to: Create, Initialize and Configure Trace Switches](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).</span></span>  
  
 <span data-ttu-id="0141f-138">开发要对其使用跟踪的应用程序时，应用程序代码中通常要包含跟踪和调试消息。</span><span class="sxs-lookup"><span data-stu-id="0141f-138">When you are developing an application for which you intend to use tracing, you usually include both tracing and debugging messages in the application code.</span></span> <span data-ttu-id="0141f-139">准备好部署应用程序时，无需打开“调试”条件属性就可编译发布版本。</span><span class="sxs-lookup"><span data-stu-id="0141f-139">When you are ready to deploy the application, you can compile your release build without turning on the **Debug** conditional attribute.</span></span> <span data-ttu-id="0141f-140">但是，也可以打开“跟踪”条件属性，以便编译器将跟踪代码包括到可执行文件中。</span><span class="sxs-lookup"><span data-stu-id="0141f-140">However, you can turn on the **Trace** conditional attribute so that the compiler includes your trace code in the executable.</span></span> <span data-ttu-id="0141f-141">有关详细信息，请参阅[如何：使用跟踪和调试执行有条件编译](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-141">For more information, see [How to: Compile Conditionally with Trace and Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md).</span></span>  
  
### <a name="phases-of-code-tracing"></a><span data-ttu-id="0141f-142">代码跟踪的阶段</span><span class="sxs-lookup"><span data-stu-id="0141f-142">Phases of Code Tracing</span></span>  
 <span data-ttu-id="0141f-143">代码跟踪有 3 个阶段：</span><span class="sxs-lookup"><span data-stu-id="0141f-143">There are three phases of code tracing:</span></span>  
  
1.  <span data-ttu-id="0141f-144">检测 - 向应用程序添加跟踪代码。</span><span class="sxs-lookup"><span data-stu-id="0141f-144">**Instrumentation** — you add trace code to your application.</span></span>  
  
2.  <span data-ttu-id="0141f-145">跟踪 - 跟踪代码向指定目标写入相应信息。</span><span class="sxs-lookup"><span data-stu-id="0141f-145">**Tracing** — the tracing code writes information to the specified target.</span></span>  
  
3.  <span data-ttu-id="0141f-146">分析 - 评估跟踪信息以确定和了解应用程序中的问题。</span><span class="sxs-lookup"><span data-stu-id="0141f-146">**Analysis** — you evaluate the tracing information to identify and understand problems in the application.</span></span>  
  
 <span data-ttu-id="0141f-147">开发过程中，所有调试和跟踪输出方法都默认将信息写入 Visual Studio 的输出窗口。</span><span class="sxs-lookup"><span data-stu-id="0141f-147">During development, all debug and trace output methods write information to the Output window in Visual Studio by default.</span></span> <span data-ttu-id="0141f-148">在已部署的应用程序中，方法将跟踪信息写入所指定的目标。</span><span class="sxs-lookup"><span data-stu-id="0141f-148">In a deployed application, the methods write tracing information to the targets you specify.</span></span> <span data-ttu-id="0141f-149">有关指定跟踪或调试的输出目标的详细信息，请参阅[跟踪侦听器](../../../docs/framework/debug-trace-profile/trace-listeners.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-149">For more information on specifying an output target for tracing or debugging, see [Trace Listeners](../../../docs/framework/debug-trace-profile/trace-listeners.md).</span></span>  
  
 <span data-ttu-id="0141f-150">以下内容概述了使用跟踪来分析和更正已部署的应用程序中的潜在问题时通常涉及的主要步骤。</span><span class="sxs-lookup"><span data-stu-id="0141f-150">The following is an overall view of the major steps typically involved in using tracing to analyze and correct potential problems in deployed applications.</span></span> <span data-ttu-id="0141f-151">有关如何执行这些步骤的详细信息，请参阅相应链接。</span><span class="sxs-lookup"><span data-stu-id="0141f-151">For more information on how to perform these steps, see the appropriate link.</span></span>  
  
##### <a name="to-use-tracing-in-an-application"></a><span data-ttu-id="0141f-152">若要在应用程序中使用跟踪</span><span class="sxs-lookup"><span data-stu-id="0141f-152">To use tracing in an application</span></span>  
  
1.  <span data-ttu-id="0141f-153">请思考部署应用程序后想要现场接收哪种跟踪输出。</span><span class="sxs-lookup"><span data-stu-id="0141f-153">Consider which tracing output you will want to receive onsite after you have deployed the application.</span></span>  
  
2.  <span data-ttu-id="0141f-154">创建一组开关。</span><span class="sxs-lookup"><span data-stu-id="0141f-154">Create a set of switches.</span></span> <span data-ttu-id="0141f-155">有关详细信息，请参阅[如何：配置跟踪开关](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-155">For more information, see [How to: Configure Trace Switches](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).</span></span>  
  
3.  <span data-ttu-id="0141f-156">向应用程序代码添加跟踪语句。</span><span class="sxs-lookup"><span data-stu-id="0141f-156">Add the trace statements to the application code.</span></span>  
  
4.  <span data-ttu-id="0141f-157">确定要显示跟踪输出的位置并添加相应的侦听器。</span><span class="sxs-lookup"><span data-stu-id="0141f-157">Determine where you want the tracing output to appear and add the appropriate listeners.</span></span> <span data-ttu-id="0141f-158">有关详细信息，请参阅[创建和初始化跟踪侦听器](../../../docs/framework/debug-trace-profile/how-to-create-and-initialize-trace-listeners.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-158">For more information, see [Creating and Initializing Trace Listeners](../../../docs/framework/debug-trace-profile/how-to-create-and-initialize-trace-listeners.md).</span></span>  
  
5.  <span data-ttu-id="0141f-159">测试和调试应用程序及其包含的跟踪代码。</span><span class="sxs-lookup"><span data-stu-id="0141f-159">Test and debug your application and the tracing code it contains.</span></span>  
  
6.  <span data-ttu-id="0141f-160">使用下面一个过程将应用程序编译为可执行代码：</span><span class="sxs-lookup"><span data-stu-id="0141f-160">Compile the application into executable code using one of the following procedures:</span></span>  
  
    -   <span data-ttu-id="0141f-161">使用“构建”菜单以及“解决方案资源管理器”中“属性页”对话框的“调试”页。</span><span class="sxs-lookup"><span data-stu-id="0141f-161">Use the **Build** menu along with the **Debug** page of the **Property Pages** dialog box in **Solution Explorer**.</span></span> <span data-ttu-id="0141f-162">在 Visual Studio 中编译时，请使用此选项。</span><span class="sxs-lookup"><span data-stu-id="0141f-162">Use this when compiling in Visual Studio.</span></span>  
  
         <span data-ttu-id="0141f-163">\- 或 -</span><span class="sxs-lookup"><span data-stu-id="0141f-163">\- or -</span></span>  
  
    -   <span data-ttu-id="0141f-164">对编译的命令行方法使用“跟踪”和“调试”编译器指令。</span><span class="sxs-lookup"><span data-stu-id="0141f-164">Use the **Trace** and **Debug** compiler directives for the command-line method of compiling.</span></span> <span data-ttu-id="0141f-165">有关详细信息，请参阅[使用跟踪和调试进行条件编译](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-165">For more information, see [Compiling Conditionally with Trace and Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md).</span></span> <span data-ttu-id="0141f-166">从命令行进行编译时，请使用此选项。</span><span class="sxs-lookup"><span data-stu-id="0141f-166">Use this when compiling from the command line.</span></span>  
  
7.  <span data-ttu-id="0141f-167">如果在运行时出现问题，请打开相应的跟踪开关。</span><span class="sxs-lookup"><span data-stu-id="0141f-167">If a problem occurs during run time, turn on the appropriate trace switch.</span></span> <span data-ttu-id="0141f-168">有关详细信息，请参阅[配置跟踪开关](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-168">For more information, see [Configuring Trace Switches](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).</span></span>  
  
     <span data-ttu-id="0141f-169">跟踪代码向指定目标写入跟踪消息，如屏幕、文本文件或事件日志。</span><span class="sxs-lookup"><span data-stu-id="0141f-169">The tracing code writes tracing messages to a specified target, for example, a screen, a text file, or an event log.</span></span> <span data-ttu-id="0141f-170">跟踪侦听器集合中附带的侦听器类型确定目标。</span><span class="sxs-lookup"><span data-stu-id="0141f-170">The type of listener you included in the **Trace.Listeners** collection determines the target.</span></span>  
  
8.  <span data-ttu-id="0141f-171">分析跟踪消息以确定和了解应用程序中的问题。</span><span class="sxs-lookup"><span data-stu-id="0141f-171">Analyze the tracing messages to identify and understand the problem in the application.</span></span>  
  
## <a name="trace-instrumentation-and-distributed-applications"></a><span data-ttu-id="0141f-172">跟踪检测和分布式应用程序</span><span class="sxs-lookup"><span data-stu-id="0141f-172">Trace Instrumentation and Distributed Applications</span></span>  
 <span data-ttu-id="0141f-173">在创建分布式应用程序时，可能难以按要使用的方式测试应用程序。</span><span class="sxs-lookup"><span data-stu-id="0141f-173">When you create a distributed application, you might find it difficult to test the application in the manner in which it will be used.</span></span> <span data-ttu-id="0141f-174">开发团队几乎都不能测试操作系统或 Web 浏览器（包括所有本地化的语言选项）的所有潜在组合，也不能模拟将同时访问应用程序的大量用户。</span><span class="sxs-lookup"><span data-stu-id="0141f-174">Few development teams have the capability to test all possible combinations of operating systems or Web browsers (including all the localized language options), or to simulate the high number of users that will access the application at the same time.</span></span> <span data-ttu-id="0141f-175">在这些情况下，无法测试分布式应用程序将如何响应高容量、不同的设置和最终用户的唯一行为。</span><span class="sxs-lookup"><span data-stu-id="0141f-175">Under these circumstances, you cannot test how a distributed application will respond to high volumes, different setups, and unique end-user behaviors.</span></span> <span data-ttu-id="0141f-176">此外，分布式应用程序的很多部件都不具有可直接与之交互或可用于查看这些部件的行为的用户界面。</span><span class="sxs-lookup"><span data-stu-id="0141f-176">Also, many parts of a distributed application have no user interface with which you can interact directly or view the activity of those parts.</span></span>  
  
 <span data-ttu-id="0141f-177">但是，可通过以下方式补偿此不足之处：启用分布式应用程序以描述系统管理员感兴趣的某些事件（尤其是故障事件），并检测应用程序（即，将跟踪语句置于代码中的关键位置）。</span><span class="sxs-lookup"><span data-stu-id="0141f-177">However, you can compensate for this by enabling distributed applications to describe certain events of interest to system administrators, especially things that go wrong, by *instrumenting* the application — that is, by placing trace statements at strategic locations in your code.</span></span> <span data-ttu-id="0141f-178">由此，如果运行时发生意外事件（例如，响应时间过于缓慢），就可确定可能的原因。</span><span class="sxs-lookup"><span data-stu-id="0141f-178">Then if something unexpected occurs at run time (for example, excessively slow response time), you can determine the likely cause.</span></span>  
  
 <span data-ttu-id="0141f-179">借助跟踪语句，可避免执行以下艰难任务：检查原始源代码、对其进行修改、重新编译以及试图在调试环境中生成运行时错误。</span><span class="sxs-lookup"><span data-stu-id="0141f-179">With trace statements you can avoid the difficult task of examining the original source code, modifying it, recompiling, and attempting to produce the run-time error within the debugging environment.</span></span> <span data-ttu-id="0141f-180">请记住，检测应用程序这一操作可用于显示错误以及监视性能。</span><span class="sxs-lookup"><span data-stu-id="0141f-180">Remember that you can instrument an application not only to display errors, but also to monitor performance.</span></span>  
  
## <a name="strategic-placement-of-trace-statements"></a><span data-ttu-id="0141f-181">将跟踪语句置于关键位置</span><span class="sxs-lookup"><span data-stu-id="0141f-181">Strategic Placement of Trace Statements</span></span>  
 <span data-ttu-id="0141f-182">放置供运行时期间使用的跟踪语句时，必须特别小心。</span><span class="sxs-lookup"><span data-stu-id="0141f-182">You must exercise special care when placing your trace statements for use during run time.</span></span> <span data-ttu-id="0141f-183">注意考虑部署的应用程序中可能需要什么跟踪信息，以便充分涵盖所有可能的跟踪方案。</span><span class="sxs-lookup"><span data-stu-id="0141f-183">You must consider what tracing information is likely to be needed in a deployed application, so that all likely tracing scenarios are adequately covered.</span></span> <span data-ttu-id="0141f-184">然而，使用跟踪的应用程序差别很大，因此关于将跟踪置于关键位置，没有通用准则。</span><span class="sxs-lookup"><span data-stu-id="0141f-184">Because applications that use tracing vary widely, however, there are no general guidelines for strategic placement of tracing.</span></span> <span data-ttu-id="0141f-185">有关放置跟踪语句的详细信息，请参阅[如何：将跟踪语句添加到应用程序代码](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-185">For more information on placing trace statements, see [How to: Add Trace Statements to Application Code](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md).</span></span>  
  
## <a name="output-from-tracing"></a><span data-ttu-id="0141f-186">跟踪的输出</span><span class="sxs-lookup"><span data-stu-id="0141f-186">Output from Tracing</span></span>  
 <span data-ttu-id="0141f-187">跟踪输出由名为“侦听器”的对象收集。</span><span class="sxs-lookup"><span data-stu-id="0141f-187">Trace output is collected by objects called *listeners*.</span></span> <span data-ttu-id="0141f-188">侦听器是接收跟踪输出，并将它写入输出设备（通常为窗口、日志或文本文件）的对象。</span><span class="sxs-lookup"><span data-stu-id="0141f-188">A listener is an object that receives trace output and writes it to an output device (usually a window, log, or text file).</span></span> <span data-ttu-id="0141f-189">跟踪侦听器在创建后，通常会被添加到 <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> 集合中，这样侦听器就可以接收所有跟踪输出。</span><span class="sxs-lookup"><span data-stu-id="0141f-189">When a trace listener is created, it is typically added to the <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> collection, allowing the listener to receive all trace output.</span></span>  
  
 <span data-ttu-id="0141f-190">在任何情况下，跟踪信息至少会写入默认的 <xref:System.Diagnostics.Trace> 输出目标 <xref:System.Diagnostics.DefaultTraceListener>。</span><span class="sxs-lookup"><span data-stu-id="0141f-190">Tracing information is always written at least to the default <xref:System.Diagnostics.Trace> output target, the <xref:System.Diagnostics.DefaultTraceListener>.</span></span> <span data-ttu-id="0141f-191">如果您因为某种原因删除了 <xref:System.Diagnostics.DefaultTraceListener> 而没有在 <xref:System.Diagnostics.Trace.Listeners%2A> 集合中添加任何其他侦听器，则将收不到任何跟踪消息。</span><span class="sxs-lookup"><span data-stu-id="0141f-191">If for some reason you have deleted the <xref:System.Diagnostics.DefaultTraceListener> without adding any other listeners to the <xref:System.Diagnostics.Trace.Listeners%2A> collection, you will not receive any tracing messages.</span></span> <span data-ttu-id="0141f-192">有关详细信息，请参阅[跟踪侦听器](../../../docs/framework/debug-trace-profile/trace-listeners.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-192">For more information, see [Trace Listeners](../../../docs/framework/debug-trace-profile/trace-listeners.md).</span></span>  
  
 <span data-ttu-id="0141f-193">下表列出了六个写入跟踪信息的 <xref:System.Diagnostics.Debug> 成员和 <xref:System.Diagnostics.Trace> 方法。</span><span class="sxs-lookup"><span data-stu-id="0141f-193">The six <xref:System.Diagnostics.Debug> members and <xref:System.Diagnostics.Trace> methods that write tracing information are listed in the following table.</span></span>  
  
|<span data-ttu-id="0141f-194">方法</span><span class="sxs-lookup"><span data-stu-id="0141f-194">Method</span></span>|<span data-ttu-id="0141f-195">Output</span><span class="sxs-lookup"><span data-stu-id="0141f-195">Output</span></span>|  
|------------|------------|  
|**<span data-ttu-id="0141f-196">Assert</span><span class="sxs-lookup"><span data-stu-id="0141f-196">Assert</span></span>**|<span data-ttu-id="0141f-197">指定的文本；若未指定，则为调用堆栈。</span><span class="sxs-lookup"><span data-stu-id="0141f-197">The specified text; or, if none is specified, the Call Stack.</span></span> <span data-ttu-id="0141f-198">只有指定为“Assert”语句中的自变量的条件为“false”时，才写入输出。</span><span class="sxs-lookup"><span data-stu-id="0141f-198">The output is written only if the condition specified as an argument in the **Assert** statement is **false**.</span></span>|  
|**<span data-ttu-id="0141f-199">Fail</span><span class="sxs-lookup"><span data-stu-id="0141f-199">Fail</span></span>**|<span data-ttu-id="0141f-200">指定的文本；若未指定，则为调用堆栈。</span><span class="sxs-lookup"><span data-stu-id="0141f-200">The specified text; or, if none is specified, the Call Stack.</span></span>|  
|**<span data-ttu-id="0141f-201">Write</span><span class="sxs-lookup"><span data-stu-id="0141f-201">Write</span></span>**|<span data-ttu-id="0141f-202">指定的文本。</span><span class="sxs-lookup"><span data-stu-id="0141f-202">The specified text.</span></span>|  
|**<span data-ttu-id="0141f-203">WriteIf</span><span class="sxs-lookup"><span data-stu-id="0141f-203">WriteIf</span></span>**|<span data-ttu-id="0141f-204">如果满足指定为“WriteIf”语句中的自变量的条件，则为指定的文本。</span><span class="sxs-lookup"><span data-stu-id="0141f-204">The specified text, if the condition specified as an argument in the **WriteIf** statement is satisfied.</span></span>|  
|**<span data-ttu-id="0141f-205">WriteLine</span><span class="sxs-lookup"><span data-stu-id="0141f-205">WriteLine</span></span>**|<span data-ttu-id="0141f-206">指定的文本和一个回车符。</span><span class="sxs-lookup"><span data-stu-id="0141f-206">The specified text and a carriage return.</span></span>|  
|**<span data-ttu-id="0141f-207">WriteLineIf</span><span class="sxs-lookup"><span data-stu-id="0141f-207">WriteLineIf</span></span>**|<span data-ttu-id="0141f-208">如果满足指定为“WriteIf”语句中的自变量的条件，则为指定的文本和一个回车符。</span><span class="sxs-lookup"><span data-stu-id="0141f-208">The specified text and a carriage return, if the condition specified as an argument in the **WriteLineIf** statement is satisfied.</span></span>|  
  
 <span data-ttu-id="0141f-209"><xref:System.Diagnostics.Trace.Listeners%2A> 集合中所有的侦听器都会接收到上表中介绍的消息，但种类不同的侦听器在接到消息后所执行的操作可能也不同。</span><span class="sxs-lookup"><span data-stu-id="0141f-209">All listeners in the <xref:System.Diagnostics.Trace.Listeners%2A> collection receive the messages described in the above table, but the actions taken may vary depending on what kind of listener receives the message.</span></span> <span data-ttu-id="0141f-210">例如，<xref:System.Diagnostics.DefaultTraceListener> 将在接收到“Fail”或失败的“Assert”通知时显示一个断言对话框，而 <xref:System.Diagnostics.TextWriterTraceListener> 仅将输出写入它的流中。</span><span class="sxs-lookup"><span data-stu-id="0141f-210">For example, the <xref:System.Diagnostics.DefaultTraceListener> displays an assertion dialog box when it receives a **Fail** or failed **Assert** notification, but a <xref:System.Diagnostics.TextWriterTraceListener> simply writes the output to its stream.</span></span>  
  
 <span data-ttu-id="0141f-211">可通过实现自己的侦听器生成自定义结果。</span><span class="sxs-lookup"><span data-stu-id="0141f-211">You can produce custom results by implementing your own listener.</span></span> <span data-ttu-id="0141f-212">例如，自定义跟踪侦听器可能将消息显示给消息框，或连接到数据库以将消息添加到表中。</span><span class="sxs-lookup"><span data-stu-id="0141f-212">A custom trace listener might, for example, display the messages to a message box, or connect to a database to add messages to a table.</span></span> <span data-ttu-id="0141f-213">所有自定义侦听器都应支持上述 6 种方法。</span><span class="sxs-lookup"><span data-stu-id="0141f-213">All custom listeners should support the six methods mentioned above.</span></span> <span data-ttu-id="0141f-214">有关创建开发人员定义的侦听器的详细信息，请参阅 .NET Framework 参考中的 <xref:System.Diagnostics.TraceListener>。</span><span class="sxs-lookup"><span data-stu-id="0141f-214">For more information on creating developer-defined listeners, see <xref:System.Diagnostics.TraceListener> in the .NET Framework reference.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0141f-215">在 [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] 中，“Debug.Write”、“Debug.WriteIf”、“Debug.WriteLine”和“Debug.WriteLineIf”方法已代替了 Visual Basic 早期版本中提供的“Debug.Print”方法。</span><span class="sxs-lookup"><span data-stu-id="0141f-215">In [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], the **Debug.Write**, **Debug.WriteIf**, **Debug.WriteLine**, and **Debug.WriteLineIf** methods have replaced the **Debug.Print** method that was available in earlier versions of Visual Basic.</span></span>  
  
 <span data-ttu-id="0141f-216">“Write”和“WriteLine”方法始终写入指定的文本。</span><span class="sxs-lookup"><span data-stu-id="0141f-216">The **Write** and **WriteLine** methods always write the text that you specify.</span></span> <span data-ttu-id="0141f-217">“Assert”、“WriteIf”和“WriteLineIf”需要布尔型自变量，该自变量控制它们是否写入指定的文本；只有在表达式为“true”（对于“WriteIf”和“WriteLineIf”），或“false”（对于“Assert”）时，它们才会写入指定的文本。</span><span class="sxs-lookup"><span data-stu-id="0141f-217">**Assert**, **WriteIf**, and **WriteLineIf** require a Boolean argument that controls whether or not they write the specified text; they write the specified text only if the expression is **true** (for **WriteIf** and **WriteLineIf**), or **false** (for **Assert**).</span></span> <span data-ttu-id="0141f-218">“Fail”方法始终写入指定的文本。</span><span class="sxs-lookup"><span data-stu-id="0141f-218">The **Fail** method always writes the specified text.</span></span> <span data-ttu-id="0141f-219">有关详细信息，请参阅[如何：将跟踪语句添加到应用程序代码](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md)和.NET Framework 参考。</span><span class="sxs-lookup"><span data-stu-id="0141f-219">For more information, see [How to: Add Trace Statements to Application Code](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md) and the .NET Framework reference.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="0141f-220">安全问题</span><span class="sxs-lookup"><span data-stu-id="0141f-220">Security Concerns</span></span>  
 <span data-ttu-id="0141f-221">如果在部署 ASP.NET 应用程序之前未禁用跟踪和调试，你的应用程序可能会泄漏自身的相关信息，从而被恶意程序利用。</span><span class="sxs-lookup"><span data-stu-id="0141f-221">If you do not disable tracing and debugging before deploying an ASP.NET application, your application may reveal information about itself that could be exploited by a malicious program.</span></span> <span data-ttu-id="0141f-222">有关详细信息，请参阅[如何：使用跟踪和调试进行有条件地编译](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md)，[编译和生成](/visualstudio/ide/compiling-and-building-in-visual-studio)，和[如何：创建、 初始化和配置跟踪开关](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md)。</span><span class="sxs-lookup"><span data-stu-id="0141f-222">For more information, see [How to: Compile Conditionally with Trace and Debug](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md), [Compiling and Building](/visualstudio/ide/compiling-and-building-in-visual-studio), and [How to: Create, Initialize and Configure Trace Switches](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md).</span></span> <span data-ttu-id="0141f-223">也可通过 Internet 信息服务 (IIS) 配置调试。</span><span class="sxs-lookup"><span data-stu-id="0141f-223">Debugging is also configurable through Internet Information Services (IIS).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0141f-224">请参阅</span><span class="sxs-lookup"><span data-stu-id="0141f-224">See also</span></span>

- <xref:System.Diagnostics.Trace>
- <xref:System.Diagnostics.TraceSource>
- [<span data-ttu-id="0141f-225">代码协定</span><span class="sxs-lookup"><span data-stu-id="0141f-225">Code Contracts</span></span>](../../../docs/framework/debug-trace-profile/code-contracts.md)
- [<span data-ttu-id="0141f-226">C#、F# 和 Visual Basic 项目类型</span><span class="sxs-lookup"><span data-stu-id="0141f-226">C#, F#, and Visual Basic Project Types</span></span>](/visualstudio/debugger/debugging-preparation-csharp-f-hash-and-visual-basic-project-types)
- [<span data-ttu-id="0141f-227">如何：向应用程序代码添加跟踪语句</span><span class="sxs-lookup"><span data-stu-id="0141f-227">How to: Add Trace Statements to Application Code</span></span>](../../../docs/framework/debug-trace-profile/how-to-add-trace-statements-to-application-code.md)
- [<span data-ttu-id="0141f-228">如何：使用跟踪和调试执行有条件编译</span><span class="sxs-lookup"><span data-stu-id="0141f-228">How to: Compile Conditionally with Trace and Debug</span></span>](../../../docs/framework/debug-trace-profile/how-to-compile-conditionally-with-trace-and-debug.md)
- [<span data-ttu-id="0141f-229">如何：创建、初始化和配置跟踪开关</span><span class="sxs-lookup"><span data-stu-id="0141f-229">How to: Create, Initialize and Configure Trace Switches</span></span>](../../../docs/framework/debug-trace-profile/how-to-create-initialize-and-configure-trace-switches.md)
- [<span data-ttu-id="0141f-230">如何：创建和初始化跟踪源</span><span class="sxs-lookup"><span data-stu-id="0141f-230">How to: Create and Initialize Trace Sources</span></span>](../../../docs/framework/debug-trace-profile/how-to-create-and-initialize-trace-sources.md)
- [<span data-ttu-id="0141f-231">如何：将 TraceSource 和筛选器与跟踪侦听器一起使用</span><span class="sxs-lookup"><span data-stu-id="0141f-231">How to: Use TraceSource and Filters with Trace Listeners</span></span>](../../../docs/framework/debug-trace-profile/how-to-use-tracesource-and-filters-with-trace-listeners.md)
- [<span data-ttu-id="0141f-232">跟踪侦听器</span><span class="sxs-lookup"><span data-stu-id="0141f-232">Trace Listeners</span></span>](../../../docs/framework/debug-trace-profile/trace-listeners.md)
- [<span data-ttu-id="0141f-233">跟踪开关</span><span class="sxs-lookup"><span data-stu-id="0141f-233">Trace Switches</span></span>](../../../docs/framework/debug-trace-profile/trace-switches.md)
