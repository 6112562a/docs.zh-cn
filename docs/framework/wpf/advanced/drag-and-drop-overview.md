---
title: 拖放概述
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- drag-and-drop [WPF], implementing
- drag sources [WPF], drag-and-drop
- data transfer [WPF], drag-and-drop
- drag-and-drop [WPF], about
- drag-and-drop [WPF], events
- drop targets [WPF], drag-and-drop
ms.assetid: 1a5b27b0-0ac5-4cdf-86c0-86ac0271fa64
ms.openlocfilehash: bb5766a3efc38750458ef0d354e8a2e3ab204000
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/27/2019
ms.locfileid: "70046409"
---
# <a name="drag-and-drop-overview"></a><span data-ttu-id="3efad-102">拖放概述</span><span class="sxs-lookup"><span data-stu-id="3efad-102">Drag and Drop Overview</span></span>
<span data-ttu-id="3efad-103">本主题概述 [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 应用程序中的拖放支持。</span><span class="sxs-lookup"><span data-stu-id="3efad-103">This topic provides an overview of drag-and-drop support in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] applications.</span></span> <span data-ttu-id="3efad-104">拖放通常指一种数据传输方法：使用鼠标（或一些其他指针设备）选择一个或多个对象，将其拖至 [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] 中的某些所需拖放目标之上并放置。</span><span class="sxs-lookup"><span data-stu-id="3efad-104">Drag-and-drop commonly refers to a method of data transfer that involves using a mouse (or some other pointing device) to select one or more objects, dragging these objects over some desired drop target in the [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)], and dropping them.</span></span>  

<a name="Drag_and_Drop_Support"></a>   
## <a name="drag-and-drop-support-in-wpf"></a><span data-ttu-id="3efad-105">WPF 中的拖放支持</span><span class="sxs-lookup"><span data-stu-id="3efad-105">Drag-and-Drop Support in WPF</span></span>  
 <span data-ttu-id="3efad-106">拖放操作通常涉及两个参与方：拖动对象所源自的拖动源和接收放置对象的拖放目标。</span><span class="sxs-lookup"><span data-stu-id="3efad-106">Drag-and-drop operations typically involve two parties: a drag source from which the dragged object originates and a drop target which receives the dropped object.</span></span>  <span data-ttu-id="3efad-107">拖动源和放置目标可能是相同应用程序或不同应用程序中的 UI 元素。</span><span class="sxs-lookup"><span data-stu-id="3efad-107">The drag source and drop target may be UI elements in the same application or a different application.</span></span>  
  
 <span data-ttu-id="3efad-108">可借助拖放操纵的对象的类型和数量是完全任意的。</span><span class="sxs-lookup"><span data-stu-id="3efad-108">The type and number of objects that can be manipulated with drag-and-drop is completely arbitrary.</span></span> <span data-ttu-id="3efad-109">例如，文件、文件夹和内容选择是利用拖放操作操纵的一些常见对象。</span><span class="sxs-lookup"><span data-stu-id="3efad-109">For example, files, folders, and selections of content are some of the more common objects manipulated through drag-and-drop operations.</span></span>  
  
 <span data-ttu-id="3efad-110">拖放操作期间执行的特定操作特定于应用程序，并且通常由上下文而定。</span><span class="sxs-lookup"><span data-stu-id="3efad-110">The particular actions performed during a drag-and-drop operation are application specific, and often determined by context.</span></span>  <span data-ttu-id="3efad-111">例如，将选择的文件从一个文件夹一拖动至相同存储设备上的另一个文件夹将默认移动文件；而将文件从 [!INCLUDE[TLA#tla_unc](../../../../includes/tlasharptla-unc-md.md)] 共享拖动至本地文件夹将默认复制文件。</span><span class="sxs-lookup"><span data-stu-id="3efad-111">For example, dragging a selection of files from one folder to another on the same storage device moves the files by default, whereas dragging files from a [!INCLUDE[TLA#tla_unc](../../../../includes/tlasharptla-unc-md.md)] share to a local folder copies the files by default.</span></span>  
  
 <span data-ttu-id="3efad-112">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 提供的拖放设施拥有高度的灵活性并可自定义，以便支持各种拖放方案。</span><span class="sxs-lookup"><span data-stu-id="3efad-112">The drag-and-drop facilities provided by [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] are designed to be highly flexible and customizable to support a wide variety of drag-and-drop scenarios.</span></span>  <span data-ttu-id="3efad-113">拖放支持在单个应用程序内或不同应用程序之间操作对象。</span><span class="sxs-lookup"><span data-stu-id="3efad-113">Drag-and-drop supports manipulating objects within a single application, or between different applications.</span></span> <span data-ttu-id="3efad-114">也完全支持应用程序和[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]其他 Windows 应用程序之间的拖放。</span><span class="sxs-lookup"><span data-stu-id="3efad-114">Dragging-and-dropping between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications and other Windows applications is also fully supported.</span></span>  
  
 <span data-ttu-id="3efad-115">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，任何 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement> 都可以参与拖放。</span><span class="sxs-lookup"><span data-stu-id="3efad-115">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], any <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> can participate in drag-and-drop.</span></span> <span data-ttu-id="3efad-116">拖放操作所需的事件和方法是在 <xref:System.Windows.DragDrop> 类中定义的。</span><span class="sxs-lookup"><span data-stu-id="3efad-116">The events and methods required for drag-and-drop operations are defined in the <xref:System.Windows.DragDrop> class.</span></span> <span data-ttu-id="3efad-117"><xref:System.Windows.UIElement> 和 <xref:System.Windows.ContentElement> 类包含 <xref:System.Windows.DragDrop> 附加事件的别名，从而在 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement> 作为基元素继承时，这些事件出现在类成员列表中。</span><span class="sxs-lookup"><span data-stu-id="3efad-117">The <xref:System.Windows.UIElement> and <xref:System.Windows.ContentElement> classes contain aliases for the <xref:System.Windows.DragDrop> attached events so that the events appear in the class members list when a <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> is inherited as a base element.</span></span> <span data-ttu-id="3efad-118">附加到这些事件的事件处理程序会附加到基础 <xref:System.Windows.DragDrop> 附加事件，并接收相同的事件数据实例。</span><span class="sxs-lookup"><span data-stu-id="3efad-118">Event handlers that are attached to these events are attached to the underlying <xref:System.Windows.DragDrop> attached event and receive the same event data instance.</span></span> <span data-ttu-id="3efad-119">有关详细信息，请参阅 <xref:System.Windows.UIElement.Drop?displayProperty=nameWithType> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-119">For more information, see the <xref:System.Windows.UIElement.Drop?displayProperty=nameWithType> event.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="3efad-120">在 Internet 区域中 OLE 拖放无效。</span><span class="sxs-lookup"><span data-stu-id="3efad-120">OLE drag-and-drop does not work while in the Internet zone.</span></span>  
  
<a name="Data_Transfer"></a>   
## <a name="data-transfer"></a><span data-ttu-id="3efad-121">数据传输</span><span class="sxs-lookup"><span data-stu-id="3efad-121">Data Transfer</span></span>  
 <span data-ttu-id="3efad-122">拖放属于广义的数据传输。</span><span class="sxs-lookup"><span data-stu-id="3efad-122">Drag-and-drop is part of the more general area of data transfer.</span></span> <span data-ttu-id="3efad-123">数据传输包括拖放和复制粘贴操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-123">Data transfer includes drag-and-drop and copy-and-paste operations.</span></span> <span data-ttu-id="3efad-124">拖放操作类似于用于借助系统剪贴板将数据从一个对象或应用程序传输到另一个对象或应用程序的复制粘贴或剪切和粘贴操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-124">A drag-and-drop operation is analogous to a copy-and-paste or cut-and-paste operation that is used to transfer data from one object or application to another by using the system clipboard.</span></span> <span data-ttu-id="3efad-125">这两种类型的操作均要求：</span><span class="sxs-lookup"><span data-stu-id="3efad-125">Both types of operations require:</span></span>  
  
- <span data-ttu-id="3efad-126">提供数据的源对象。</span><span class="sxs-lookup"><span data-stu-id="3efad-126">A source object that provides the data.</span></span>  
  
- <span data-ttu-id="3efad-127">用于临时存储传输的数据的方法。</span><span class="sxs-lookup"><span data-stu-id="3efad-127">A way to temporarily store the transferred data.</span></span>  
  
- <span data-ttu-id="3efad-128">接收数据的目标对象。</span><span class="sxs-lookup"><span data-stu-id="3efad-128">A target object that receives the data.</span></span>  
  
 <span data-ttu-id="3efad-129">在复制粘贴操作中，系统剪贴板用于临时存储传输的数据；在拖放操作中，<xref:System.Windows.DataObject> 用于存储数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-129">In a copy-and-paste operation, the system clipboard is used to temporarily store the transferred data; in a drag-and-drop operation, a <xref:System.Windows.DataObject> is used to store the data.</span></span> <span data-ttu-id="3efad-130">从概念上讲，数据对象由一对或多对包含实际数据的 <xref:System.Object> 和对应的数据格式标识符组成。</span><span class="sxs-lookup"><span data-stu-id="3efad-130">Conceptually, a data object consists of one or more pairs of an <xref:System.Object> that contains the actual data, and a corresponding data format identifier.</span></span>  
  
 <span data-ttu-id="3efad-131">拖动源通过调用静态 <xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=nameWithType> 方法和向其传递传输的数据来启动拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-131">The drag source initiates a drag-and-drop operation by calling the static <xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=nameWithType> method and passing the transferred data to it.</span></span> <span data-ttu-id="3efad-132">如有必要，<xref:System.Windows.DragDrop.DoDragDrop%2A> 方法将使 <xref:System.Windows.DataObject> 中的数据自动换行。</span><span class="sxs-lookup"><span data-stu-id="3efad-132">The <xref:System.Windows.DragDrop.DoDragDrop%2A> method will automatically wrap the data in a <xref:System.Windows.DataObject> if necessary.</span></span> <span data-ttu-id="3efad-133">为了更好地控制数据格式，可将 <xref:System.Windows.DataObject> 中的数据换行，然后再将其传递至 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="3efad-133">For greater control over the data format, you can wrap the data in a <xref:System.Windows.DataObject> before passing it to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="3efad-134">拖放目标负责从 <xref:System.Windows.DataObject> 中提取数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-134">The drop target is responsible for extracting the data from the <xref:System.Windows.DataObject>.</span></span> <span data-ttu-id="3efad-135">有关使用数据对象的详细信息，请参阅[数据和数据对象](data-and-data-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="3efad-135">For more information about working with data objects, see [Data and Data Objects](data-and-data-objects.md).</span></span>  
  
 <span data-ttu-id="3efad-136">拖放操作的源和目标均为 UI 元素；然而，实际正在传输的数据通常不具有可视表示形式。</span><span class="sxs-lookup"><span data-stu-id="3efad-136">The source and target of a drag-and-drop operation are UI elements; however, the data that is actually being transferred typically does not have a visual representation.</span></span> <span data-ttu-id="3efad-137">可以编写代码来提供拖动的数据的可视表示形式（比如当在 Windows 资源管理器中拖动文件时会出现这种情况）。</span><span class="sxs-lookup"><span data-stu-id="3efad-137">You can write code to provide a visual representation of the data that is dragged, such as occurs when dragging files in Windows Explorer.</span></span> <span data-ttu-id="3efad-138">默认情况下，通过更改光标将反馈提供给用户，以便表示拖放操作将对数据产生的影响，例如将移动数据还是复制数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-138">By default, feedback is provided to the user by changing the cursor to represent the effect that the drag-and-drop operation will have on the data, such as whether the data will be moved or copied.</span></span>  
  
### <a name="drag-and-drop-effects"></a><span data-ttu-id="3efad-139">拖放效果</span><span class="sxs-lookup"><span data-stu-id="3efad-139">Drag-and-Drop Effects</span></span>  
 <span data-ttu-id="3efad-140">拖放操作对传输的数据可具有不同的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-140">Drag-and-drop operations can have different effects on the transferred data.</span></span> <span data-ttu-id="3efad-141">例如，可以复制数据，或者可以移动数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-141">For example, you can copy the data or you can move the data.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="3efad-142">定义可用于指定拖放操作效果的 <xref:System.Windows.DragDropEffects> 枚举。</span><span class="sxs-lookup"><span data-stu-id="3efad-142">defines a <xref:System.Windows.DragDropEffects> enumeration that you can use to specify the effect of a drag-and-drop operation.</span></span> <span data-ttu-id="3efad-143">在拖动源中，可以指定源在 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法中允许的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-143">In the drag source, you can specify the effects that the source will allow in the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="3efad-144">在拖放目标中，可以指定目标在 <xref:System.Windows.DragEventArgs.Effects%2A> 类的 <xref:System.Windows.DragEventArgs> 属性的中预期的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-144">In the drop target, you can specify the effect that the target intends in the <xref:System.Windows.DragEventArgs.Effects%2A> property of the <xref:System.Windows.DragEventArgs> class.</span></span> <span data-ttu-id="3efad-145">当拖放目标指定其在 <xref:System.Windows.DragDrop.DragOver> 事件中的预期效果时，该信息将被传递回 <xref:System.Windows.DragDrop.GiveFeedback> 事件中的拖动源。</span><span class="sxs-lookup"><span data-stu-id="3efad-145">When the drop target specifies its intended effect in the <xref:System.Windows.DragDrop.DragOver> event, that information is passed back to the drag source in the <xref:System.Windows.DragDrop.GiveFeedback> event.</span></span> <span data-ttu-id="3efad-146">拖动源则使用此信息通知用户拖放目标想要对数据产生的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-146">The drag source uses this information to inform the user what effect the drop target intends to have on the data.</span></span> <span data-ttu-id="3efad-147">放置数据时，拖放目标指定其在 <xref:System.Windows.DragDrop.Drop> 事件中的实际效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-147">When the data is dropped, the drop target specifies its actual effect in the <xref:System.Windows.DragDrop.Drop> event.</span></span> <span data-ttu-id="3efad-148">该信息会作为 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法的返回值传递回拖动源。</span><span class="sxs-lookup"><span data-stu-id="3efad-148">That information is passed back to the drag source as the return value of the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="3efad-149">如果拖放目标返回并不在 `allowedEffects` 拖动源列表中的效果，那么将取消拖放操作，且不会进行任何数据传输。</span><span class="sxs-lookup"><span data-stu-id="3efad-149">If the drop target returns an effect that is not in the drag sources list of `allowedEffects`, the drag-and-drop operation is cancelled without any data transfer occurring.</span></span>  
  
 <span data-ttu-id="3efad-150">请务必记住，在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，<xref:System.Windows.DragDropEffects> 值仅用于提供有关拖放操作效果的拖动源和拖放目标之间的通信。</span><span class="sxs-lookup"><span data-stu-id="3efad-150">It is important to remember that in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], the <xref:System.Windows.DragDropEffects> values are only used to provide communication between the drag source and the drop target regarding the effects of the drag-and-drop operation.</span></span> <span data-ttu-id="3efad-151">拖放操作的实际效果取决于你在应用程序中编写的相应代码。</span><span class="sxs-lookup"><span data-stu-id="3efad-151">The actual effect of the drag-and-drop operation depends on you to write the appropriate code in your application.</span></span>  
  
 <span data-ttu-id="3efad-152">例如，拖放目标可以指定在其中放置数据的效果是移动数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-152">For example, the drop target might specify that the effect of dropping data on it is to move the data.</span></span> <span data-ttu-id="3efad-153">然而，若要移动数据，必须将数据添加到目标元素并从源元素中删除数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-153">However, to move the data, it must be both added to the target element and removed from the source element.</span></span> <span data-ttu-id="3efad-154">源元素可能指示允许移动数据，但是如果没有提供从源元素中删除数据的代码，那么最终结果将为复制但不删除数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-154">The source element might indicate that it allows moving the data, but if you do not provide the code to remove the data from the source element, the end result will be that the data is copied, and not moved.</span></span>  
  
<a name="Drag_and_Drop_Events"></a>   
## <a name="drag-and-drop-events"></a><span data-ttu-id="3efad-155">拖放事件</span><span class="sxs-lookup"><span data-stu-id="3efad-155">Drag-and-Drop Events</span></span>  
 <span data-ttu-id="3efad-156">拖放操作支持事件驱动模型。</span><span class="sxs-lookup"><span data-stu-id="3efad-156">Drag-and-drop operations support an event driven model.</span></span>  <span data-ttu-id="3efad-157">拖动源和拖放目标都使用一组标准的事件来处理拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-157">Both the drag source and the drop target use a standard set of events to handle drag-and-drop operations.</span></span>  <span data-ttu-id="3efad-158">下表总结了标准的拖放事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-158">The following tables summarize the standard drag-and-drop events.</span></span> <span data-ttu-id="3efad-159">它们是 <xref:System.Windows.DragDrop> 类中的附加事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-159">These are attached events on the <xref:System.Windows.DragDrop> class.</span></span> <span data-ttu-id="3efad-160">有关附加事件的详细信息，请参阅[附加事件概述](attached-events-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="3efad-160">For more information about attached events, see [Attached Events Overview](attached-events-overview.md).</span></span>  
  
### <a name="drag-source-events"></a><span data-ttu-id="3efad-161">拖动源事件</span><span class="sxs-lookup"><span data-stu-id="3efad-161">Drag Source Events</span></span>  
  
|<span data-ttu-id="3efad-162">Event</span><span class="sxs-lookup"><span data-stu-id="3efad-162">Event</span></span>|<span data-ttu-id="3efad-163">总结</span><span class="sxs-lookup"><span data-stu-id="3efad-163">Summary</span></span>|  
|-----------|-------------|  
|<xref:System.Windows.DragDrop.GiveFeedback>|<span data-ttu-id="3efad-164">此事件在拖放操作期间持续发生，并且使放置源能够向用户提供反馈信息。</span><span class="sxs-lookup"><span data-stu-id="3efad-164">This event occurs continuously during a drag-and-drop operation, and enables the drop source to give feedback information to the user.</span></span> <span data-ttu-id="3efad-165">通常通过更改鼠标指针外观来指示拖放目标允许的效果这一方式来提供这种反馈。</span><span class="sxs-lookup"><span data-stu-id="3efad-165">This feedback is commonly given by changing the appearance of the mouse pointer to indicate the effects allowed by the drop target.</span></span>  <span data-ttu-id="3efad-166">这是冒泡事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-166">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.QueryContinueDrag>|<span data-ttu-id="3efad-167">此事件于拖放操作期间键盘或鼠标按钮状态发生变化时发生，并使放置源能够根据键/按钮状态取消拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-167">This event occurs when there is a change in the keyboard or mouse button states during a drag-and-drop operation, and enables the drop source to cancel the drag-and-drop operation depending on the key/button states.</span></span> <span data-ttu-id="3efad-168">这是冒泡事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-168">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewGiveFeedback>|<span data-ttu-id="3efad-169"><xref:System.Windows.DragDrop.GiveFeedback> 的隧道版本。</span><span class="sxs-lookup"><span data-stu-id="3efad-169">Tunneling version of <xref:System.Windows.DragDrop.GiveFeedback>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewQueryContinueDrag>|<span data-ttu-id="3efad-170"><xref:System.Windows.DragDrop.QueryContinueDrag> 的隧道版本。</span><span class="sxs-lookup"><span data-stu-id="3efad-170">Tunneling version of <xref:System.Windows.DragDrop.QueryContinueDrag>.</span></span>|  
  
### <a name="drop-target-events"></a><span data-ttu-id="3efad-171">拖放目标事件</span><span class="sxs-lookup"><span data-stu-id="3efad-171">Drop Target Events</span></span>  
  
|<span data-ttu-id="3efad-172">Event</span><span class="sxs-lookup"><span data-stu-id="3efad-172">Event</span></span>|<span data-ttu-id="3efad-173">总结</span><span class="sxs-lookup"><span data-stu-id="3efad-173">Summary</span></span>|  
|-----------|-------------|  
|<xref:System.Windows.DragDrop.DragEnter>|<span data-ttu-id="3efad-174">将对象拖到拖放目标的边界中时发生此事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-174">This event occurs when an object is dragged into the drop target's boundary.</span></span> <span data-ttu-id="3efad-175">这是冒泡事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-175">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.DragLeave>|<span data-ttu-id="3efad-176">将对象拖出拖放目标边界时发生此事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-176">This event occurs when an object is dragged out of the drop target's boundary.</span></span>  <span data-ttu-id="3efad-177">这是冒泡事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-177">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.DragOver>|<span data-ttu-id="3efad-178">在拖放目标的边界内拖动（移动）对象时会持续发生此事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-178">This event occurs continuously while an object is dragged (moved) within the drop target's boundary.</span></span> <span data-ttu-id="3efad-179">这是冒泡事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-179">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.Drop>|<span data-ttu-id="3efad-180">将对象放置在拖放目标上时发生此事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-180">This event occurs when an object is dropped on the drop target.</span></span>  <span data-ttu-id="3efad-181">这是冒泡事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-181">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDragEnter>|<span data-ttu-id="3efad-182"><xref:System.Windows.DragDrop.DragEnter> 的隧道版本。</span><span class="sxs-lookup"><span data-stu-id="3efad-182">Tunneling version of <xref:System.Windows.DragDrop.DragEnter>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDragLeave>|<span data-ttu-id="3efad-183"><xref:System.Windows.DragDrop.DragLeave> 的隧道版本。</span><span class="sxs-lookup"><span data-stu-id="3efad-183">Tunneling version of <xref:System.Windows.DragDrop.DragLeave>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDragOver>|<span data-ttu-id="3efad-184"><xref:System.Windows.DragDrop.DragOver> 的隧道版本。</span><span class="sxs-lookup"><span data-stu-id="3efad-184">Tunneling version of <xref:System.Windows.DragDrop.DragOver>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDrop>|<span data-ttu-id="3efad-185"><xref:System.Windows.DragDrop.Drop> 的隧道版本。</span><span class="sxs-lookup"><span data-stu-id="3efad-185">Tunneling version of <xref:System.Windows.DragDrop.Drop>.</span></span>|  
  
 <span data-ttu-id="3efad-186">若要处理对象实例的拖放事件，请为上表中所列的事件添加处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-186">To handle drag-and-drop events for instances of an object, add handlers for the events listed in the preceding tables.</span></span> <span data-ttu-id="3efad-187">若要处理类级别的拖放事件，请替代相应的虚拟 On\*Event 和 On\*PreviewEvent 方法。</span><span class="sxs-lookup"><span data-stu-id="3efad-187">To handle drag-and-drop events at the class level, override the corresponding virtual On\*Event and On\*PreviewEvent methods.</span></span> <span data-ttu-id="3efad-188">有关详细信息，请参阅[按控件基类进行的路由事件类处理](marking-routed-events-as-handled-and-class-handling.md#Class_Handling_of_Routed_Events)。</span><span class="sxs-lookup"><span data-stu-id="3efad-188">For more information, see [Class Handling of Routed Events by Control Base Classes](marking-routed-events-as-handled-and-class-handling.md#Class_Handling_of_Routed_Events).</span></span>  
  
<a name="Implementing_Drag_And_Drop"></a>   
## <a name="implementing-drag-and-drop"></a><span data-ttu-id="3efad-189">实现拖放</span><span class="sxs-lookup"><span data-stu-id="3efad-189">Implementing Drag-and-Drop</span></span>  
 <span data-ttu-id="3efad-190">UI 元素可以是拖动源、拖放目标或两者均可。</span><span class="sxs-lookup"><span data-stu-id="3efad-190">A UI element can be a drag source, a drop target, or both.</span></span> <span data-ttu-id="3efad-191">若要实现基本拖放，请编写用于启动拖放操作和处理放置的数据的代码。</span><span class="sxs-lookup"><span data-stu-id="3efad-191">To implement basic drag-and-drop, you write code to initiate the drag-and-drop operation and to process the dropped data.</span></span> <span data-ttu-id="3efad-192">可以通过处理可选拖放事件增强拖放体验。</span><span class="sxs-lookup"><span data-stu-id="3efad-192">You can enhance the drag-and-drop experience by handling optional drag-and-drop events.</span></span>  
  
 <span data-ttu-id="3efad-193">若要实现基本拖放，将完成以下任务：</span><span class="sxs-lookup"><span data-stu-id="3efad-193">To implement basic drag-and-drop, you will complete the following tasks:</span></span>  
  
- <span data-ttu-id="3efad-194">标识将作为拖动源的元素。</span><span class="sxs-lookup"><span data-stu-id="3efad-194">Identify the element that will be a drag source.</span></span> <span data-ttu-id="3efad-195">拖动源可以是 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement>。</span><span class="sxs-lookup"><span data-stu-id="3efad-195">A drag source can be a <xref:System.Windows.UIElement> or a <xref:System.Windows.ContentElement>.</span></span>  
  
- <span data-ttu-id="3efad-196">在将启动拖放操作的拖动源上创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-196">Create an event handler on the drag source that will initiate the drag-and-drop operation.</span></span> <span data-ttu-id="3efad-197">此事件通常是 <xref:System.Windows.UIElement.MouseMove> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-197">The event is typically the <xref:System.Windows.UIElement.MouseMove> event.</span></span>  
  
- <span data-ttu-id="3efad-198">在拖动源事件处理程序中，调用 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法启动拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-198">In the drag source event handler, call the <xref:System.Windows.DragDrop.DoDragDrop%2A> method to initiate the drag-and-drop operation.</span></span> <span data-ttu-id="3efad-199">在 <xref:System.Windows.DragDrop.DoDragDrop%2A> 调用中，指定拖动源、要传输的数据和允许的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-199">In the <xref:System.Windows.DragDrop.DoDragDrop%2A> call, specify the drag source, the data to be transferred, and the allowed effects.</span></span>  
  
- <span data-ttu-id="3efad-200">标识将作为拖放目标的元素。</span><span class="sxs-lookup"><span data-stu-id="3efad-200">Identify the element that will be a drop target.</span></span> <span data-ttu-id="3efad-201">拖放目标可以是 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement>。</span><span class="sxs-lookup"><span data-stu-id="3efad-201">A drop target can be <xref:System.Windows.UIElement> or a <xref:System.Windows.ContentElement>.</span></span>  
  
- <span data-ttu-id="3efad-202">在拖放目标上，将 <xref:System.Windows.UIElement.AllowDrop%2A> 属性设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="3efad-202">On the drop target, set the <xref:System.Windows.UIElement.AllowDrop%2A> property to `true`.</span></span>  
  
- <span data-ttu-id="3efad-203">在拖放目标中，创建 <xref:System.Windows.DragDrop.Drop> 事件处理程序以处理放置的数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-203">In the drop target, create a <xref:System.Windows.DragDrop.Drop> event handler to process the dropped data.</span></span>  
  
- <span data-ttu-id="3efad-204">在 <xref:System.Windows.DragDrop.Drop> 事件处理程序中，利用 <xref:System.Windows.DragEventArgs> 和 <xref:System.Windows.DataObject.GetDataPresent%2A> 方法提取 <xref:System.Windows.DataObject.GetData%2A> 中的数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-204">In the <xref:System.Windows.DragDrop.Drop> event handler, extract the data from the <xref:System.Windows.DragEventArgs> by using the <xref:System.Windows.DataObject.GetDataPresent%2A> and <xref:System.Windows.DataObject.GetData%2A> methods.</span></span>  
  
- <span data-ttu-id="3efad-205">在 <xref:System.Windows.DragDrop.Drop> 事件处理程序中，使用数据来执行所需的拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-205">In the <xref:System.Windows.DragDrop.Drop> event handler, use the data to perform the desired drag-and-drop operation.</span></span>  
  
 <span data-ttu-id="3efad-206">可以通过创建自定义 <xref:System.Windows.DataObject> 和处理可选拖动源和拖放目标事件来增加拖放实现，如以下任务中所示：</span><span class="sxs-lookup"><span data-stu-id="3efad-206">You can enhance your drag-and-drop implementation by creating a custom <xref:System.Windows.DataObject> and by handling optional drag source and drop target events, as shown in the following tasks:</span></span>  
  
- <span data-ttu-id="3efad-207">若要传输自定义数据或多个数据项，请创建一个 <xref:System.Windows.DataObject>以传递至 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="3efad-207">To transfer custom data or multiple data items, create a <xref:System.Windows.DataObject> to pass to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span>  
  
- <span data-ttu-id="3efad-208">若要在拖动过程中执行其他操作，请处理拖放目标上的 <xref:System.Windows.DragDrop.DragEnter><xref:System.Windows.DragDrop.DragOver> 和 <xref:System.Windows.DragDrop.DragLeave> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-208">To perform additional actions during a drag, handle the <xref:System.Windows.DragDrop.DragEnter>, <xref:System.Windows.DragDrop.DragOver>, and <xref:System.Windows.DragDrop.DragLeave> events on the drop target.</span></span>  
  
- <span data-ttu-id="3efad-209">若要更改鼠标指针外观，请处理拖动源上的 <xref:System.Windows.DragDrop.GiveFeedback> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-209">To change the appearance of the mouse pointer, handle the <xref:System.Windows.DragDrop.GiveFeedback> event on the drag source.</span></span>  
  
- <span data-ttu-id="3efad-210">若要更改取消拖放操作的方式，请处理拖动源上的 <xref:System.Windows.DragDrop.QueryContinueDrag> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-210">To change how the drag-and-drop operation is canceled, handle the <xref:System.Windows.DragDrop.QueryContinueDrag> event on the drag source.</span></span>  
  
<a name="Drag_And_Drop_Example"></a>   
## <a name="drag-and-drop-example"></a><span data-ttu-id="3efad-211">拖放示例</span><span class="sxs-lookup"><span data-stu-id="3efad-211">Drag-and-Drop Example</span></span>  
 <span data-ttu-id="3efad-212">本节介绍如何实现 <xref:System.Windows.Shapes.Ellipse> 元素的拖放。</span><span class="sxs-lookup"><span data-stu-id="3efad-212">This section describes how to implement drag-and-drop for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="3efad-213"><xref:System.Windows.Shapes.Ellipse> 既是拖动源也是拖放目标。</span><span class="sxs-lookup"><span data-stu-id="3efad-213">The <xref:System.Windows.Shapes.Ellipse> is both a drag source and a drop target.</span></span> <span data-ttu-id="3efad-214">传输的数据是椭圆形的 <xref:System.Windows.Shapes.Shape.Fill%2A> 属性的字符串表示形式。</span><span class="sxs-lookup"><span data-stu-id="3efad-214">The transferred data is the string representation of the ellipse’s <xref:System.Windows.Shapes.Shape.Fill%2A> property.</span></span> <span data-ttu-id="3efad-215">下面的 XAML 展示 <xref:System.Windows.Shapes.Ellipse> 元素和它处理的拖放相关事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-215">The following XAML shows the <xref:System.Windows.Shapes.Ellipse> element and the drag-and-drop related events that it handles.</span></span> <span data-ttu-id="3efad-216">有关如何实现拖放的完整步骤, 请参阅[演练:对用户控件](walkthrough-enabling-drag-and-drop-on-a-user-control.md)启用拖放。</span><span class="sxs-lookup"><span data-stu-id="3efad-216">For complete steps on how to implement drag-and-drop, see [Walkthrough: Enabling Drag and Drop on a User Control](walkthrough-enabling-drag-and-drop-on-a-user-control.md).</span></span>  
  
 [!code-xaml[DragDropSnippets#EllipseXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml#ellipsexaml)]  
  
### <a name="enabling-an-element-to-be-a-drag-source"></a><span data-ttu-id="3efad-217">使元素作为拖动源</span><span class="sxs-lookup"><span data-stu-id="3efad-217">Enabling an Element to be a Drag Source</span></span>  
 <span data-ttu-id="3efad-218">拖动源对象用于：</span><span class="sxs-lookup"><span data-stu-id="3efad-218">An object that is a drag source is responsible for:</span></span>  
  
- <span data-ttu-id="3efad-219">标识拖动发生的时候。</span><span class="sxs-lookup"><span data-stu-id="3efad-219">Identifying when a drag occurs.</span></span>  
  
- <span data-ttu-id="3efad-220">启动拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-220">Initiating the drag-and-drop operation.</span></span>  
  
- <span data-ttu-id="3efad-221">标识要传输的数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-221">Identifying the data to be transferred.</span></span>  
  
- <span data-ttu-id="3efad-222">指定允许拖放操作对传输的数据产生的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-222">Specifying the effects that the drag-and-drop operation is allowed to have on the transferred data.</span></span>  
  
 <span data-ttu-id="3efad-223">拖动源还可能针对允许的操作（移动、复制、无）向用户提供反馈，并且可以根据额外用户输入（如拖动过程中按 ESC 键）取消拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-223">The drag source may also give feedback to the user regarding the allowed actions (move, copy, none), and can cancel the drag-and-drop operation based on additional user input, such as pressing the ESC key during the drag.</span></span>  
  
 <span data-ttu-id="3efad-224">你的应用程序负责确定发生拖动的时间，然后通过调用 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法启动拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-224">It is the responsibility of your application to determine when a drag occurs, and then initiate the drag-and-drop operation by calling the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="3efad-225">通常情况下，这是在按下鼠标按钮的同时，要拖动的元素上发生 <xref:System.Windows.UIElement.MouseMove> 事件时。</span><span class="sxs-lookup"><span data-stu-id="3efad-225">Typically, this is when a <xref:System.Windows.UIElement.MouseMove> event occurs over the element to be dragged while a mouse button is pressed.</span></span> <span data-ttu-id="3efad-226">下面的示例显示了如何从 <xref:System.Windows.Shapes.Ellipse> 元素的 <xref:System.Windows.UIElement.MouseMove> 事件处理程序中启动拖放操作，以将其作为拖动源。</span><span class="sxs-lookup"><span data-stu-id="3efad-226">The following example shows how to initiate a drag-and-drop operation from the <xref:System.Windows.UIElement.MouseMove> event handler of an <xref:System.Windows.Shapes.Ellipse> element to make it a drag source.</span></span> <span data-ttu-id="3efad-227">传输的数据是椭圆形的 <xref:System.Windows.Shapes.Shape.Fill%2A> 属性的字符串表示形式。</span><span class="sxs-lookup"><span data-stu-id="3efad-227">The transferred data is the string representation of the ellipse’s <xref:System.Windows.Shapes.Shape.Fill%2A> property.</span></span>  
  
 [!code-csharp[DragDropSnippets#DoDragDrop](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dodragdrop)]
 [!code-vb[DragDropSnippets#DoDragDrop](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dodragdrop)]  
  
 <span data-ttu-id="3efad-228">在 <xref:System.Windows.UIElement.MouseMove> 事件处理程序中，调用 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法启动拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-228">Inside of the <xref:System.Windows.UIElement.MouseMove> event handler, call the <xref:System.Windows.DragDrop.DoDragDrop%2A> method to initiate the drag-and-drop operation.</span></span> <span data-ttu-id="3efad-229"><xref:System.Windows.DragDrop.DoDragDrop%2A> 方法采用三个参数：</span><span class="sxs-lookup"><span data-stu-id="3efad-229">The <xref:System.Windows.DragDrop.DoDragDrop%2A> method takes three parameters:</span></span>  
  
- <span data-ttu-id="3efad-230">`dragSource` – 引用作为传输的数据的源的依赖项对象；通常是 <xref:System.Windows.UIElement.MouseMove> 事件的源。</span><span class="sxs-lookup"><span data-stu-id="3efad-230">`dragSource` – A reference to the dependency object that is the source of the transferred data; this is typically the source of the <xref:System.Windows.UIElement.MouseMove> event.</span></span>  
  
- <span data-ttu-id="3efad-231">`data` - 包含传输的数据（包装在 <xref:System.Windows.DataObject> 中）的对象。</span><span class="sxs-lookup"><span data-stu-id="3efad-231">`data` - An object that contains the transferred data, wrapped in a <xref:System.Windows.DataObject>.</span></span>  
  
- <span data-ttu-id="3efad-232">`allowedEffects` - 指定拖放操作允许的效果的 <xref:System.Windows.DragDropEffects> 枚举值之一。</span><span class="sxs-lookup"><span data-stu-id="3efad-232">`allowedEffects` - One of the <xref:System.Windows.DragDropEffects> enumeration values that specifies the permitted effects of the drag-and-drop operation.</span></span>  
  
 <span data-ttu-id="3efad-233">任何可序列化对象都可以在 `data` 参数中传递。</span><span class="sxs-lookup"><span data-stu-id="3efad-233">Any serializable object can be passed in the `data` parameter.</span></span> <span data-ttu-id="3efad-234">如果数据尚未包装在 <xref:System.Windows.DataObject> 中，则它将自动包装在一个新的 <xref:System.Windows.DataObject> 中。</span><span class="sxs-lookup"><span data-stu-id="3efad-234">If the data is not already wrapped in a <xref:System.Windows.DataObject>, it will automatically be wrapped in a new <xref:System.Windows.DataObject>.</span></span> <span data-ttu-id="3efad-235">若要传递多个数据项，必须自行创建 <xref:System.Windows.DataObject>，并将其传递到 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="3efad-235">To pass multiple data items, you must create the <xref:System.Windows.DataObject> yourself, and pass it to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="3efad-236">有关详细信息，请参阅[数据和数据对象](data-and-data-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="3efad-236">For more information, see [Data and Data Objects](data-and-data-objects.md).</span></span>  
  
 <span data-ttu-id="3efad-237">`allowedEffects` 参数用于指定拖动源允许拖放目标对传输的数据进行什么操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-237">The `allowedEffects` parameter is used to specify what the drag source will allow the drop target to do with the transferred data.</span></span> <span data-ttu-id="3efad-238">拖动源公共值为 <xref:System.Windows.DragDropEffects.Copy><xref:System.Windows.DragDropEffects.Move> 和<xref:System.Windows.DragDropEffects.All>。</span><span class="sxs-lookup"><span data-stu-id="3efad-238">The common values for a drag source are <xref:System.Windows.DragDropEffects.Copy>, <xref:System.Windows.DragDropEffects.Move>, and <xref:System.Windows.DragDropEffects.All>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3efad-239">拖放目标也能够指定其对放置的数据的预期效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-239">The drop target is also able to specify what effects it intends in response to the dropped data.</span></span> <span data-ttu-id="3efad-240">例如，如果拖放目标不能识别要放置的数据类型，则可以通过将其允许的效果设置为 <xref:System.Windows.DragDropEffects.None> 来拒绝数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-240">For example, if the drop target does not recognize the data type to be dropped, it can refuse the data by setting its allowed effects to <xref:System.Windows.DragDropEffects.None>.</span></span> <span data-ttu-id="3efad-241">通常在其 <xref:System.Windows.DragDrop.DragOver> 事件处理程序中进行此操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-241">It typically does this in its <xref:System.Windows.DragDrop.DragOver> event handler.</span></span>  
  
 <span data-ttu-id="3efad-242">拖动源还可以可选地处理 <xref:System.Windows.DragDrop.GiveFeedback> 和 <xref:System.Windows.DragDrop.QueryContinueDrag> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-242">A drag source can optionally handle the <xref:System.Windows.DragDrop.GiveFeedback> and <xref:System.Windows.DragDrop.QueryContinueDrag> events.</span></span> <span data-ttu-id="3efad-243">这些事件都具有使用的默认处理程序，除非将事件标记为已处理。</span><span class="sxs-lookup"><span data-stu-id="3efad-243">These events have default handlers that are used unless you mark the events as handled.</span></span> <span data-ttu-id="3efad-244">通常将忽略这些事件，除非有更改其默认行为的特定需要。</span><span class="sxs-lookup"><span data-stu-id="3efad-244">You will typically ignore these events unless you have a specific need to change their default behavior.</span></span>  
  
 <span data-ttu-id="3efad-245">对拖动源进行拖动时，持续引发 <xref:System.Windows.DragDrop.GiveFeedback> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-245">The <xref:System.Windows.DragDrop.GiveFeedback> event is raised continuously while the drag source is being dragged.</span></span> <span data-ttu-id="3efad-246">此事件的默认处理程序会检查拖动源是否在有效放置目标之上。</span><span class="sxs-lookup"><span data-stu-id="3efad-246">The default handler for this event checks whether the drag source is over a valid drop target.</span></span> <span data-ttu-id="3efad-247">如果是，它会检查拖放目标的允许的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-247">If it is, it checks the allowed effects of the drop target.</span></span> <span data-ttu-id="3efad-248">然后向最终用户提供有关允许的放置效果的反馈。</span><span class="sxs-lookup"><span data-stu-id="3efad-248">It then gives feedback to the end user regarding the allowed drop effects.</span></span> <span data-ttu-id="3efad-249">通常通过将鼠标光标更改为非放置、复制或移动光标实现此操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-249">This is typically done by changing the mouse cursor to a no-drop, copy, or move cursor.</span></span> <span data-ttu-id="3efad-250">仅在需要使用自定义光标向用户提供反馈时处理此事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-250">You should only handle this event if you need to use custom cursors to provide feedback to the user.</span></span> <span data-ttu-id="3efad-251">在处理此事件时，请务必将其标记为“已处理”，以便默认处理程序不会替代你的处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-251">If you handle this event, be sure to mark it as handled so that the default handler does not override your handler.</span></span>  
  
 <span data-ttu-id="3efad-252">对拖动源进行拖动时，持续引发 <xref:System.Windows.DragDrop.QueryContinueDrag> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-252">The <xref:System.Windows.DragDrop.QueryContinueDrag> event is raised continuously while the drag source is being dragged.</span></span> <span data-ttu-id="3efad-253">你可以根据 ESC、SHIFT、CTRL 和 ALT 键以及鼠标按钮的状态处理此事件，以确定结束拖放操作的操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-253">You can handle this event to determine what action ends the drag-and-drop operation based on the state of the ESC, SHIFT, CTRL, and ALT keys, as well as the state of the mouse buttons.</span></span> <span data-ttu-id="3efad-254">此事件的默认处理程序在按下 ESC 键后取消拖放操作，并且在释放鼠标按钮后放置数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-254">The default handler for this event cancels the drag-and-drop operation if the ESC key is pressed, and drops the data if the mouse button is released.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="3efad-255">在拖放操作过程中，将持续引发这些事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-255">These events are raised continuously during the drag-and-drop operation.</span></span> <span data-ttu-id="3efad-256">因此，应避免事件处理程序中的资源密集型任务。</span><span class="sxs-lookup"><span data-stu-id="3efad-256">Therefore, you should avoid resource-intensive tasks in the event handlers.</span></span>  <span data-ttu-id="3efad-257">例如，每次引发 <xref:System.Windows.DragDrop.GiveFeedback> 事件时，请使用缓存的光标，而不是创建新光标。</span><span class="sxs-lookup"><span data-stu-id="3efad-257">For example, use a cached cursor instead of creating a new cursor each time the <xref:System.Windows.DragDrop.GiveFeedback> event is raised.</span></span>  
  
### <a name="enabling-an-element-to-be-a-drop-target"></a><span data-ttu-id="3efad-258">使元素作为拖放目标</span><span class="sxs-lookup"><span data-stu-id="3efad-258">Enabling an Element to be a Drop Target</span></span>  
 <span data-ttu-id="3efad-259">作为拖放目标的对象用于：</span><span class="sxs-lookup"><span data-stu-id="3efad-259">An object that is a drop target is responsible for:</span></span>  
  
- <span data-ttu-id="3efad-260">指定其是有效的拖放目标。</span><span class="sxs-lookup"><span data-stu-id="3efad-260">Specifying that it is a valid drop target.</span></span>  
  
- <span data-ttu-id="3efad-261">当它拖动到目标之上时，向拖动源作出响应。</span><span class="sxs-lookup"><span data-stu-id="3efad-261">Responding to the drag source when it drags over the target.</span></span>  
  
- <span data-ttu-id="3efad-262">检查传输的数据是否是它可以接收的格式。</span><span class="sxs-lookup"><span data-stu-id="3efad-262">Checking that the transferred data is in a format that it can receive.</span></span>  
  
- <span data-ttu-id="3efad-263">处理已放置的数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-263">Processing the dropped data.</span></span>  
  
 <span data-ttu-id="3efad-264">若要指定一个元素是拖放目标，请将其 <xref:System.Windows.UIElement.AllowDrop%2A> 属性设置为 `true`。</span><span class="sxs-lookup"><span data-stu-id="3efad-264">To specify that an element is a drop target, you set its <xref:System.Windows.UIElement.AllowDrop%2A> property to `true`.</span></span> <span data-ttu-id="3efad-265">然后，元素中将引发拖放目标事件，以便处理这些事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-265">The drop target events will then be raised on the element so that you can handle them.</span></span> <span data-ttu-id="3efad-266">在拖放操作期间，拖放目标上将依次发生以下事件：</span><span class="sxs-lookup"><span data-stu-id="3efad-266">During a drag-and-drop operation, the following sequence of events occurs on the drop target:</span></span>  
  
1. <xref:System.Windows.DragDrop.DragEnter>  
  
2. <xref:System.Windows.DragDrop.DragOver>  
  
3. <span data-ttu-id="3efad-267"><xref:System.Windows.DragDrop.DragLeave> 或 <xref:System.Windows.DragDrop.Drop></span><span class="sxs-lookup"><span data-stu-id="3efad-267"><xref:System.Windows.DragDrop.DragLeave> or <xref:System.Windows.DragDrop.Drop></span></span>  
  
 <span data-ttu-id="3efad-268">将数据拖到拖放目标的边界中时发生 <xref:System.Windows.DragDrop.DragEnter> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-268">The <xref:System.Windows.DragDrop.DragEnter> event occurs when the data is dragged into the drop target's boundary.</span></span> <span data-ttu-id="3efad-269">通常，如果适用于你的应用程序，可处理此事件，以便提供拖放操作效果预览。</span><span class="sxs-lookup"><span data-stu-id="3efad-269">You typically handle this event to provide a preview of the effects of the drag-and-drop operation, if appropriate for your application.</span></span> <span data-ttu-id="3efad-270">请勿设置 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 事件中的 <xref:System.Windows.DragDrop.DragEnter> 属性，因为在 <xref:System.Windows.DragDrop.DragOver> 事件中该属性将被覆盖。</span><span class="sxs-lookup"><span data-stu-id="3efad-270">Do not set the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property in the <xref:System.Windows.DragDrop.DragEnter> event, as it will be overwritten in the <xref:System.Windows.DragDrop.DragOver> event.</span></span>  
  
 <span data-ttu-id="3efad-271">下面的示例演示 <xref:System.Windows.DragDrop.DragEnter> 元素的 <xref:System.Windows.Shapes.Ellipse> 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-271">The following example shows the <xref:System.Windows.DragDrop.DragEnter> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="3efad-272">此代码通过保存当前的 <xref:System.Windows.Shapes.Shape.Fill%2A> 画笔预览拖放操作的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-272">This code previews the effects of the drag-and-drop operation by saving the current <xref:System.Windows.Shapes.Shape.Fill%2A> brush.</span></span> <span data-ttu-id="3efad-273">然后，它使用 <xref:System.Windows.DataObject.GetDataPresent%2A> 方法来检查是否已将 <xref:System.Windows.DataObject> 拖动到包含可以转换为 <xref:System.Windows.Media.Brush> 的字符串数据的椭圆上方。</span><span class="sxs-lookup"><span data-stu-id="3efad-273">It then uses the <xref:System.Windows.DataObject.GetDataPresent%2A> method to check whether the <xref:System.Windows.DataObject> being dragged over the ellipse contains string data that can be converted to a <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="3efad-274">如果是，则使用 <xref:System.Windows.DataObject.GetData%2A> 方法提取数据。</span><span class="sxs-lookup"><span data-stu-id="3efad-274">If so, the data is extracted using the <xref:System.Windows.DataObject.GetData%2A> method.</span></span> <span data-ttu-id="3efad-275">然后将其转换为 <xref:System.Windows.Media.Brush> 并应用于椭圆。</span><span class="sxs-lookup"><span data-stu-id="3efad-275">It is then converted to a <xref:System.Windows.Media.Brush> and applied to the ellipse.</span></span> <span data-ttu-id="3efad-276">在 <xref:System.Windows.DragDrop.DragLeave> 事件处理程序中还原更改。</span><span class="sxs-lookup"><span data-stu-id="3efad-276">The change is reverted in the <xref:System.Windows.DragDrop.DragLeave> event handler.</span></span> <span data-ttu-id="3efad-277">如果数据无法转换为 <xref:System.Windows.Media.Brush>，则不执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-277">If the data cannot be converted to a <xref:System.Windows.Media.Brush>, no action is performed.</span></span>  
  
 [!code-csharp[DragDropSnippets#DragEnter](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dragenter)]
 [!code-vb[DragDropSnippets#DragEnter](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dragenter)]  
  
 <span data-ttu-id="3efad-278">将数据拖动到拖放目标上方时持续发生 <xref:System.Windows.DragDrop.DragOver> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-278">The <xref:System.Windows.DragDrop.DragOver> event occurs continuously while the data is dragged over the drop target.</span></span> <span data-ttu-id="3efad-279">此事件和拖动源上的 <xref:System.Windows.DragDrop.GiveFeedback> 事件成对出现。</span><span class="sxs-lookup"><span data-stu-id="3efad-279">This event is paired with the <xref:System.Windows.DragDrop.GiveFeedback> event on the drag source.</span></span> <span data-ttu-id="3efad-280">在 <xref:System.Windows.DragDrop.DragOver> 事件处理程序中，通常使用 <xref:System.Windows.DataObject.GetDataPresent%2A> 和 <xref:System.Windows.DataObject.GetData%2A> 方法来检查传输的数据是否是拖放目标可以处理的格式。</span><span class="sxs-lookup"><span data-stu-id="3efad-280">In the <xref:System.Windows.DragDrop.DragOver> event handler, you typically use the <xref:System.Windows.DataObject.GetDataPresent%2A> and <xref:System.Windows.DataObject.GetData%2A> methods to check whether the transferred data is in a format that the drop target can process.</span></span> <span data-ttu-id="3efad-281">还可以检查是否已按下修改键，这通常指示用户想进行移动操作还是复制操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-281">You can also check whether any modifier keys are pressed, which will typically indicate whether the user intends a move or copy action.</span></span> <span data-ttu-id="3efad-282">执行这些检查后，设置 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 属性以通知拖动源放置数据将产生的效果。</span><span class="sxs-lookup"><span data-stu-id="3efad-282">After these checks are performed, you set the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property to notify the drag source what effect dropping the data will have.</span></span> <span data-ttu-id="3efad-283">拖动源收到 <xref:System.Windows.DragDrop.GiveFeedback> 事件参数中的此信息，并且可以设置相应的光标以向用户提供反馈。</span><span class="sxs-lookup"><span data-stu-id="3efad-283">The drag source receives this information in the <xref:System.Windows.DragDrop.GiveFeedback> event args, and can set an appropriate cursor to give feedback to the user.</span></span>  
  
 <span data-ttu-id="3efad-284">下面的示例演示 <xref:System.Windows.DragDrop.DragOver> 元素的 <xref:System.Windows.Shapes.Ellipse> 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-284">The following example shows the <xref:System.Windows.DragDrop.DragOver> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="3efad-285">此代码检查是否已将 <xref:System.Windows.DataObject> 拖动到包含可以转换为 <xref:System.Windows.Media.Brush> 的字符串数据的椭圆上方。</span><span class="sxs-lookup"><span data-stu-id="3efad-285">This code checks to see if the <xref:System.Windows.DataObject> being dragged over the ellipse contains string data that can be converted to a <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="3efad-286">如果是，它会将 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 属性设置为 <xref:System.Windows.DragDropEffects.Copy>。</span><span class="sxs-lookup"><span data-stu-id="3efad-286">If so, it sets the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property to <xref:System.Windows.DragDropEffects.Copy>.</span></span> <span data-ttu-id="3efad-287">这将向拖动源指示可以将数据复制到椭圆。</span><span class="sxs-lookup"><span data-stu-id="3efad-287">This indicates to the drag source that the data can be copied to the ellipse.</span></span> <span data-ttu-id="3efad-288">如果数据无法转换为 <xref:System.Windows.Media.Brush>，则将 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 属性设置为 <xref:System.Windows.DragDropEffects.None>。</span><span class="sxs-lookup"><span data-stu-id="3efad-288">If the data cannot be converted to a <xref:System.Windows.Media.Brush>, the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property is set to <xref:System.Windows.DragDropEffects.None>.</span></span> <span data-ttu-id="3efad-289">这将向拖动源指示椭圆不是数据的有效拖放目标。</span><span class="sxs-lookup"><span data-stu-id="3efad-289">This indicates to the drag source that the ellipse is not a valid drop target for the data.</span></span>  
  
 [!code-csharp[DragDropSnippets#DragOver](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dragover)]
 [!code-vb[DragDropSnippets#DragOver](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dragover)]  
  
 <span data-ttu-id="3efad-290">将数据拖出目标边界而未放置时，发生 <xref:System.Windows.DragDrop.DragLeave> 事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-290">The <xref:System.Windows.DragDrop.DragLeave> event occurs when the data is dragged out of the target's boundary without being dropped.</span></span> <span data-ttu-id="3efad-291">可以处理此事件，以便撤销在 <xref:System.Windows.DragDrop.DragEnter> 事件处理程序中进行的一切操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-291">You handle this event to undo anything that you did in the <xref:System.Windows.DragDrop.DragEnter> event handler.</span></span>  
  
 <span data-ttu-id="3efad-292">下面的示例演示 <xref:System.Windows.DragDrop.DragLeave> 元素的 <xref:System.Windows.Shapes.Ellipse> 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-292">The following example shows the <xref:System.Windows.DragDrop.DragLeave> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="3efad-293">此代码通过将保存的 <xref:System.Windows.Media.Brush> 应用到椭圆来撤销 <xref:System.Windows.DragDrop.DragEnter> 事件处理程序中执行的预览。</span><span class="sxs-lookup"><span data-stu-id="3efad-293">This code undoes the preview performed in the <xref:System.Windows.DragDrop.DragEnter> event handler by applying the saved <xref:System.Windows.Media.Brush> to the ellipse.</span></span>  
  
 [!code-csharp[DragDropSnippets#DragLeave](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dragleave)]
 [!code-vb[DragDropSnippets#DragLeave](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dragleave)]  
  
 <span data-ttu-id="3efad-294">数据放置在拖放目标上方时，发生 <xref:System.Windows.DragDrop.Drop> 事件；默认情况下，释放鼠标按钮时，发生此事件。</span><span class="sxs-lookup"><span data-stu-id="3efad-294">The <xref:System.Windows.DragDrop.Drop> event occurs when the data is dropped over the drop target; by default, this happens when the mouse button is released.</span></span> <span data-ttu-id="3efad-295">在 <xref:System.Windows.DragDrop.Drop> 事件处理程序中，使用 <xref:System.Windows.DataObject.GetData%2A> 方法提取 <xref:System.Windows.DataObject> 中的传输的数据并执行应用程序所需的任何数据处理。</span><span class="sxs-lookup"><span data-stu-id="3efad-295">In the <xref:System.Windows.DragDrop.Drop> event handler, you use the <xref:System.Windows.DataObject.GetData%2A> method to extract the transferred data from the <xref:System.Windows.DataObject> and perform any data processing that your application requires.</span></span> <span data-ttu-id="3efad-296"><xref:System.Windows.DragDrop.Drop> 事件结束拖放操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-296">The <xref:System.Windows.DragDrop.Drop> event ends the drag-and-drop operation.</span></span>  
  
 <span data-ttu-id="3efad-297">下面的示例演示 <xref:System.Windows.DragDrop.Drop> 元素的 <xref:System.Windows.Shapes.Ellipse> 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="3efad-297">The following example shows the <xref:System.Windows.DragDrop.Drop> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="3efad-298">此代码应用拖放操作的效果，并且它类似于 <xref:System.Windows.DragDrop.DragEnter> 事件处理程序中的代码。</span><span class="sxs-lookup"><span data-stu-id="3efad-298">This code applies the effects of the drag-and-drop operation, and is similar to the code in the <xref:System.Windows.DragDrop.DragEnter> event handler.</span></span> <span data-ttu-id="3efad-299">它会检查是否将 <xref:System.Windows.DataObject> 拖动到包含可以转换为 <xref:System.Windows.Media.Brush> 的字符串数据的椭圆上方。</span><span class="sxs-lookup"><span data-stu-id="3efad-299">It checks to see if the <xref:System.Windows.DataObject> being dragged over the ellipse contains string data that can be converted to a <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="3efad-300">如果是，将 <xref:System.Windows.Media.Brush> 应用于椭圆。</span><span class="sxs-lookup"><span data-stu-id="3efad-300">If so, the <xref:System.Windows.Media.Brush> is applied to the ellipse.</span></span> <span data-ttu-id="3efad-301">如果数据无法转换为 <xref:System.Windows.Media.Brush>，则不执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="3efad-301">If the data cannot be converted to a <xref:System.Windows.Media.Brush>, no action is performed.</span></span>  
  
 [!code-csharp[DragDropSnippets#Drop](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#drop)]
 [!code-vb[DragDropSnippets#Drop](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#drop)]  
  
## <a name="see-also"></a><span data-ttu-id="3efad-302">请参阅</span><span class="sxs-lookup"><span data-stu-id="3efad-302">See also</span></span>

- <xref:System.Windows.Clipboard>
- [<span data-ttu-id="3efad-303">演练：对用户控件启用拖放</span><span class="sxs-lookup"><span data-stu-id="3efad-303">Walkthrough: Enabling Drag and Drop on a User Control</span></span>](walkthrough-enabling-drag-and-drop-on-a-user-control.md)
- [<span data-ttu-id="3efad-304">帮助主题</span><span class="sxs-lookup"><span data-stu-id="3efad-304">How-to Topics</span></span>](drag-and-drop-how-to-topics.md)
- [<span data-ttu-id="3efad-305">拖放</span><span class="sxs-lookup"><span data-stu-id="3efad-305">Drag and Drop</span></span>](drag-and-drop.md)
