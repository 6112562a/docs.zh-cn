---
title: 合并资源字典
ms.date: 03/30/2017
helpviewer_keywords:
- merged resource dictionaries [WPF]
- dictionaries [WPF], merged resources
ms.assetid: d159531f-05d4-49fd-b951-c332de51e5bc
ms.openlocfilehash: ae6c8dc3669ed46165f3d78e78735187ebbc3776
ms.sourcegitcommit: 0c48191d6d641ce88d7510e319cf38c0e35697d0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/05/2019
ms.locfileid: "57377012"
---
# <a name="merged-resource-dictionaries"></a><span data-ttu-id="286ca-102">合并资源字典</span><span class="sxs-lookup"><span data-stu-id="286ca-102">Merged Resource Dictionaries</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="286ca-103">资源支持合并资源字典功能。</span><span class="sxs-lookup"><span data-stu-id="286ca-103">resources support a merged resource dictionary feature.</span></span> <span data-ttu-id="286ca-104">此功能提供一种方法，可在编译的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 应用程序外部定义 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 应用程序的资源部分。</span><span class="sxs-lookup"><span data-stu-id="286ca-104">This feature provides a way to define the resources portion of a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application outside of the compiled [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] application.</span></span> <span data-ttu-id="286ca-105">然后可以在应用程序之间共享资源，还可更方便地将资源隔离以进行本地化。</span><span class="sxs-lookup"><span data-stu-id="286ca-105">Resources can then be shared across applications and are also more conveniently isolated for localization.</span></span>  
  
## <a name="introducing-a-merged-resource-dictionary"></a><span data-ttu-id="286ca-106">引入合并资源字典</span><span class="sxs-lookup"><span data-stu-id="286ca-106">Introducing a Merged Resource Dictionary</span></span>  
 <span data-ttu-id="286ca-107">在标记中，使用以下语法将合并资源字典引入页面：</span><span class="sxs-lookup"><span data-stu-id="286ca-107">In markup, you use the following syntax to introduce a merged resource dictionary into a page:</span></span>  
  
 [!code-xaml[ResourceMergeDictionary#MergedXAML](~/samples/snippets/csharp/VS_Snippets_Wpf/ResourceMergeDictionary/CS/default.xaml#mergedxaml)]  
  
 <span data-ttu-id="286ca-108">请注意，<xref:System.Windows.ResourceDictionary>元素不具有[X:key 指令](../../xaml-services/x-key-directive.md)，通常需要的资源集合中的所有项。</span><span class="sxs-lookup"><span data-stu-id="286ca-108">Note that the <xref:System.Windows.ResourceDictionary> element does not have an [x:Key Directive](../../xaml-services/x-key-directive.md), which is generally required for all items in a resource collection.</span></span> <span data-ttu-id="286ca-109">但另一个<xref:System.Windows.ResourceDictionary>中引用<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>集合是一种特殊情况，保留此合并的资源字典方案。</span><span class="sxs-lookup"><span data-stu-id="286ca-109">But another <xref:System.Windows.ResourceDictionary> reference within the <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A> collection is a special case, reserved for this merged resource dictionary scenario.</span></span> <span data-ttu-id="286ca-110"><xref:System.Windows.ResourceDictionary>引入了合并资源字典不能有[X:key 指令](../../xaml-services/x-key-directive.md)。</span><span class="sxs-lookup"><span data-stu-id="286ca-110">The <xref:System.Windows.ResourceDictionary> that introduces a merged resource dictionary cannot have an [x:Key Directive](../../xaml-services/x-key-directive.md).</span></span> <span data-ttu-id="286ca-111">通常情况下，每个<xref:System.Windows.ResourceDictionary>内<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>集合指定<xref:System.Windows.ResourceDictionary.Source%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="286ca-111">Typically, each <xref:System.Windows.ResourceDictionary> within the <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A> collection specifies a <xref:System.Windows.ResourceDictionary.Source%2A> attribute.</span></span> <span data-ttu-id="286ca-112">值<xref:System.Windows.ResourceDictionary.Source%2A>应为[!INCLUDE[TLA#tla_uri](../../../../includes/tlasharptla-uri-md.md)]解析到要合并的资源文件的位置。</span><span class="sxs-lookup"><span data-stu-id="286ca-112">The value of <xref:System.Windows.ResourceDictionary.Source%2A> should be a [!INCLUDE[TLA#tla_uri](../../../../includes/tlasharptla-uri-md.md)] that resolves to the location of the resources file to be merged.</span></span> <span data-ttu-id="286ca-113">目标[!INCLUDE[TLA2#tla_uri](../../../../includes/tla2sharptla-uri-md.md)]必须是另一个[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]文件中，使用<xref:System.Windows.ResourceDictionary>作为其根元素。</span><span class="sxs-lookup"><span data-stu-id="286ca-113">The destination of that [!INCLUDE[TLA2#tla_uri](../../../../includes/tla2sharptla-uri-md.md)] must be another [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file, with <xref:System.Windows.ResourceDictionary> as its root element.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="286ca-114">它是合法定义中的资源<xref:System.Windows.ResourceDictionary>作为指定的替代方法指定为合并字典<xref:System.Windows.ResourceDictionary.Source%2A>，或除了任何资源都包含从指定的源。</span><span class="sxs-lookup"><span data-stu-id="286ca-114">It is legal to define resources within a <xref:System.Windows.ResourceDictionary> that is specified as a merged dictionary, either as an alternative to specifying <xref:System.Windows.ResourceDictionary.Source%2A>, or in addition to whatever resources are included from the specified source.</span></span> <span data-ttu-id="286ca-115">但是，这不是一种常见方案；合并字典的主要方案是从外部文件位置合并资源。</span><span class="sxs-lookup"><span data-stu-id="286ca-115">However, this is not a common scenario; the main scenario for merged dictionaries is to merge resources from external file locations.</span></span> <span data-ttu-id="286ca-116">如果你想要指定页的标记中的资源，则应通常定义这些主<xref:System.Windows.ResourceDictionary>而不是在合并的字典。</span><span class="sxs-lookup"><span data-stu-id="286ca-116">If you want to specify resources within the markup for a page, you should typically define these in the main <xref:System.Windows.ResourceDictionary> and not in the merged dictionaries.</span></span>  
  
## <a name="merged-dictionary-behavior"></a><span data-ttu-id="286ca-117">合并字典的行为</span><span class="sxs-lookup"><span data-stu-id="286ca-117">Merged Dictionary Behavior</span></span>  
 <span data-ttu-id="286ca-118">合并字典中的资源占用资源查找范围中的一个位置，此范围恰好在它们合并到的主要资源字典中的范围之后。</span><span class="sxs-lookup"><span data-stu-id="286ca-118">Resources in a merged dictionary occupy a location in the resource lookup scope that is just after the scope of the main resource dictionary they are merged into.</span></span> <span data-ttu-id="286ca-119">尽管任何字典中的资源键必须唯一，但一个资源键可在一组合并字典中多次存在。</span><span class="sxs-lookup"><span data-stu-id="286ca-119">Although a resource key must be unique within any individual dictionary, a key can exist multiple times in a set of merged dictionaries.</span></span> <span data-ttu-id="286ca-120">在这种情况下，返回的资源将来自按顺序在找到的最后一个字典<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>集合。</span><span class="sxs-lookup"><span data-stu-id="286ca-120">In this case, the resource that is returned will come from the last dictionary found sequentially in the <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A> collection.</span></span> <span data-ttu-id="286ca-121">如果<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>集合中定义[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]，则合并的字典集合中的顺序是提供在标记中元素的顺序。</span><span class="sxs-lookup"><span data-stu-id="286ca-121">If the <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A> collection was defined in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], then the order of the merged dictionaries in the collection is the order of the elements as provided in the markup.</span></span> <span data-ttu-id="286ca-122">如果在主要字典和合并的字典中均定义了同一个键，则返回的资源将来自主要字典。</span><span class="sxs-lookup"><span data-stu-id="286ca-122">If a key is defined in the primary dictionary and also in a dictionary that was merged, then the resource that is returned will come from the primary dictionary.</span></span> <span data-ttu-id="286ca-123">这些范围规则同等地适用于静态资源引用和动态资源引用。</span><span class="sxs-lookup"><span data-stu-id="286ca-123">These scoping rules apply equally for both static resource references and dynamic resource references.</span></span>  
  
### <a name="merged-dictionaries-and-code"></a><span data-ttu-id="286ca-124">合并字典和代码</span><span class="sxs-lookup"><span data-stu-id="286ca-124">Merged Dictionaries and Code</span></span>  
 <span data-ttu-id="286ca-125">可通过代码将合并字典添加到 `Resources` 字典。</span><span class="sxs-lookup"><span data-stu-id="286ca-125">Merged dictionaries can be added to a `Resources` dictionary through code.</span></span> <span data-ttu-id="286ca-126">默认情况下，最初为空<xref:System.Windows.ResourceDictionary>存在于任何`Resources`属性都具有默认值，最初为空<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>集合属性。</span><span class="sxs-lookup"><span data-stu-id="286ca-126">The default, initially empty <xref:System.Windows.ResourceDictionary> that exists for any `Resources` property also has a default, initially empty <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A> collection property.</span></span> <span data-ttu-id="286ca-127">若要添加的代码通过合并的字典，则获取到所需的主副本的引用<xref:System.Windows.ResourceDictionary>，获取其<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>属性值，然后调用`Add`泛型`Collection`中包含的<xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>。</span><span class="sxs-lookup"><span data-stu-id="286ca-127">To add a merged dictionary through code, you obtain a reference to the desired primary <xref:System.Windows.ResourceDictionary>, get its <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A> property value, and call `Add` on the generic `Collection` that is contained in <xref:System.Windows.ResourceDictionary.MergedDictionaries%2A>.</span></span> <span data-ttu-id="286ca-128">添加的对象必须是一个新<xref:System.Windows.ResourceDictionary>。</span><span class="sxs-lookup"><span data-stu-id="286ca-128">The object you add must be a new <xref:System.Windows.ResourceDictionary>.</span></span> <span data-ttu-id="286ca-129">在代码中，未设置<xref:System.Windows.ResourceDictionary.Source%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="286ca-129">In code, you do not set the <xref:System.Windows.ResourceDictionary.Source%2A> property.</span></span> <span data-ttu-id="286ca-130">相反，你必须获取<xref:System.Windows.ResourceDictionary>通过创建或加载其中一个对象。</span><span class="sxs-lookup"><span data-stu-id="286ca-130">Instead, you must obtain a <xref:System.Windows.ResourceDictionary> object by either creating one or loading one.</span></span> <span data-ttu-id="286ca-131">加载现有的一种方法<xref:System.Windows.ResourceDictionary>来调用<xref:System.Windows.Markup.XamlReader.Load%2A?displayProperty=nameWithType>上的现有[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]具有文件流<xref:System.Windows.ResourceDictionary>根，然后强制转换<xref:System.Windows.Markup.XamlReader.Load%2A?displayProperty=nameWithType>返回值为<xref:System.Windows.ResourceDictionary>。</span><span class="sxs-lookup"><span data-stu-id="286ca-131">One way to load an existing <xref:System.Windows.ResourceDictionary> to call <xref:System.Windows.Markup.XamlReader.Load%2A?displayProperty=nameWithType> on an existing [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file stream that has a <xref:System.Windows.ResourceDictionary> root, then casting the <xref:System.Windows.Markup.XamlReader.Load%2A?displayProperty=nameWithType> return value to <xref:System.Windows.ResourceDictionary>.</span></span>  
  
### <a name="merged-resource-dictionary-uris"></a><span data-ttu-id="286ca-132">合并资源字典 URI</span><span class="sxs-lookup"><span data-stu-id="286ca-132">Merged Resource Dictionary URIs</span></span>  
 <span data-ttu-id="286ca-133">可通过几种技术来包括合并资源字典，具体由将使用的 [!INCLUDE[TLA#tla_uri](../../../../includes/tlasharptla-uri-md.md)] 格式指示。</span><span class="sxs-lookup"><span data-stu-id="286ca-133">There are several techniques for how to include a merged resource dictionary, which are indicated by the [!INCLUDE[TLA#tla_uri](../../../../includes/tlasharptla-uri-md.md)] format that you will use.</span></span> <span data-ttu-id="286ca-134">这些技术可概括地分为两类：作为项目的一部分编译的资源，和不作为项目的一部分编译的资源。</span><span class="sxs-lookup"><span data-stu-id="286ca-134">Broadly speaking, these techniques can be divided into two categories: resources that are compiled as part of the project, and resources that are not compiled as part of the project.</span></span>  
  
 <span data-ttu-id="286ca-135">对于作为项目的一部分编译的资源，可使用引用资源位置的相对路径。</span><span class="sxs-lookup"><span data-stu-id="286ca-135">For resources that are compiled as part of the project, you can use a relative path that refers to the resource location.</span></span> <span data-ttu-id="286ca-136">相对路径会在编辑期间计算。</span><span class="sxs-lookup"><span data-stu-id="286ca-136">The relative path is evaluated during compilation.</span></span> <span data-ttu-id="286ca-137">必须将资源作为“资源”生成操作定义为项目的一部分。</span><span class="sxs-lookup"><span data-stu-id="286ca-137">Your resource must be defined as part of the project as a Resource build action.</span></span> <span data-ttu-id="286ca-138">如果将资源 .xaml 文件作为“资源”包括在项目中，则无需将资源文件复制到输出目录，因为资源已包括在编译的应用程序中。</span><span class="sxs-lookup"><span data-stu-id="286ca-138">If you include a resource .xaml file in the project as Resource, you do not need to copy the resource file to the output directory, the resource is already included within the compiled application.</span></span> <span data-ttu-id="286ca-139">也可以使用“内容”生成操作，但必须将文件复制到输出目录，还需将相同路径关系中的资源文件部署到可执行文件。</span><span class="sxs-lookup"><span data-stu-id="286ca-139">You can also use Content build action, but you must then copy the files to the output directory and also deploy the resource files in the same path relationship to the executable.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="286ca-140">不要使用“嵌入资源”生成操作。</span><span class="sxs-lookup"><span data-stu-id="286ca-140">Do not use the Embedded Resource build action.</span></span> <span data-ttu-id="286ca-141">支持生成操作本身[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]应用程序，但的分辨率<xref:System.Windows.ResourceDictionary.Source%2A>不会合并<xref:System.Resources.ResourceManager>，并因此不能将单个资源分离流外。</span><span class="sxs-lookup"><span data-stu-id="286ca-141">The build action itself is supported for [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications, but the resolution of <xref:System.Windows.ResourceDictionary.Source%2A> does not incorporate <xref:System.Resources.ResourceManager>, and thus cannot separate the individual resource out of the stream.</span></span> <span data-ttu-id="286ca-142">您仍可以使用嵌入的资源，出于其他目的，只要还使用<xref:System.Resources.ResourceManager>才能访问资源。</span><span class="sxs-lookup"><span data-stu-id="286ca-142">You could still use Embedded Resource for other purposes so long as you also used <xref:System.Resources.ResourceManager> to access the resources.</span></span>  
  
 <span data-ttu-id="286ca-143">还有一种相关技术是使用指向 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 文件的 Pack URI，并将其作为“源”进行引用。</span><span class="sxs-lookup"><span data-stu-id="286ca-143">A related technique is to use a Pack URI to a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file, and refer to it as Source.</span></span> <span data-ttu-id="286ca-144">Pack URI 可启用对引用程序集的组件和其他技术的引用。</span><span class="sxs-lookup"><span data-stu-id="286ca-144">Pack URI enables references to components of referenced assemblies and other techniques.</span></span> <span data-ttu-id="286ca-145">有关 Pack URI 的详细信息，请参阅 [WPF 应用程序资源、内容和数据文件](../app-development/wpf-application-resource-content-and-data-files.md)。</span><span class="sxs-lookup"><span data-stu-id="286ca-145">For more information on Pack URIs, see [WPF Application Resource, Content, and Data Files](../app-development/wpf-application-resource-content-and-data-files.md).</span></span>  
  
 <span data-ttu-id="286ca-146">对于不作为项目的一部分编译的资源，URI 将在运行时计算。</span><span class="sxs-lookup"><span data-stu-id="286ca-146">For resources that are not compiled as part of the project, the URI is evaluated at run time.</span></span> <span data-ttu-id="286ca-147">可使用常见的 URI 传输（如 file: 或 http:）引用资源文件。</span><span class="sxs-lookup"><span data-stu-id="286ca-147">You can use a common URI transport such as file: or http: to refer to the resource file.</span></span> <span data-ttu-id="286ca-148">使用非编译资源方法的缺点是：file: 访问需要额外部署步骤，并且 http: 访问意味着需访问 Internet 安全区域。</span><span class="sxs-lookup"><span data-stu-id="286ca-148">The disadvantage of using the noncompiled resource approach is that file: access requires additional deployment steps, and http: access implies the Internet security zone.</span></span>  
  
### <a name="reusing-merged-dictionaries"></a><span data-ttu-id="286ca-149">重用合并字典</span><span class="sxs-lookup"><span data-stu-id="286ca-149">Reusing Merged Dictionaries</span></span>  
 <span data-ttu-id="286ca-150">可以重复使用或在应用程序之间共享合并资源字典，因为可以通过任何有效的 [!INCLUDE[TLA#tla_uri](../../../../includes/tlasharptla-uri-md.md)] 引用要合并的资源字典。</span><span class="sxs-lookup"><span data-stu-id="286ca-150">You can reuse or share merged resource dictionaries between applications, because the resource dictionary to merge can be referenced through any valid [!INCLUDE[TLA#tla_uri](../../../../includes/tlasharptla-uri-md.md)].</span></span> <span data-ttu-id="286ca-151">执行此操作的确切方式取决于应用程序部署策略和所遵循的应用程序模型。</span><span class="sxs-lookup"><span data-stu-id="286ca-151">Exactly how you do this will depend on your application deployment strategy and which application model you follow.</span></span> <span data-ttu-id="286ca-152">前面提及的 Pack URI 策略提供了一种方法，通常可通过共享程序集引用在开发期间跨多个项目将合并资源作为源使用。</span><span class="sxs-lookup"><span data-stu-id="286ca-152">The aforementioned Pack URI strategy provides a way to commonly source a merged resource across multiple projects during development by sharing an assembly reference.</span></span> <span data-ttu-id="286ca-153">在此方案中，资源仍由客户端分发，并且至少有一个应用程序必须部署引用的程序集。</span><span class="sxs-lookup"><span data-stu-id="286ca-153">In this scenario the resources are still distributed by the client, and at least one of the applications must deploy the referenced assembly.</span></span> <span data-ttu-id="286ca-154">还有可能通过使用 http 协议的分布式 URI 引用合并资源。</span><span class="sxs-lookup"><span data-stu-id="286ca-154">It is also possible to reference merged resources through a distributed URI that uses the http protocol.</span></span>  
  
 <span data-ttu-id="286ca-155">另一种合并字典/应用程序部署的可能方案是将合并字典编写为本地应用程序文件或编写到共享存储。</span><span class="sxs-lookup"><span data-stu-id="286ca-155">Writing merged dictionaries as local application files or to local shared storage is another possible merged dictionary / application deployment scenario.</span></span>  
  
### <a name="localization"></a><span data-ttu-id="286ca-156">本地化</span><span class="sxs-lookup"><span data-stu-id="286ca-156">Localization</span></span>  
 <span data-ttu-id="286ca-157">如果需要本地化的资源保留为松散的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]，并且隔离于将合并为主要字典的字典，则可单独本地化这些文件。</span><span class="sxs-lookup"><span data-stu-id="286ca-157">If resources that need to be localized are isolated to dictionaries that are merged into primary dictionaries, and kept as loose [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], these files can be localized separately.</span></span> <span data-ttu-id="286ca-158">这是本地化附属资源程序集的轻量级替代方法。</span><span class="sxs-lookup"><span data-stu-id="286ca-158">This technique is a lightweight alternative to localizing  the satellite resource assemblies.</span></span> <span data-ttu-id="286ca-159">有关详细信息，请参阅 [WPF 全球化和本地化概述](wpf-globalization-and-localization-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="286ca-159">For details, see [WPF Globalization and Localization Overview](wpf-globalization-and-localization-overview.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="286ca-160">请参阅</span><span class="sxs-lookup"><span data-stu-id="286ca-160">See also</span></span>
- <xref:System.Windows.ResourceDictionary>
- [<span data-ttu-id="286ca-161">XAML 资源</span><span class="sxs-lookup"><span data-stu-id="286ca-161">XAML Resources</span></span>](xaml-resources.md)
- [<span data-ttu-id="286ca-162">资源和代码</span><span class="sxs-lookup"><span data-stu-id="286ca-162">Resources and Code</span></span>](resources-and-code.md)
- [<span data-ttu-id="286ca-163">WPF 应用程序资源、内容和数据文件</span><span class="sxs-lookup"><span data-stu-id="286ca-163">WPF Application Resource, Content, and Data Files</span></span>](../app-development/wpf-application-resource-content-and-data-files.md)
