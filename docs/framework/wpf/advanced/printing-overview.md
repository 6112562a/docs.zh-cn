---
title: 打印概述
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- print path [WPF], XPS
- printers [WPF], XPSDrv-based
- printing [WPF]
- PrintQueue class PrintServer class [WPF]
- XML Paper Specification (XPS) file format
- XPS (XML Paper Specification) file format
- XPSDrv-based printers
- GDI print path [WPF]
ms.assetid: 0de8ac41-9aa6-413d-a121-7aa6f41539b1
ms.openlocfilehash: 902d51341850b5245b9fa6410b1954b2ab373bbc
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/12/2020
ms.locfileid: "79187200"
---
# <a name="printing-overview"></a><span data-ttu-id="99516-102">打印概述</span><span class="sxs-lookup"><span data-stu-id="99516-102">Printing Overview</span></span>
<span data-ttu-id="99516-103">使用 Microsoft .NET 框架，使用 Windows 演示基础 （WPF） 的应用程序开发人员具有一套丰富的新打印和打印系统管理 API。</span><span class="sxs-lookup"><span data-stu-id="99516-103">With Microsoft .NET Framework, application developers using Windows Presentation Foundation (WPF) have a rich new set of printing and print system management APIs.</span></span> <span data-ttu-id="99516-104">使用 Windows Vista，这些打印系统增强功能中的一些也可用于创建 Windows 窗体应用程序的开发人员和使用非托管代码的开发人员。</span><span class="sxs-lookup"><span data-stu-id="99516-104">With Windows Vista, some of these print system enhancements are also available to developers creating Windows Forms applications and developers using unmanaged code.</span></span> <span data-ttu-id="99516-105">此新功能的核心是新的 XML 纸张规范 （XPS） 文件格式和 XPS 打印路径。</span><span class="sxs-lookup"><span data-stu-id="99516-105">At the core of this new functionality is the new XML Paper Specification (XPS) file format and the XPS print path.</span></span>  
  
 <span data-ttu-id="99516-106">本主题包含以下各节。</span><span class="sxs-lookup"><span data-stu-id="99516-106">This topic contains the following sections.</span></span>  
  
<a name="introduction_to_XPS"></a>
## <a name="about-xps"></a><span data-ttu-id="99516-107">关于 XPS</span><span class="sxs-lookup"><span data-stu-id="99516-107">About XPS</span></span>  
 <span data-ttu-id="99516-108">XPS 是一种电子文档格式、假脱机文件格式和页面描述语言。</span><span class="sxs-lookup"><span data-stu-id="99516-108">XPS is an electronic document format, a spool file format and a page description language.</span></span> <span data-ttu-id="99516-109">它是一种开放文档格式，使用 XML、开放打包约定 （OPC） 和其他行业标准来创建跨平台文档。</span><span class="sxs-lookup"><span data-stu-id="99516-109">It is an open document format that uses XML, Open Packaging Conventions (OPC), and other industry standards to create cross-platform documents.</span></span> <span data-ttu-id="99516-110">XPS 简化了数字文档的创建、共享、打印、查看和存档过程。</span><span class="sxs-lookup"><span data-stu-id="99516-110">XPS simplifies the process by which digital documents are created, shared, printed, viewed, and archived.</span></span> <span data-ttu-id="99516-111">有关 XPS 的其他信息，请参阅[XPS 文档](/windows/desktop/printdocs/documents)。</span><span class="sxs-lookup"><span data-stu-id="99516-111">For additional information on XPS, see [XPS Documents](/windows/desktop/printdocs/documents).</span></span>  
  
 <span data-ttu-id="99516-112">使用 WPF 打印基于 XPS 的内容的几种技术在[编程打印 XPS 文件中](how-to-programmatically-print-xps-files.md)进行了演示。</span><span class="sxs-lookup"><span data-stu-id="99516-112">Several techniques for printing XPS-based content using WPF are demonstrated in [Programmatically Print XPS Files](how-to-programmatically-print-xps-files.md).</span></span> <span data-ttu-id="99516-113">在查看本主题中的内容时，参考这些示例会很有帮助。</span><span class="sxs-lookup"><span data-stu-id="99516-113">You may find it useful to reference these samples during review of content contained in this topic.</span></span> <span data-ttu-id="99516-114">（非托管代码开发人员应查看[MXDC_ESCAPE函数](/windows/desktop/printdocs/mxdc-escape)的文档。</span><span class="sxs-lookup"><span data-stu-id="99516-114">(Unmanaged code developers should see documentation for the [MXDC_ESCAPE function](/windows/desktop/printdocs/mxdc-escape).</span></span> <span data-ttu-id="99516-115">Windows 窗体开发人员必须在不支持完整<xref:System.Drawing.Printing>XPS 打印路径但支持混合 GDI 到 XPS 打印路径的命名空间中使用 API。</span><span class="sxs-lookup"><span data-stu-id="99516-115">Windows Forms developers must use the API in the <xref:System.Drawing.Printing> namespace which does not support the full XPS print path, but does support a hybrid GDI-to-XPS print path.</span></span> <span data-ttu-id="99516-116">请参阅下面的**打印路径体系结构**。）</span><span class="sxs-lookup"><span data-stu-id="99516-116">See **Print Path Architecture** below.)</span></span>  
  
<a name="XPS_print_path_intro"></a>
## <a name="xps-print-path"></a><span data-ttu-id="99516-117">XPS 打印路径</span><span class="sxs-lookup"><span data-stu-id="99516-117">XPS Print Path</span></span>  
 <span data-ttu-id="99516-118">XML 纸张规范 （XPS） 打印路径是一项新 Windows 功能，可重新定义在 Windows 应用程序中处理打印的方式。</span><span class="sxs-lookup"><span data-stu-id="99516-118">The XML Paper Specification (XPS) print path is a new Windows feature that redefines how printing is handled in Windows applications.</span></span> <span data-ttu-id="99516-119">因为 XPS 可以替换文档演示语言（如 RTF）、打印后台打印器格式（如 WMF）和页面描述语言（如 PCL 或后记）;新的打印路径在打印驱动程序或设备中维护从应用程序发布到最终处理的 XPS 格式。</span><span class="sxs-lookup"><span data-stu-id="99516-119">Because XPS can replace a document presentation language (such as RTF), a print spooler format (such as WMF), and a page description language (such as PCL or Postscript); the new print path maintains the XPS format from application publication to the final processing in the print driver or device.</span></span>  
  
 <span data-ttu-id="99516-120">XPS 打印路径基于 XPS 打印机驱动程序模型 （XPSDrv） 构建，它为开发人员提供了多种好处，例如"您所看到的就是您得到的"（WYSIWYG）打印、改进了颜色支持以及显著提高了打印性能。</span><span class="sxs-lookup"><span data-stu-id="99516-120">The XPS print path is built upon the XPS printer driver model (XPSDrv), which provides several benefits for developers such as "what you see is what you get" (WYSIWYG) printing, improved color support, and significantly improved print performance.</span></span> <span data-ttu-id="99516-121">（有关 XPSDrv 的更多信息，请参阅[Windows 驱动程序工具包文档](/windows-hardware/drivers/)。</span><span class="sxs-lookup"><span data-stu-id="99516-121">(For more on XPSDrv, see the [Windows Driver Kit documentation](/windows-hardware/drivers/).)</span></span>  
  
 <span data-ttu-id="99516-122">XPS 文档的打印后台程序的操作与早期版本的 Windows 基本相同。</span><span class="sxs-lookup"><span data-stu-id="99516-122">The operation of the print spooler for XPS documents is essentially the same as in previous versions of Windows.</span></span> <span data-ttu-id="99516-123">但是，除了现有的 GDI 打印路径之外，它还增强了 XPS 打印路径。</span><span class="sxs-lookup"><span data-stu-id="99516-123">However, it has been enhanced to support the XPS print path in addition to the existing GDI print path.</span></span> <span data-ttu-id="99516-124">新的打印路径本机使用 XPS 假脱机文件。</span><span class="sxs-lookup"><span data-stu-id="99516-124">The new print path natively consumes an XPS spool file.</span></span> <span data-ttu-id="99516-125">虽然为早期版本的 Windows 编写的用户模式打印机驱动程序将继续工作，但 XPS 打印机驱动程序 （XPSDrv） 需要一个才能使用 XPS 打印路径。</span><span class="sxs-lookup"><span data-stu-id="99516-125">While user-mode printer drivers written for previous versions of Windows will continue to work, an XPS printer driver (XPSDrv) is required in order to use the XPS print path.</span></span>  
  
 <span data-ttu-id="99516-126">XPS 打印路径的优势非常重要，包括：</span><span class="sxs-lookup"><span data-stu-id="99516-126">The benefits of the XPS print path are significant, and include:</span></span>  
  
- <span data-ttu-id="99516-127">威西威格打印支持</span><span class="sxs-lookup"><span data-stu-id="99516-127">WYSIWYG print support</span></span>  
  
- <span data-ttu-id="99516-128">对高级颜色配置文件的本机支持（包括 32 位/通道 (bpc)、CMYK、已命名的颜色、n 墨迹）以及对透明和渐变的本机支持。</span><span class="sxs-lookup"><span data-stu-id="99516-128">Native support of advanced color profiles, which include 32 bits per channel (bpc), CMYK, named-colors, n-inks, and native support of transparency and gradients.</span></span>  
  
- <span data-ttu-id="99516-129">提高了 .NET 框架和基于 Win32 的应用程序的打印性能。</span><span class="sxs-lookup"><span data-stu-id="99516-129">Improved print performance for both .NET Framework and Win32 based applications.</span></span>  
  
- <span data-ttu-id="99516-130">行业标准 XPS 格式。</span><span class="sxs-lookup"><span data-stu-id="99516-130">Industry standard XPS format.</span></span>  
  
 <span data-ttu-id="99516-131">对于基本打印方案，提供简单直观的 API，并带有一个入口点，用于用户界面、配置和作业提交。</span><span class="sxs-lookup"><span data-stu-id="99516-131">For basic print scenarios, a simple and intuitive API is available with a single entry point for user interface, configuration and job submission.</span></span> <span data-ttu-id="99516-132">对于高级方案，为 [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] 自定义（或根本没有 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]）、同步或异步打印以及批量打印功能添加了附加支持。</span><span class="sxs-lookup"><span data-stu-id="99516-132">For advanced scenarios, an additional support is added for [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] customization (or no [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] at all), synchronous or asynchronous printing, and batch printing capabilities.</span></span> <span data-ttu-id="99516-133">这两个选项在完全或部分信任模式下都提供打印支持。</span><span class="sxs-lookup"><span data-stu-id="99516-133">Both options provide print support in full or partial trust mode.</span></span>  
  
 <span data-ttu-id="99516-134">XPS 的设计考虑到了可扩展性。</span><span class="sxs-lookup"><span data-stu-id="99516-134">XPS was designed with extensibility in mind.</span></span> <span data-ttu-id="99516-135">通过使用可扩展性框架，可以模块化地将特性和功能添加到 XPS 中。</span><span class="sxs-lookup"><span data-stu-id="99516-135">By using the extensibility framework, features and capabilities can be added to XPS in a modular manner.</span></span> <span data-ttu-id="99516-136">扩展性功能包括：</span><span class="sxs-lookup"><span data-stu-id="99516-136">Extensibility features include:</span></span>  
  
- <span data-ttu-id="99516-137">打印架构。</span><span class="sxs-lookup"><span data-stu-id="99516-137">Print Schema.</span></span> <span data-ttu-id="99516-138">公共架构将定期进行更新，并可以实现设备功能的迅速扩展。</span><span class="sxs-lookup"><span data-stu-id="99516-138">The public schema is updated regularly and enables rapid extension of device capabilities.</span></span> <span data-ttu-id="99516-139">（请参阅下面的 **PrintTicket 和 PrintCapabilities**。）</span><span class="sxs-lookup"><span data-stu-id="99516-139">(See **PrintTicket and PrintCapabilities** below.)</span></span>  
  
- <span data-ttu-id="99516-140">可扩展筛选器管道。</span><span class="sxs-lookup"><span data-stu-id="99516-140">Extensible Filter Pipeline.</span></span> <span data-ttu-id="99516-141">XPS 打印机驱动程序 （XPSDrv） 过滤管道旨在支持直接和可扩展地打印 XPS 文档。</span><span class="sxs-lookup"><span data-stu-id="99516-141">The XPS printer driver (XPSDrv) filter pipeline was designed to enable both direct and scalable printing of XPS documents.</span></span> <span data-ttu-id="99516-142">有关详细信息，请参阅 [XPSDrv 打印机驱动程序](/windows-hardware/drivers/print/xpsdrv-printer-drivers)。</span><span class="sxs-lookup"><span data-stu-id="99516-142">For more information, see [XPSDrv Printer Drivers](/windows-hardware/drivers/print/xpsdrv-printer-drivers).</span></span>
  
### <a name="print-path-architecture"></a><span data-ttu-id="99516-143">打印路径体系结构</span><span class="sxs-lookup"><span data-stu-id="99516-143">Print Path Architecture</span></span>  
 <span data-ttu-id="99516-144">虽然 Win32 和 .NET 框架应用程序都支持 XPS，但 Win32 和 Windows 窗体应用程序使用 GDI 到 XPS 转换，以便为 XPS 打印机驱动程序 （XPSDrv） 创建 XPS 格式化的内容。</span><span class="sxs-lookup"><span data-stu-id="99516-144">While both Win32 and .NET Framework applications support XPS, Win32 and Windows Forms applications use a GDI to XPS conversion in order to create XPS formatted content for the XPS printer driver (XPSDrv).</span></span> <span data-ttu-id="99516-145">这些应用程序不需要使用 XPS 打印路径，并且可以继续使用基于增强的元文件 （EMF） 打印。</span><span class="sxs-lookup"><span data-stu-id="99516-145">These applications are not required to use the XPS print path, and can continue to use Enhanced Metafile (EMF) based printing.</span></span> <span data-ttu-id="99516-146">但是，大多数 XPS 功能和增强功能仅对面向 XPS 打印路径的应用程序可用。</span><span class="sxs-lookup"><span data-stu-id="99516-146">However, most XPS features and enhancements are only available to applications that target the XPS print path.</span></span>  
  
 <span data-ttu-id="99516-147">为了启用 Win32 和 Windows 窗体应用程序使用基于 XPSDrv 的打印机，XPS 打印机驱动程序 （XPSDrv） 支持将 GDI 转换为 XPS 格式。</span><span class="sxs-lookup"><span data-stu-id="99516-147">To enable the use of XPSDrv-based printers by Win32 and Windows Forms applications, the XPS printer driver (XPSDrv) supports conversion of GDI to XPS format.</span></span> <span data-ttu-id="99516-148">XPSDrv 型号还为 XPS 到 GDI 格式提供了转换器，以便 Win32 应用程序可以打印 XPS 文档。</span><span class="sxs-lookup"><span data-stu-id="99516-148">The XPSDrv model also provides a converter for XPS to GDI format so that Win32 applications can print XPS Documents.</span></span> <span data-ttu-id="99516-149">对于 WPF 应用程序，只要写入操作的目标打印队列没有 XPSDrv<xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%2A>驱动程序，XPS 格式转换为 GDI 格式由<xref:System.Windows.Xps.XpsDocumentWriter>类<xref:System.Windows.Xps.XpsDocumentWriter.Write%2A>和方法自动完成。</span><span class="sxs-lookup"><span data-stu-id="99516-149">For WPF applications, conversion of XPS to GDI format is done automatically by the <xref:System.Windows.Xps.XpsDocumentWriter.Write%2A> and <xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%2A> methods of the <xref:System.Windows.Xps.XpsDocumentWriter> class whenever the target print queue of the write operation does not have an XPSDrv driver.</span></span> <span data-ttu-id="99516-150">（Windows 窗体应用程序无法打印 XPS 文档。</span><span class="sxs-lookup"><span data-stu-id="99516-150">(Windows Forms applications cannot print XPS Documents.)</span></span>  
  
 <span data-ttu-id="99516-151">下图描述了打印子系统，并定义了 Microsoft 提供的部分以及软件和硬件供应商定义的部分：</span><span class="sxs-lookup"><span data-stu-id="99516-151">The following illustration depicts the print subsystem and defines the portions provided by Microsoft, and the portions defined by software and hardware vendors:</span></span>  
  
 ![屏幕截图显示了 XPS 打印系统。](./media/printing-overview/xml-paper-specification-print-system.png)  
  
### <a name="basic-xps-printing"></a><span data-ttu-id="99516-153">基本 XPS 打印</span><span class="sxs-lookup"><span data-stu-id="99516-153">Basic XPS Printing</span></span>  
 <span data-ttu-id="99516-154">WPF 同时定义基本和高级 API。</span><span class="sxs-lookup"><span data-stu-id="99516-154">WPF defines both a basic and advanced API.</span></span> <span data-ttu-id="99516-155">对于不需要大量打印自定义或访问完整 XPS 功能集的应用程序，可提供基本打印支持。</span><span class="sxs-lookup"><span data-stu-id="99516-155">For those applications that do not require extensive print customization or access to the complete XPS feature set, basic print support is available.</span></span> <span data-ttu-id="99516-156">基本打印支持通过一个打印对话框控件公开，该控件要求最低的配置，并采用熟悉的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="99516-156">Basic print support is exposed through a print dialog control that requires minimal configuration and features a familiar [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="99516-157">许多 XPS 功能都可用于使用此简化的打印模型。</span><span class="sxs-lookup"><span data-stu-id="99516-157">Many XPS features are available using this simplified print model.</span></span>  
  
#### <a name="printdialog"></a><span data-ttu-id="99516-158">PrintDialog</span><span class="sxs-lookup"><span data-stu-id="99516-158">PrintDialog</span></span>  
 <span data-ttu-id="99516-159">该<xref:System.Windows.Controls.PrintDialog?displayProperty=nameWithType>控件为[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]、配置和 XPS 作业提交提供单个入口点。</span><span class="sxs-lookup"><span data-stu-id="99516-159">The <xref:System.Windows.Controls.PrintDialog?displayProperty=nameWithType> control provides a single entry point for [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], configuration, and XPS job submission.</span></span> <span data-ttu-id="99516-160">若要了解如何实例化和使用该控件，请参阅[调用打印对话框](how-to-invoke-a-print-dialog.md)。</span><span class="sxs-lookup"><span data-stu-id="99516-160">For information about how to instantiate and use the control, see [Invoke a Print Dialog](how-to-invoke-a-print-dialog.md).</span></span>  
  
### <a name="advanced-xps-printing"></a><span data-ttu-id="99516-161">高级 XPS 打印</span><span class="sxs-lookup"><span data-stu-id="99516-161">Advanced XPS Printing</span></span>  
 <span data-ttu-id="99516-162">要访问完整的 XPS 功能集，必须使用高级打印 API。</span><span class="sxs-lookup"><span data-stu-id="99516-162">To access the complete set of XPS features, the advanced print API must be used.</span></span> <span data-ttu-id="99516-163">下面将更详细地介绍几个相关的 API。</span><span class="sxs-lookup"><span data-stu-id="99516-163">Several relevant API are described in greater detail below.</span></span> <span data-ttu-id="99516-164">有关 XPS 打印路径 API 的完整列表，请参阅<xref:System.Windows.Xps><xref:System.Printing>和 命名空间引用。</span><span class="sxs-lookup"><span data-stu-id="99516-164">For a complete list of XPS print path APIs, see the <xref:System.Windows.Xps> and <xref:System.Printing> namespace references.</span></span>  
  
#### <a name="printticket-and-printcapabilities"></a><span data-ttu-id="99516-165">PrintTicket 和 PrintCapabilities</span><span class="sxs-lookup"><span data-stu-id="99516-165">PrintTicket and PrintCapabilities</span></span>  
 <span data-ttu-id="99516-166"><xref:System.Printing.PrintTicket>和<xref:System.Printing.PrintCapabilities>类是高级 XPS 功能的基础。</span><span class="sxs-lookup"><span data-stu-id="99516-166">The <xref:System.Printing.PrintTicket> and <xref:System.Printing.PrintCapabilities> classes are the foundation of the advanced XPS features.</span></span> <span data-ttu-id="99516-167">这两种类型的对象都是面向打印的功能（如排序、双面打印、装订等）的 XML 格式结构。这些结构由打印架构定义。</span><span class="sxs-lookup"><span data-stu-id="99516-167">Both types of objects are XML formatted structures of print-oriented features such as collation, two-sided printing, stapling, etc. These structures are defined by the print schema.</span></span> <span data-ttu-id="99516-168"><xref:System.Printing.PrintTicket> 指示打印机如何处理打印作业。</span><span class="sxs-lookup"><span data-stu-id="99516-168">A <xref:System.Printing.PrintTicket> instructs a printer how to process a print job.</span></span> <span data-ttu-id="99516-169"><xref:System.Printing.PrintCapabilities> 类定义打印机的各种功能。</span><span class="sxs-lookup"><span data-stu-id="99516-169">The <xref:System.Printing.PrintCapabilities> class defines the capabilities of a printer.</span></span> <span data-ttu-id="99516-170">通过查询打印机的功能，可以创建充分利用打印机的受支持功能的 <xref:System.Printing.PrintTicket>。</span><span class="sxs-lookup"><span data-stu-id="99516-170">By querying the capabilities of a printer, a <xref:System.Printing.PrintTicket> can be created that takes full advantage of a printer's supported features.</span></span> <span data-ttu-id="99516-171">同样，可以避免不受支持的功能。</span><span class="sxs-lookup"><span data-stu-id="99516-171">Similarly, unsupported features can be avoided.</span></span>  
  
 <span data-ttu-id="99516-172">下面的示例演示如何使用代码查询打印机的 <xref:System.Printing.PrintCapabilities> 和创建 <xref:System.Printing.PrintTicket>。</span><span class="sxs-lookup"><span data-stu-id="99516-172">The following example demonstrates how to query the <xref:System.Printing.PrintCapabilities> of a printer and create a <xref:System.Printing.PrintTicket> using code.</span></span>  
  
 [!code-cpp[xpscreate#PrinterCapabilities](~/samples/snippets/cpp/VS_Snippets_Wpf/XpsCreate/CPP/XpsCreate.cpp#printercapabilities)]
 [!code-csharp[xpscreate#PrinterCapabilities](~/samples/snippets/csharp/VS_Snippets_Wpf/XpsCreate/CSharp/XpsCreate.cs#printercapabilities)]
 [!code-vb[xpscreate#PrinterCapabilities](~/samples/snippets/visualbasic/VS_Snippets_Wpf/XpsCreate/visualbasic/xpscreate.vb#printercapabilities)]  
  
#### <a name="printserver-and-printqueue"></a><span data-ttu-id="99516-173">PrintServer 和 PrintQueue</span><span class="sxs-lookup"><span data-stu-id="99516-173">PrintServer and PrintQueue</span></span>  
 <span data-ttu-id="99516-174"><xref:System.Printing.PrintServer> 类表示一个网络打印服务器，而 <xref:System.Printing.PrintQueue> 类则表示一台打印机以及与其关联的输出作业队列。</span><span class="sxs-lookup"><span data-stu-id="99516-174">The <xref:System.Printing.PrintServer> class represents a network print server and the <xref:System.Printing.PrintQueue> class represents a printer and the output job queue associated with it.</span></span> <span data-ttu-id="99516-175">总之，这些 API 允许对服务器的打印作业进行高级管理。</span><span class="sxs-lookup"><span data-stu-id="99516-175">Together, these APIs allow advanced management of a server's print jobs.</span></span> <span data-ttu-id="99516-176"><xref:System.Printing.PrintServer> 或其派生类之一用于管理 <xref:System.Printing.PrintQueue>。</span><span class="sxs-lookup"><span data-stu-id="99516-176">A <xref:System.Printing.PrintServer>, or one of its derived classes, is used to manage a <xref:System.Printing.PrintQueue>.</span></span> <span data-ttu-id="99516-177"><xref:System.Printing.PrintQueue.AddJob%2A> 方法用于将新的打印作业插入队列。</span><span class="sxs-lookup"><span data-stu-id="99516-177">The <xref:System.Printing.PrintQueue.AddJob%2A> method is used to insert a new print job into the queue.</span></span>  
  
 <span data-ttu-id="99516-178">下面的示例演示如何使用代码创建 <xref:System.Printing.LocalPrintServer> 和访问其默认的 <xref:System.Printing.PrintQueue>。</span><span class="sxs-lookup"><span data-stu-id="99516-178">The following example demonstrates how to create a <xref:System.Printing.LocalPrintServer> and access its default <xref:System.Printing.PrintQueue> by using code.</span></span>  
  
 [!code-csharp[xpsprint#PrintQueueSnip](~/samples/snippets/csharp/VS_Snippets_Wpf/XpsPrint/CSharp/XpsPrintHelper.cs#printqueuesnip)]
 [!code-vb[xpsprint#PrintQueueSnip](~/samples/snippets/visualbasic/VS_Snippets_Wpf/XpsPrint/visualbasic/xpsprinthelper.vb#printqueuesnip)]  
  
#### <a name="xpsdocumentwriter"></a><span data-ttu-id="99516-179">XpsDocumentWriter</span><span class="sxs-lookup"><span data-stu-id="99516-179">XpsDocumentWriter</span></span>  
 <span data-ttu-id="99516-180">A<xref:System.Windows.Xps.XpsDocumentWriter>及其许多<xref:System.Windows.Xps.XpsDocumentWriter.Write%2A>和<xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%2A>方法用于将 XPS 文档写入 。 <xref:System.Printing.PrintQueue></span><span class="sxs-lookup"><span data-stu-id="99516-180">An <xref:System.Windows.Xps.XpsDocumentWriter>, with its many the <xref:System.Windows.Xps.XpsDocumentWriter.Write%2A> and <xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%2A> methods, is used to write XPS documents to a <xref:System.Printing.PrintQueue>.</span></span> <span data-ttu-id="99516-181">例如，<xref:System.Windows.Xps.XpsDocumentWriter.Write%28System.Windows.Documents.FixedPage%2CSystem.Printing.PrintTicket%29>该方法用于输出 XPS 文档并<xref:System.Printing.PrintTicket>同步输出。</span><span class="sxs-lookup"><span data-stu-id="99516-181">For example, the <xref:System.Windows.Xps.XpsDocumentWriter.Write%28System.Windows.Documents.FixedPage%2CSystem.Printing.PrintTicket%29> method is used to output an XPS document and <xref:System.Printing.PrintTicket> synchronously.</span></span> <span data-ttu-id="99516-182">该方法<xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%28System.Windows.Documents.FixedDocument%2CSystem.Printing.PrintTicket%29>用于输出 XPS 文档并<xref:System.Printing.PrintTicket>异步输出。</span><span class="sxs-lookup"><span data-stu-id="99516-182">The <xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%28System.Windows.Documents.FixedDocument%2CSystem.Printing.PrintTicket%29> method is used to output an XPS document and <xref:System.Printing.PrintTicket> asynchronously.</span></span>  
  
 <span data-ttu-id="99516-183">下面的示例演示如何使用代码创建 <xref:System.Windows.Xps.XpsDocumentWriter>。</span><span class="sxs-lookup"><span data-stu-id="99516-183">The following example demonstrates how to create an <xref:System.Windows.Xps.XpsDocumentWriter> using code.</span></span>  
  
 [!code-csharp[XpsPrint#PrintQueueSnip](~/samples/snippets/csharp/VS_Snippets_Wpf/XpsPrint/CSharp/XpsPrintHelper.cs#printqueuesnip)]
 [!code-vb[XpsPrint#PrintQueueSnip](~/samples/snippets/visualbasic/VS_Snippets_Wpf/XpsPrint/visualbasic/xpsprinthelper.vb#printqueuesnip)]  
  
 <span data-ttu-id="99516-184"><xref:System.Printing.PrintQueue.AddJob%2A> 方法还提供打印方法。</span><span class="sxs-lookup"><span data-stu-id="99516-184">The <xref:System.Printing.PrintQueue.AddJob%2A> methods also provide ways to print.</span></span> <span data-ttu-id="99516-185">请参阅[以编程方式打印 XPS 文件](how-to-programmatically-print-xps-files.md)。</span><span class="sxs-lookup"><span data-stu-id="99516-185">See [Programmatically Print XPS Files](how-to-programmatically-print-xps-files.md).</span></span> <span data-ttu-id="99516-186">以获取详细信息。</span><span class="sxs-lookup"><span data-stu-id="99516-186">for details.</span></span>  
  
<a name="GDI_Print_Path_intro"></a>
## <a name="gdi-print-path"></a><span data-ttu-id="99516-187">GDI 打印路径</span><span class="sxs-lookup"><span data-stu-id="99516-187">GDI Print Path</span></span>  
 <span data-ttu-id="99516-188">虽然 WPF 应用程序本机支持 XPS 打印路径，但 Win32 和 Windows 窗体应用程序也可以利用某些 XPS 功能。</span><span class="sxs-lookup"><span data-stu-id="99516-188">While WPF applications natively support the XPS print path, Win32 and Windows Forms applications can also take advantage of some XPS features.</span></span> <span data-ttu-id="99516-189">XPS 打印机驱动程序 （XPSDrv） 可将基于 GDI 的输出转换为 XPS 格式。</span><span class="sxs-lookup"><span data-stu-id="99516-189">The XPS printer driver (XPSDrv) can convert GDI based output to XPS format.</span></span> <span data-ttu-id="99516-190">对于高级方案，支持使用[Microsoft XPS 文档转换器 （MXDC）](/windows/desktop/printdocs/microsoft-xps-document-converter--mxdc-)自定义内容转换。</span><span class="sxs-lookup"><span data-stu-id="99516-190">For advanced scenarios, custom conversion of content is supported using the [Microsoft XPS Document Converter (MXDC)](/windows/desktop/printdocs/microsoft-xps-document-converter--mxdc-).</span></span> <span data-ttu-id="99516-191">同样，WPF 应用程序还可以通过调用<xref:System.Windows.Xps.XpsDocumentWriter.Write%2A><xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%2A><xref:System.Windows.Xps.XpsDocumentWriter>类的或方法之一并将非 XpsDrv 打印机指定为目标打印队列，输出到 GDI 打印路径。</span><span class="sxs-lookup"><span data-stu-id="99516-191">Similarly, WPF applications can also output to the GDI print path by calling one of the <xref:System.Windows.Xps.XpsDocumentWriter.Write%2A> or <xref:System.Windows.Xps.XpsDocumentWriter.WriteAsync%2A> methods of the <xref:System.Windows.Xps.XpsDocumentWriter> class and designating a non-XpsDrv printer as the target print queue.</span></span>  

<span data-ttu-id="99516-192">对于不需要 XPS 功能或支持的应用程序，当前 GDI 打印路径保持不变。</span><span class="sxs-lookup"><span data-stu-id="99516-192">For applications that do not require XPS functionality or support, the current GDI print path remains unchanged.</span></span>  
  
- <span data-ttu-id="99516-193">有关 GDI 打印路径和各种 XPS 转换选项的其他参考资料，请参阅[Microsoft XPS 文档转换器 （MXDC）](/windows/desktop/printdocs/microsoft-xps-document-converter--mxdc-)和[XPSDrv 打印机驱动程序](/windows-hardware/drivers/print/xpsdrv-printer-drivers)。</span><span class="sxs-lookup"><span data-stu-id="99516-193">For additional reference material on the GDI print path and the various XPS conversion options, see [Microsoft XPS Document Converter (MXDC)](/windows/desktop/printdocs/microsoft-xps-document-converter--mxdc-) and [XPSDrv Printer Drivers](/windows-hardware/drivers/print/xpsdrv-printer-drivers).</span></span>  
  
<a name="XPS_Driver_Model_intro"></a>
## <a name="xpsdrv-driver-model"></a><span data-ttu-id="99516-194">XPSDrv 驱动程序模型</span><span class="sxs-lookup"><span data-stu-id="99516-194">XPSDrv Driver Model</span></span>  
 <span data-ttu-id="99516-195">在打印到启用 XPS 的打印机或驱动程序时，XPS 打印路径使用 XPS 作为本机打印假脱机格式，从而提高了后台程序的效率。</span><span class="sxs-lookup"><span data-stu-id="99516-195">The XPS print path improves spooler efficiency by using XPS as the native print spool format when printing to an XPS -enabled printer or driver.</span></span> <span data-ttu-id="99516-196">简化的后台打印过程消除了在文档后台化之前生成中间假脱机文件（如 EMF 数据文件）的需要。</span><span class="sxs-lookup"><span data-stu-id="99516-196">The simplified spooling process eliminates the need to generate an intermediate spool file, such as an EMF data file, before the document is spooled.</span></span> <span data-ttu-id="99516-197">通过更小的假脱机文件大小，XPS 打印路径可以减少网络流量并提高打印性能。</span><span class="sxs-lookup"><span data-stu-id="99516-197">Through smaller spool file sizes, the XPS print path can reduce network traffic and improve print performance.</span></span>  
  
 <span data-ttu-id="99516-198">EMF 是一种封闭格式，表示应用程序输出为一系列对 GDI 的调用，用于呈现服务。</span><span class="sxs-lookup"><span data-stu-id="99516-198">EMF is a closed format that represents application output as a series of calls into GDI for rendering services.</span></span> <span data-ttu-id="99516-199">与 EMF 不同，XPS 假脱机格式表示实际文档，无需在输出到基于 XPS 的打印机驱动程序 （XPSDrv） 时需要进一步解释。</span><span class="sxs-lookup"><span data-stu-id="99516-199">Unlike EMF, the XPS spool format represents the actual document without requiring further interpretation when output to an XPS-based printer driver (XPSDrv).</span></span> <span data-ttu-id="99516-200">这些驱动程序可以用这种格式直接对数据进行操作。</span><span class="sxs-lookup"><span data-stu-id="99516-200">The drivers can operate directly on the data in the format.</span></span> <span data-ttu-id="99516-201">此功能消除了使用 EMF 文件和基于 GDI 的打印驱动程序所需的数据和色彩空间转换。</span><span class="sxs-lookup"><span data-stu-id="99516-201">This capability eliminates the data and color space conversions required when you use EMF files and GDI-based print drivers.</span></span>  
  
 <span data-ttu-id="99516-202">与 EMF 等效项相比，当您使用针对 XPS 打印机驱动程序 （XPSDrv） 的 XPS 文档时，Spool 文件大小通常会减小;但是，也有例外：</span><span class="sxs-lookup"><span data-stu-id="99516-202">Spool file sizes are usually reduced when you use XPS Documents that target an XPS printer driver (XPSDrv) compared with their EMF equivalents; however, there are exceptions:</span></span>  
  
- <span data-ttu-id="99516-203">相当复杂、分为多层或者编写效率低下的向量图形可能比同一图形的位图图形更大。</span><span class="sxs-lookup"><span data-stu-id="99516-203">A vector graphic that is very complex, multi-layered, or inefficiently written can be larger than a bitmapped version of the same graphic.</span></span>  
  
- <span data-ttu-id="99516-204">出于屏幕显示的目的，XPS 文件中嵌入了设备字体以及基于计算机的字体，而 GDI 打印后台文件未嵌入设备字体。</span><span class="sxs-lookup"><span data-stu-id="99516-204">For screen display purposes, XPS files embed device fonts as well as computer-based fonts; whereas GDI spool files do not embed device fonts.</span></span> <span data-ttu-id="99516-205">这两种字体都划分了子集（请参见下面的内容），而且打印机驱动程序可以在将文件传输给打印机之前删除这些设备字体。</span><span class="sxs-lookup"><span data-stu-id="99516-205">But both kinds of fonts are subsetted (see below) and printer drivers can remove the device fonts before transmitting the file to the printer.</span></span>  
  
 <span data-ttu-id="99516-206">可通过几种机制来减小后台打印文件的大小：</span><span class="sxs-lookup"><span data-stu-id="99516-206">Spool size reduction is performed through several mechanisms:</span></span>  
  
- <span data-ttu-id="99516-207">**字体子集划分**。</span><span class="sxs-lookup"><span data-stu-id="99516-207">**Font subsetting**.</span></span> <span data-ttu-id="99516-208">XPS 文件中仅存储实际文档中使用的字符。</span><span class="sxs-lookup"><span data-stu-id="99516-208">Only characters used within the actual document are stored in the XPS file.</span></span>  
  
- <span data-ttu-id="99516-209">**高级图形支持**。</span><span class="sxs-lookup"><span data-stu-id="99516-209">**Advanced Graphics Support**.</span></span> <span data-ttu-id="99516-210">对透明度和梯度基元的本机支持可避免 XPS 文档中内容的栅格化。</span><span class="sxs-lookup"><span data-stu-id="99516-210">Native support for transparency and gradient primitives avoids rasterization of content in the XPS Document.</span></span>  
  
- <span data-ttu-id="99516-211">**公共资源的识别**。</span><span class="sxs-lookup"><span data-stu-id="99516-211">**Identification of common resources**.</span></span> <span data-ttu-id="99516-212">将多次使用的资源（如表示公司徽标的图像）视为共享资源，并且只加载一次。</span><span class="sxs-lookup"><span data-stu-id="99516-212">Resources that are used multiple times (such as an image that represents a corporate logo) are treated as shared resources and are loaded only once.</span></span>  
  
- <span data-ttu-id="99516-213">**ZIP 压缩**。</span><span class="sxs-lookup"><span data-stu-id="99516-213">**ZIP compression**.</span></span> <span data-ttu-id="99516-214">所有 XPS 文档都使用 ZIP 压缩。</span><span class="sxs-lookup"><span data-stu-id="99516-214">All XPS documents use ZIP compression.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="99516-215">另请参阅</span><span class="sxs-lookup"><span data-stu-id="99516-215">See also</span></span>

- <xref:System.Windows.Controls.PrintDialog>
- <xref:System.Windows.Xps.XpsDocumentWriter>
- <xref:System.Windows.Xps.Packaging.XpsDocument>
- <xref:System.Printing.PrintTicket>
- <xref:System.Printing.PrintCapabilities>
- <xref:System.Printing.PrintServer>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="99516-216">如何使用主题</span><span class="sxs-lookup"><span data-stu-id="99516-216">How-to Topics</span></span>](printing-how-to-topics.md)
- [<span data-ttu-id="99516-217">WPF 中的文档</span><span class="sxs-lookup"><span data-stu-id="99516-217">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="99516-218">XPS 文档</span><span class="sxs-lookup"><span data-stu-id="99516-218">XPS Documents</span></span>](/windows/desktop/printdocs/documents)
- [<span data-ttu-id="99516-219">文档序列化和存储</span><span class="sxs-lookup"><span data-stu-id="99516-219">Document Serialization and Storage</span></span>](document-serialization-and-storage.md)
- [<span data-ttu-id="99516-220">微软XPS文档转换器（MXDC）</span><span class="sxs-lookup"><span data-stu-id="99516-220">Microsoft XPS Document Converter (MXDC)</span></span>](/windows/desktop/printdocs/microsoft-xps-document-converter--mxdc-)
