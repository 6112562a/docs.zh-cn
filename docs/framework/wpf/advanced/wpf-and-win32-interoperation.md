---
title: WPF 和 Win32 互操作
ms.date: 03/30/2017
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
- HWND interop [WPF]
- Win32 code [WPF], WPF interoperation
- interoperability [WPF], Win32
ms.assetid: 0ffbde0d-701d-45a3-a6fa-dd71f4d9772e
ms.openlocfilehash: cbae3011634fb6c6b68e477a10931a1ef13c3f55
ms.sourcegitcommit: eaa6d5cd0f4e7189dbe0bd756e9f53508b01989e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/07/2019
ms.locfileid: "67610366"
---
# <a name="wpf-and-win32-interoperation"></a><span data-ttu-id="ac8b2-102">WPF 和 Win32 互操作</span><span class="sxs-lookup"><span data-stu-id="ac8b2-102">WPF and Win32 Interoperation</span></span>
<span data-ttu-id="ac8b2-103">本主题概述如何互操作 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 和 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 代码。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-103">This topic provides an overview of how to interoperate [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span> [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="ac8b2-104">提供了用于创建应用程序的丰富环境。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-104">provides a rich environment for creating applications.</span></span> <span data-ttu-id="ac8b2-105">但是，如果对 [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] 代码投入很大，重复使用部分此代码可能更有效。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-105">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to reuse some of that code.</span></span>  

<a name="basics"></a>   
## <a name="wpf-and-win32-interoperation-basics"></a><span data-ttu-id="ac8b2-106">WPF 和 Win32 互操作基础知识</span><span class="sxs-lookup"><span data-stu-id="ac8b2-106">WPF and Win32 Interoperation Basics</span></span>  
 <span data-ttu-id="ac8b2-107">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 和 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 代码间的互操作存在两种基本方法。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-107">There are two basic techniques for interoperation between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
- <span data-ttu-id="ac8b2-108">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 窗口中承载 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 内容。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-108">Host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="ac8b2-109">通过此方法，可在标准 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 窗口和应用程序的框架内使用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 的高级图形功能。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-109">With this technique, you can use the advanced graphics capabilities of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] within the framework of a standard [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window and application.</span></span>  
  
- <span data-ttu-id="ac8b2-110">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容中承载 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 窗口。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-110">Host a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="ac8b2-111">通过此方法，可在其他 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的上下文中使用现有自定义 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 控件，并可跨边界传递数据。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-111">With this technique, you can use an existing custom [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control in the context of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and pass data across the boundaries.</span></span>  
  
 <span data-ttu-id="ac8b2-112">本主题中对上述每种方法进行了概念性介绍。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-112">Each of these techniques is conceptually introduced in this topic.</span></span> <span data-ttu-id="ac8b2-113">托管的更加面向代码演示[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]，请参阅[演练：Win32 中承载 WPF 内容](walkthrough-hosting-wpf-content-in-win32.md)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-113">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], see [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md).</span></span> <span data-ttu-id="ac8b2-114">托管的更加面向代码演示[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]中[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]，请参阅[演练：中承载 Win32 控件在 WPF 中的](walkthrough-hosting-a-win32-control-in-wpf.md)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-114">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
<a name="projects"></a>   
## <a name="wpf-interoperation-projects"></a><span data-ttu-id="ac8b2-115">WPF 互操作项目</span><span class="sxs-lookup"><span data-stu-id="ac8b2-115">WPF Interoperation Projects</span></span>  
 <span data-ttu-id="ac8b2-116">虽然 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] 为托管代码，但大多数现有 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程序是以非托管 [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 编写而成。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-116">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] are managed code, but most existing [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programs are written in unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="ac8b2-117">无法从真正的非托管程序调用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-117">You cannot call [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] from a true unmanaged program.</span></span> <span data-ttu-id="ac8b2-118">但是，通过使用`/clr`选项与[!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)]编译器，可以创建可无缝混合托管和非托管 API 调用的混合托管-非托管的程序。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-118">However, by using the `/clr` option with the [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged API calls.</span></span>  
  
 <span data-ttu-id="ac8b2-119">存在的一个项目级问题是无法将 [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] 文件编译到 [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 项目中。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-119">One project-level complication is that you cannot compile [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] files into a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] project.</span></span>  <span data-ttu-id="ac8b2-120">可通过一些项目分离技术对此进行弥补。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-120">There are several project division techniques to compensate for this.</span></span>  
  
- <span data-ttu-id="ac8b2-121">创建包含所有的 C# DLL 你[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]页为已编译的程序集，然后让你[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]可执行文件包含[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]作为参考。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-121">Create a C# DLL that contains all your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages as a compiled assembly, and then have your [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] executable include that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] as a reference.</span></span>  
  
- <span data-ttu-id="ac8b2-122">创建一个 C# 可执行文件[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容，并将其引用[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] ，其中包含[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]内容。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-122">Create a C# executable for the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and have it reference a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] that contains the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
- <span data-ttu-id="ac8b2-123">使用<xref:System.Windows.Markup.XamlReader.Load%2A>加载任何[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]在运行时，而不是编译您[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-123">Use <xref:System.Windows.Markup.XamlReader.Load%2A> to load any [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at run time, instead of compiling your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>  
  
- <span data-ttu-id="ac8b2-124">不要使用[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]，并写入所有你[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]在代码中，构建元素树从<xref:System.Windows.Application>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-124">Do not use [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at all, and write all your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in code, building up the element tree from <xref:System.Windows.Application>.</span></span>  
  
 <span data-ttu-id="ac8b2-125">请使用最适合你的方法。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-125">Use whatever approach works best for you.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ac8b2-126">如果之前未使用过 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]，在互操作代码示例中你可能会看到 `gcnew` 和 `nullptr` 等一些“新”关键字。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-126">If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some "new" keywords such as `gcnew` and `nullptr` in the interoperation code examples.</span></span> <span data-ttu-id="ac8b2-127">这些关键字取代旧版双下划线语法 (`__gc`)，为 [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 中的托管代码提供了更加自然的语法。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-127">These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="ac8b2-128">若要详细了解 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 托管功能，请参阅[适用于运行时平台的组件扩展](/cpp/windows/component-extensions-for-runtime-platforms)和[了解 C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-128">To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739).</span></span>  
  
<a name="hwnds"></a>   
## <a name="how-wpf-uses-hwnds"></a><span data-ttu-id="ac8b2-129">WPF 如何使用 Hwnd</span><span class="sxs-lookup"><span data-stu-id="ac8b2-129">How WPF Uses Hwnds</span></span>  
 <span data-ttu-id="ac8b2-130">若要充分利用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]“HWND 互操作”，需要了解 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 如何使用 HWND。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-130">To make the most of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] "HWND interop", you need to understand how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses HWNDs.</span></span> <span data-ttu-id="ac8b2-131">对于任何 HWND，无法将 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 绘制与 [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] 绘制或 [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] 绘制混合。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-131">For any HWND, you cannot mix [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering with [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] rendering or [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] rendering.</span></span> <span data-ttu-id="ac8b2-132">这具有许多影响。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-132">This has a number of implications.</span></span> <span data-ttu-id="ac8b2-133">首先，若要混合这些绘制模型，必须创建互操作解决方案，并对选择使用的每个绘制模型使用互操作的指定段。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-133">Primarily, in order to mix these rendering models at all, you must create an interoperation solution, and use designated segments of interoperation for each rendering model that you choose to use.</span></span> <span data-ttu-id="ac8b2-134">此外，绘制行为会为互操作解决方案可实现的操作创建一个“空域”限制。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-134">Also, the rendering behavior creates an "airspace" restriction for what your interoperation solution can accomplish.</span></span> <span data-ttu-id="ac8b2-135">有关“空域”概念的详细信息，请参见[技术区概述](technology-regions-overview.md)主题。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-135">The "airspace" concept is explained in greater detail in the topic [Technology Regions Overview](technology-regions-overview.md).</span></span>  
  
 <span data-ttu-id="ac8b2-136">屏幕上的所有 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 元素最终受 HWND 支持。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-136">All [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements on the screen are ultimately backed by a HWND.</span></span> <span data-ttu-id="ac8b2-137">当您创建[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]创建一个顶层 HWND，并使用<xref:System.Windows.Interop.HwndSource>放置<xref:System.Windows.Window>并将其[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]HWND 内的内容。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-137">When you create a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] creates a top-level HWND, and uses an <xref:System.Windows.Interop.HwndSource> to put the <xref:System.Windows.Window> and its [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content inside the HWND.</span></span>  <span data-ttu-id="ac8b2-138">应用程序中的其余 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容共享单个 HWND。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-138">The rest of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in the application shares that singular HWND.</span></span> <span data-ttu-id="ac8b2-139">菜单、组合框下拉列表和其他弹出窗口例外。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-139">An exception is menus, combo box drop downs, and other pop-ups.</span></span> <span data-ttu-id="ac8b2-140">这些元素会创建自己的顶层窗口，因此 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 菜单可能超出所在窗口 HWND 的边缘。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-140">These elements create their own top-level window, which is why a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] menu can potentially go past the edge of the window HWND that contains it.</span></span> <span data-ttu-id="ac8b2-141">当你使用<xref:System.Windows.Interop.HwndHost>将 HWND 内的放置[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]通知[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]如何定位到的新子 HWND 相对[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-141">When you use <xref:System.Windows.Interop.HwndHost> to put an HWND inside [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] informs [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] how to position the new child HWND relative to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND.</span></span>  
  
 <span data-ttu-id="ac8b2-142">与之相关的 HWND 概念是每个 HWND 内及其之间的透明度。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-142">A related concept to HWND is transparency within and between each HWND.</span></span> <span data-ttu-id="ac8b2-143">[技术区概述](technology-regions-overview.md)主题中对此也有相关介绍。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-143">This is also discussed in the topic [Technology Regions Overview](technology-regions-overview.md).</span></span>  
  
<a name="hosting_a_wpf_page"></a>   
## <a name="hosting-wpf-content-in-a-microsoft-win32-window"></a><span data-ttu-id="ac8b2-144">在 Microsoft Win32 窗口中承载 WPF 内容</span><span class="sxs-lookup"><span data-stu-id="ac8b2-144">Hosting WPF Content in a Microsoft Win32 Window</span></span>  
 <span data-ttu-id="ac8b2-145">托管的关键[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]上[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]窗口是<xref:System.Windows.Interop.HwndSource>类。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-145">The key to hosting a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="ac8b2-146">此类在 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 窗口中包装 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容，以便 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容可作为子窗口并入 [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-146">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, so that the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content can be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="ac8b2-147">以下方法在单个应用程序中合并 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 和 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-147">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1. <span data-ttu-id="ac8b2-148">将 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容（内容根元素）作为托管类实现。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-148">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (the content root element) as a managed class.</span></span> <span data-ttu-id="ac8b2-149">通常情况下，该类继承的一个类可以包含多个子元素和/或使用作为根元素，如<xref:System.Windows.Controls.DockPanel>或<xref:System.Windows.Controls.Page>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-149">Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <xref:System.Windows.Controls.DockPanel> or <xref:System.Windows.Controls.Page>.</span></span> <span data-ttu-id="ac8b2-150">后续步骤中，此类被称为 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容类，此类的实例被称为 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容对象。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-150">In subsequent steps, this class is referred to as the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class, and instances of the class are referred to as [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content objects.</span></span>  
  
2. <span data-ttu-id="ac8b2-151">使用 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 实现 [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)] 应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-151">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)].</span></span> <span data-ttu-id="ac8b2-152">若要以现有非托管 [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 应用程序开始，可更改项目设置将 `/clr` 编译器标志包括在内，以此来允许应用程序调用托管代码（本主题中未介绍支持 `/clr` 编译可能所需内容的完整范围）。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-152">If you are starting with an existing unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] application, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag (the full scope of what might be necessary to support `/clr` compilation is not described in this topic).</span></span>  
  
3. <span data-ttu-id="ac8b2-153">将线程处理模型设置为单线程单元 (STA)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-153">Set the threading model to Single Threaded Apartment (STA).</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="ac8b2-154">使用此线程模型。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-154">uses this threading model.</span></span>  
  
4. <span data-ttu-id="ac8b2-155">处理窗口过程中的 WM_CREATE 通知。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-155">Handle the WM_CREATE notification in your window procedure.</span></span>  
  
5. <span data-ttu-id="ac8b2-156">在处理程序（或处理程序调用的函数）中，执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="ac8b2-156">Within the handler (or a function that the handler calls), do the following:</span></span>  
  
    1. <span data-ttu-id="ac8b2-157">创建一个新<xref:System.Windows.Interop.HwndSource>对象，将父窗口 HWND 作为其`parent`参数。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-157">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window HWND as its `parent` parameter.</span></span>  
  
    2. <span data-ttu-id="ac8b2-158">创建 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容类的一个实例。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-158">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3. <span data-ttu-id="ac8b2-159">将分配到的引用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容对象<xref:System.Windows.Interop.HwndSource>对象<xref:System.Windows.Interop.HwndSource.RootVisual%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-159">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property.</span></span>  
  
    4. <span data-ttu-id="ac8b2-160"><xref:System.Windows.Interop.HwndSource>对象<xref:System.Windows.Interop.HwndSource.Handle%2A>属性包含窗口句柄 (HWND)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-160">The <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.Handle%2A> property contains the window handle (HWND).</span></span> <span data-ttu-id="ac8b2-161">要获取可在应用程序的非托管部分中使用的 HWND，需将 `Handle.ToPointer()` 强制装换为 HWND。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-161">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
6. <span data-ttu-id="ac8b2-162">实现一个托管类，该类包含一个用于保存对 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容对象的引用的静态字段。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-162">Implement a managed class that contains a static field that holds a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="ac8b2-163">此类可以获取对引用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容对象从你[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]的代码，但重要的是，它会阻止的详细信息在<xref:System.Windows.Interop.HwndSource>无意中进行垃圾回收。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-163">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code, but more importantly it prevents your <xref:System.Windows.Interop.HwndSource> from being inadvertently garbage collected.</span></span>  
  
7. <span data-ttu-id="ac8b2-164">通过将处理程序附加到一个或多个 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容对象事件，接收 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容对象的通知。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-164">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object events.</span></span>  
  
8. <span data-ttu-id="ac8b2-165">通过使用存储在静态字段中的引用设置属性、调用方法等，与 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容对象进行通信。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-165">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by using the reference that you stored in the static field to set properties, call methods, etc.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ac8b2-166">如果生成一个单独的程序集然后对其进行引用，对于步骤 1，可使用内容类的默认分部类在 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 中完成部分或全部 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容类定义。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-166">You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it.</span></span> <span data-ttu-id="ac8b2-167">虽然通常包括<xref:System.Windows.Application>对象作为编译的一部分[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]程序集，您不的最终使用该<xref:System.Windows.Application>作为互操作的一部分，您只需使用一个或多个用于根类[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]文件引用为应用程序和引用其分部类。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-167">Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes.</span></span> <span data-ttu-id="ac8b2-168">该过程的其余部分基本与上述相似。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-168">The remainder of the procedure is essentially similar to that outlined above.</span></span>  
>   
>  <span data-ttu-id="ac8b2-169">每个步骤执行本主题中的代码所示[演练：Win32 中承载 WPF 内容](walkthrough-hosting-wpf-content-in-win32.md)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-169">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md).</span></span>  
  
<a name="hosting_an_hwnd"></a>   
## <a name="hosting-a-microsoft-win32-window-in-wpf"></a><span data-ttu-id="ac8b2-170">在 WPF 中承载 Microsoft Win32 窗口</span><span class="sxs-lookup"><span data-stu-id="ac8b2-170">Hosting a Microsoft Win32 Window in WPF</span></span>  
 <span data-ttu-id="ac8b2-171">托管的关键[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]内其他窗口[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容是<xref:System.Windows.Interop.HwndHost>类。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-171">The key to hosting a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window within other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is the <xref:System.Windows.Interop.HwndHost> class.</span></span> <span data-ttu-id="ac8b2-172">该类在可添加到 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 元素树的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 元素中包装窗口。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-172">This class wraps the window in a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element which can be added to a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element tree.</span></span> <span data-ttu-id="ac8b2-173"><xref:System.Windows.Interop.HwndHost> 此外支持[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]，让你执行进程所承载的窗口消息之类的任务。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-173"><xref:System.Windows.Interop.HwndHost> also supports [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that allow you to do such tasks as process messages for the hosted window.</span></span> <span data-ttu-id="ac8b2-174">基本过程：</span><span class="sxs-lookup"><span data-stu-id="ac8b2-174">The basic procedure is:</span></span>  
  
1. <span data-ttu-id="ac8b2-175">为 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 应用程序创建一个元素树（可通过代码或标记）。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-175">Create an element tree for a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application (can be through code or markup).</span></span> <span data-ttu-id="ac8b2-176">在元素树中查找相应的许可点其中<xref:System.Windows.Interop.HwndHost>实现可添加为子元素。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-176">Find an appropriate and permissible point in the element tree where the <xref:System.Windows.Interop.HwndHost> implementation can be added as a child element.</span></span> <span data-ttu-id="ac8b2-177">剩余步骤中，此元素称为保留元素。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-177">In the remainder of these steps, this element is referred to as the reserving element.</span></span>  
  
2. <span data-ttu-id="ac8b2-178">派生自<xref:System.Windows.Interop.HwndHost>若要创建一个对象，保存你[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]内容。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-178">Derive from <xref:System.Windows.Interop.HwndHost> to create an object that holds your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
3. <span data-ttu-id="ac8b2-179">在此主机类，重写<xref:System.Windows.Interop.HwndHost>方法<xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-179">In that host class, override the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>.</span></span> <span data-ttu-id="ac8b2-180">返回承载窗口的 HWND。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-180">Return the HWND of the hosted window.</span></span> <span data-ttu-id="ac8b2-181">可能需要将实际控件包装为返回窗口的子窗口；在承载窗口中包装控件为 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容从控件接收通知提供了一种简单的方式。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-181">You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to receive notifications from the controls.</span></span> <span data-ttu-id="ac8b2-182">此方法有助于更正一些有关主机控件边界处消息处理的 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 问题。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-182">This technique helps correct for some [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] issues regarding message handling at the hosted control boundary.</span></span>  
  
4. <span data-ttu-id="ac8b2-183">重写<xref:System.Windows.Interop.HwndHost>方法<xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A>和<xref:System.Windows.Interop.HwndHost.WndProc%2A>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-183">Override the <xref:System.Windows.Interop.HwndHost> methods <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> and <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span> <span data-ttu-id="ac8b2-184">这样做的目的是处理清除和删除对承载内容的引用，尤其是在已创建对非托管对象的引用的情况下。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-184">The intention here is to process cleanup and remove references to the hosted content, particularly if you created references to unmanaged objects.</span></span>  
  
5. <span data-ttu-id="ac8b2-185">在代码隐藏文件中，创建控件承载类的一个实例，并使其成为保留元素的子元素。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-185">In your code-behind file, create an instance of the control hosting class and make it a child of the reserving element.</span></span> <span data-ttu-id="ac8b2-186">通常会使用事件处理程序如<xref:System.Windows.FrameworkElement.Loaded>，或使用分部类构造函数。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-186">Typically you would use an event handler such as <xref:System.Windows.FrameworkElement.Loaded>, or use the partial class constructor.</span></span> <span data-ttu-id="ac8b2-187">但也可通过运行时行为添加互操作内容。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-187">But you could also add the interoperation content through a runtime behavior.</span></span>  
  
6. <span data-ttu-id="ac8b2-188">处理选择的窗口消息，例如控件通知。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-188">Process selected window messages, such as control notifications.</span></span> <span data-ttu-id="ac8b2-189">方法有两种。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-189">There are two approaches.</span></span> <span data-ttu-id="ac8b2-190">两种方法提供对消息流的相同访问权限，因此你的选择很大程度上取决于编程简便性。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-190">Both provide identical access to the message stream, so your choice is largely a matter of programming convenience.</span></span>  
  
    - <span data-ttu-id="ac8b2-191">实现消息处理的所有消息 （而不仅仅是关闭消息） 中的重写<xref:System.Windows.Interop.HwndHost>方法<xref:System.Windows.Interop.HwndHost.WndProc%2A>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-191">Implement message processing for all messages (not just shutdown messages) in your override of the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
    - <span data-ttu-id="ac8b2-192">使承载[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]元素处理的消息，处理<xref:System.Windows.Interop.HwndHost.MessageHook>事件。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-192">Have the hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element process the messages by handling the <xref:System.Windows.Interop.HwndHost.MessageHook> event.</span></span> <span data-ttu-id="ac8b2-193">对发送到承载窗口的主窗口过程的每个消息都会引发该事件。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-193">This event is raised for every message that is sent to the main window procedure of the hosted window.</span></span>  
  
    - <span data-ttu-id="ac8b2-194">无法处理超出进程使用的 windows 中的消息<xref:System.Windows.Interop.HwndHost.WndProc%2A>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-194">You cannot process messages from windows that are out of process using <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
7. <span data-ttu-id="ac8b2-195">通过使用平台调用来调用非托管 `SendMessage` 函数，与承载窗口通信。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-195">Communicate with the hosted window by using platform invoke to call the unmanaged `SendMessage` function.</span></span>  
  
 <span data-ttu-id="ac8b2-196">按照这些步骤，创建一个处理鼠标输入的应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-196">Following these steps creates an application that works with mouse input.</span></span> <span data-ttu-id="ac8b2-197">可以通过实现为承载窗口添加 tab 键支持<xref:System.Windows.Interop.IKeyboardInputSink>接口。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-197">You can add tabbing support for your hosted window by implementing the <xref:System.Windows.Interop.IKeyboardInputSink> interface.</span></span>  
  
 <span data-ttu-id="ac8b2-198">每个步骤执行本主题中的代码所示[演练：中承载 Win32 控件在 WPF 中的](walkthrough-hosting-a-win32-control-in-wpf.md)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-198">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
### <a name="hwnds-inside-wpf"></a><span data-ttu-id="ac8b2-199">WPF 内部的 Hwnd</span><span class="sxs-lookup"><span data-stu-id="ac8b2-199">Hwnds Inside WPF</span></span>  
 <span data-ttu-id="ac8b2-200">您可以将<xref:System.Windows.Interop.HwndHost>视为一个特殊控件。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-200">You can think of <xref:System.Windows.Interop.HwndHost> as a special control.</span></span> <span data-ttu-id="ac8b2-201">(从技术上讲，<xref:System.Windows.Interop.HwndHost>是<xref:System.Windows.FrameworkElement>派生的类，不<xref:System.Windows.Controls.Control>派生的类，但它可被视为用于互操作的目的的控件。)<xref:System.Windows.Interop.HwndHost>抽象化基础[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]性质所承载的内容以便的其余部分[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]考虑所承载的内容是另一个类似于控件的对象，其中应呈现和处理输入。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-201">(Technically, <xref:System.Windows.Interop.HwndHost> is a <xref:System.Windows.FrameworkElement> derived class, not a <xref:System.Windows.Controls.Control> derived class, but it can be considered a control for purposes of interoperation.) <xref:System.Windows.Interop.HwndHost> abstracts the underlying [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] nature of the hosted content such that the remainder of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] considers the hosted content to be another control-like object, which should render and process input.</span></span> <span data-ttu-id="ac8b2-202"><xref:System.Windows.Interop.HwndHost> 行为通常类似于任何其他[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>，尽管有一些重要差异围绕输出 （绘图和图形） 和基于基础 Hwnd 的限制的输入 （鼠标和键盘） 可以支持。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-202"><xref:System.Windows.Interop.HwndHost> generally behaves like any other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support.</span></span>  
  
#### <a name="notable-differences-in-output-behavior"></a><span data-ttu-id="ac8b2-203">输出行为的显著差异</span><span class="sxs-lookup"><span data-stu-id="ac8b2-203">Notable Differences in Output Behavior</span></span>  
  
- <span data-ttu-id="ac8b2-204"><xref:System.Windows.FrameworkElement>它是<xref:System.Windows.Interop.HwndHost>基类、 具有很多属性，表示对 UI 的更改。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-204"><xref:System.Windows.FrameworkElement>, which is the <xref:System.Windows.Interop.HwndHost> base class, has quite a few properties that imply changes to the UI.</span></span> <span data-ttu-id="ac8b2-205">这些包括属性如下所述<xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>，这将更改该元素作为父级内的元素的布局。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-205">These include properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, which changes the layout of elements within that element as a parent.</span></span> <span data-ttu-id="ac8b2-206">但是，这些属性大多数未映射到可能的 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 等效项（即使这类等效项可能存在）。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-206">However, most of these properties are not mapped to possible [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] equivalents, even if such equivalents might exist.</span></span> <span data-ttu-id="ac8b2-207">过多这些属性及其含义具有过高的绘制技术针对性，这使得映射并不可行。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-207">Too many of these properties and their meanings are too rendering-technology specific for mappings to be practical.</span></span> <span data-ttu-id="ac8b2-208">因此，如设置属性<xref:System.Windows.FrameworkElement.FlowDirection%2A>上<xref:System.Windows.Interop.HwndHost>不起作用。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-208">Therefore, setting properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A> on <xref:System.Windows.Interop.HwndHost> has no effect.</span></span>  
  
- <span data-ttu-id="ac8b2-209"><xref:System.Windows.Interop.HwndHost> 不能旋转、 缩放、 倾斜，或其他受 Transform 影响。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-209"><xref:System.Windows.Interop.HwndHost> cannot be rotated, scaled, skewed, or otherwise affected by a Transform.</span></span>  
  
- <span data-ttu-id="ac8b2-210"><xref:System.Windows.Interop.HwndHost> 不支持<xref:System.Windows.UIElement.Opacity%2A>属性 （alpha 值混合处理）。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-210"><xref:System.Windows.Interop.HwndHost> does not support the <xref:System.Windows.UIElement.Opacity%2A> property (alpha blending).</span></span> <span data-ttu-id="ac8b2-211">如果中的内容<xref:System.Windows.Interop.HwndHost>执行<xref:System.Drawing>操作包含 alpha 信息，本身不是冲突，但<xref:System.Windows.Interop.HwndHost>作为一个整体仅支持不透明度 = 1.0 （100%)。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-211">If content inside the <xref:System.Windows.Interop.HwndHost> performs <xref:System.Drawing> operations that include alpha information, that is itself not a violation, but the <xref:System.Windows.Interop.HwndHost> as a whole only supports Opacity = 1.0 (100%).</span></span>  
  
- <span data-ttu-id="ac8b2-212"><xref:System.Windows.Interop.HwndHost> 将显示在其他之上[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]相同的顶级窗口中的元素。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-212"><xref:System.Windows.Interop.HwndHost> will appear on top of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements in the same top-level window.</span></span> <span data-ttu-id="ac8b2-213">但是，<xref:System.Windows.Controls.ToolTip>或<xref:System.Windows.Controls.ContextMenu>生成的菜单是一个单独的顶级窗口，并因此就能正常工作与<xref:System.Windows.Interop.HwndHost>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-213">However, a <xref:System.Windows.Controls.ToolTip> or <xref:System.Windows.Controls.ContextMenu> generated menu is a separate top-level window, and so will behave correctly with <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
- <span data-ttu-id="ac8b2-214"><xref:System.Windows.Interop.HwndHost> 不遵从其父级的剪辑区域<xref:System.Windows.UIElement>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-214"><xref:System.Windows.Interop.HwndHost> does not respect the clipping region of its parent <xref:System.Windows.UIElement>.</span></span> <span data-ttu-id="ac8b2-215">这可能是一个问题，如果你尝试将放<xref:System.Windows.Interop.HwndHost>滚动区域内的类或<xref:System.Windows.Controls.Canvas>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-215">This is potentially an issue if you attempt to put an <xref:System.Windows.Interop.HwndHost> class inside a scrolling region or <xref:System.Windows.Controls.Canvas>.</span></span>  
  
#### <a name="notable-differences-in-input-behavior"></a><span data-ttu-id="ac8b2-216">输入行为的显著差异</span><span class="sxs-lookup"><span data-stu-id="ac8b2-216">Notable Differences in Input Behavior</span></span>  
  
- <span data-ttu-id="ac8b2-217">通常，虽然输入的设备作用域内<xref:System.Windows.Interop.HwndHost>托管[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]区域中，输入的事件直接转到[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-217">In general, while input devices are scoped within the <xref:System.Windows.Interop.HwndHost> hosted [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, input events go directly to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span></span>  
  
- <span data-ttu-id="ac8b2-218">尽管鼠标位于<xref:System.Windows.Interop.HwndHost>，你的应用程序不会收到[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]鼠标事件和的值[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]属性<xref:System.Windows.UIElement.IsMouseOver%2A>将`false`。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-218">While the mouse is over the <xref:System.Windows.Interop.HwndHost>, your application does not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mouse events, and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsMouseOver%2A> will be `false`.</span></span>  
  
- <span data-ttu-id="ac8b2-219">虽然<xref:System.Windows.Interop.HwndHost>具有键盘焦点，你的应用程序将不会收到[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]键盘事件和的值[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]属性<xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A>将`false`。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-219">While the <xref:System.Windows.Interop.HwndHost> has keyboard focus, your application will not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard events and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> will be `false`.</span></span>  
  
- <span data-ttu-id="ac8b2-220">当焦点位于<xref:System.Windows.Interop.HwndHost>并更改到另一个控件内<xref:System.Windows.Interop.HwndHost>，你的应用程序将不会收到[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]事件<xref:System.Windows.UIElement.GotFocus>或<xref:System.Windows.UIElement.LostFocus>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-220">When focus is within the <xref:System.Windows.Interop.HwndHost> and changes to another control inside the <xref:System.Windows.Interop.HwndHost>, your application will not receive the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events <xref:System.Windows.UIElement.GotFocus> or <xref:System.Windows.UIElement.LostFocus>.</span></span>  
  
- <span data-ttu-id="ac8b2-221">相关触笔属性和事件相似，且并不报告信息，而在触笔位于<xref:System.Windows.Interop.HwndHost>。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-221">Related stylus properties and events are analogous, and do not report information while the stylus is over <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
<a name="tabbing_mnemonics_accelerators"></a>   
## <a name="tabbing-mnemonics-and-accelerators"></a><span data-ttu-id="ac8b2-222">Tab 键、助记键和加速键</span><span class="sxs-lookup"><span data-stu-id="ac8b2-222">Tabbing, Mnemonics, and Accelerators</span></span>  
 <span data-ttu-id="ac8b2-223"><xref:System.Windows.Interop.IKeyboardInputSink>并<xref:System.Windows.Interop.IKeyboardInputSite>接口允许你创建的无缝键盘体验，为混合[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]和[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]应用程序：</span><span class="sxs-lookup"><span data-stu-id="ac8b2-223">The <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces allow you to create a seamless keyboard experience for mixed [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications:</span></span>  
  
- <span data-ttu-id="ac8b2-224">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 和 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 组件之间的 Tab 键</span><span class="sxs-lookup"><span data-stu-id="ac8b2-224">Tabbing between [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] components</span></span>  
  
- <span data-ttu-id="ac8b2-225">焦点位于 Win32 组件内和 WPF 组件内时皆起作用的助记键和加速键。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-225">Mnemonics and accelerators that work both when focus is within a Win32 component and when it is within a WPF component.</span></span>  
  
 <span data-ttu-id="ac8b2-226"><xref:System.Windows.Interop.HwndHost>并<xref:System.Windows.Interop.HwndSource>这两个类提供的实现<xref:System.Windows.Interop.IKeyboardInputSink>，但它们不会处理更高级的方案所需的所有输入的消息。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-226">The <xref:System.Windows.Interop.HwndHost> and <xref:System.Windows.Interop.HwndSource> classes both provide implementations of <xref:System.Windows.Interop.IKeyboardInputSink>, but they may not handle all the input messages that you want for more advanced scenarios.</span></span> <span data-ttu-id="ac8b2-227">替换为适当方法，获取所需的键盘行为。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-227">Override the appropriate methods to get the keyboard behavior you want.</span></span>  
  
 <span data-ttu-id="ac8b2-228">接口仅对 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 和 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 区域间的转换过程中发生的事件提供支持。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-228">The interfaces only provide support for what happens on the transition between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] regions.</span></span> <span data-ttu-id="ac8b2-229">在 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 区域内，Tab 键行为完全受 Tab 键的 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 实现逻辑（若有）控制。</span><span class="sxs-lookup"><span data-stu-id="ac8b2-229">Within the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, tabbing behavior is entirely controlled by the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] implemented logic for tabbing, if any.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ac8b2-230">请参阅</span><span class="sxs-lookup"><span data-stu-id="ac8b2-230">See also</span></span>

- <xref:System.Windows.Interop.HwndHost>
- <xref:System.Windows.Interop.HwndSource>
- <xref:System.Windows.Interop>
- [<span data-ttu-id="ac8b2-231">演练：中承载 Win32 控件在 WPF 中</span><span class="sxs-lookup"><span data-stu-id="ac8b2-231">Walkthrough: Hosting a Win32 Control in WPF</span></span>](walkthrough-hosting-a-win32-control-in-wpf.md)
- [<span data-ttu-id="ac8b2-232">演练：Win32 中承载 WPF 内容</span><span class="sxs-lookup"><span data-stu-id="ac8b2-232">Walkthrough: Hosting WPF Content in Win32</span></span>](walkthrough-hosting-wpf-content-in-win32.md)
