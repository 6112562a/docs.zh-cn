---
title: 高级文本格式设置
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- formatting [WPF]
- text [WPF]
- typography [WPF], text formatting
ms.assetid: f0a7986e-f5b2-485c-a27d-f8e922022212
ms.openlocfilehash: 469c62691ff38a8c5a01bec3ddfd7b324bab7eca
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/22/2019
ms.locfileid: "69969070"
---
# <a name="advanced-text-formatting"></a><span data-ttu-id="aadcb-102">高级文本格式设置</span><span class="sxs-lookup"><span data-stu-id="aadcb-102">Advanced Text Formatting</span></span>
<span data-ttu-id="aadcb-103">Windows Presentation Foundation (WPF) 提供了一组可靠的 Api, 用于在应用程序中包含文本。</span><span class="sxs-lookup"><span data-stu-id="aadcb-103">The Windows Presentation Foundation (WPF) provides a robust set of APIs for including text in your application.</span></span> <span data-ttu-id="aadcb-104">布局和[!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]api ( <xref:System.Windows.Controls.TextBlock>例如) 提供了最常见的用于文本呈现的常用元素。</span><span class="sxs-lookup"><span data-stu-id="aadcb-104">Layout and [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]APIs, such as <xref:System.Windows.Controls.TextBlock>, provide the most common and general use elements for text presentation.</span></span> <span data-ttu-id="aadcb-105">绘图 api (例如<xref:System.Windows.Media.GlyphRunDrawing>和<xref:System.Windows.Media.FormattedText>) 提供了一种在绘图中包含格式化文本的方法。</span><span class="sxs-lookup"><span data-stu-id="aadcb-105">Drawing APIs, such as <xref:System.Windows.Media.GlyphRunDrawing> and <xref:System.Windows.Media.FormattedText>, provide a means for including formatted text in drawings.</span></span> <span data-ttu-id="aadcb-106">在最高级级别, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]提供了一个可扩展的文本格式引擎来控制文本显示的每个方面, 如文本存储管理、文本运行格式管理和嵌入的对象管理。</span><span class="sxs-lookup"><span data-stu-id="aadcb-106">At the most advanced level, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] provides an extensible text formatting engine to control every aspect of text presentation, such as text store management, text run formatting management, and embedded object management.</span></span>  
  
 <span data-ttu-id="aadcb-107">本主题介绍[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]文本格式设置。</span><span class="sxs-lookup"><span data-stu-id="aadcb-107">This topic provides an introduction to [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] text formatting.</span></span> <span data-ttu-id="aadcb-108">它侧重于客户端实现和[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]文本格式引擎使用。</span><span class="sxs-lookup"><span data-stu-id="aadcb-108">It focuses on client implementation and use of the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] text formatting engine.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="aadcb-109">此文档中的所有代码示例都可以在[高级文本格式设置示例](https://go.microsoft.com/fwlink/?LinkID=159965)中找到。</span><span class="sxs-lookup"><span data-stu-id="aadcb-109">All code examples within this document can be found in the [Advanced Text Formatting Sample](https://go.microsoft.com/fwlink/?LinkID=159965).</span></span>  

<a name="prereq"></a>   
## <a name="prerequisites"></a><span data-ttu-id="aadcb-110">系统必备</span><span class="sxs-lookup"><span data-stu-id="aadcb-110">Prerequisites</span></span>  
 <span data-ttu-id="aadcb-111">本主题假定您熟悉用于文本呈现的更高级 Api。</span><span class="sxs-lookup"><span data-stu-id="aadcb-111">This topic assumes that you are familiar with the higher level APIs used for text presentation.</span></span> <span data-ttu-id="aadcb-112">大多数用户方案都不需要本主题中讨论的高级文本格式设置 Api。</span><span class="sxs-lookup"><span data-stu-id="aadcb-112">Most user scenarios will not require the advanced text formatting APIs discussed in this topic.</span></span> <span data-ttu-id="aadcb-113">有关不同文本 Api 的介绍, 请参阅[WPF 中的文档](documents-in-wpf.md)。</span><span class="sxs-lookup"><span data-stu-id="aadcb-113">For an introduction to the different text APIs, see [Documents in WPF](documents-in-wpf.md).</span></span>  
  
<a name="section1"></a>   
## <a name="advanced-text-formatting"></a><span data-ttu-id="aadcb-114">高级文本格式设置</span><span class="sxs-lookup"><span data-stu-id="aadcb-114">Advanced Text Formatting</span></span>  
 <span data-ttu-id="aadcb-115">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 中[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]的文本布局和控件提供了格式设置属性, 使你可以轻松地在应用程序中包含格式化文本。</span><span class="sxs-lookup"><span data-stu-id="aadcb-115">The text layout and [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] controls in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] provide formatting properties that allow you to easily include formatted text in your application.</span></span> <span data-ttu-id="aadcb-116">这些控件会公开许多用于处理文本呈现（包括字样、大小和颜色）的属性。</span><span class="sxs-lookup"><span data-stu-id="aadcb-116">These controls expose a number of properties to handle the presentation of text, which includes its typeface, size, and color.</span></span> <span data-ttu-id="aadcb-117">一般情况下，这些控件可以处理应用程序中的大部分文本呈现。</span><span class="sxs-lookup"><span data-stu-id="aadcb-117">Under ordinary circumstances, these controls can handle the majority of text presentation in your application.</span></span> <span data-ttu-id="aadcb-118">但是，某些高级方案要求控制文本存储和文本呈现。</span><span class="sxs-lookup"><span data-stu-id="aadcb-118">However, some advanced scenarios require the control of text storage as well as text presentation.</span></span> <span data-ttu-id="aadcb-119">为此，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 提供了一个可扩展的文本格式引擎。</span><span class="sxs-lookup"><span data-stu-id="aadcb-119">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] provides an extensible text formatting engine for this purpose.</span></span>  
  
 <span data-ttu-id="aadcb-120">中[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]找到的高级文本格式设置功能包括文本格式引擎、文本存储、文本运行和格式设置属性。</span><span class="sxs-lookup"><span data-stu-id="aadcb-120">The advanced text formatting features found in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] consist of a text formatting engine, a text store, text runs, and formatting properties.</span></span> <span data-ttu-id="aadcb-121">文本格式引擎<xref:System.Windows.Media.TextFormatting.TextFormatter>用于创建要用于显示的文本行。</span><span class="sxs-lookup"><span data-stu-id="aadcb-121">The text formatting engine, <xref:System.Windows.Media.TextFormatting.TextFormatter>, creates lines of text to be used for presentation.</span></span> <span data-ttu-id="aadcb-122">这是通过启动行格式设置进程并调用文本格式化程序的<xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A>来实现的。</span><span class="sxs-lookup"><span data-stu-id="aadcb-122">This is achieved by initiating the line formatting process and calling the text formatter's <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A>.</span></span> <span data-ttu-id="aadcb-123">文本格式化程序通过调用商店的<xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A>方法从文本存储中检索文本运行。</span><span class="sxs-lookup"><span data-stu-id="aadcb-123">The text formatter retrieves text runs from your text store by calling the store's <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> method.</span></span> <span data-ttu-id="aadcb-124">然后, 文本格式化程序将<xref:System.Windows.Media.TextFormatting.TextLine> 对象组成对象,并将其提供给应用程序进行检查或显示。<xref:System.Windows.Media.TextFormatting.TextRun></span><span class="sxs-lookup"><span data-stu-id="aadcb-124">The <xref:System.Windows.Media.TextFormatting.TextRun> objects are then formed into <xref:System.Windows.Media.TextFormatting.TextLine> objects by the text formatter and given to your application for inspection or display.</span></span>  
  
<a name="section2"></a>   
## <a name="using-the-text-formatter"></a><span data-ttu-id="aadcb-125">使用文本格式化程序</span><span class="sxs-lookup"><span data-stu-id="aadcb-125">Using the Text Formatter</span></span>  
 <span data-ttu-id="aadcb-126"><xref:System.Windows.Media.TextFormatting.TextFormatter>[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]是文本格式引擎, 并提供用于设置格式和断开文本线条的服务。</span><span class="sxs-lookup"><span data-stu-id="aadcb-126"><xref:System.Windows.Media.TextFormatting.TextFormatter> is the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] text formatting engine and provides services for formatting and breaking text lines.</span></span> <span data-ttu-id="aadcb-127">文本格式化程序可处理各种文本字符格式和段落样式，并提供对国际文本布局的支持。</span><span class="sxs-lookup"><span data-stu-id="aadcb-127">The text formatter can handle different text character formats and paragraph styles, and includes support for international text layout.</span></span>  
  
 <span data-ttu-id="aadcb-128">与传统的文本 API 不同, <xref:System.Windows.Media.TextFormatting.TextFormatter>通过一组回调方法与文本布局客户端进行交互。</span><span class="sxs-lookup"><span data-stu-id="aadcb-128">Unlike a traditional text API, the <xref:System.Windows.Media.TextFormatting.TextFormatter> interacts with a text layout client through a set of callback methods.</span></span> <span data-ttu-id="aadcb-129">它要求客户端在<xref:System.Windows.Media.TextFormatting.TextSource>类的实现中提供这些方法。</span><span class="sxs-lookup"><span data-stu-id="aadcb-129">It requires the client to provide these methods in an implementation of the <xref:System.Windows.Media.TextFormatting.TextSource> class.</span></span> <span data-ttu-id="aadcb-130">下图说明了客户端应用程序和<xref:System.Windows.Media.TextFormatting.TextFormatter>之间的文本布局交互。</span><span class="sxs-lookup"><span data-stu-id="aadcb-130">The following diagram illustrates the text layout interaction between the client application and <xref:System.Windows.Media.TextFormatting.TextFormatter>.</span></span>  
  
 ![文本布局客户端和 TextFormatter 示意图](./media/advanced-text-formatting/text-layout-textformatter-interaction.png)  
  
 <span data-ttu-id="aadcb-132">文本格式化程序用于从文本存储中检索格式化文本行, 这是的<xref:System.Windows.Media.TextFormatting.TextSource>实现。</span><span class="sxs-lookup"><span data-stu-id="aadcb-132">The text formatter is used to retrieve formatted text lines from the text store, which is an implementation of <xref:System.Windows.Media.TextFormatting.TextSource>.</span></span> <span data-ttu-id="aadcb-133">这是通过使用<xref:System.Windows.Media.TextFormatting.TextFormatter.Create%2A>方法首先创建文本格式化程序的实例来完成的。</span><span class="sxs-lookup"><span data-stu-id="aadcb-133">This is done by first creating an instance of the text formatter by using the <xref:System.Windows.Media.TextFormatting.TextFormatter.Create%2A> method.</span></span> <span data-ttu-id="aadcb-134">此方法可创建一个文本格式化程序实例，并设置最大行高值和行宽值。</span><span class="sxs-lookup"><span data-stu-id="aadcb-134">This method creates an instance of the text formatter and sets the maximum line height and width values.</span></span> <span data-ttu-id="aadcb-135">一旦创建了文本格式化程序实例, 就会通过调用<xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A>方法来启动行创建进程。</span><span class="sxs-lookup"><span data-stu-id="aadcb-135">As soon as an instance of the text formatter is created, the line creation process is started by calling the <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> method.</span></span> <span data-ttu-id="aadcb-136"><xref:System.Windows.Media.TextFormatting.TextFormatter>回调到文本源, 以检索构成线条的文本运行的文本和格式参数。</span><span class="sxs-lookup"><span data-stu-id="aadcb-136"><xref:System.Windows.Media.TextFormatting.TextFormatter> calls back to the text source to retrieve the text and formatting parameters for the runs of text that form a line.</span></span>  
  
 <span data-ttu-id="aadcb-137">下例演示文本存储的格式设置过程。</span><span class="sxs-lookup"><span data-stu-id="aadcb-137">In the following example, the process of formatting a text store is shown.</span></span> <span data-ttu-id="aadcb-138">对象用于从文本存储中检索文本行, 然后将绘制<xref:System.Windows.Media.DrawingContext>的文本行的格式设置为。 <xref:System.Windows.Media.TextFormatting.TextFormatter></span><span class="sxs-lookup"><span data-stu-id="aadcb-138">The <xref:System.Windows.Media.TextFormatting.TextFormatter> object is used to retrieve text lines from the text store and then format the text line for drawing into the <xref:System.Windows.Media.DrawingContext>.</span></span>  
  
 [!code-csharp[TextFormatterExample#100](~/samples/snippets/csharp/VS_Snippets_Wpf/TextFormatterExample/CSharp/Window1.xaml.cs#100)]
 [!code-vb[TextFormatterExample#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/TextFormatterExample/VisualBasic/Window1.xaml.vb#100)]  
  
<a name="section3"></a>   
## <a name="implementing-the-client-text-store"></a><span data-ttu-id="aadcb-139">实现客户端文本存储</span><span class="sxs-lookup"><span data-stu-id="aadcb-139">Implementing the Client Text Store</span></span>  
 <span data-ttu-id="aadcb-140">扩展文本格式引擎时，需要实现和管理文本存储的各个方面。</span><span class="sxs-lookup"><span data-stu-id="aadcb-140">When you extend the text formatting engine, you are required to implement and manage all aspects of the text store.</span></span> <span data-ttu-id="aadcb-141">该任务不是无关紧要的。</span><span class="sxs-lookup"><span data-stu-id="aadcb-141">This is not a trivial task.</span></span> <span data-ttu-id="aadcb-142">文本存储负责跟踪文本运行属性、段落属性、嵌入对象和其他类似内容。</span><span class="sxs-lookup"><span data-stu-id="aadcb-142">The text store is responsible for tracking text run properties, paragraph properties, embedded objects, and other similar content.</span></span> <span data-ttu-id="aadcb-143">它还为文本格式化程序提供了<xref:System.Windows.Media.TextFormatting.TextRun>文本格式化程序用来创建<xref:System.Windows.Media.TextFormatting.TextLine>对象的单个对象。</span><span class="sxs-lookup"><span data-stu-id="aadcb-143">It also provides the text formatter with individual <xref:System.Windows.Media.TextFormatting.TextRun> objects which the text formatter uses to create <xref:System.Windows.Media.TextFormatting.TextLine> objects.</span></span>  
  
 <span data-ttu-id="aadcb-144">若要处理文本存储的虚拟化, 文本存储必须派生自<xref:System.Windows.Media.TextFormatting.TextSource>。</span><span class="sxs-lookup"><span data-stu-id="aadcb-144">To handle the virtualization of the text store, the text store must be derived from <xref:System.Windows.Media.TextFormatting.TextSource>.</span></span> <span data-ttu-id="aadcb-145"><xref:System.Windows.Media.TextFormatting.TextSource>定义文本格式化程序用来从文本存储中检索文本运行的方法。</span><span class="sxs-lookup"><span data-stu-id="aadcb-145"><xref:System.Windows.Media.TextFormatting.TextSource> defines the method the text formatter uses to retrieve text runs from the text store.</span></span> <span data-ttu-id="aadcb-146"><xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A>文本格式化程序用来检索在行格式设置中使用的文本运行的方法。</span><span class="sxs-lookup"><span data-stu-id="aadcb-146"><xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> is the method used by the text formatter to retrieve text runs used in line formatting.</span></span> <span data-ttu-id="aadcb-147">在发生以下<xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A>情况之一之前, 对的调用是由文本格式化程序重复执行的:</span><span class="sxs-lookup"><span data-stu-id="aadcb-147">The call to <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> is repeatedly made by the text formatter until one of the following conditions occurs:</span></span>  
  
- <span data-ttu-id="aadcb-148">返回<xref:System.Windows.Media.TextFormatting.TextEndOfLine>一个或子类。</span><span class="sxs-lookup"><span data-stu-id="aadcb-148">A <xref:System.Windows.Media.TextFormatting.TextEndOfLine> or a subclass is returned.</span></span>  
  
- <span data-ttu-id="aadcb-149">文本运行的累积宽度超出了在创建文本格式化程序的调用中指定的最大线条宽度或对文本格式化程序的<xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A>方法的调用。</span><span class="sxs-lookup"><span data-stu-id="aadcb-149">The accumulated width of text runs exceeds the maximum line width specified in either the call to create the text formatter or the call to the text formatter's <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> method.</span></span>  
  
- <span data-ttu-id="aadcb-150">返回[!INCLUDE[TLA#tla_unicode](../../../../includes/tlasharptla-unicode-md.md)]一个换行符序列, 如 "CF"、"LF" 或 "CRLF"。</span><span class="sxs-lookup"><span data-stu-id="aadcb-150">A [!INCLUDE[TLA#tla_unicode](../../../../includes/tlasharptla-unicode-md.md)] newline sequence, such as "CF", "LF", or "CRLF", is returned.</span></span>  
  
<a name="section4"></a>   
## <a name="providing-text-runs"></a><span data-ttu-id="aadcb-151">提供文本运行</span><span class="sxs-lookup"><span data-stu-id="aadcb-151">Providing Text Runs</span></span>  
 <span data-ttu-id="aadcb-152">文本格式设置过程的核心是文本格式化程序和文本存储之间的交互。</span><span class="sxs-lookup"><span data-stu-id="aadcb-152">The core of the text formatting process is the interaction between the text formatter and the text store.</span></span> <span data-ttu-id="aadcb-153">的<xref:System.Windows.Media.TextFormatting.TextSource>实现为文本格式化程序<xref:System.Windows.Media.TextFormatting.TextRun>提供了用于设置文本运行格式的对象和属性。</span><span class="sxs-lookup"><span data-stu-id="aadcb-153">Your implementation of <xref:System.Windows.Media.TextFormatting.TextSource> provides the text formatter with the <xref:System.Windows.Media.TextFormatting.TextRun> objects and the properties with which to format the text runs.</span></span> <span data-ttu-id="aadcb-154">此交互由<xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A>文本格式化程序调用的方法进行处理。</span><span class="sxs-lookup"><span data-stu-id="aadcb-154">This interaction is handled by the <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> method, which is called by the text formatter.</span></span>  
  
 <span data-ttu-id="aadcb-155">下表显示了一些预定义<xref:System.Windows.Media.TextFormatting.TextRun>的对象。</span><span class="sxs-lookup"><span data-stu-id="aadcb-155">The following table shows some of the predefined <xref:System.Windows.Media.TextFormatting.TextRun> objects.</span></span>  
  
|<span data-ttu-id="aadcb-156">TextRun 类型</span><span class="sxs-lookup"><span data-stu-id="aadcb-156">TextRun Type</span></span>|<span data-ttu-id="aadcb-157">用法</span><span class="sxs-lookup"><span data-stu-id="aadcb-157">Usage</span></span>|  
|------------------|-----------|  
|<xref:System.Windows.Media.TextFormatting.TextCharacters>|<span data-ttu-id="aadcb-158">专用文本运行，用于将字符标志符号的表示形式传回给文本格式化程序。</span><span class="sxs-lookup"><span data-stu-id="aadcb-158">The specialized text run used to pass a representation of character glyphs back to the text formatter.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEmbeddedObject>|<span data-ttu-id="aadcb-159">专用文本运行，用于提供其中的度量、命中测试和绘制将作为整体执行的内容，例如文本中的按钮或图像。</span><span class="sxs-lookup"><span data-stu-id="aadcb-159">The specialized text run used to provide content in which measuring, hit testing, and drawing is done in whole, such as a button or image within the text.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEndOfLine>|<span data-ttu-id="aadcb-160">专用文本运行，用于对行尾进行标记。</span><span class="sxs-lookup"><span data-stu-id="aadcb-160">The specialized text run used to mark the end of a line.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEndOfParagraph>|<span data-ttu-id="aadcb-161">专用文本运行，用于对段落结尾进行标记。</span><span class="sxs-lookup"><span data-stu-id="aadcb-161">The specialized text run used to mark the end of a paragraph.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEndOfSegment>|<span data-ttu-id="aadcb-162">专用文本运行, 用于标记段的结束, 如结束之前<xref:System.Windows.Media.TextFormatting.TextModifier>运行的影响的范围。</span><span class="sxs-lookup"><span data-stu-id="aadcb-162">The specialized text run used to mark the end of a segment, such as to end the scope affected by a previous <xref:System.Windows.Media.TextFormatting.TextModifier> run.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextHidden>|<span data-ttu-id="aadcb-163">专用文本运行，用于对一系列隐藏字符进行标记。</span><span class="sxs-lookup"><span data-stu-id="aadcb-163">The specialized text run used to mark a range of hidden characters.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextModifier>|<span data-ttu-id="aadcb-164">专用文本运行，用于在其范围内修改文本运行属性。</span><span class="sxs-lookup"><span data-stu-id="aadcb-164">The specialized text run used to modify properties of text runs in its scope.</span></span> <span data-ttu-id="aadcb-165">范围将扩展到下一个匹配<xref:System.Windows.Media.TextFormatting.TextEndOfSegment>的文本运行或下一个<xref:System.Windows.Media.TextFormatting.TextEndOfParagraph>匹配的文本运行。</span><span class="sxs-lookup"><span data-stu-id="aadcb-165">The scope extends to the next matching <xref:System.Windows.Media.TextFormatting.TextEndOfSegment> text run, or the next <xref:System.Windows.Media.TextFormatting.TextEndOfParagraph>.</span></span>|  
  
 <span data-ttu-id="aadcb-166">任何预定义<xref:System.Windows.Media.TextFormatting.TextRun>的对象都可以为子类。</span><span class="sxs-lookup"><span data-stu-id="aadcb-166">Any of the predefined <xref:System.Windows.Media.TextFormatting.TextRun> objects can be subclassed.</span></span> <span data-ttu-id="aadcb-167">这样，文本源便可为文本格式化程序提供包含自定义数据的文本运行。</span><span class="sxs-lookup"><span data-stu-id="aadcb-167">This allows your text source to provide the text formatter with text runs that include custom data.</span></span>  
  
 <span data-ttu-id="aadcb-168">下面的示例演示了<xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A>一个方法。</span><span class="sxs-lookup"><span data-stu-id="aadcb-168">The following example demonstrates a <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> method.</span></span> <span data-ttu-id="aadcb-169">此文本存储将<xref:System.Windows.Media.TextFormatting.TextRun>对象返回到文本格式化程序以进行处理。</span><span class="sxs-lookup"><span data-stu-id="aadcb-169">This text store returns <xref:System.Windows.Media.TextFormatting.TextRun> objects to the text formatter for processing.</span></span>  
  
 [!code-csharp[TextFormatterExample#101](~/samples/snippets/csharp/VS_Snippets_Wpf/TextFormatterExample/CSharp/CustomTextSource.cs#101)]
 [!code-vb[TextFormatterExample#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/TextFormatterExample/VisualBasic/CustomTextSource.vb#101)]  
  
> [!NOTE]
> <span data-ttu-id="aadcb-170">在此示例中，文本存储为所有文本提供了相同的文本属性。</span><span class="sxs-lookup"><span data-stu-id="aadcb-170">In this example, the text store provides the same text properties to all of the text.</span></span> <span data-ttu-id="aadcb-171">高级文本存储需要实现各自的范围管理，以便单个字符具有不同的属性。</span><span class="sxs-lookup"><span data-stu-id="aadcb-171">Advanced text stores would need to implement their own span management to allow individual characters to have different properties.</span></span>  
  
<a name="section5"></a>   
## <a name="specifying-formatting-properties"></a><span data-ttu-id="aadcb-172">指定格式设置属性</span><span class="sxs-lookup"><span data-stu-id="aadcb-172">Specifying Formatting Properties</span></span>  
 <span data-ttu-id="aadcb-173"><xref:System.Windows.Media.TextFormatting.TextRun>使用文本存储提供的属性对对象进行格式设置。</span><span class="sxs-lookup"><span data-stu-id="aadcb-173"><xref:System.Windows.Media.TextFormatting.TextRun> objects are formatted by using properties provided by the text store.</span></span> <span data-ttu-id="aadcb-174">这些属性分为两种类型: <xref:System.Windows.Media.TextFormatting.TextParagraphProperties>和<xref:System.Windows.Media.TextFormatting.TextRunProperties>。</span><span class="sxs-lookup"><span data-stu-id="aadcb-174">These properties come in two types, <xref:System.Windows.Media.TextFormatting.TextParagraphProperties> and <xref:System.Windows.Media.TextFormatting.TextRunProperties>.</span></span> <span data-ttu-id="aadcb-175"><xref:System.Windows.Media.TextFormatting.TextParagraphProperties>处理段落非独占属性<xref:System.Windows.TextAlignment> , 例如和。 <xref:System.Windows.FlowDirection></span><span class="sxs-lookup"><span data-stu-id="aadcb-175"><xref:System.Windows.Media.TextFormatting.TextParagraphProperties> handle paragraph inclusive properties such as <xref:System.Windows.TextAlignment> and <xref:System.Windows.FlowDirection>.</span></span> <span data-ttu-id="aadcb-176"><xref:System.Windows.Media.TextFormatting.TextRunProperties>是在段落中运行的每个文本的属性, 例如前景画笔、 <xref:System.Windows.Media.Typeface>和字号。</span><span class="sxs-lookup"><span data-stu-id="aadcb-176"><xref:System.Windows.Media.TextFormatting.TextRunProperties> are properties that can be different for each text run within a paragraph, such as foreground brush, <xref:System.Windows.Media.Typeface>, and font size.</span></span> <span data-ttu-id="aadcb-177">若要实现自定义段落和自定义文本运行属性类型, 应用程序必须分别创建<xref:System.Windows.Media.TextFormatting.TextParagraphProperties>派生<xref:System.Windows.Media.TextFormatting.TextRunProperties>自和的类。</span><span class="sxs-lookup"><span data-stu-id="aadcb-177">To implement custom paragraph and custom text run property types, your application must create classes that derive from <xref:System.Windows.Media.TextFormatting.TextParagraphProperties> and <xref:System.Windows.Media.TextFormatting.TextRunProperties> respectively.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="aadcb-178">请参阅</span><span class="sxs-lookup"><span data-stu-id="aadcb-178">See also</span></span>

- [<span data-ttu-id="aadcb-179">WPF 中的版式</span><span class="sxs-lookup"><span data-stu-id="aadcb-179">Typography in WPF</span></span>](typography-in-wpf.md)
- [<span data-ttu-id="aadcb-180">WPF 中的文档</span><span class="sxs-lookup"><span data-stu-id="aadcb-180">Documents in WPF</span></span>](documents-in-wpf.md)
