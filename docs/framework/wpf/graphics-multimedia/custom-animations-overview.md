---
title: 自定义动画概述
ms.date: 03/30/2017
helpviewer_keywords:
- custom classes [WPF], animation
- key frames [WPF], custom
- custom key frames [WPF]
- animation [WPF], custom classes
- custom animation classes [WPF]
ms.assetid: 9be69d50-3384-4938-886f-08ce00e4a7a6
ms.openlocfilehash: 5a9ca51b87f73a24b90d0bd843ee306f8a1b970a
ms.sourcegitcommit: 700ea803fb06c5ce98de017c7f76463ba33ff4a9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/19/2020
ms.locfileid: "77453086"
---
# <a name="custom-animations-overview"></a><span data-ttu-id="d133b-102">自定义动画概述</span><span class="sxs-lookup"><span data-stu-id="d133b-102">Custom Animations Overview</span></span>
<span data-ttu-id="d133b-103">本主题介绍如何以及何时通过以下方法来扩展 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画系统：创建自定义关键帧、动画类或者使用每帧回叫来绕过它。</span><span class="sxs-lookup"><span data-stu-id="d133b-103">This topic describes how and when to extend the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation system by creating custom key frames, animation classes, or by using per-frame callback to bypass it.</span></span>  
  
<a name="prerequisites"></a>   
## <a name="prerequisites"></a><span data-ttu-id="d133b-104">先决条件</span><span class="sxs-lookup"><span data-stu-id="d133b-104">Prerequisites</span></span>  
 <span data-ttu-id="d133b-105">若要了解本主题，用户应当熟悉 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 提供的不同动画类型。</span><span class="sxs-lookup"><span data-stu-id="d133b-105">To understand this topic, you should be familiar with the different types of animations provided by the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span> <span data-ttu-id="d133b-106">有关详细信息，请参阅 From/To/By 动画概述、[关键帧动画概述](key-frame-animations-overview.md)和[路径动画概述](path-animations-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d133b-106">For more information, see the From/To/By Animations Overview, the [Key-Frame Animations Overview](key-frame-animations-overview.md), and the [Path Animations Overview](path-animations-overview.md).</span></span>  
  
 <span data-ttu-id="d133b-107">由于动画类从 <xref:System.Windows.Freezable> 类继承，因此您应该熟悉 <xref:System.Windows.Freezable> 对象以及如何从 <xref:System.Windows.Freezable>继承。</span><span class="sxs-lookup"><span data-stu-id="d133b-107">Because the animation classes inherit from the <xref:System.Windows.Freezable> class, you should be familiar with <xref:System.Windows.Freezable> objects and how to inherit from <xref:System.Windows.Freezable>.</span></span> <span data-ttu-id="d133b-108">有关详细信息，请参阅 [Freezable 对象概述](../advanced/freezable-objects-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d133b-108">For more information, see the [Freezable Objects Overview](../advanced/freezable-objects-overview.md).</span></span>  
  
<a name="extendingtheanimationsystem"></a>   
## <a name="extending-the-animation-system"></a><span data-ttu-id="d133b-109">扩展动画系统</span><span class="sxs-lookup"><span data-stu-id="d133b-109">Extending the Animation System</span></span>  
 <span data-ttu-id="d133b-110">扩展 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画系统有多种方法，具体取决于要使用的内置功能的级别。</span><span class="sxs-lookup"><span data-stu-id="d133b-110">There are a number of ways to extend the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation system, depending on the level of built-in functionality you want to use.</span></span>  <span data-ttu-id="d133b-111">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画引擎中有三个主要的扩展点：</span><span class="sxs-lookup"><span data-stu-id="d133b-111">There are three primary extensibility points in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation engine:</span></span>  
  
- <span data-ttu-id="d133b-112">通过从某个 *\<类型 >* 关键帧类（如 <xref:System.Windows.Media.Animation.DoubleKeyFrame>）继承来创建自定义关键帧对象。</span><span class="sxs-lookup"><span data-stu-id="d133b-112">Create a custom key frame object by inheriting from one of the *\<Type>* KeyFrame classes, such as <xref:System.Windows.Media.Animation.DoubleKeyFrame>.</span></span> <span data-ttu-id="d133b-113">此方法使用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画引擎的大部分内置功能。</span><span class="sxs-lookup"><span data-stu-id="d133b-113">This approach uses most of the built-in functionality of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation engine.</span></span>  
  
- <span data-ttu-id="d133b-114">通过从 <xref:System.Windows.Media.Animation.AnimationTimeline> 或 *\<类型 >* AnimationBase 类之一继承来创建自己的动画类。</span><span class="sxs-lookup"><span data-stu-id="d133b-114">Create your own animation class by inheriting from <xref:System.Windows.Media.Animation.AnimationTimeline> or one of the *\<Type>* AnimationBase classes.</span></span>  
  
- <span data-ttu-id="d133b-115">使用每帧回叫针对每个帧生成动画。</span><span class="sxs-lookup"><span data-stu-id="d133b-115">Use per-frame callback to generate animations on a per-frame basis.</span></span> <span data-ttu-id="d133b-116">此方法完全绕过动画和计时系统。</span><span class="sxs-lookup"><span data-stu-id="d133b-116">This approach completely bypasses the animation and timing system.</span></span>  
  
 <span data-ttu-id="d133b-117">下表介绍了扩展动画系统的一些方案。</span><span class="sxs-lookup"><span data-stu-id="d133b-117">The following table describes some the scenarios for extending the animation system.</span></span>  
  
|<span data-ttu-id="d133b-118">要执行此操作...</span><span class="sxs-lookup"><span data-stu-id="d133b-118">When you want to...</span></span>|<span data-ttu-id="d133b-119">使用此方法</span><span class="sxs-lookup"><span data-stu-id="d133b-119">Use this approach</span></span>|  
|-------------------------|-----------------------|  
|<span data-ttu-id="d133b-120">自定义具有对应 *\<Type>* AnimationUsingKeyFrames 的类型值之间的内插</span><span class="sxs-lookup"><span data-stu-id="d133b-120">Customize the interpolation between values of a type that has a corresponding *\<Type>* AnimationUsingKeyFrames</span></span>|<span data-ttu-id="d133b-121">创建自定义关键帧。</span><span class="sxs-lookup"><span data-stu-id="d133b-121">Create a custom key frame.</span></span> <span data-ttu-id="d133b-122">有关详细信息，请参阅[创建自定义关键帧](#createacustomkeyframe)部分。</span><span class="sxs-lookup"><span data-stu-id="d133b-122">For more information, see the [Create a Custom Key Frame](#createacustomkeyframe) section.</span></span>|  
|<span data-ttu-id="d133b-123">除了自定义具有对应 *\<Type>* Animation 的类型值之间的内插外，还要自定义其他内容。</span><span class="sxs-lookup"><span data-stu-id="d133b-123">Customize more than just the interpolation between values of a type that has a corresponding *\<Type>* Animation.</span></span>|<span data-ttu-id="d133b-124">创建自定义动画类，该类继承自对应于要进行动画处理的类型的 *\<Type>* AnimationBase 类。</span><span class="sxs-lookup"><span data-stu-id="d133b-124">Create a custom animation class that inherits from the *\<Type>* AnimationBase class that corresponds to the type you want to animate.</span></span> <span data-ttu-id="d133b-125">有关详细信息，请参阅[创建自定义动画类](#createacustomanimationtype)部分。</span><span class="sxs-lookup"><span data-stu-id="d133b-125">For more information, see the [Create a Custom Animation Class](#createacustomanimationtype) section.</span></span>|  
|<span data-ttu-id="d133b-126">对没有对应 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画的类型进行动画处理</span><span class="sxs-lookup"><span data-stu-id="d133b-126">Animate a type that has no corresponding [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation</span></span>|<span data-ttu-id="d133b-127">使用 <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames> 或创建从 <xref:System.Windows.Media.Animation.AnimationTimeline>继承的类。</span><span class="sxs-lookup"><span data-stu-id="d133b-127">Use an <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames> or create a class that inherits from <xref:System.Windows.Media.Animation.AnimationTimeline>.</span></span> <span data-ttu-id="d133b-128">有关详细信息，请参阅[创建自定义动画类](#createacustomanimationtype)部分。</span><span class="sxs-lookup"><span data-stu-id="d133b-128">For more information, see the [Create a Custom Animation Class](#createacustomanimationtype) section.</span></span>|  
|<span data-ttu-id="d133b-129">对多个对象进行动画处理，这些对象带有按每个帧进行计算并基于最后一组对象交互的值</span><span class="sxs-lookup"><span data-stu-id="d133b-129">Animate multiple objects with values that are computed each frame and are based on the last set of object interactions</span></span>|<span data-ttu-id="d133b-130">使用每帧回叫。</span><span class="sxs-lookup"><span data-stu-id="d133b-130">Use per-frame callback.</span></span> <span data-ttu-id="d133b-131">有关详细信息，请参阅[使用每帧回叫](#useperframecallback)部分。</span><span class="sxs-lookup"><span data-stu-id="d133b-131">For more information, see the [Create a Use Per-Frame Callback](#useperframecallback) section.</span></span>|  
  
<a name="createacustomkeyframe"></a>   
## <a name="create-a-custom-key-frame"></a><span data-ttu-id="d133b-132">创建自定义关键帧</span><span class="sxs-lookup"><span data-stu-id="d133b-132">Create a Custom Key Frame</span></span>  
 <span data-ttu-id="d133b-133">创建自定义关键帧类是扩展动画系统的最简单方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-133">Creating a custom key frame class is the simplest way to extend the animation system.</span></span> <span data-ttu-id="d133b-134">当希望为关键帧动画使用不同的内插方法时，请使用此方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-134">Use this approach when you want to a different interpolation method for a key-frame animation.</span></span>  <span data-ttu-id="d133b-135">如[关键帧动画概述](key-frame-animations-overview.md)中所述，关键帧动画使用关键帧对象生成器输出值。</span><span class="sxs-lookup"><span data-stu-id="d133b-135">As described in the [Key-Frame Animations Overview](key-frame-animations-overview.md), a key-frame animation uses key frame objects to generate its output values.</span></span> <span data-ttu-id="d133b-136">每个关键帧对象都执行三个功能：</span><span class="sxs-lookup"><span data-stu-id="d133b-136">Each key frame object performs three functions:</span></span>  
  
- <span data-ttu-id="d133b-137">使用其 <xref:System.Windows.Media.Animation.IKeyFrame.Value%2A> 属性指定目标值。</span><span class="sxs-lookup"><span data-stu-id="d133b-137">Specifies a target value using its <xref:System.Windows.Media.Animation.IKeyFrame.Value%2A> property.</span></span>  
  
- <span data-ttu-id="d133b-138">指定使用其 <xref:System.Windows.Media.Animation.IKeyFrame.KeyTime%2A> 属性访问该值的时间。</span><span class="sxs-lookup"><span data-stu-id="d133b-138">Specifies the time at which that value should be reached using its <xref:System.Windows.Media.Animation.IKeyFrame.KeyTime%2A> property.</span></span>  
  
- <span data-ttu-id="d133b-139">通过实现 InterpolateValueCore 方法在上一个关键帧的值和它自己的值之间内插。</span><span class="sxs-lookup"><span data-stu-id="d133b-139">Interpolates between the value of the previous key frame and its own value by implementing the InterpolateValueCore method.</span></span>  
  
 <span data-ttu-id="d133b-140">**实现说明**</span><span class="sxs-lookup"><span data-stu-id="d133b-140">**Implementation Instructions**</span></span>  
  
 <span data-ttu-id="d133b-141">从 *\<Type>* KeyFrame 抽象类派生，并实现 InterpolateValueCore 方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-141">Derive from the *\<Type>* KeyFrame abstract class and implement the InterpolateValueCore method.</span></span> <span data-ttu-id="d133b-142">InterpolateValueCore 方法返回关键帧的当前值。</span><span class="sxs-lookup"><span data-stu-id="d133b-142">The InterpolateValueCore method returns the current value of the key frame.</span></span> <span data-ttu-id="d133b-143">它采用两个参数：上一个关键帧的值和范围是从 0 到 1 的进度值。</span><span class="sxs-lookup"><span data-stu-id="d133b-143">It takes two parameters: the value of the previous key frame and a progress value that ranges from 0 to 1.</span></span> <span data-ttu-id="d133b-144">进度0指示关键帧刚开始，值为1指示关键帧刚完成并且应返回由其 <xref:System.Windows.Media.Animation.IKeyFrame.Value%2A> 属性指定的值。</span><span class="sxs-lookup"><span data-stu-id="d133b-144">A progress of 0 indicates the key frame has just started, and a value of 1 indicates that the key frame has just completed and should return the value specified by its <xref:System.Windows.Media.Animation.IKeyFrame.Value%2A> property.</span></span>  
  
 <span data-ttu-id="d133b-145">由于 > 关键帧类 *\<类型*继承自 <xref:System.Windows.Freezable> 类，因此还必须重写 <xref:System.Windows.Freezable.CreateInstanceCore%2A> 核心才能返回类的新实例。</span><span class="sxs-lookup"><span data-stu-id="d133b-145">Because the *\<Type>* KeyFrame classes inherit from the <xref:System.Windows.Freezable> class, you must also override <xref:System.Windows.Freezable.CreateInstanceCore%2A> core to return a new instance of your class.</span></span> <span data-ttu-id="d133b-146">如果该类不使用依赖属性存储其数据，或者它在创建后需要额外初始化，则可能需要重写其他方法；有关详细信息，请参阅 [Freezable 对象概述](../advanced/freezable-objects-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d133b-146">If the class does not use dependency properties to store its data or it requires extra initialization after creation, you might need to override additional methods; see the [Freezable Objects Overview](../advanced/freezable-objects-overview.md) for more information.</span></span>  
  
 <span data-ttu-id="d133b-147">创建自定义 *\<Type>* KeyFrame 动画后，可以将其与该类型的 *\<Type>* AnimationUsingKeyFrames 结合使用。</span><span class="sxs-lookup"><span data-stu-id="d133b-147">After you've created your custom *\<Type>* KeyFrame animation, you can use it with the *\<Type>* AnimationUsingKeyFrames for that type.</span></span>  
  
<a name="createacustomanimationtype"></a>   
## <a name="create-a-custom-animation-class"></a><span data-ttu-id="d133b-148">创建自定义动画类</span><span class="sxs-lookup"><span data-stu-id="d133b-148">Create a Custom Animation Class</span></span>  
 <span data-ttu-id="d133b-149">创建自己的动画类型可以更好地控制对某个对象进行动画处理的方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-149">Creating your own animation type gives you more control over how an object in animated.</span></span> <span data-ttu-id="d133b-150">可通过两种方法创建自己的动画类型：可从 <xref:System.Windows.Media.Animation.AnimationTimeline> 类或 *\<类型 >* AnimationBase 类派生。</span><span class="sxs-lookup"><span data-stu-id="d133b-150">There are two recommended ways to create your own animation type: you can derive from the <xref:System.Windows.Media.Animation.AnimationTimeline> class or the *\<Type>* AnimationBase class.</span></span> <span data-ttu-id="d133b-151">不建议从 *\<Type>* Animation 或 *\<Type>* AnimationUsingKeyFrames 类派生。</span><span class="sxs-lookup"><span data-stu-id="d133b-151">Deriving from the *\<Type>* Animation or *\<Type>* AnimationUsingKeyFrames classes is not recommended.</span></span>  
  
### <a name="derive-from-typeanimationbase"></a><span data-ttu-id="d133b-152">从 \<Type>AnimationBase 派生</span><span class="sxs-lookup"><span data-stu-id="d133b-152">Derive from \<Type>AnimationBase</span></span>  
 <span data-ttu-id="d133b-153">从 *\<Type>* AnimationBase 类派生是创建新动画类型的最简单方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-153">Deriving from a *\<Type>* AnimationBase class is the simplest way to create a new animation type.</span></span> <span data-ttu-id="d133b-154">要为已经具有对应 *\<Type>* AnimationBase 类的类型创建新动画时，请使用此方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-154">Use this approach when you want to create a new animation for type that already has a corresponding *\<Type>* AnimationBase class.</span></span>  
  
 <span data-ttu-id="d133b-155">**实现说明**</span><span class="sxs-lookup"><span data-stu-id="d133b-155">**Implementation Instructions**</span></span>  
  
 <span data-ttu-id="d133b-156">从 *\<Type>* Animation 类派生并实现 GetCurrentValueCore 方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-156">Derive from a *\<Type>* Animation class and implement the GetCurrentValueCore method.</span></span> <span data-ttu-id="d133b-157">GetCurrentValueCore 方法返回动画的当前值。</span><span class="sxs-lookup"><span data-stu-id="d133b-157">The GetCurrentValueCore method returns the current value of the animation.</span></span> <span data-ttu-id="d133b-158">它采用三个参数：一个建议的起始值、一个建议的结束值和一个用于确定动画进度的 <xref:System.Windows.Media.Animation.AnimationClock>。</span><span class="sxs-lookup"><span data-stu-id="d133b-158">It takes three parameters: a suggested starting value, a suggested ending value, and an <xref:System.Windows.Media.Animation.AnimationClock>, which you use to determine the progress of the animation.</span></span>  
  
 <span data-ttu-id="d133b-159">由于 *\<类型 >* AnimationBase 类继承自 <xref:System.Windows.Freezable> 类，因此还必须重写 <xref:System.Windows.Freezable.CreateInstanceCore%2A> 核心才能返回类的新实例。</span><span class="sxs-lookup"><span data-stu-id="d133b-159">Because the *\<Type>* AnimationBase classes inherit from the <xref:System.Windows.Freezable> class, you must also override <xref:System.Windows.Freezable.CreateInstanceCore%2A> core to return a new instance of your class.</span></span> <span data-ttu-id="d133b-160">如果该类不使用依赖属性存储其数据，或者它在创建后需要额外初始化，则可能需要重写其他方法；有关详细信息，请参阅 [Freezable 对象概述](../advanced/freezable-objects-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d133b-160">If the class does not use dependency properties to store its data or it requires extra initialization after creation, you might need to override additional methods; see the [Freezable Objects Overview](../advanced/freezable-objects-overview.md) for more information.</span></span>  
  
 <span data-ttu-id="d133b-161">有关详细信息，请参阅要进行动画处理的类型的 *\<Type>* AnimationBase 类的 GetCurrentValueCore 方法文档。</span><span class="sxs-lookup"><span data-stu-id="d133b-161">For more information, see the GetCurrentValueCore method documentation for the *\<Type>* AnimationBase class for the type that you want to animate.</span></span> <span data-ttu-id="d133b-162">有关示例，请参阅[自定义动画示例](https://github.com/Microsoft/WPF-Samples/tree/master/Animation/CustomAnimation)</span><span class="sxs-lookup"><span data-stu-id="d133b-162">For an example, see the [Custom Animation Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Animation/CustomAnimation)</span></span>  
  
 <span data-ttu-id="d133b-163">**替代方法**</span><span class="sxs-lookup"><span data-stu-id="d133b-163">**Alternative Approaches**</span></span>  
  
 <span data-ttu-id="d133b-164">如果只需更改动画值的内插方式，请考虑从某个 *\<Type>* KeyFrame 类派生。</span><span class="sxs-lookup"><span data-stu-id="d133b-164">If you simply want to change how animation values are interpolated, considering deriving from one of the *\<Type>* KeyFrame classes.</span></span> <span data-ttu-id="d133b-165">可以将所创建的关键帧与  *提供的对应 \<* Type>[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]AnimationUsingKeyFrames 结合使用。</span><span class="sxs-lookup"><span data-stu-id="d133b-165">The key frame you create can be used with the corresponding *\<Type>* AnimationUsingKeyFrames provided by [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
### <a name="derive-from-animationtimeline"></a><span data-ttu-id="d133b-166">从 AnimationTimeline 派生</span><span class="sxs-lookup"><span data-stu-id="d133b-166">Derive from AnimationTimeline</span></span>  
 <span data-ttu-id="d133b-167">如果要为尚未与 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画匹配的类型创建动画，或要创建不是强类型的动画，请从 <xref:System.Windows.Media.Animation.AnimationTimeline> 类派生。</span><span class="sxs-lookup"><span data-stu-id="d133b-167">Derive from the <xref:System.Windows.Media.Animation.AnimationTimeline> class when you want to create an animation for a type that doesn't already have a matching [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation, or you want to create an animation that is not strongly typed.</span></span>  
  
 <span data-ttu-id="d133b-168">**实现说明**</span><span class="sxs-lookup"><span data-stu-id="d133b-168">**Implementation Instructions**</span></span>  
  
 <span data-ttu-id="d133b-169">从 <xref:System.Windows.Media.Animation.AnimationTimeline> 类派生并重写以下成员：</span><span class="sxs-lookup"><span data-stu-id="d133b-169">Derive from the <xref:System.Windows.Media.Animation.AnimationTimeline> class and override the following members:</span></span>  
  
- <span data-ttu-id="d133b-170"><xref:System.Windows.Freezable.CreateInstanceCore%2A> –如果新类是具体类，则必须重写 <xref:System.Windows.Freezable.CreateInstanceCore%2A> 才能返回类的新实例。</span><span class="sxs-lookup"><span data-stu-id="d133b-170"><xref:System.Windows.Freezable.CreateInstanceCore%2A> – If your new class is concrete, you must override <xref:System.Windows.Freezable.CreateInstanceCore%2A> to return a new instance of your class.</span></span>  
  
- <span data-ttu-id="d133b-171"><xref:System.Windows.Media.Animation.AnimationTimeline.GetCurrentValue%2A> –重写此方法以返回动画的当前值。</span><span class="sxs-lookup"><span data-stu-id="d133b-171"><xref:System.Windows.Media.Animation.AnimationTimeline.GetCurrentValue%2A> – Override this method to return the current value of your animation.</span></span> <span data-ttu-id="d133b-172">它使用三个参数：默认的原始值、默认目标值和 <xref:System.Windows.Media.Animation.AnimationClock>。</span><span class="sxs-lookup"><span data-stu-id="d133b-172">It takes three parameters: a default origin value, a default destination value, and an <xref:System.Windows.Media.Animation.AnimationClock>.</span></span> <span data-ttu-id="d133b-173">使用 <xref:System.Windows.Media.Animation.AnimationClock> 获取动画的当前时间或进度。</span><span class="sxs-lookup"><span data-stu-id="d133b-173">Use the <xref:System.Windows.Media.Animation.AnimationClock> to obtain the current time or progress for the animation.</span></span> <span data-ttu-id="d133b-174">可以选择是否使用默认的原始和目标值。</span><span class="sxs-lookup"><span data-stu-id="d133b-174">You can choose whether to use the default origin and destination values.</span></span>  
  
- <span data-ttu-id="d133b-175"><xref:System.Windows.Media.Animation.AnimationTimeline.IsDestinationDefault%2A> –重写此属性，以指示动画是否使用 <xref:System.Windows.Media.Animation.AnimationTimeline.GetCurrentValue%2A> 方法指定的默认目标值。</span><span class="sxs-lookup"><span data-stu-id="d133b-175"><xref:System.Windows.Media.Animation.AnimationTimeline.IsDestinationDefault%2A> – Override this property to indicate whether your animation uses the default destination value specified by the <xref:System.Windows.Media.Animation.AnimationTimeline.GetCurrentValue%2A> method.</span></span>  
  
- <span data-ttu-id="d133b-176"><xref:System.Windows.Media.Animation.AnimationTimeline.TargetPropertyType%2A> –重写此属性，以指示动画生成的输出的 <xref:System.Type>。</span><span class="sxs-lookup"><span data-stu-id="d133b-176"><xref:System.Windows.Media.Animation.AnimationTimeline.TargetPropertyType%2A> – Override this property to indicate the <xref:System.Type> of output your animation produces.</span></span>  
  
 <span data-ttu-id="d133b-177">如果该类不使用依赖属性存储其数据，或者它在创建后需要额外初始化，则可能需要重写其他方法；有关详细信息，请参阅 [Freezable 对象概述](../advanced/freezable-objects-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d133b-177">If the class does not use dependency properties to store its data or it requires extra initialization after creation, you might need to override additional methods; see the [Freezable Objects Overview](../advanced/freezable-objects-overview.md) for more information.</span></span>  
  
 <span data-ttu-id="d133b-178">推荐的范例（由 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画使用）是使用两个继承级别：</span><span class="sxs-lookup"><span data-stu-id="d133b-178">The recommended paradigm (used by [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animations) is to use two inheritance levels:</span></span>  
  
1. <span data-ttu-id="d133b-179">创建从 <xref:System.Windows.Media.Animation.AnimationTimeline>派生的 > AnimationBase 类的抽象 *\<类型*。</span><span class="sxs-lookup"><span data-stu-id="d133b-179">Create an abstract *\<Type>* AnimationBase class that derives from <xref:System.Windows.Media.Animation.AnimationTimeline>.</span></span> <span data-ttu-id="d133b-180">此类应重写 <xref:System.Windows.Media.Animation.AnimationTimeline.TargetPropertyType%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-180">This class should override the <xref:System.Windows.Media.Animation.AnimationTimeline.TargetPropertyType%2A> method.</span></span> <span data-ttu-id="d133b-181">它还应引入一个新的抽象方法 GetCurrentValueCore，并覆盖 <xref:System.Windows.Media.Animation.AnimationTimeline.GetCurrentValue%2A> 以便验证默认原始值和默认目标值参数的类型，然后调用 GetCurrentValueCore。</span><span class="sxs-lookup"><span data-stu-id="d133b-181">It should also introduce a new abstract method, GetCurrentValueCore, and override <xref:System.Windows.Media.Animation.AnimationTimeline.GetCurrentValue%2A> so that it validates the types of the default origin value and default destination value parameters, then calls GetCurrentValueCore.</span></span>  
  
2. <span data-ttu-id="d133b-182">创建另一个从新 *\<类型*继承的类 > AnimationBase 类，并重写 <xref:System.Windows.Freezable.CreateInstanceCore%2A> 方法、引入的 GetCurrentValueCore 方法和 <xref:System.Windows.Media.Animation.AnimationTimeline.IsDestinationDefault%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="d133b-182">Create another class that inherits from your new *\<Type>* AnimationBase class and overrides the <xref:System.Windows.Freezable.CreateInstanceCore%2A> method, the GetCurrentValueCore method that you introduced, and the <xref:System.Windows.Media.Animation.AnimationTimeline.IsDestinationDefault%2A> property.</span></span>  
  
 <span data-ttu-id="d133b-183">**替代方法**</span><span class="sxs-lookup"><span data-stu-id="d133b-183">**Alternative Approaches**</span></span>  
  
 <span data-ttu-id="d133b-184">如果要对没有对应的 From/To/By 动画或关键帧动画的类型进行动画处理，请考虑使用 <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames>。</span><span class="sxs-lookup"><span data-stu-id="d133b-184">If you want to animate a type that has no corresponding From/To/By animation or key-frame animation, consider using an <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames>.</span></span> <span data-ttu-id="d133b-185">由于它是弱类型，因此 <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames> 可以对任何类型的值进行动画处理。</span><span class="sxs-lookup"><span data-stu-id="d133b-185">Because it is weakly typed, an <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames> can animate any type of value.</span></span> <span data-ttu-id="d133b-186">此方法的缺点是 <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames> 仅支持离散内插。</span><span class="sxs-lookup"><span data-stu-id="d133b-186">The drawback to this approach is that <xref:System.Windows.Media.Animation.ObjectAnimationUsingKeyFrames> only supports discrete interpolation.</span></span>  
  
<a name="useperframecallback"></a>   
## <a name="use-per-frame-callback"></a><span data-ttu-id="d133b-187">使用每帧回叫</span><span class="sxs-lookup"><span data-stu-id="d133b-187">Use Per-Frame Callback</span></span>  
 <span data-ttu-id="d133b-188">如果需要完全绕过 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 动画系统，可以使用此方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-188">Use this approach when you need to completely bypass the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation system.</span></span> <span data-ttu-id="d133b-189">此方法的一个方案是物理动画，其中的每个动画步都需要基于最后一组对象交互重新计算动画处理对象的新方向或位置。</span><span class="sxs-lookup"><span data-stu-id="d133b-189">One scenario for this approach is physics animations, where at each animation step a new direction or position of animated objects needs to be recomputed based on the  last set of object interactions.</span></span>  
  
 <span data-ttu-id="d133b-190">**实现说明**</span><span class="sxs-lookup"><span data-stu-id="d133b-190">**Implementation Instructions**</span></span>  
  
 <span data-ttu-id="d133b-191">和本概述中所述的其他方法不同，要使用每帧回叫，无需创建自定义动画或关键帧类。</span><span class="sxs-lookup"><span data-stu-id="d133b-191">Unlike the other approaches described in this overview, to use per-frame callback you don't need to create a custom animation or key frame class.</span></span>  
  
 <span data-ttu-id="d133b-192">而是注册对象的 <xref:System.Windows.Media.CompositionTarget.Rendering> 事件，该对象包含要进行动画处理的对象。</span><span class="sxs-lookup"><span data-stu-id="d133b-192">Instead, you register for the <xref:System.Windows.Media.CompositionTarget.Rendering> event of the object that contains the objects you want to animate.</span></span> <span data-ttu-id="d133b-193">每帧会调用一次此事件处理程序方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-193">This event handler method gets called once per frame.</span></span> <span data-ttu-id="d133b-194">每次 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 将可视化树中的持久呈现数据封送到复合树时，都将调用事件处理程序方法。</span><span class="sxs-lookup"><span data-stu-id="d133b-194">Each time that [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] marshals the persisted rendering data in the visual tree across to the composition tree, your event handler method is called.</span></span>  
  
 <span data-ttu-id="d133b-195">在事件处理程序中，执行动画效果所需的任何计算，并设置要使用这些值进行动画处理的对象的属性。</span><span class="sxs-lookup"><span data-stu-id="d133b-195">In your event handler, perform your whatever calculations necessary for your animation effect and set the properties of the objects you want to animate with these values.</span></span>  
  
 <span data-ttu-id="d133b-196">若要获取当前帧的显示时间，可以将与此事件相关联的 <xref:System.EventArgs> 转换为 <xref:System.Windows.Media.RenderingEventArgs>，这将提供可用于获取当前帧呈现时间的 <xref:System.Windows.Media.RenderingEventArgs.RenderingTime%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="d133b-196">To obtain the presentation time of the current frame, the <xref:System.EventArgs> associated with this event can be cast as <xref:System.Windows.Media.RenderingEventArgs>, which provide a <xref:System.Windows.Media.RenderingEventArgs.RenderingTime%2A> property that you can use to obtain the current frame's rendering time.</span></span>  
  
 <span data-ttu-id="d133b-197">有关详细信息，请参阅 "<xref:System.Windows.Media.CompositionTarget.Rendering>" 页。</span><span class="sxs-lookup"><span data-stu-id="d133b-197">For more information, see the <xref:System.Windows.Media.CompositionTarget.Rendering> page.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d133b-198">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d133b-198">See also</span></span>

- <xref:System.Windows.Media.Animation.AnimationTimeline>
- <xref:System.Windows.Media.Animation.IKeyFrame>
- [<span data-ttu-id="d133b-199">属性动画技术概述</span><span class="sxs-lookup"><span data-stu-id="d133b-199">Property Animation Techniques Overview</span></span>](property-animation-techniques-overview.md)
- [<span data-ttu-id="d133b-200">Freezable 对象概述</span><span class="sxs-lookup"><span data-stu-id="d133b-200">Freezable Objects Overview</span></span>](../advanced/freezable-objects-overview.md)
- [<span data-ttu-id="d133b-201">关键帧动画概述</span><span class="sxs-lookup"><span data-stu-id="d133b-201">Key-Frame Animations Overview</span></span>](key-frame-animations-overview.md)
- [<span data-ttu-id="d133b-202">路径动画概述</span><span class="sxs-lookup"><span data-stu-id="d133b-202">Path Animations Overview</span></span>](path-animations-overview.md)
- [<span data-ttu-id="d133b-203">动画概述</span><span class="sxs-lookup"><span data-stu-id="d133b-203">Animation Overview</span></span>](animation-overview.md)
- [<span data-ttu-id="d133b-204">动画和计时系统概述</span><span class="sxs-lookup"><span data-stu-id="d133b-204">Animation and Timing System Overview</span></span>](animation-and-timing-system-overview.md)
- [<span data-ttu-id="d133b-205">自定义动画示例</span><span class="sxs-lookup"><span data-stu-id="d133b-205">Custom Animation Sample</span></span>](https://github.com/Microsoft/WPF-Samples/tree/master/Animation/CustomAnimation)
