---
title: 数据绑定概述
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- data conversion for binding [WPF]
- binding data [WPF], about data binding
- data binding [WPF], about data binding
- conversion for data binding [WPF]
ms.assetid: c707c95f-7811-401d-956e-2fffd019a211
ms.openlocfilehash: 44a35131273c6f191ab5da5bc1639d97bd961ff1
ms.sourcegitcommit: 29a9b29d8b7d07b9c59d46628da754a8bff57fa4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/17/2019
ms.locfileid: "69567513"
---
# <a name="data-binding-overview"></a><span data-ttu-id="73b0a-102">数据绑定概述</span><span class="sxs-lookup"><span data-stu-id="73b0a-102">Data Binding Overview</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="73b0a-103">数据绑定为应用程序呈现数据并与数据交互提供了一种简单且一致的方式。</span><span class="sxs-lookup"><span data-stu-id="73b0a-103">data binding provides a simple and consistent way for applications to present and interact with data.</span></span> <span data-ttu-id="73b0a-104">元素可以绑定到各种数据源中的数据, 格式为公共语言运行时 (CLR) 对象和[!INCLUDE[TLA#tla_xml](../../../../includes/tlasharptla-xml-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="73b0a-104">Elements can be bound to data from a variety of data sources in the form of common language runtime (CLR) objects and [!INCLUDE[TLA#tla_xml](../../../../includes/tlasharptla-xml-md.md)].</span></span> <span data-ttu-id="73b0a-105"><xref:System.Windows.Controls.ContentControl><xref:System.Windows.Controls.Button>等和<xref:System.Windows.Controls.ItemsControl>都具有内置功能,可实现单一数据项或数据项集合的灵活样式。<xref:System.Windows.Controls.ListBox> <xref:System.Windows.Controls.ListView></span><span class="sxs-lookup"><span data-stu-id="73b0a-105"><xref:System.Windows.Controls.ContentControl>s such as <xref:System.Windows.Controls.Button> and <xref:System.Windows.Controls.ItemsControl>s such as <xref:System.Windows.Controls.ListBox> and <xref:System.Windows.Controls.ListView> have built-in functionality to enable flexible styling of single data items or collections of data items.</span></span> <span data-ttu-id="73b0a-106">可基于数据生成排序、筛选和分组视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-106">Sort, filter, and group views can be generated on top of the data.</span></span>  
  
 <span data-ttu-id="73b0a-107">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中的数据绑定功能与传统模型相比具有几个优点，包括本质上支持数据绑定的大量属性、灵活的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 数据 UI 表示形式以及业务逻辑与 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的完全分离。</span><span class="sxs-lookup"><span data-stu-id="73b0a-107">The data binding functionality in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] has several advantages over traditional models, including a broad range of properties that inherently support data binding, flexible [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] representation of data, and clean separation of business logic from [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
 <span data-ttu-id="73b0a-108">本主题首先讨论有关[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]数据绑定的基本概念, 并探讨<xref:System.Windows.Data.Binding>类的用法和数据绑定的其他功能。</span><span class="sxs-lookup"><span data-stu-id="73b0a-108">This topic first discusses concepts fundamental to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding and then goes into the usage of the <xref:System.Windows.Data.Binding> class and other features of data binding.</span></span>  

<a name="what_is_data_binding"></a>   
## <a name="what-is-data-binding"></a><span data-ttu-id="73b0a-109">什么是数据绑定？</span><span class="sxs-lookup"><span data-stu-id="73b0a-109">What Is Data Binding?</span></span>  
 <span data-ttu-id="73b0a-110">数据绑定是在应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 和业务逻辑之间建立连接的过程。</span><span class="sxs-lookup"><span data-stu-id="73b0a-110">Data binding is the process that establishes a connection between the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] and business logic.</span></span> <span data-ttu-id="73b0a-111">如果绑定具有正确的设置，并且数据提供适当的通知，则在数据更改其值时，绑定到该数据的元素会自动反映更改。</span><span class="sxs-lookup"><span data-stu-id="73b0a-111">If the binding has the correct settings and the data provides the proper notifications, then, when the data changes its value, the elements that are bound to the data reflect changes automatically.</span></span> <span data-ttu-id="73b0a-112">数据绑定还意味着，如果元素中数据的外部表示形式发生更改，则基础数据可以自动进行更新以反映更改。</span><span class="sxs-lookup"><span data-stu-id="73b0a-112">Data binding can also mean that if an outer representation of the data in an element changes, then the underlying data can be automatically updated to reflect the change.</span></span> <span data-ttu-id="73b0a-113">例如, 如果用户编辑<xref:System.Windows.Controls.TextBox>元素中的值, 则基础数据值会自动更新以反映此更改。</span><span class="sxs-lookup"><span data-stu-id="73b0a-113">For example, if the user edits the value in a <xref:System.Windows.Controls.TextBox> element, the underlying data value is automatically updated to reflect that change.</span></span>  
  
 <span data-ttu-id="73b0a-114">数据绑定的典型用法是将服务器或本地配置数据放置到窗体或其他 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 控件中。</span><span class="sxs-lookup"><span data-stu-id="73b0a-114">A typical use of data binding is to place server or local configuration data into forms or other [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] controls.</span></span> <span data-ttu-id="73b0a-115">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，此概念得到扩展，包括将大量属性绑定到各种数据源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-115">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], this concept is expanded to include the binding of a broad range of properties to a variety of data sources.</span></span> <span data-ttu-id="73b0a-116">在[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中, 元素的依赖项属性可以绑定到 CLR 对象 (包括与 web 服务和 web 属性相关联的 ADO.NET 对象或[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]对象) 和数据。</span><span class="sxs-lookup"><span data-stu-id="73b0a-116">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], dependency properties of elements can be bound to CLR objects (including ADO.NET objects or objects associated with Web Services and Web properties) and [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data.</span></span>  
  
 <span data-ttu-id="73b0a-117">有关数据绑定的示例，请参阅[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)中的以下应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]：</span><span class="sxs-lookup"><span data-stu-id="73b0a-117">For an example of data binding, take a look at the following application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] from the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703):</span></span>  
  
 <span data-ttu-id="73b0a-118">![数据绑定示例屏幕快照](./media/databinding-databindingdemo.png "DataBinding_DataBindingDemo")</span><span class="sxs-lookup"><span data-stu-id="73b0a-118">![Data binding sample screenshot](./media/databinding-databindingdemo.png "DataBinding_DataBindingDemo")</span></span>  
  
 <span data-ttu-id="73b0a-119">以上是一个显示拍卖项列表的应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="73b0a-119">The above is the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] of an application that displays a list of auction items.</span></span> <span data-ttu-id="73b0a-120">应用程序演示了数据绑定的以下功能：</span><span class="sxs-lookup"><span data-stu-id="73b0a-120">The application demonstrates the following features of data binding:</span></span>  
  
- <span data-ttu-id="73b0a-121">的<xref:System.Windows.Controls.ListBox>内容绑定到*AuctionItem*对象的集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-121">The content of the <xref:System.Windows.Controls.ListBox> is bound to a collection of *AuctionItem* objects.</span></span> <span data-ttu-id="73b0a-122">*AuctionItem* 对象具有 *Description*、*StartPrice*、*StartDate*、*Category*、*SpecialFeatures* 等属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-122">An *AuctionItem* object has properties such as *Description*, *StartPrice*, *StartDate*, *Category*, *SpecialFeatures*, etc.</span></span>  
  
- <span data-ttu-id="73b0a-123">中显示的 <xref:System.Windows.Controls.ListBox>数据 (AuctionItem 对象) 为模板化, 以便为每个项目显示说明和当前价格。</span><span class="sxs-lookup"><span data-stu-id="73b0a-123">The data (*AuctionItem* objects) displayed in the <xref:System.Windows.Controls.ListBox> is templated so that the description and the current price are shown for each item.</span></span> <span data-ttu-id="73b0a-124">这是使用来完成<xref:System.Windows.DataTemplate>的。</span><span class="sxs-lookup"><span data-stu-id="73b0a-124">This is done using a <xref:System.Windows.DataTemplate>.</span></span> <span data-ttu-id="73b0a-125">此外，每个项的外观取决于要显示的 *AuctionItem* 的 *SpecialFeatures* 值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-125">In addition, the appearance of each item depends on the *SpecialFeatures* value of the *AuctionItem* being displayed.</span></span> <span data-ttu-id="73b0a-126">如果 *AuctionItem* 的 *SpecialFeatures* 值为 *Color*，则该项具有蓝色边框。</span><span class="sxs-lookup"><span data-stu-id="73b0a-126">If the *SpecialFeatures* value of the *AuctionItem* is *Color*, the item has a blue border.</span></span> <span data-ttu-id="73b0a-127">如果值为 *Highlight*，则该项具有橙色边框和一个星号。</span><span class="sxs-lookup"><span data-stu-id="73b0a-127">If the value is *Highlight*, the item has an orange border and a star.</span></span> <span data-ttu-id="73b0a-128">[数据模板化](#data_templating)部分提供了数据模板化的相关信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-128">The [Data Templating](#data_templating) section provides information about data templating.</span></span>  
  
- <span data-ttu-id="73b0a-129">用户可以使用所提供的<xref:System.Windows.Controls.CheckBox>es 对数据进行分组、筛选或排序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-129">The user can group, filter, or sort the data using the <xref:System.Windows.Controls.CheckBox>es provided.</span></span> <span data-ttu-id="73b0a-130">在上面的图像中, 选择了 "按类别分组" 和 "按类别排序和<xref:System.Windows.Controls.CheckBox>日期排序"。</span><span class="sxs-lookup"><span data-stu-id="73b0a-130">In the image above, the "Group by category" and "Sort by category and date" <xref:System.Windows.Controls.CheckBox>es are selected.</span></span> <span data-ttu-id="73b0a-131">你可能已注意到，数据按产品类别分组，类别名称按字母顺序排序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-131">You may have noticed that the data is grouped based on the category of the product, and the category name is in alphabetical order.</span></span> <span data-ttu-id="73b0a-132">这些项还按每个类别中的开始日期排序，但难以从图中注意到这一点。</span><span class="sxs-lookup"><span data-stu-id="73b0a-132">It is difficult to notice from the image but the items are also sorted by the start date within each category.</span></span> <span data-ttu-id="73b0a-133">这可使用*集合视图*来实现。</span><span class="sxs-lookup"><span data-stu-id="73b0a-133">This is done using a *collection view*.</span></span> <span data-ttu-id="73b0a-134">[绑定到集合](#binding_to_collections)部分讨论了集合视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-134">The [Binding to Collections](#binding_to_collections) section discusses collection views.</span></span>  
  
- <span data-ttu-id="73b0a-135">当用户选择某一项时, <xref:System.Windows.Controls.ContentControl>将显示所选项的详细信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-135">When the user selects an item, the <xref:System.Windows.Controls.ContentControl> displays the details of the selected item.</span></span> <span data-ttu-id="73b0a-136">这称为*主从方案*。</span><span class="sxs-lookup"><span data-stu-id="73b0a-136">This is called the *Master-Detail scenario*.</span></span> <span data-ttu-id="73b0a-137">[主从方案](#master_detail_scenario)部分提供了有关此类型的绑定方案的信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-137">The [Master-Detail Scenario](#master_detail_scenario) section provides information about this type of binding scenario.</span></span>  
  
- <span data-ttu-id="73b0a-138">开始属性的类型为<xref:System.DateTime>, 它返回包含毫秒的时间的日期。</span><span class="sxs-lookup"><span data-stu-id="73b0a-138">The type of the *StartDate* property is <xref:System.DateTime>, which returns a date that includes the time to the millisecond.</span></span> <span data-ttu-id="73b0a-139">在此应用程序中，使用了一个自定义转换器，以便显示较短的日期字符串。</span><span class="sxs-lookup"><span data-stu-id="73b0a-139">In this application, a custom converter has been used so that a shorter date string is displayed.</span></span> <span data-ttu-id="73b0a-140">[数据转换](#data_conversion)部分提供了有关转换器的信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-140">The [Data Conversion](#data_conversion) section provides information about converters.</span></span>  
  
 <span data-ttu-id="73b0a-141">当用户单击“添加产品”按钮时，会出现以下窗体：</span><span class="sxs-lookup"><span data-stu-id="73b0a-141">When the user clicks the *Add Product* button, the following form comes up:</span></span>  
  
 <span data-ttu-id="73b0a-142">![添加产品清单页](./media/databinding-demo-addproductlisting.png "DataBinding_Demo_AddProductListing")</span><span class="sxs-lookup"><span data-stu-id="73b0a-142">![Add Product Listing page](./media/databinding-demo-addproductlisting.png "DataBinding_Demo_AddProductListing")</span></span>  
  
 <span data-ttu-id="73b0a-143">用户可以编辑窗体中的字段，使用简略预览和详细预览窗格来预览产品清单，然后单击“提交”以添加新的产品清单。</span><span class="sxs-lookup"><span data-stu-id="73b0a-143">The user can edit the fields in the form, preview the product listing using the short preview and the more detailed preview panes, and then click *submit* to add the new product listing.</span></span> <span data-ttu-id="73b0a-144">任何现有的分组、筛选和排序功能都将应用于新项。</span><span class="sxs-lookup"><span data-stu-id="73b0a-144">Any existing grouping, filtering and sorting functionalities will apply to the new entry.</span></span> <span data-ttu-id="73b0a-145">在这种特殊情况下，上图中输入的项会作为 *Computer* 类别中的第二项显示。</span><span class="sxs-lookup"><span data-stu-id="73b0a-145">In this particular case, the item entered in the above image will be displayed as the second item within the *Computer* category.</span></span>  
  
 <span data-ttu-id="73b0a-146">此图中未显示的是在*开始日期* <xref:System.Windows.Controls.TextBox>提供的验证逻辑。</span><span class="sxs-lookup"><span data-stu-id="73b0a-146">Not shown in this image is the validation logic provided in the *Start Date* <xref:System.Windows.Controls.TextBox>.</span></span> <span data-ttu-id="73b0a-147">如果用户输入无效的日期 (格式无效或过去的日期), 则将向用户通知<xref:System.Windows.Controls.ToolTip> , 旁边<xref:System.Windows.Controls.TextBox>有一个红色的感叹号。</span><span class="sxs-lookup"><span data-stu-id="73b0a-147">If the user enters an invalid date (invalid formatting or a past date), the user will be notified with a <xref:System.Windows.Controls.ToolTip> and a red exclamation point next to the <xref:System.Windows.Controls.TextBox>.</span></span> <span data-ttu-id="73b0a-148">[数据验证](#data_validation)一节讨论了如何创建验证逻辑。</span><span class="sxs-lookup"><span data-stu-id="73b0a-148">The [Data Validation](#data_validation) section discusses how to create validation logic.</span></span>  
  
 <span data-ttu-id="73b0a-149">在详细介绍数据绑定的上述不同功能之前，我们会先在下一节中讨论一些对理解 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 数据绑定非常重要的基本概念。</span><span class="sxs-lookup"><span data-stu-id="73b0a-149">Before going into the different features of data binding outlined above, we will first discuss in the next section the fundamental concepts that are critical to understanding [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding.</span></span>  
  
## <a name="basic-data-binding-concepts"></a><span data-ttu-id="73b0a-150">数据绑定基本概念</span><span class="sxs-lookup"><span data-stu-id="73b0a-150">Basic Data Binding Concepts</span></span>  
  
 <span data-ttu-id="73b0a-151">不论要绑定什么元素，也不论数据源的特性是什么，每个绑定都始终遵循下图所示的模型：</span><span class="sxs-lookup"><span data-stu-id="73b0a-151">Regardless of what element you are binding and the nature of your data source, each binding always follows the model illustrated by the following figure:</span></span>  
  
 ![显示基本数据绑定模型的关系图。](./media/data-binding-overview/basic-data-binding-diagram.png)  
  
 <span data-ttu-id="73b0a-153">如上图所示，数据绑定实质上是绑定目标与绑定源之间的桥梁。</span><span class="sxs-lookup"><span data-stu-id="73b0a-153">As illustrated by the above figure, data binding is essentially the bridge between your binding target and your binding source.</span></span> <span data-ttu-id="73b0a-154">该图演示了以下基本的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 数据绑定概念：</span><span class="sxs-lookup"><span data-stu-id="73b0a-154">The figure demonstrates the following fundamental [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding concepts:</span></span>  
  
- <span data-ttu-id="73b0a-155">通常，每个绑定都具有以下四个组件：绑定目标对象、目标属性、绑定源，以及要使用的绑定源中的值路径。</span><span class="sxs-lookup"><span data-stu-id="73b0a-155">Typically, each binding has these four components: a binding target object, a target property, a binding source, and a path to the value in the binding source to use.</span></span> <span data-ttu-id="73b0a-156">例如, 如果想要将的<xref:System.Windows.Controls.TextBox>内容绑定到*Employee*对象的<xref:System.Windows.Controls.TextBox> *Name*属性, 则目标对象为, 目标属性是<xref:System.Windows.Controls.TextBox.Text%2A>属性, 要使用的值为*Name*,源对象是*Employee*对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-156">For example, if you want to bind the content of a <xref:System.Windows.Controls.TextBox> to the *Name* property of an *Employee* object, your target object is the <xref:System.Windows.Controls.TextBox>, the target property is the <xref:System.Windows.Controls.TextBox.Text%2A> property, the value to use is *Name*, and the source object is the *Employee* object.</span></span>  
  
- <span data-ttu-id="73b0a-157">目标属性必须为依赖属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-157">The target property must be a dependency property.</span></span> <span data-ttu-id="73b0a-158">大多数<xref:System.Windows.UIElement>属性都是依赖属性, 大多数依赖属性 (只读属性除外) 默认支持数据绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-158">Most <xref:System.Windows.UIElement> properties are dependency properties and most dependency properties, except read-only ones, support data binding by default.</span></span> <span data-ttu-id="73b0a-159">(仅<xref:System.Windows.DependencyObject>类型可以定义依赖属性, 而<xref:System.Windows.UIElement>所有的都<xref:System.Windows.DependencyObject>是从派生的。)</span><span class="sxs-lookup"><span data-stu-id="73b0a-159">(Only <xref:System.Windows.DependencyObject> types can define dependency properties and all <xref:System.Windows.UIElement>s derive from <xref:System.Windows.DependencyObject>.)</span></span>  
  
- <span data-ttu-id="73b0a-160">虽然图中未指定, 但应注意, 绑定源对象并不限于自定义 CLR 对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-160">Although not specified in the figure, it should be noted that the binding source object is not restricted to being a custom CLR object.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="73b0a-161">数据绑定支持 CLR 对象和[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]格式的数据。</span><span class="sxs-lookup"><span data-stu-id="73b0a-161">data binding supports data in the form of CLR objects and [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)].</span></span> <span data-ttu-id="73b0a-162">若要提供一些示例, 绑定源可以是<xref:System.Windows.UIElement>、任何列表对象、与 ADO.NET 数据或 Web 服务关联的 CLR 对象, 也可以是[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]包含数据的 XmlNode。</span><span class="sxs-lookup"><span data-stu-id="73b0a-162">To provide some examples, your binding source may be a <xref:System.Windows.UIElement>, any list object, a CLR object that is associated with ADO.NET data or Web Services, or an XmlNode that contains your [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data.</span></span> <span data-ttu-id="73b0a-163">有关详细信息，请参阅[绑定源概述](binding-sources-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-163">For more information, see [Binding Sources Overview](binding-sources-overview.md).</span></span>  
  
 <span data-ttu-id="73b0a-164">当你通读其他 SDK 主题时, 请务必记住, 在建立绑定时, 将绑定目标绑定*到*绑定源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-164">As you read through other SDK topics, it is important to remember that when you are establishing a binding, you are binding a binding target *to* a binding source.</span></span> <span data-ttu-id="73b0a-165">例如, 如果<xref:System.Windows.Controls.ListBox>使用数据绑定显示某些基础[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]数据<xref:System.Windows.Controls.ListBox> , 则[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]会将绑定到数据。</span><span class="sxs-lookup"><span data-stu-id="73b0a-165">For example, if you are displaying some underlying [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data in a <xref:System.Windows.Controls.ListBox> using data binding, you are binding your <xref:System.Windows.Controls.ListBox> to the [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data.</span></span>  
  
 <span data-ttu-id="73b0a-166">若要建立绑定, 请使用<xref:System.Windows.Data.Binding>对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-166">To establish a binding, you use the <xref:System.Windows.Data.Binding> object.</span></span> <span data-ttu-id="73b0a-167">本主题的其余部分讨论与相关联的许多概念以及<xref:System.Windows.Data.Binding>对象的一些属性和用法。</span><span class="sxs-lookup"><span data-stu-id="73b0a-167">The rest of this topic discusses many of the concepts associated with and some of the properties and usage of the <xref:System.Windows.Data.Binding> object.</span></span>  
  
<a name="direction_of_data_flow"></a>   
### <a name="direction-of-the-data-flow"></a><span data-ttu-id="73b0a-168">数据流的方向</span><span class="sxs-lookup"><span data-stu-id="73b0a-168">Direction of the Data Flow</span></span>  
 <span data-ttu-id="73b0a-169">如前所述, 如上图中的箭头所示, 绑定的数据流可以从绑定目标传输到绑定源 (例如, 当用户编辑的<xref:System.Windows.Controls.TextBox>值时, 源值将更改) 和/或从绑定源如果绑定源提供了正确的通知, <xref:System.Windows.Controls.TextBox>则为绑定目标 (例如, 内容会更新到绑定源中的更改)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-169">As mentioned previously and as indicated by the arrow in the figure above, the data flow of a binding can go from the binding target to the binding source (for example, the source value changes when a user edits the value of a <xref:System.Windows.Controls.TextBox>) and/or from the binding source to the binding target (for example, your <xref:System.Windows.Controls.TextBox> content gets updated with changes in the binding source) if the binding source provides the proper notifications.</span></span>  
  
 <span data-ttu-id="73b0a-170">可能希望应用程序允许用户更改数据，然后将该数据传播回源对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-170">You may want your application to enable users to change the data and propagate it back to the source object.</span></span> <span data-ttu-id="73b0a-171">或者，可能不希望允许用户更新源数据。</span><span class="sxs-lookup"><span data-stu-id="73b0a-171">Or you may not want to enable users to update the source data.</span></span> <span data-ttu-id="73b0a-172">可以通过设置<xref:System.Windows.Data.Binding>对象的属性对<xref:System.Windows.Data.Binding.Mode%2A>此进行控制。</span><span class="sxs-lookup"><span data-stu-id="73b0a-172">You can control this by setting the <xref:System.Windows.Data.Binding.Mode%2A> property of your <xref:System.Windows.Data.Binding> object.</span></span> <span data-ttu-id="73b0a-173">下图演示了不同类型的数据流：</span><span class="sxs-lookup"><span data-stu-id="73b0a-173">The following figure illustrates the different types of data flow:</span></span>  
  
 <span data-ttu-id="73b0a-174">![数据绑定数据流](./media/databinding-dataflow.png "DataBinding_DataFlow")</span><span class="sxs-lookup"><span data-stu-id="73b0a-174">![Data binding data flow](./media/databinding-dataflow.png "DataBinding_DataFlow")</span></span>  
  
- <span data-ttu-id="73b0a-175"><xref:System.Windows.Data.BindingMode.OneWay>绑定会导致对源属性的更改自动更新目标属性, 但对目标属性所做的更改不会传播回 source 属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-175"><xref:System.Windows.Data.BindingMode.OneWay> binding causes changes to the source property to automatically update the target property, but changes to the target property are not propagated back to the source property.</span></span> <span data-ttu-id="73b0a-176">如果绑定的控件为隐式只读，则此类型的绑定适用。</span><span class="sxs-lookup"><span data-stu-id="73b0a-176">This type of binding is appropriate if the control being bound is implicitly read-only.</span></span> <span data-ttu-id="73b0a-177">例如，可能绑定到如股票行情自动收录器这样的源，或许目标属性没有用于进行更改的控件接口（如表的数据绑定背景色）。</span><span class="sxs-lookup"><span data-stu-id="73b0a-177">For instance, you may bind to a source such as a stock ticker or perhaps your target property has no control interface provided for making changes, such as a data-bound background color of a table.</span></span> <span data-ttu-id="73b0a-178">如果无需监视目标属性的更改，则使用 <xref:System.Windows.Data.BindingMode.OneWay> 绑定模式可避免 <xref:System.Windows.Data.BindingMode.TwoWay> 绑定模式的系统开销。</span><span class="sxs-lookup"><span data-stu-id="73b0a-178">If there is no need to monitor the changes of the target property, using the <xref:System.Windows.Data.BindingMode.OneWay> binding mode avoids the overhead of the <xref:System.Windows.Data.BindingMode.TwoWay> binding mode.</span></span>  
  
- <span data-ttu-id="73b0a-179"><xref:System.Windows.Data.BindingMode.TwoWay>绑定会导致对源属性或目标属性的更改自动更新。</span><span class="sxs-lookup"><span data-stu-id="73b0a-179"><xref:System.Windows.Data.BindingMode.TwoWay> binding causes changes to either the source property or the target property to automatically update the other.</span></span> <span data-ttu-id="73b0a-180">此类型的绑定适用于可编辑窗体或其他完整交互式的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 方案。</span><span class="sxs-lookup"><span data-stu-id="73b0a-180">This type of binding is appropriate for editable forms or other fully-interactive [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] scenarios.</span></span> <span data-ttu-id="73b0a-181">大多数属性默认为<xref:System.Windows.Data.BindingMode.OneWay>绑定, 但某些依赖属性 (通常是用户可编辑控件的属性<xref:System.Windows.Controls.TextBox> , 例如<xref:System.Windows.Controls.TextBox.Text%2A>的属性和<xref:System.Windows.Controls.Primitives.ToggleButton.IsChecked%2A>的属性<xref:System.Windows.Controls.CheckBox>) 默认为<xref:System.Windows.Data.BindingMode.TwoWay>绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-181">Most properties default to <xref:System.Windows.Data.BindingMode.OneWay> binding, but some dependency properties (typically properties of user-editable controls such as the <xref:System.Windows.Controls.TextBox.Text%2A> property of <xref:System.Windows.Controls.TextBox> and the <xref:System.Windows.Controls.Primitives.ToggleButton.IsChecked%2A> property of <xref:System.Windows.Controls.CheckBox>) default to <xref:System.Windows.Data.BindingMode.TwoWay> binding.</span></span> <span data-ttu-id="73b0a-182">确定依赖属性绑定在默认情况下是单向还是双向的编程方法是：使用 <xref:System.Windows.DependencyProperty.GetMetadata%2A> 获取属性的属性元数据，然后检查 <xref:System.Windows.FrameworkPropertyMetadata.BindsTwoWayByDefault%2A> 属性的布尔值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-182">A programmatic way to determine whether a dependency property binds one-way or two-way by default is to get the property metadata of the property using <xref:System.Windows.DependencyProperty.GetMetadata%2A> and then check the Boolean value of the <xref:System.Windows.FrameworkPropertyMetadata.BindsTwoWayByDefault%2A> property.</span></span>  
  
- <span data-ttu-id="73b0a-183"><xref:System.Windows.Data.BindingMode.OneWayToSource>是反向<xref:System.Windows.Data.BindingMode.OneWay>绑定; 当目标属性发生更改时, 它将更新源属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-183"><xref:System.Windows.Data.BindingMode.OneWayToSource> is the reverse of <xref:System.Windows.Data.BindingMode.OneWay> binding; it updates the source property when the target property changes.</span></span> <span data-ttu-id="73b0a-184">一个示例方案是只需要从 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 重新计算源值的情况。</span><span class="sxs-lookup"><span data-stu-id="73b0a-184">One example scenario is if you only need to re-evaluate the source value from the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
- <span data-ttu-id="73b0a-185">图中未说明<xref:System.Windows.Data.BindingMode.OneTime>绑定, 这会导致源属性初始化目标属性, 但后续更改不会传播。</span><span class="sxs-lookup"><span data-stu-id="73b0a-185">Not illustrated in the figure is <xref:System.Windows.Data.BindingMode.OneTime> binding, which causes the source property to initialize the target property, but subsequent changes do not propagate.</span></span> <span data-ttu-id="73b0a-186">这意味着，如果数据上下文发生了更改，或者数据上下文中的对象发生了更改，该更改不会反映在目标属性中。</span><span class="sxs-lookup"><span data-stu-id="73b0a-186">This means that if the data context undergoes a change or the object in the data context changes, then the change is not reflected in the target property.</span></span> <span data-ttu-id="73b0a-187">如果你在适合使用当前状态的快照或数据实际为静态数据的位置使用数据，则此类型的绑定适合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-187">This type of binding is appropriate if you are using data where either a snapshot of the current state is appropriate to use or the data is truly static.</span></span> <span data-ttu-id="73b0a-188">如果你想使用源属性中的某个值来初始化目标属性，且提前不知道数据上下文，则此类型的绑定也有用。</span><span class="sxs-lookup"><span data-stu-id="73b0a-188">This type of binding is also useful if you want to initialize your target property with some value from a source property and the data context is not known in advance.</span></span> <span data-ttu-id="73b0a-189">这是实质上是 <xref:System.Windows.Data.BindingMode.OneWay> 绑定的一种简化形式，它在源值不更改的情况下提供更好的性能。</span><span class="sxs-lookup"><span data-stu-id="73b0a-189">This is essentially a simpler form of <xref:System.Windows.Data.BindingMode.OneWay> binding that provides better performance in cases where the source value does not change.</span></span>  
  
 <span data-ttu-id="73b0a-190">请注意, 若要检测源更改 ( <xref:System.Windows.Data.BindingMode.OneWay>适用<xref:System.Windows.Data.BindingMode.TwoWay>于和绑定), 源必须实现适当的属性<xref:System.ComponentModel.INotifyPropertyChanged>更改通知机制, 例如。</span><span class="sxs-lookup"><span data-stu-id="73b0a-190">Note that to detect source changes (applicable to <xref:System.Windows.Data.BindingMode.OneWay> and <xref:System.Windows.Data.BindingMode.TwoWay> bindings), the source must implement a suitable property change notification mechanism such as <xref:System.ComponentModel.INotifyPropertyChanged>.</span></span> <span data-ttu-id="73b0a-191">有关<xref:System.ComponentModel.INotifyPropertyChanged>实现的示例, 请参阅[实现属性更改通知](how-to-implement-property-change-notification.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-191">See [Implement Property Change Notification](how-to-implement-property-change-notification.md) for an example of an <xref:System.ComponentModel.INotifyPropertyChanged> implementation.</span></span>  
  
 <span data-ttu-id="73b0a-192"><xref:System.Windows.Data.Binding.Mode%2A>属性页提供了有关绑定模式的详细信息, 以及如何指定绑定方向的示例。</span><span class="sxs-lookup"><span data-stu-id="73b0a-192">The <xref:System.Windows.Data.Binding.Mode%2A> property page provides more information about binding modes and an example of how to specify the direction of a binding.</span></span>  
  
<a name="what_triggers_source_updates"></a>   
### <a name="what-triggers-source-updates"></a><span data-ttu-id="73b0a-193">触发源更新的因素</span><span class="sxs-lookup"><span data-stu-id="73b0a-193">What Triggers Source Updates</span></span>  
 <span data-ttu-id="73b0a-194">作为<xref:System.Windows.Data.BindingMode.TwoWay> 或<xref:System.Windows.Data.BindingMode.OneWayToSource>侦听目标属性中的更改并将其传播回源的绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-194">Bindings that are <xref:System.Windows.Data.BindingMode.TwoWay> or <xref:System.Windows.Data.BindingMode.OneWayToSource> listen for changes in the target property and propagate them back to the source.</span></span> <span data-ttu-id="73b0a-195">这称为更新源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-195">This is known as updating the source.</span></span> <span data-ttu-id="73b0a-196">例如，可以编辑文本框的文本以更改基础源值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-196">For example, you may edit the text of a TextBox to change the underlying source value.</span></span> <span data-ttu-id="73b0a-197">如最后一部分所述, 数据流的方向由绑定的<xref:System.Windows.Data.Binding.Mode%2A>属性值决定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-197">As described in the last section, the direction of the data flow is determined by the value of the <xref:System.Windows.Data.Binding.Mode%2A> property of the binding.</span></span>  
  
 <span data-ttu-id="73b0a-198">但是，源值是在编辑文本的同时进行更新，还是在结束编辑文本并将鼠标指针从文本框移走后才进行更新呢？</span><span class="sxs-lookup"><span data-stu-id="73b0a-198">However, does your source value get updated while you are editing the text or after you finish editing the text and point your mouse away from the TextBox?</span></span> <span data-ttu-id="73b0a-199">绑定<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>的属性确定源更新的触发因素。</span><span class="sxs-lookup"><span data-stu-id="73b0a-199">The <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property of the binding determines what triggers the update of the source.</span></span> <span data-ttu-id="73b0a-200">下图中右箭头的点说明了<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>属性的角色:</span><span class="sxs-lookup"><span data-stu-id="73b0a-200">The dots of the right arrows in the following figure illustrate the role of the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property:</span></span>  
  
 ![显示 System.windows.data.binding.updatesourcetrigger 属性的角色的关系图。](./media/data-binding-overview/data-binding-updatesource-trigger.png)  
  
 <span data-ttu-id="73b0a-202">如果值为<xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, 则<xref:System.Windows.Data.BindingMode.TwoWay>或<xref:System.Windows.Data.BindingMode.OneWayToSource>的右箭头指向的值将在目标属性更改后立即更新。 <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-202">If the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value is <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, then the value pointed to by the right arrow of <xref:System.Windows.Data.BindingMode.TwoWay> or the <xref:System.Windows.Data.BindingMode.OneWayToSource> bindings gets updated as soon as the target property changes.</span></span> <span data-ttu-id="73b0a-203">但是, 如果<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>该值为, <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>则只有当目标属性失去焦点时, 该值才会更新为新值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-203">However, if the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value is <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>, then that value only gets updated with the new value when the target property loses focus.</span></span>  
  
 <span data-ttu-id="73b0a-204">与属性类似, 不同的依赖属性具有不同的<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>默认值。 <xref:System.Windows.Data.Binding.Mode%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-204">Similar to the <xref:System.Windows.Data.Binding.Mode%2A> property, different dependency properties have different default <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> values.</span></span> <span data-ttu-id="73b0a-205">大多数依赖属性的默认值为 <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>，而 <xref:System.Windows.Controls.TextBox.Text%2A> 属性的默认值为 <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>。</span><span class="sxs-lookup"><span data-stu-id="73b0a-205">The default value for most dependency properties is <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, while the <xref:System.Windows.Controls.TextBox.Text%2A> property has a default value of <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>.</span></span> <span data-ttu-id="73b0a-206">这意味着, 当目标属性发生更改时, 通常会发生源更新, 这<xref:System.Windows.Controls.CheckBox>对于 es 和其他简单控件来说是很不错的。</span><span class="sxs-lookup"><span data-stu-id="73b0a-206">This means that source updates usually happen whenever the target property changes, which is fine for <xref:System.Windows.Controls.CheckBox>es and other simple controls.</span></span> <span data-ttu-id="73b0a-207">但对于文本字段，每次击键之后都进行更新会降低性能，用户也没有机会在提交新值之前使用 Backspace 键修改键入错误。</span><span class="sxs-lookup"><span data-stu-id="73b0a-207">However, for text fields, updating after every keystroke can diminish performance and it denies the user the usual opportunity to backspace and fix typing errors before committing to the new value.</span></span> <span data-ttu-id="73b0a-208">这就是为什么<xref:System.Windows.Controls.TextBox.Text%2A>属性具有默认<xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>值而不是的<xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>原因。</span><span class="sxs-lookup"><span data-stu-id="73b0a-208">That is why the <xref:System.Windows.Controls.TextBox.Text%2A> property has a default value of <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus> instead of <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>.</span></span>  
  
 <span data-ttu-id="73b0a-209">有关如何查找依赖属性的默认<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值的信息, 请参阅属性页。<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-209">See the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property page for information about how to find the default <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value of a dependency property.</span></span>  
  
 <span data-ttu-id="73b0a-210">下表提供了<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> <xref:System.Windows.Controls.TextBox>使用作为示例的每个值的示例方案:</span><span class="sxs-lookup"><span data-stu-id="73b0a-210">The following table provides an example scenario for each <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value using the <xref:System.Windows.Controls.TextBox> as an example:</span></span>  
  
|<span data-ttu-id="73b0a-211">UpdateSourceTrigger 值</span><span class="sxs-lookup"><span data-stu-id="73b0a-211">UpdateSourceTrigger value</span></span>|<span data-ttu-id="73b0a-212">源值何时进行更新</span><span class="sxs-lookup"><span data-stu-id="73b0a-212">When the Source Value Gets Updated</span></span>|<span data-ttu-id="73b0a-213">文本框的示例方案</span><span class="sxs-lookup"><span data-stu-id="73b0a-213">Example Scenario for TextBox</span></span>|  
|-------------------------------|----------------------------------------|----------------------------------|  
|<span data-ttu-id="73b0a-214">LostFocus (默认值<xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=nameWithType>)</span><span class="sxs-lookup"><span data-stu-id="73b0a-214">LostFocus (default for <xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=nameWithType>)</span></span>|<span data-ttu-id="73b0a-215">当 TextBox 控件失去焦点时</span><span class="sxs-lookup"><span data-stu-id="73b0a-215">When the TextBox control loses focus</span></span>|<span data-ttu-id="73b0a-216"><xref:System.Windows.Controls.TextBox>与验证逻辑关联的 (请参阅 "数据验证" 一节)</span><span class="sxs-lookup"><span data-stu-id="73b0a-216">A <xref:System.Windows.Controls.TextBox> that is associated with validation logic (see Data Validation section)</span></span>|  
|<span data-ttu-id="73b0a-217">PropertyChanged</span><span class="sxs-lookup"><span data-stu-id="73b0a-217">PropertyChanged</span></span>|<span data-ttu-id="73b0a-218">当你键入<xref:System.Windows.Controls.TextBox></span><span class="sxs-lookup"><span data-stu-id="73b0a-218">As you type into the <xref:System.Windows.Controls.TextBox></span></span>|<span data-ttu-id="73b0a-219"><xref:System.Windows.Controls.TextBox>聊天室窗口中的控件</span><span class="sxs-lookup"><span data-stu-id="73b0a-219"><xref:System.Windows.Controls.TextBox> controls in a chat room window</span></span>|  
|<span data-ttu-id="73b0a-220">Explicit</span><span class="sxs-lookup"><span data-stu-id="73b0a-220">Explicit</span></span>|<span data-ttu-id="73b0a-221">当应用程序调用<xref:System.Windows.Data.BindingExpression.UpdateSource%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-221">When the application calls <xref:System.Windows.Data.BindingExpression.UpdateSource%2A></span></span>|<span data-ttu-id="73b0a-222"><xref:System.Windows.Controls.TextBox>可编辑窗体中的控件 (仅当用户单击 "提交" 按钮时才更新源值)</span><span class="sxs-lookup"><span data-stu-id="73b0a-222"><xref:System.Windows.Controls.TextBox> controls in an editable form (updates the source values only when the user clicks the submit button)</span></span>|  
  
 <span data-ttu-id="73b0a-223">有关示例，请参阅[控制文本框文本更新源的时间](how-to-control-when-the-textbox-text-updates-the-source.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-223">For an example, see [Control When the TextBox Text Updates the Source](how-to-control-when-the-textbox-text-updates-the-source.md).</span></span>  
  
<a name="creating_a_binding"></a>   
## <a name="creating-a-binding"></a><span data-ttu-id="73b0a-224">创建绑定</span><span class="sxs-lookup"><span data-stu-id="73b0a-224">Creating a Binding</span></span>  
  
 <span data-ttu-id="73b0a-225">若要 recapitulate 前面几节中讨论的一些概念, 请使用<xref:System.Windows.Data.Binding>对象建立绑定, 每个绑定通常具有四个组件: 绑定目标、目标属性、绑定源和要使用的源值的路径。</span><span class="sxs-lookup"><span data-stu-id="73b0a-225">To recapitulate some of the concepts discussed in the previous sections, you establish a binding using the <xref:System.Windows.Data.Binding> object, and each binding usually has four components: binding target, target property, binding source, and a path to the source value to use.</span></span> <span data-ttu-id="73b0a-226">本节讨论如何设置绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-226">This section discusses how to set up a binding.</span></span>  
  
 <span data-ttu-id="73b0a-227">请考虑以下示例，其中的绑定源对象是一个名为 *MyData* 的类，该类在 *SDKSample* 命名空间中定义。</span><span class="sxs-lookup"><span data-stu-id="73b0a-227">Consider the following example, in which the binding source object is a class named *MyData* that is defined in the *SDKSample* namespace.</span></span> <span data-ttu-id="73b0a-228">出于演示目的，*MyData* 类具有一个名为 *ColorName* 的字符串属性，该属性的值设置为“Red”。</span><span class="sxs-lookup"><span data-stu-id="73b0a-228">For demonstration purposes, *MyData* class has a string property named *ColorName*, of which the value is set to "Red".</span></span> <span data-ttu-id="73b0a-229">因此，此示例生成一个具有红色背景的按钮。</span><span class="sxs-lookup"><span data-stu-id="73b0a-229">Thus, this example generates a button with a red background.</span></span>  
  
 [!code-xaml[BindNonTextProperty#1](~/samples/snippets/csharp/VS_Snippets_Wpf/BindNonTextProperty/CS/Page1.xaml#1)]  
  
 <span data-ttu-id="73b0a-230">有关绑定声明语法的详细信息以及如何在代码中设置绑定的示例，请参阅[绑定声明概述](binding-declarations-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-230">For more details on the binding declaration syntax and for examples of how to set up a binding in code, see [Binding Declarations Overview](binding-declarations-overview.md).</span></span>  
  
 <span data-ttu-id="73b0a-231">如果将此示例应用于基本关系图，则生成的图如下所示。</span><span class="sxs-lookup"><span data-stu-id="73b0a-231">If we apply this example to our basic diagram, the resulting figure looks like the following.</span></span> <span data-ttu-id="73b0a-232">这是一个<xref:System.Windows.Data.BindingMode.OneWay>绑定, 因为默认情况下<xref:System.Windows.Data.BindingMode.OneWay> , 该后台属性支持绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-232">This is a <xref:System.Windows.Data.BindingMode.OneWay> binding because the Background property supports <xref:System.Windows.Data.BindingMode.OneWay> binding by default.</span></span>  
  
 ![显示数据绑定背景属性的关系图。](./media/data-binding-overview/data-binding-button-background-example.png)  
  
 <span data-ttu-id="73b0a-234">尽管*ColorName*属性的类型为字符串<xref:System.Windows.Controls.Control.Background%2A> , 但该属性的类型<xref:System.Windows.Media.Brush>为, 但你可能想知道为什么此操作有效。</span><span class="sxs-lookup"><span data-stu-id="73b0a-234">You may wonder why this works even though the *ColorName* property is of type string while the <xref:System.Windows.Controls.Control.Background%2A> property is of type <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="73b0a-235">这是由于进行了默认类型转换，此类型转换在[数据转换](#data_conversion)一节中进行讨论。</span><span class="sxs-lookup"><span data-stu-id="73b0a-235">This is default type conversion at work and is discussed in the [Data Conversion](#data_conversion) section.</span></span>  
  
<a name="specifying_the_binding_source"></a>   
### <a name="specifying-the-binding-source"></a><span data-ttu-id="73b0a-236">指定绑定源</span><span class="sxs-lookup"><span data-stu-id="73b0a-236">Specifying the Binding Source</span></span>  
 <span data-ttu-id="73b0a-237">请注意, 在上面的示例中, 通过在<xref:System.Windows.FrameworkElement.DataContext%2A> <xref:System.Windows.Controls.DockPanel>元素上设置属性来指定绑定源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-237">Notice that in the previous example, the binding source is specified by setting the <xref:System.Windows.FrameworkElement.DataContext%2A> property on the <xref:System.Windows.Controls.DockPanel> element.</span></span> <span data-ttu-id="73b0a-238">然后从中继承<xref:System.Windows.FrameworkElement.DataContext%2A>值,该值是其父元素。<xref:System.Windows.Controls.DockPanel> <xref:System.Windows.Controls.Button></span><span class="sxs-lookup"><span data-stu-id="73b0a-238">The <xref:System.Windows.Controls.Button> then inherits the <xref:System.Windows.FrameworkElement.DataContext%2A> value from the <xref:System.Windows.Controls.DockPanel>, which is its parent element.</span></span> <span data-ttu-id="73b0a-239">重申一下，绑定源对象是绑定的四个必需组件之一。</span><span class="sxs-lookup"><span data-stu-id="73b0a-239">To reiterate, the binding source object is one of the four necessary components of a binding.</span></span> <span data-ttu-id="73b0a-240">因此，如果未指定绑定源对象，则绑定将没有任何作用。</span><span class="sxs-lookup"><span data-stu-id="73b0a-240">Therefore, without the binding source object being specified, the binding would do nothing.</span></span>  
  
 <span data-ttu-id="73b0a-241">可通过多种方法指定绑定源对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-241">There are several ways to specify the binding source object.</span></span> <span data-ttu-id="73b0a-242">将多个属性绑定到同一个源时, 对父元素使用属性非常有用。<xref:System.Windows.FrameworkElement.DataContext%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-242">Using the <xref:System.Windows.FrameworkElement.DataContext%2A> property on a parent element is useful when you are binding multiple properties to the same source.</span></span> <span data-ttu-id="73b0a-243">不过，有时在个别绑定声明中指定绑定源可能更为合适。</span><span class="sxs-lookup"><span data-stu-id="73b0a-243">However, sometimes it may be more appropriate to specify the binding source on individual binding declarations.</span></span> <span data-ttu-id="73b0a-244">对于前面的示例, <xref:System.Windows.FrameworkElement.DataContext%2A>可以通过直接在按钮的绑定声明上<xref:System.Windows.Data.Binding.Source%2A>设置属性来指定绑定源, 如以下示例中所示:</span><span class="sxs-lookup"><span data-stu-id="73b0a-244">For the previous example, instead of using the <xref:System.Windows.FrameworkElement.DataContext%2A> property, you can specify the binding source by setting the <xref:System.Windows.Data.Binding.Source%2A> property directly on the binding declaration of the button, as in the following example:</span></span>  
  
 [!code-xaml[BindNonTextProperty#BackgroundBindingCompact](~/samples/snippets/csharp/VS_Snippets_Wpf/BindNonTextProperty/CS/Page2.xaml#backgroundbindingcompact)]  
  
 <span data-ttu-id="73b0a-245">除了直接在元素<xref:System.Windows.FrameworkElement.DataContext%2A>上设置属性, 还会从祖先<xref:System.Windows.FrameworkElement.DataContext%2A>继承值 (如第一个示例中的按钮), 并通过设置中的<xref:System.Windows.Data.Binding.Source%2A>属性显式指定绑定源。<xref:System.Windows.Data.Binding>(如最后一个示例中的按钮), 也可以使用<xref:System.Windows.Data.Binding.ElementName%2A>属性<xref:System.Windows.Data.Binding.RelativeSource%2A>或属性来指定绑定源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-245">Other than setting the <xref:System.Windows.FrameworkElement.DataContext%2A> property on an element directly, inheriting the <xref:System.Windows.FrameworkElement.DataContext%2A> value from an ancestor (such as the button in the first example), and explicitly specifying the binding source by setting the <xref:System.Windows.Data.Binding.Source%2A> property on the <xref:System.Windows.Data.Binding> (such as the button the last example), you can also use the <xref:System.Windows.Data.Binding.ElementName%2A> property or the <xref:System.Windows.Data.Binding.RelativeSource%2A> property to specify the binding source.</span></span> <span data-ttu-id="73b0a-246">如果要绑定到应用程序中的其他元素 (例如, 当使用滑块调整按钮的宽度时),属性会很有用。<xref:System.Windows.Data.Binding.ElementName%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-246">The <xref:System.Windows.Data.Binding.ElementName%2A> property is useful when you are binding to other elements in your application, such as when you are using a slider to adjust the width of a button.</span></span> <span data-ttu-id="73b0a-247">如果<xref:System.Windows.Data.Binding.RelativeSource%2A> 在或<xref:System.Windows.Style>中指定了绑定, 则属性很有用。 <xref:System.Windows.Controls.ControlTemplate></span><span class="sxs-lookup"><span data-stu-id="73b0a-247">The <xref:System.Windows.Data.Binding.RelativeSource%2A> property is useful when the binding is specified in a <xref:System.Windows.Controls.ControlTemplate> or a <xref:System.Windows.Style>.</span></span> <span data-ttu-id="73b0a-248">有关详细信息，请参阅[指定绑定源](how-to-specify-the-binding-source.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-248">For more information, see [Specify the Binding Source](how-to-specify-the-binding-source.md).</span></span>  
  
<a name="specifying_the_path_to_the_value"></a>   
### <a name="specifying-the-path-to-the-value"></a><span data-ttu-id="73b0a-249">指定值的路径</span><span class="sxs-lookup"><span data-stu-id="73b0a-249">Specifying the Path to the Value</span></span>  
 <span data-ttu-id="73b0a-250">如果绑定源是一个对象, 则可以使用<xref:System.Windows.Data.Binding.Path%2A>属性来指定要用于绑定的值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-250">If your binding source is an object, you use the <xref:System.Windows.Data.Binding.Path%2A> property to specify the value to use for your binding.</span></span> <span data-ttu-id="73b0a-251">如果要绑定到[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]数据, 请<xref:System.Windows.Data.Binding.XPath%2A>使用属性指定值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-251">If you are binding to [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data, you use the <xref:System.Windows.Data.Binding.XPath%2A> property to specify the value.</span></span> <span data-ttu-id="73b0a-252">在某些情况下, 即使在您的数据为<xref:System.Windows.Data.Binding.Path%2A> [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]时也可能会使用属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-252">In some cases, it may be applicable to use the <xref:System.Windows.Data.Binding.Path%2A> property even when your data is [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)].</span></span> <span data-ttu-id="73b0a-253">例如, 如果想要访问返回的 XmlNode 的 Name 属性 (作为 XPath 查询的结果), 则应使用<xref:System.Windows.Data.Binding.Path%2A>属性以及<xref:System.Windows.Data.Binding.XPath%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-253">For example, if you want to access the Name property of a returned XmlNode (as a result of an XPath query), you should use the <xref:System.Windows.Data.Binding.Path%2A> property in addition to the <xref:System.Windows.Data.Binding.XPath%2A> property.</span></span>  
  
 <span data-ttu-id="73b0a-254">有关语法信息和示例, 请参见<xref:System.Windows.Data.Binding.Path%2A>和<xref:System.Windows.Data.Binding.XPath%2A>属性页。</span><span class="sxs-lookup"><span data-stu-id="73b0a-254">For syntax information and examples, see the <xref:System.Windows.Data.Binding.Path%2A> and <xref:System.Windows.Data.Binding.XPath%2A> property pages.</span></span>  
  
 <span data-ttu-id="73b0a-255">请注意, 尽管我们已经强调<xref:System.Windows.Data.Binding.Path%2A> , 要使用的值是绑定的四个必需组件之一, 但在要绑定到整个对象的情况下, 要使用的值将与绑定源对象的值相同。</span><span class="sxs-lookup"><span data-stu-id="73b0a-255">Note that although we have emphasized that the <xref:System.Windows.Data.Binding.Path%2A> to the value to use is one of the four necessary components of a binding, in the scenarios which you want to bind to an entire object, the value to use would be the same as the binding source object.</span></span> <span data-ttu-id="73b0a-256">在这些情况下, 它适用于不指定<xref:System.Windows.Data.Binding.Path%2A>。</span><span class="sxs-lookup"><span data-stu-id="73b0a-256">In those cases, it is applicable to not specify a <xref:System.Windows.Data.Binding.Path%2A>.</span></span> <span data-ttu-id="73b0a-257">请看下面的示例：</span><span class="sxs-lookup"><span data-stu-id="73b0a-257">Consider the following example:</span></span>  
  
 [!code-xaml[MasterDetail#EmptyBinding](~/samples/snippets/csharp/VS_Snippets_Wpf/MasterDetail/CSharp/Page1.xaml#emptybinding)]  
  
 <span data-ttu-id="73b0a-258">以上示例使用空绑定语法：{Binding}。</span><span class="sxs-lookup"><span data-stu-id="73b0a-258">The above example uses the empty binding syntax: {Binding}.</span></span> <span data-ttu-id="73b0a-259">在这种情况下<xref:System.Windows.Controls.ListBox> , 将从父 system.windows.controls.dockpanel> 元素继承 DataContext (在本示例中未显示)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-259">In this case, the <xref:System.Windows.Controls.ListBox> inherits the DataContext from a parent DockPanel element (not shown in this example).</span></span> <span data-ttu-id="73b0a-260">未指定路径时，默认为绑定到整个对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-260">When the path is not specified, the default is to bind to the entire object.</span></span> <span data-ttu-id="73b0a-261">换句话说, 在此示例中, 路径已被省略, 因为我们要将<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>属性绑定到整个对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-261">In other words, in this example, the path has been left out because we are binding the <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property to the entire object.</span></span> <span data-ttu-id="73b0a-262">（有关深入讨论，请参阅[绑定到集合](#binding_to_collections)一节。）</span><span class="sxs-lookup"><span data-stu-id="73b0a-262">(See the [Binding to Collections](#binding_to_collections) section for an in-depth discussion.)</span></span>  
  
 <span data-ttu-id="73b0a-263">除了绑定到集合以外，在希望绑定到整个对象，而不是仅绑定到对象的单个属性时，也可以使用此方案。</span><span class="sxs-lookup"><span data-stu-id="73b0a-263">Other than binding to a collection, this scenario is also useful when you want to bind to an entire object instead of just a single property of an object.</span></span> <span data-ttu-id="73b0a-264">例如，在源对象为类型字符串，并且仅仅希望绑定到该字符串本身时。</span><span class="sxs-lookup"><span data-stu-id="73b0a-264">For example, if your source object is of type string and you simply want to bind to the string itself.</span></span> <span data-ttu-id="73b0a-265">另一种常见情况是希望将一个元素绑定到一个具有多个属性的对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-265">Another common scenario is when you want to bind an element to an object with several properties.</span></span>  
  
 <span data-ttu-id="73b0a-266">请注意，可能需要应用自定义逻辑，以便数据对于绑定的目标属性有意义。</span><span class="sxs-lookup"><span data-stu-id="73b0a-266">Note that you may need to apply custom logic so that the data is meaningful to your bound target property.</span></span> <span data-ttu-id="73b0a-267">自定义逻辑可能采用自定义转换器形式（如果不存在默认的类型转换）。</span><span class="sxs-lookup"><span data-stu-id="73b0a-267">The custom logic may be in the form of a custom converter (if default type conversion does not exist).</span></span> <span data-ttu-id="73b0a-268">有关转换器的信息，请参阅[数据转换](#data_conversion)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-268">See [Data Conversion](#data_conversion) for information about converters.</span></span>  
  
<a name="binding_bindingexpression"></a>   
### <a name="binding-and-bindingexpression"></a><span data-ttu-id="73b0a-269">Binding 和 BindingExpression</span><span class="sxs-lookup"><span data-stu-id="73b0a-269">Binding and BindingExpression</span></span>  
 <span data-ttu-id="73b0a-270">在进入数据绑定的其他功能和用法之前, 引入<xref:System.Windows.Data.BindingExpression>类将十分有用。</span><span class="sxs-lookup"><span data-stu-id="73b0a-270">Before getting into other features and usages of data binding, it would be useful to introduce the <xref:System.Windows.Data.BindingExpression> class.</span></span> <span data-ttu-id="73b0a-271">正如您在前面的<xref:System.Windows.Data.Binding>部分中所示, 类是绑定声明的高级类<xref:System.Windows.Data.Binding> ; 类提供了许多允许您指定绑定特性的属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-271">As you have seen in previous sections, the <xref:System.Windows.Data.Binding> class is the high-level class for the declaration of a binding; the <xref:System.Windows.Data.Binding> class provides many properties that allow you to specify the characteristics of a binding.</span></span> <span data-ttu-id="73b0a-272">相关类<xref:System.Windows.Data.BindingExpression>是维护源与目标之间的连接的基础对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-272">A related class, <xref:System.Windows.Data.BindingExpression>, is the underlying object that maintains the connection between the source and the target.</span></span> <span data-ttu-id="73b0a-273">一个绑定包含了可以在多个绑定表达式之间共享的所有信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-273">A binding contains all the information that can be shared across several binding expressions.</span></span> <span data-ttu-id="73b0a-274">是无法共享的实例表达式, 它包含的所有实例信息<xref:System.Windows.Data.Binding>。 <xref:System.Windows.Data.BindingExpression></span><span class="sxs-lookup"><span data-stu-id="73b0a-274">A <xref:System.Windows.Data.BindingExpression> is an instance expression that cannot be shared and contains all the instance information of the <xref:System.Windows.Data.Binding>.</span></span>  
  
 <span data-ttu-id="73b0a-275">例如, 请考虑以下情况, 其中*myDataObject*是*MyData*类的实例, *myBinding*是源<xref:System.Windows.Data.Binding>对象, *MyData*类是包含名为*MyDataProperty*。</span><span class="sxs-lookup"><span data-stu-id="73b0a-275">For example, consider the following, where *myDataObject* is an instance of *MyData* class, *myBinding* is the source <xref:System.Windows.Data.Binding> object, and *MyData* class is a defined class that contains a string property named *MyDataProperty*.</span></span> <span data-ttu-id="73b0a-276">此示例将*mytext*(实例<xref:System.Windows.Controls.TextBlock>) 的文本内容绑定到*MyDataProperty*。</span><span class="sxs-lookup"><span data-stu-id="73b0a-276">This example binds the text content of *mytext*, an instance of <xref:System.Windows.Controls.TextBlock>, to *MyDataProperty*.</span></span>  
  
 [!code-csharp[CodeOnlyBinding#1](~/samples/snippets/csharp/VS_Snippets_Wpf/CodeOnlyBinding/CSharp/binding.cs#1)]
 [!code-vb[CodeOnlyBinding#1](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CodeOnlyBinding/VisualBasic/App.vb#1)]  
  
 <span data-ttu-id="73b0a-277">可以使用同一 *myBinding* 对象来创建其他绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-277">You can use the same *myBinding* object to create other bindings.</span></span> <span data-ttu-id="73b0a-278">例如，可以使用 *myBinding* 对象将复选框的文本内容绑定到 *MyDataProperty*。</span><span class="sxs-lookup"><span data-stu-id="73b0a-278">For example, you may use *myBinding* object to bind the text content of a check box to *MyDataProperty*.</span></span> <span data-ttu-id="73b0a-279">在这种情况下, 将有两个<xref:System.Windows.Data.BindingExpression>共享*myBinding*对象的实例。</span><span class="sxs-lookup"><span data-stu-id="73b0a-279">In that scenario, there will be two instances of <xref:System.Windows.Data.BindingExpression> sharing the *myBinding* object.</span></span>  
  
 <span data-ttu-id="73b0a-280">可以通过对数据绑定对象调用<xref:System.Windows.Data.BindingOperations.GetBindingExpression%2A>的返回值来获取对象。<xref:System.Windows.Data.BindingExpression></span><span class="sxs-lookup"><span data-stu-id="73b0a-280">A <xref:System.Windows.Data.BindingExpression> object can be obtained through the return value of calling <xref:System.Windows.Data.BindingOperations.GetBindingExpression%2A> on a data-bound object.</span></span> <span data-ttu-id="73b0a-281">以下主题演示了<xref:System.Windows.Data.BindingExpression>类的一些用法:</span><span class="sxs-lookup"><span data-stu-id="73b0a-281">The following topics demonstrate some of the usages of the <xref:System.Windows.Data.BindingExpression> class:</span></span>  
  
- [<span data-ttu-id="73b0a-282">从已绑定的目标属性获取绑定对象</span><span class="sxs-lookup"><span data-stu-id="73b0a-282">Get the Binding Object from a Bound Target Property</span></span>](how-to-get-the-binding-object-from-a-bound-target-property.md)  
  
- [<span data-ttu-id="73b0a-283">控制文本框文本更新源的时间</span><span class="sxs-lookup"><span data-stu-id="73b0a-283">Control When the TextBox Text Updates the Source</span></span>](how-to-control-when-the-textbox-text-updates-the-source.md)  
  
<a name="data_conversion"></a>   
## <a name="data-conversion"></a><span data-ttu-id="73b0a-284">数据转换</span><span class="sxs-lookup"><span data-stu-id="73b0a-284">Data Conversion</span></span>  
 <span data-ttu-id="73b0a-285">在上面的示例中, 按钮是红色的, <xref:System.Windows.Controls.Control.Background%2A>因为其属性已绑定到值为 "red" 的字符串属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-285">In the previous example, the button is red because its <xref:System.Windows.Controls.Control.Background%2A> property is bound to a string property with the value "Red".</span></span> <span data-ttu-id="73b0a-286">这是因为类型转换器在<xref:System.Windows.Media.Brush>类型上存在, 以将字符串值转换<xref:System.Windows.Media.Brush>为。</span><span class="sxs-lookup"><span data-stu-id="73b0a-286">This works because a type converter is present on the <xref:System.Windows.Media.Brush> type to convert the string value to a <xref:System.Windows.Media.Brush>.</span></span>  
  
 <span data-ttu-id="73b0a-287">若要将此信息添加到[创建绑定](#creating_a_binding)一节的图中，关系图如下所示：</span><span class="sxs-lookup"><span data-stu-id="73b0a-287">To add this information to the figure in the [Creating a Binding](#creating_a_binding) section, the diagram looks like the following:</span></span>  
  
 ![显示数据绑定默认属性的关系图。](./media/data-binding-overview/data-binding-button-default-conversion.png)  
  
 <span data-ttu-id="73b0a-289">但是, 如果绑定源对象的*颜色*属性<xref:System.Windows.Media.Color>不是字符串类型, 则会发生什么情况呢？</span><span class="sxs-lookup"><span data-stu-id="73b0a-289">However, what if instead of having a property of type string your binding source object has a *Color* property of type <xref:System.Windows.Media.Color>?</span></span> <span data-ttu-id="73b0a-290">在这种情况下, 为了使绑定正常工作, 需要首先将*颜色*属性值转换为<xref:System.Windows.Controls.Control.Background%2A>属性接受的内容。</span><span class="sxs-lookup"><span data-stu-id="73b0a-290">In that case, in order for the binding to work you would need to first turn the *Color* property value into something that the <xref:System.Windows.Controls.Control.Background%2A> property accepts.</span></span> <span data-ttu-id="73b0a-291">需要通过实现<xref:System.Windows.Data.IValueConverter>接口来创建自定义转换器, 如以下示例中所示:</span><span class="sxs-lookup"><span data-stu-id="73b0a-291">You would need to create a custom converter by implementing the <xref:System.Windows.Data.IValueConverter> interface, as in the following example:</span></span>  
  
 [!code-csharp[ColorPicker_snip#16](~/samples/snippets/csharp/VS_Snippets_Wpf/ColorPicker_snip/CSharp/ColorPickerLib/ColorPicker.cs#16)]
 [!code-vb[ColorPicker_snip#16](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ColorPicker_snip/visualbasic/colorpickerlib/colorpicker.vb#16)]  
  
 <span data-ttu-id="73b0a-292"><xref:System.Windows.Data.IValueConverter>参考页提供了详细信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-292">The <xref:System.Windows.Data.IValueConverter> reference page provides more information.</span></span>  
  
 <span data-ttu-id="73b0a-293">现在使用自定义转换器而不是默认转换，关系图如下所示：</span><span class="sxs-lookup"><span data-stu-id="73b0a-293">Now the custom converter is used instead of default conversion, and our diagram looks like this:</span></span>  
  
 ![显示数据绑定自定义转换器的关系图。](./media/data-binding-overview/data-binding-converter-color-example.png)  
  
 <span data-ttu-id="73b0a-295">重申一下，由于要绑定到的类型中提供了类型转换器，因此可以使用默认转换。</span><span class="sxs-lookup"><span data-stu-id="73b0a-295">To reiterate, default conversions may be available because of type converters that are present in the type being bound to.</span></span> <span data-ttu-id="73b0a-296">此行为取决于目标中可用的类型转换器。</span><span class="sxs-lookup"><span data-stu-id="73b0a-296">This behavior will depend on which type converters are available in the target.</span></span> <span data-ttu-id="73b0a-297">如果无法确定，请创建自己的转换器。</span><span class="sxs-lookup"><span data-stu-id="73b0a-297">If in doubt, create your own converter.</span></span>  
  
 <span data-ttu-id="73b0a-298">下面提供了一些典型方案，在这些方案中，实现数据转换器非常有意义：</span><span class="sxs-lookup"><span data-stu-id="73b0a-298">Following are some typical scenarios where it makes sense to implement a data converter:</span></span>  
  
- <span data-ttu-id="73b0a-299">数据应根据区域性以不同方式显示。</span><span class="sxs-lookup"><span data-stu-id="73b0a-299">Your data should be displayed differently, depending on culture.</span></span> <span data-ttu-id="73b0a-300">例如，可能需要根据在特定区域性中使用的值或标准，实现货币转换器或日历日期/时间转换器。</span><span class="sxs-lookup"><span data-stu-id="73b0a-300">For instance, you might want to implement a currency converter or a calendar date/time converter based on the values or standards used in a particular culture.</span></span>  
  
- <span data-ttu-id="73b0a-301">使用的数据不一定会更改属性的文本值，但会更改其他某个值（如图像的源，或显示文本的颜色或样式）。</span><span class="sxs-lookup"><span data-stu-id="73b0a-301">The data being used is not necessarily intended to change the text value of a property, but is instead intended to change some other value, such as the source for an image, or the color or style of the display text.</span></span> <span data-ttu-id="73b0a-302">在这种情况下，可以通过转换可能不合适的属性绑定（如将文本字段绑定到表单元格的 Background 属性）来使用转换器。</span><span class="sxs-lookup"><span data-stu-id="73b0a-302">Converters can be used in this instance by converting the binding of a property that might not seem to be appropriate, such as binding a text field to the Background property of a table cell.</span></span>  
  
- <span data-ttu-id="73b0a-303">将多个控件或控件的多个属性绑定到相同数据。</span><span class="sxs-lookup"><span data-stu-id="73b0a-303">More than one control or to multiple properties of controls are bound to the same data.</span></span> <span data-ttu-id="73b0a-304">在这种情况下，主绑定可能仅显示文本，而其他绑定则处理特定的显示问题，但仍使用同一绑定作为源信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-304">In this case, the primary binding might just display the text, whereas other bindings handle specific display issues but still use the same binding as source information.</span></span>  
  
- <span data-ttu-id="73b0a-305">到目前为止, 我们尚未讨论<xref:System.Windows.Data.MultiBinding>, 其中目标属性具有绑定的集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-305">So far we have not yet discussed <xref:System.Windows.Data.MultiBinding>, where a target property has a collection of bindings.</span></span> <span data-ttu-id="73b0a-306">对于<xref:System.Windows.Data.MultiBinding>, 你可以使用自定义<xref:System.Windows.Data.IMultiValueConverter>从绑定值生成最终值。</span><span class="sxs-lookup"><span data-stu-id="73b0a-306">In the case of a <xref:System.Windows.Data.MultiBinding>, you use a custom <xref:System.Windows.Data.IMultiValueConverter> to produce a final value from the values of the bindings.</span></span> <span data-ttu-id="73b0a-307">例如，可以从红色、蓝色和绿色的值来计算颜色，这些值可能来自相同绑定源对象，也可能来自不同绑定源对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-307">For example, color may be computed from red, blue, and green values, which can be values from the same or different binding source objects.</span></span> <span data-ttu-id="73b0a-308">有关示例和信息, 请参阅类页。<xref:System.Windows.Data.MultiBinding></span><span class="sxs-lookup"><span data-stu-id="73b0a-308">See the <xref:System.Windows.Data.MultiBinding> class page for examples and information.</span></span>  
  
<a name="binding_to_collections"></a>   
## <a name="binding-to-collections"></a><span data-ttu-id="73b0a-309">绑定到集合</span><span class="sxs-lookup"><span data-stu-id="73b0a-309">Binding to Collections</span></span>  
  
 <span data-ttu-id="73b0a-310">绑定源对象可以视为其属性包含数据的单个对象，也可以视为通常组合在一起的多态对象的数据集合（如数据库的查询结果）。</span><span class="sxs-lookup"><span data-stu-id="73b0a-310">A binding source object can be treated either as a single object of which the properties contain data or as a data collection of polymorphic objects that are often grouped together (such as the result of a query to a database).</span></span> <span data-ttu-id="73b0a-311">到目前为止，我们仅讨论了绑定到单个对象，但绑定到数据集合才是一种常见方案。</span><span class="sxs-lookup"><span data-stu-id="73b0a-311">So far we've only discussed binding to single objects, however, binding to a data collection is a common scenario.</span></span> <span data-ttu-id="73b0a-312">例如, 一种常见<xref:System.Windows.Controls.ItemsControl>方案是使用<xref:System.Windows.Controls.ListBox>、 <xref:System.Windows.Controls.ListView>或<xref:System.Windows.Controls.TreeView>来显示数据集合, 如在[什么是数据绑定？](#what_is_data_binding)一节中显示的应用程序中。</span><span class="sxs-lookup"><span data-stu-id="73b0a-312">For example, a common scenario is to use an <xref:System.Windows.Controls.ItemsControl> such as a <xref:System.Windows.Controls.ListBox>, <xref:System.Windows.Controls.ListView>, or <xref:System.Windows.Controls.TreeView> to display a data collection, such as in the application shown in the [What Is Data Binding?](#what_is_data_binding) section.</span></span>  
  
 <span data-ttu-id="73b0a-313">幸运的是，基本关系图仍然适用。</span><span class="sxs-lookup"><span data-stu-id="73b0a-313">Fortunately, our basic diagram still applies.</span></span> <span data-ttu-id="73b0a-314">如果要将绑定<xref:System.Windows.Controls.ItemsControl>到集合, 关系图如下所示:</span><span class="sxs-lookup"><span data-stu-id="73b0a-314">If you are binding an <xref:System.Windows.Controls.ItemsControl> to a collection, the diagram looks like this:</span></span>  
  
 ![显示数据绑定 System.windows.controls.itemscontrol> 对象的关系图。](./media/data-binding-overview/data-binding-itemscontrol.png)  
  
 <span data-ttu-id="73b0a-316">如图所示, 若要将绑定<xref:System.Windows.Controls.ItemsControl>到集合对象, <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>属性是要使用的属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-316">As shown in this diagram, to bind an <xref:System.Windows.Controls.ItemsControl> to a collection object, <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property is the property to use.</span></span> <span data-ttu-id="73b0a-317">可以<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>将属性视为的内容<xref:System.Windows.Controls.ItemsControl>。</span><span class="sxs-lookup"><span data-stu-id="73b0a-317">You can think of <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property as the content of the <xref:System.Windows.Controls.ItemsControl>.</span></span> <span data-ttu-id="73b0a-318">请注意, 此绑定<xref:System.Windows.Data.BindingMode.OneWay>是因为<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>默认情况<xref:System.Windows.Data.BindingMode.OneWay>下, 该属性支持绑定。</span><span class="sxs-lookup"><span data-stu-id="73b0a-318">Note that the binding is <xref:System.Windows.Data.BindingMode.OneWay> because the <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property supports <xref:System.Windows.Data.BindingMode.OneWay> binding by default.</span></span>  
  
<a name="how_to_implement_collections"></a>   
### <a name="how-to-implement-collections"></a><span data-ttu-id="73b0a-319">如何实现集合</span><span class="sxs-lookup"><span data-stu-id="73b0a-319">How to Implement Collections</span></span>  
 <span data-ttu-id="73b0a-320">可以枚举实现<xref:System.Collections.IEnumerable>接口的任何集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-320">You can enumerate over any collection that implements the <xref:System.Collections.IEnumerable> interface.</span></span> <span data-ttu-id="73b0a-321">但是, 若要设置动态绑定, 以便集合中的插入或删除操作[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]自动更新, 该集合必须<xref:System.Collections.Specialized.INotifyCollectionChanged>实现接口。</span><span class="sxs-lookup"><span data-stu-id="73b0a-321">However, to set up dynamic bindings so that insertions or deletions in the collection update the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] automatically, the collection must implement the <xref:System.Collections.Specialized.INotifyCollectionChanged> interface.</span></span> <span data-ttu-id="73b0a-322">此接口公开一个事件，只要基础集合发生更改，就应该引发该事件。</span><span class="sxs-lookup"><span data-stu-id="73b0a-322">This interface exposes an event that should be raised whenever the underlying collection changes.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="73b0a-323">提供类, 该类是<xref:System.Collections.Specialized.INotifyCollectionChanged>公开接口的数据集合的内置实现。 <xref:System.Collections.ObjectModel.ObservableCollection%601></span><span class="sxs-lookup"><span data-stu-id="73b0a-323">provides the <xref:System.Collections.ObjectModel.ObservableCollection%601> class, which is a built-in implementation of a data collection that exposes the <xref:System.Collections.Specialized.INotifyCollectionChanged> interface.</span></span> <span data-ttu-id="73b0a-324">请注意, 若要完全支持将数据值从源对象传输到目标, 则支持可绑定属性的集合中的每个<xref:System.ComponentModel.INotifyPropertyChanged>对象还必须实现接口。</span><span class="sxs-lookup"><span data-stu-id="73b0a-324">Note that to fully support transferring data values from source objects to targets, each object in your collection that supports bindable properties must also implement the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="73b0a-325">有关详细信息，请参阅[绑定源概述](binding-sources-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-325">For more information, see [Binding Sources Overview](binding-sources-overview.md).</span></span>  
  
 <span data-ttu-id="73b0a-326">在实现自己的集合之前, 请<xref:System.Collections.ObjectModel.ObservableCollection%601>考虑使用或一个现有的集合类, <xref:System.Collections.Generic.List%601>例如、 <xref:System.Collections.ObjectModel.Collection%601>和<xref:System.ComponentModel.BindingList%601>。</span><span class="sxs-lookup"><span data-stu-id="73b0a-326">Before implementing your own collection, consider using <xref:System.Collections.ObjectModel.ObservableCollection%601> or one of the existing collection classes, such as <xref:System.Collections.Generic.List%601>, <xref:System.Collections.ObjectModel.Collection%601>, and <xref:System.ComponentModel.BindingList%601>, among many others.</span></span> <span data-ttu-id="73b0a-327">如果你有一个高级方案, 并且想要实现自己的集合, 请<xref:System.Collections.IList>考虑使用, 它提供了一个对象的非泛型集合, 该集合可按索引单独访问, 从而获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="73b0a-327">If you have an advanced scenario and want to implement your own collection, consider using <xref:System.Collections.IList>, which provides a non-generic collection of objects that can be individually accessed by index and thus the best performance.</span></span>  
  
<a name="collection_views"></a>   
### <a name="collection-views"></a><span data-ttu-id="73b0a-328">集合视图</span><span class="sxs-lookup"><span data-stu-id="73b0a-328">Collection Views</span></span>  
 <span data-ttu-id="73b0a-329"><xref:System.Windows.Controls.ItemsControl>将绑定到数据集合后, 您可能需要对数据进行排序、筛选或分组。</span><span class="sxs-lookup"><span data-stu-id="73b0a-329">Once your <xref:System.Windows.Controls.ItemsControl> is bound to a data collection, you may want to sort, filter, or group the data.</span></span> <span data-ttu-id="73b0a-330">为此, 需要使用集合视图, 这些视图是实现<xref:System.ComponentModel.ICollectionView>接口的类。</span><span class="sxs-lookup"><span data-stu-id="73b0a-330">To do that, you use collection views, which are classes that implement the <xref:System.ComponentModel.ICollectionView> interface.</span></span>  

#### <a name="what-are-collection-views"></a><span data-ttu-id="73b0a-331">什么是集合视图？</span><span class="sxs-lookup"><span data-stu-id="73b0a-331">What Are Collection Views?</span></span>  
 <span data-ttu-id="73b0a-332">集合视图这一层基于绑定源集合，它允许基于排序、筛选和分组查询来导航并显示源集合，而无需更改基础源集合本身。</span><span class="sxs-lookup"><span data-stu-id="73b0a-332">A collection view is a layer on top of a binding source collection that allows you to navigate and display the source collection based on sort, filter, and group queries, without having to change the underlying source collection itself.</span></span> <span data-ttu-id="73b0a-333">集合视图还维护一个指向集合中当前项的指针。</span><span class="sxs-lookup"><span data-stu-id="73b0a-333">A collection view also maintains a pointer to the current item in the collection.</span></span> <span data-ttu-id="73b0a-334">如果源集合实现了<xref:System.Collections.Specialized.INotifyCollectionChanged>接口, 则会将<xref:System.Collections.Specialized.INotifyCollectionChanged.CollectionChanged>事件引发的更改传播到视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-334">If the source collection implements the <xref:System.Collections.Specialized.INotifyCollectionChanged> interface, the changes raised by the <xref:System.Collections.Specialized.INotifyCollectionChanged.CollectionChanged> event are propagated to the views.</span></span>  
  
 <span data-ttu-id="73b0a-335">由于视图不会更改基础源集合，因此每个源集合都可以有多个关联的视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-335">Because views do not change the underlying source collections, each source collection can have multiple views associated with it.</span></span> <span data-ttu-id="73b0a-336">例如，可以有 *Task* 对象的集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-336">For example, you may have a collection of *Task* objects.</span></span> <span data-ttu-id="73b0a-337">使用视图，可以通过不同方式显示相同数据。</span><span class="sxs-lookup"><span data-stu-id="73b0a-337">With the use of views, you can display that same data in different ways.</span></span> <span data-ttu-id="73b0a-338">例如，可能希望在页面左侧显示按优先级排序的任务，而在页面右侧显示按区域分组的任务。</span><span class="sxs-lookup"><span data-stu-id="73b0a-338">For example, on the left side of your page you may want to show tasks sorted by priority, and on the right side, grouped by area.</span></span>  
  
<a name="how_to_create_a_view"></a>   
#### <a name="how-to-create-a-view"></a><span data-ttu-id="73b0a-339">如何创建视图</span><span class="sxs-lookup"><span data-stu-id="73b0a-339">How to Create a View</span></span>  
 <span data-ttu-id="73b0a-340">创建并使用视图的一种方式是直接实例化视图对象，然后将它用作绑定源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-340">One way to create and use a view is to instantiate the view object directly and then use it as the binding source.</span></span> <span data-ttu-id="73b0a-341">例如，请考虑在[什么是数据绑定？](#what_is_data_binding)一节中显示的[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)应用程序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-341">For example, consider the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703) application shown in the [What Is Data Binding?](#what_is_data_binding) section.</span></span> <span data-ttu-id="73b0a-342">实现应用程序, 以便在<xref:System.Windows.Controls.ListBox>数据集合而不是直接对数据集合绑定到视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-342">The application is implemented such that the <xref:System.Windows.Controls.ListBox> binds to a view over the data collection instead of the data collection directly.</span></span> <span data-ttu-id="73b0a-343">下面的示例摘自[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)应用程序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-343">The following example is extracted from the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703) application.</span></span> <span data-ttu-id="73b0a-344">类是继承自<xref:System.Windows.Data.CollectionView>的类的代理。[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] <xref:System.Windows.Data.CollectionViewSource></span><span class="sxs-lookup"><span data-stu-id="73b0a-344">The <xref:System.Windows.Data.CollectionViewSource> class is the [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] proxy of a class that inherits from <xref:System.Windows.Data.CollectionView>.</span></span> <span data-ttu-id="73b0a-345">在此特定示例中, <xref:System.Windows.Data.CollectionViewSource.Source%2A>视图的绑定到当前应用程序对象的*AuctionItems*集合 ( <xref:System.Collections.ObjectModel.ObservableCollection%601>类型为)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-345">In this particular example, the <xref:System.Windows.Data.CollectionViewSource.Source%2A> of the view is bound to the *AuctionItems* collection (of type <xref:System.Collections.ObjectModel.ObservableCollection%601>) of the current application object.</span></span>  
  
 [!code-xaml[DataBindingLab#WindowResources1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#windowresources1)]  
[!code-xaml[DataBindingLab#CollectionViewSource](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#collectionviewsource)]  
[!code-xaml[DataBindingLab#WindowResources2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#windowresources2)]  
  
 <span data-ttu-id="73b0a-346">然后, 资源*listingDataView*充当应用程序中的元素的绑定源, 例如<xref:System.Windows.Controls.ListBox>:</span><span class="sxs-lookup"><span data-stu-id="73b0a-346">The resource *listingDataView* then serves as the binding source for elements in the application, such as the <xref:System.Windows.Controls.ListBox>:</span></span>  
  
 [!code-xaml[DataBindingLab#Master1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master1)]  
[!code-xaml[DataBindingLab#Master2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master2)]  
  
 <span data-ttu-id="73b0a-347">若要为同一集合创建另一个视图, 可以创建另<xref:System.Windows.Data.CollectionViewSource>一个实例, 并为其`x:Key`指定一个不同的名称。</span><span class="sxs-lookup"><span data-stu-id="73b0a-347">To create another view for the same collection, you can create another <xref:System.Windows.Data.CollectionViewSource> instance and give it a different `x:Key` name.</span></span>  
  
 <span data-ttu-id="73b0a-348">下表显示了将哪些视图数据类型创建为默认集合视图或<xref:System.Windows.Data.CollectionViewSource>基于源集合类型。</span><span class="sxs-lookup"><span data-stu-id="73b0a-348">The following table shows which view data types are created as the default collection view or by <xref:System.Windows.Data.CollectionViewSource> based on the source collection type.</span></span>  
  
|<span data-ttu-id="73b0a-349">源集合类型</span><span class="sxs-lookup"><span data-stu-id="73b0a-349">Source collection type</span></span>|<span data-ttu-id="73b0a-350">集合视图类型</span><span class="sxs-lookup"><span data-stu-id="73b0a-350">Collection view type</span></span>|<span data-ttu-id="73b0a-351">说明</span><span class="sxs-lookup"><span data-stu-id="73b0a-351">Notes</span></span>|  
|----------------------------|--------------------------|-----------|  
|<xref:System.Collections.IEnumerable>|<span data-ttu-id="73b0a-352">基于的内部类型<xref:System.Windows.Data.CollectionView></span><span class="sxs-lookup"><span data-stu-id="73b0a-352">An internal type based on <xref:System.Windows.Data.CollectionView></span></span>|<span data-ttu-id="73b0a-353">无法对项进行分组。</span><span class="sxs-lookup"><span data-stu-id="73b0a-353">Cannot group items.</span></span>|  
|<xref:System.Collections.IList>|<xref:System.Windows.Data.ListCollectionView>|<span data-ttu-id="73b0a-354">最快。</span><span class="sxs-lookup"><span data-stu-id="73b0a-354">Fastest.</span></span>|  
|<xref:System.ComponentModel.IBindingList>|<xref:System.Windows.Data.BindingListCollectionView>||  
  
##### <a name="using-a-default-view"></a><span data-ttu-id="73b0a-355">使用默认视图</span><span class="sxs-lookup"><span data-stu-id="73b0a-355">Using a Default View</span></span>  
 <span data-ttu-id="73b0a-356">创建并使用集合视图的一种方式是指定集合视图作为绑定源。</span><span class="sxs-lookup"><span data-stu-id="73b0a-356">Specifying a collection view as a binding source is one way to create and use a collection view.</span></span> <span data-ttu-id="73b0a-357">WPF 还会为用作绑定源的每个集合创建一个默认集合视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-357">WPF also creates a default collection view for every collection used as a binding source.</span></span> <span data-ttu-id="73b0a-358">如果直接绑定到集合，WPF 会绑定到该集合的默认视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-358">If you bind directly to a collection, WPF binds to its default view.</span></span> <span data-ttu-id="73b0a-359">请注意，此默认视图由同一集合的所有绑定共享，因此一个绑定控件或代码对默认视图所做的更改（如排序或对当前项指针的更改，下文将对此进行讨论）会反映到同一集合的所有其他绑定中。</span><span class="sxs-lookup"><span data-stu-id="73b0a-359">Note that this default view is shared by all bindings to the same collection, so a change made to a default view by one bound control or code (such as sorting or a change to the current item pointer, discussed later) is reflected in all other bindings to the same collection.</span></span>  
  
 <span data-ttu-id="73b0a-360">若要获取默认视图, 请使用<xref:System.Windows.Data.CollectionViewSource.GetDefaultView%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="73b0a-360">To get the default view, you use the <xref:System.Windows.Data.CollectionViewSource.GetDefaultView%2A> method.</span></span> <span data-ttu-id="73b0a-361">有关示例，请参阅[获取数据集合的默认视图](how-to-get-the-default-view-of-a-data-collection.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-361">For an example, see [Get the Default View of a Data Collection](how-to-get-the-default-view-of-a-data-collection.md).</span></span>  
  
##### <a name="collection-views-with-adonet-datatables"></a><span data-ttu-id="73b0a-362">包含 ADO.NET DataTables 的集合视图</span><span class="sxs-lookup"><span data-stu-id="73b0a-362">Collection Views with ADO.NET DataTables</span></span>  
 <span data-ttu-id="73b0a-363">为了提高性能, ADO.NET <xref:System.Data.DataTable>或<xref:System.Data.DataView>对象的集合视图将对<xref:System.Data.DataView>进行排序和筛选。</span><span class="sxs-lookup"><span data-stu-id="73b0a-363">To improve performance, collection views for ADO.NET <xref:System.Data.DataTable> or <xref:System.Data.DataView> objects delegate sorting and filtering to the <xref:System.Data.DataView>.</span></span> <span data-ttu-id="73b0a-364">这会导致排序和筛选任务由数据源的所有集合视图分担。</span><span class="sxs-lookup"><span data-stu-id="73b0a-364">This causes sorting and filtering to be shared across all collection views of the data source.</span></span> <span data-ttu-id="73b0a-365">若要使每个集合视图分别进行排序和筛选, 请使用其自己<xref:System.Data.DataView>的对象初始化每个集合视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-365">To enable each collection view to sort and filter independently, initialize each collection view with its own <xref:System.Data.DataView> object.</span></span>  
  
#### <a name="sorting"></a><span data-ttu-id="73b0a-366">排序</span><span class="sxs-lookup"><span data-stu-id="73b0a-366">Sorting</span></span>  
 <span data-ttu-id="73b0a-367">如前所述，视图可以将排序顺序应用于集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-367">As mentioned before, views can apply a sort order to a collection.</span></span> <span data-ttu-id="73b0a-368">如同在基础集合中一样，数据可能具有或不具有相关的固有顺序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-368">As it exists in the underlying collection, your data may or may not have a relevant, inherent order.</span></span> <span data-ttu-id="73b0a-369">借助集合视图，可以根据自己提供的比较条件来强制确定顺序，或更改默认顺序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-369">The view over the collection allows you to impose an order, or change the default order, based on comparison criteria that you supply.</span></span> <span data-ttu-id="73b0a-370">由于这是基于客户端的数据视图，因此一种常见情况是用户可能希望根据列对应的值，对多列表格数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="73b0a-370">Because it is a client-based view of the data, a common scenario is that the user might want to sort columns of tabular data per the value that the column corresponds to.</span></span> <span data-ttu-id="73b0a-371">通过使用视图，可以应用这种用户实施的排序，而无需对基础集合进行任何更改，甚至不必再次查询集合内容。</span><span class="sxs-lookup"><span data-stu-id="73b0a-371">Using views, this user-driven sort can be applied, again without making any changes to the underlying collection or even having to requery for the collection content.</span></span> <span data-ttu-id="73b0a-372">有关示例，请参阅[在单击标题时对 GridView 列进行排序](../controls/how-to-sort-a-gridview-column-when-a-header-is-clicked.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-372">For an example, see [Sort a GridView Column When a Header Is Clicked](../controls/how-to-sort-a-gridview-column-when-a-header-is-clicked.md).</span></span>  
  
 <span data-ttu-id="73b0a-373">下面的示例演示了 "[什么是数据绑定？](#what_is_data_binding) " 一节中的<xref:System.Windows.Controls.CheckBox> "按类别[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]和日期排序" 应用程序的排序逻辑:</span><span class="sxs-lookup"><span data-stu-id="73b0a-373">The following example shows the sorting logic of the "Sort by category and date" <xref:System.Windows.Controls.CheckBox> of the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section:</span></span>  
  
 [!code-csharp[DataBindingLab#8](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#8)]
 [!code-vb[DataBindingLab#8](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#8)]  
  
#### <a name="filtering"></a><span data-ttu-id="73b0a-374">筛选</span><span class="sxs-lookup"><span data-stu-id="73b0a-374">Filtering</span></span>  
 <span data-ttu-id="73b0a-375">视图还可以将筛选器应用于集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-375">Views can also apply a filter to a collection.</span></span> <span data-ttu-id="73b0a-376">这意味着即使集合中可能存在一个项，此特定视图也仅用于显示整个集合的某个子集。</span><span class="sxs-lookup"><span data-stu-id="73b0a-376">This means that although an item might exist in the collection, this particular view is intended to show only a certain subset of the full collection.</span></span> <span data-ttu-id="73b0a-377">可以根据条件在数据中进行筛选。</span><span class="sxs-lookup"><span data-stu-id="73b0a-377">You might filter on a condition in the data.</span></span> <span data-ttu-id="73b0a-378">例如, 当应用程序在[什么是数据绑定？](#what_is_data_binding)一节中完成, "仅显示 bargains" <xref:System.Windows.Controls.CheckBox>包含用于筛选出成本 $25 或更高的项的逻辑。</span><span class="sxs-lookup"><span data-stu-id="73b0a-378">For instance, as is done by the application in the [What Is Data Binding?](#what_is_data_binding) section, the "Show only bargains" <xref:System.Windows.Controls.CheckBox> contains logic to filter out items that cost $25 or more.</span></span> <span data-ttu-id="73b0a-379">选择以下代码时<xref:System.Windows.Controls.CheckBox> , 将*ShowOnlyBargainsFilter* <xref:System.Windows.Data.CollectionViewSource.Filter>设置为事件处理程序:</span><span class="sxs-lookup"><span data-stu-id="73b0a-379">The following code is executed to set *ShowOnlyBargainsFilter* as the <xref:System.Windows.Data.CollectionViewSource.Filter> event handler when that <xref:System.Windows.Controls.CheckBox> is selected:</span></span>  
  
 [!code-csharp[DataBindingLab#10](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#10)]
 [!code-vb[DataBindingLab#10](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#10)]  
  
 <span data-ttu-id="73b0a-380">*ShowOnlyBargainsFilter* 事件处理程序具有以下实现：</span><span class="sxs-lookup"><span data-stu-id="73b0a-380">The *ShowOnlyBargainsFilter* event handler has the following implementation:</span></span>  
  
 [!code-csharp[DataBindingLab#5](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#5)]
 [!code-vb[DataBindingLab#5](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#5)]  
  
 <span data-ttu-id="73b0a-381">如果直接使用某个<xref:System.Windows.Data.CollectionView>类<xref:System.Windows.Data.CollectionViewSource>而不是<xref:System.Windows.Data.CollectionView.Filter%2A> , 则可以使用属性来指定回调。</span><span class="sxs-lookup"><span data-stu-id="73b0a-381">If you are using one of the <xref:System.Windows.Data.CollectionView> classes directly instead of <xref:System.Windows.Data.CollectionViewSource>, you would use the <xref:System.Windows.Data.CollectionView.Filter%2A> property to specify a callback.</span></span> <span data-ttu-id="73b0a-382">有关示例，请参阅[筛选视图中的数据](how-to-filter-data-in-a-view.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-382">For an example, see [Filter Data in a View](how-to-filter-data-in-a-view.md).</span></span>  
  
#### <a name="grouping"></a><span data-ttu-id="73b0a-383">分组</span><span class="sxs-lookup"><span data-stu-id="73b0a-383">Grouping</span></span>  
 <span data-ttu-id="73b0a-384">除查看<xref:System.Collections.IEnumerable>集合的内部类之外, 所有集合视图都支持分组功能, 这允许用户将集合视图中的集合分区为逻辑组。</span><span class="sxs-lookup"><span data-stu-id="73b0a-384">Except for the internal class that views an <xref:System.Collections.IEnumerable> collection, all collection views support the functionality of grouping, which allows the user to partition the collection in the collection view into logical groups.</span></span> <span data-ttu-id="73b0a-385">这些组可以是显式的，由用户提供组列表；也可以是隐式的，这些组依据数据动态生成。</span><span class="sxs-lookup"><span data-stu-id="73b0a-385">The groups can be explicit, where the user supplies a list of groups, or implicit, where the groups are generated dynamically depending on the data.</span></span>  
  
 <span data-ttu-id="73b0a-386">下面的示例显示 "Group by category" <xref:System.Windows.Controls.CheckBox>的逻辑:</span><span class="sxs-lookup"><span data-stu-id="73b0a-386">The following example shows the logic of the "Group by category" <xref:System.Windows.Controls.CheckBox>:</span></span>  
  
 [!code-csharp[DataBindingLab#6](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#6)]
 [!code-vb[DataBindingLab#6](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#6)]  
  
 <span data-ttu-id="73b0a-387">有关其他分组示例，请参阅[对实现 GridView 的 ListView 中的项进行分组](../controls/how-to-group-items-in-a-listview-that-implements-a-gridview.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-387">For another grouping example, see [Group Items in a ListView That Implements a GridView](../controls/how-to-group-items-in-a-listview-that-implements-a-gridview.md).</span></span>  
  
#### <a name="current-item-pointers"></a><span data-ttu-id="73b0a-388">当前项指针</span><span class="sxs-lookup"><span data-stu-id="73b0a-388">Current Item Pointers</span></span>  
 <span data-ttu-id="73b0a-389">视图还支持当前项的概念。</span><span class="sxs-lookup"><span data-stu-id="73b0a-389">Views also support the notion of a current item.</span></span> <span data-ttu-id="73b0a-390">可以在集合视图中的对象之间导航。</span><span class="sxs-lookup"><span data-stu-id="73b0a-390">You can navigate through the objects in a collection view.</span></span> <span data-ttu-id="73b0a-391">在导航时，你是在移动项指针，该指针可用于检索存在于集合中特定位置的对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-391">As you navigate, you are moving an item pointer that allows you to retrieve the object that exists at that particular location in the collection.</span></span> <span data-ttu-id="73b0a-392">有关示例，请参阅[在数据集合视图中的对象之间导航](how-to-navigate-through-the-objects-in-a-data-collectionview.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-392">For an example, see [Navigate Through the Objects in a Data CollectionView](how-to-navigate-through-the-objects-in-a-data-collectionview.md).</span></span>  
  
 <span data-ttu-id="73b0a-393">由于 WPF 只通过使用视图（你指定的视图或集合的默认视图）绑定到集合，因此集合的所有绑定都有一个当前项指针。</span><span class="sxs-lookup"><span data-stu-id="73b0a-393">Because WPF binds to a collection only by using a view (either a view you specify, or the collection's default view), all bindings to collections have a current item pointer.</span></span> <span data-ttu-id="73b0a-394">绑定到视图时，`Path` 值中的斜杠（“/”）字符用于指定视图的当前项。</span><span class="sxs-lookup"><span data-stu-id="73b0a-394">When binding to a view, the slash ("/") character in a `Path` value designates the current item of the view.</span></span> <span data-ttu-id="73b0a-395">在下面的示例中，数据上下文是一个集合视图。</span><span class="sxs-lookup"><span data-stu-id="73b0a-395">In the following example, the data context is a collection view.</span></span> <span data-ttu-id="73b0a-396">第一行绑定到集合。</span><span class="sxs-lookup"><span data-stu-id="73b0a-396">The first line binds to the collection.</span></span> <span data-ttu-id="73b0a-397">第二行绑定到集合中的当前项。</span><span class="sxs-lookup"><span data-stu-id="73b0a-397">The second line binds to the current item in the collection.</span></span> <span data-ttu-id="73b0a-398">第三行绑定到集合中当前项的 `Description` 属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-398">The third line binds to the `Description` property of the current item in the collection.</span></span>  
  
```xaml  
<Button Content="{Binding }" />  
<Button Content="{Binding Path=/}" />  
<Button Content="{Binding Path=/Description}" />   
```  
  
 <span data-ttu-id="73b0a-399">还可以连着使用斜杠和属性语法以遍历集合的分层。</span><span class="sxs-lookup"><span data-stu-id="73b0a-399">The slash and property syntax can also be stacked to traverse a hierarchy of collections.</span></span> <span data-ttu-id="73b0a-400">以下示例绑定到一个名为 `Offices` 的集合的当前项，此集合是源集合的当前项的属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-400">The following example binds to the current item of a collection named `Offices`, which is a property of the current item of the source collection.</span></span>  
  
```xaml  
<Button Content="{Binding /Offices/}" />  
```  
  
 <span data-ttu-id="73b0a-401">当前项指针可能会受对集合应用的任何排序或筛选操作的影响。</span><span class="sxs-lookup"><span data-stu-id="73b0a-401">The current item pointer can be affected by any sorting or filtering that is applied to the collection.</span></span> <span data-ttu-id="73b0a-402">排序操作将当前项指针保留在所选的最后一项上，但集合视图现已围绕此指针重构。</span><span class="sxs-lookup"><span data-stu-id="73b0a-402">Sorting preserves the current item pointer on the last item selected, but the collection view is now restructured around it.</span></span> <span data-ttu-id="73b0a-403">（或许所选项以前曾位于列表的开头，但现在所选项可能位于中间的某个位置。）如果所选内容在筛选之后保留在视图中，则筛选操作会保留所选项。</span><span class="sxs-lookup"><span data-stu-id="73b0a-403">(Perhaps the selected item was at the beginning of the list before, but now the selected item might be somewhere in the middle.) Filtering preserves the selected item if that selection remains in view after the filtering.</span></span> <span data-ttu-id="73b0a-404">否则，当前项指针会设置为经过筛选的集合视图的第一项。</span><span class="sxs-lookup"><span data-stu-id="73b0a-404">Otherwise, the current item pointer is set to the first item of the filtered collection view.</span></span>  
  
<a name="master_detail_scenario"></a>   
#### <a name="master-detail-binding-scenario"></a><span data-ttu-id="73b0a-405">主-从绑定方案</span><span class="sxs-lookup"><span data-stu-id="73b0a-405">Master-Detail Binding Scenario</span></span>  
 <span data-ttu-id="73b0a-406">当前项的概念不仅适用于集合中各项的导航，也适用于主-从绑定方案。</span><span class="sxs-lookup"><span data-stu-id="73b0a-406">The notion of a current item is useful not only for navigation of items in a collection, but also for the master-detail binding scenario.</span></span> <span data-ttu-id="73b0a-407">再考虑一下[什么是数据绑定？](#what_is_data_binding)一节中的应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="73b0a-407">Consider the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section again.</span></span> <span data-ttu-id="73b0a-408">在该应用程序中, 中<xref:System.Windows.Controls.ListBox>的选择确定<xref:System.Windows.Controls.ContentControl>中显示的内容。</span><span class="sxs-lookup"><span data-stu-id="73b0a-408">In that application, the selection within the <xref:System.Windows.Controls.ListBox> determines the content shown in the <xref:System.Windows.Controls.ContentControl>.</span></span> <span data-ttu-id="73b0a-409">若要以另一种方式将其<xref:System.Windows.Controls.ListBox>放在选定项时<xref:System.Windows.Controls.ContentControl> , 将显示所选项的详细信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-409">To put it in another way, when a <xref:System.Windows.Controls.ListBox> item is selected, the <xref:System.Windows.Controls.ContentControl> shows the details of the selected item.</span></span>  
  
 <span data-ttu-id="73b0a-410">只需将两个或更多控件绑定到同一视图即可实现主-从方案。</span><span class="sxs-lookup"><span data-stu-id="73b0a-410">You can implement the master-detail scenario simply by having two or more controls bound to the same view.</span></span> <span data-ttu-id="73b0a-411">以下来自[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)的示例显示<xref:System.Windows.Controls.ListBox>了的标记, 以及<xref:System.Windows.Controls.ContentControl>在[什么是数据绑定？](#what_is_data_binding)一[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]节中的应用程序上看到的标记:</span><span class="sxs-lookup"><span data-stu-id="73b0a-411">The following example from the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703) shows the markup of the <xref:System.Windows.Controls.ListBox> and the <xref:System.Windows.Controls.ContentControl> you see on the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section:</span></span>  
  
 [!code-xaml[DataBindingLab#Master1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master1)]  
[!code-xaml[DataBindingLab#Master2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master2)]  
[!code-xaml[DataBindingLab#Detail](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#detail)]  
  
 <span data-ttu-id="73b0a-412">请注意，这两个控件都绑定到同一个源，即 *listingDataView* 静态资源（请参阅[如何创建视图](#how_to_create_a_view)一节中此资源的定义）。</span><span class="sxs-lookup"><span data-stu-id="73b0a-412">Notice that both of the controls are bound to the same source, the *listingDataView* static resource (see the definition of this resource in the [How to Create a View section](#how_to_create_a_view)).</span></span> <span data-ttu-id="73b0a-413">这是因为当单一实例对象 ( <xref:System.Windows.Controls.ContentControl>在本例中为) 绑定到集合视图时, 它会自动绑定到该<xref:System.Windows.Data.CollectionView.CurrentItem%2A>视图的。</span><span class="sxs-lookup"><span data-stu-id="73b0a-413">This works because when a singleton object (the <xref:System.Windows.Controls.ContentControl> in this case) is bound to a collection view, it automatically binds to the <xref:System.Windows.Data.CollectionView.CurrentItem%2A> of the view.</span></span> <span data-ttu-id="73b0a-414">请注意<xref:System.Windows.Data.CollectionViewSource> , 对象会自动同步货币和选择。</span><span class="sxs-lookup"><span data-stu-id="73b0a-414">Note that <xref:System.Windows.Data.CollectionViewSource> objects automatically synchronize currency and selection.</span></span> <span data-ttu-id="73b0a-415">如果列表控件未绑定到<xref:System.Windows.Data.CollectionViewSource>对象 (如本示例所示), 则需要将其<xref:System.Windows.Controls.Primitives.Selector.IsSynchronizedWithCurrentItem%2A>属性设置为`true` , 以便此工作。</span><span class="sxs-lookup"><span data-stu-id="73b0a-415">If your list control is not bound to a <xref:System.Windows.Data.CollectionViewSource> object as in this example, then you would need to set its <xref:System.Windows.Controls.Primitives.Selector.IsSynchronizedWithCurrentItem%2A> property to `true` for this to work.</span></span>  
  
 <span data-ttu-id="73b0a-416">有关其他示例，请参阅[绑定到集合并基于选择显示信息](how-to-bind-to-a-collection-and-display-information-based-on-selection.md)和[对分层数据使用主-从模式](how-to-use-the-master-detail-pattern-with-hierarchical-data.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-416">For other examples, see [Bind to a Collection and Display Information Based on Selection](how-to-bind-to-a-collection-and-display-information-based-on-selection.md) and [Use the Master-Detail Pattern with Hierarchical Data](how-to-use-the-master-detail-pattern-with-hierarchical-data.md).</span></span>  
  
 <span data-ttu-id="73b0a-417">你可能已经注意到上述示例使用了一个模板。</span><span class="sxs-lookup"><span data-stu-id="73b0a-417">You may have noticed that the above example uses a template.</span></span> <span data-ttu-id="73b0a-418">事实上, 数据不会以我们所需的方式显示, 无需使用模板 (显式<xref:System.Windows.Controls.ContentControl>使用的模板和<xref:System.Windows.Controls.ListBox>由隐式使用的模板)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-418">In fact, the data would not be displayed the way we wish without the use of templates (the one explicitly used by the <xref:System.Windows.Controls.ContentControl> and the one implicitly used by the <xref:System.Windows.Controls.ListBox>).</span></span> <span data-ttu-id="73b0a-419">现在，我们开始介绍下一节中的数据模板化。</span><span class="sxs-lookup"><span data-stu-id="73b0a-419">We now turn to data templating in the next section.</span></span>  
  
<a name="data_templating"></a>   
## <a name="data-templating"></a><span data-ttu-id="73b0a-420">数据模板化</span><span class="sxs-lookup"><span data-stu-id="73b0a-420">Data Templating</span></span>  
 <span data-ttu-id="73b0a-421">如果不使用数据模板，[什么是数据绑定？](#what_is_data_binding)一节中的应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 将如下所示：</span><span class="sxs-lookup"><span data-stu-id="73b0a-421">Without the use of data templates, our application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section would look like the following:</span></span>  
  
 ![没有数据模板的数据绑定演示](./media/data-binding-overview/data-binding-demo-templates.png)  
  
 <span data-ttu-id="73b0a-423">如上一部分的示例中所示, <xref:System.Windows.Controls.ListBox>控件<xref:System.Windows.Controls.ContentControl>和都绑定到*AuctionItem*s 的整个集合对象 (或更具体地说, 是集合对象上的视图)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-423">As shown in the example in the previous section, both the <xref:System.Windows.Controls.ListBox> control and the <xref:System.Windows.Controls.ContentControl> are bound to the entire collection object (or more specifically, the view over the collection object) of *AuctionItem*s.</span></span> <span data-ttu-id="73b0a-424">如果没有关于如何显示数据集合的特定说明, <xref:System.Windows.Controls.ListBox>将显示基础集合中每个对象的字符串表示形式, <xref:System.Windows.Controls.ContentControl>并显示它所绑定到的对象的字符串表示形式。</span><span class="sxs-lookup"><span data-stu-id="73b0a-424">Without specific instructions of how to display the data collection, the <xref:System.Windows.Controls.ListBox> is displaying a string representation of each object in the underlying collection and the <xref:System.Windows.Controls.ContentControl> is displaying a string representation of the object it is bound to.</span></span>  
  
 <span data-ttu-id="73b0a-425">若要解决此问题, 应用程序<xref:System.Windows.DataTemplate>将定义。</span><span class="sxs-lookup"><span data-stu-id="73b0a-425">To solve that problem, the application defines <xref:System.Windows.DataTemplate>s.</span></span> <span data-ttu-id="73b0a-426">如上一部分的示例中所示, <xref:System.Windows.Controls.ContentControl>显式使用*detailsProductListingTemplate*<xref:System.Windows.DataTemplate>。</span><span class="sxs-lookup"><span data-stu-id="73b0a-426">As shown in the example in the previous section, the <xref:System.Windows.Controls.ContentControl> explicitly uses the *detailsProductListingTemplate*<xref:System.Windows.DataTemplate>.</span></span> <span data-ttu-id="73b0a-427">显示<xref:System.Windows.Controls.ListBox>集合中的*AuctionItem*对象<xref:System.Windows.DataTemplate>时, 控件隐式使用以下内容:</span><span class="sxs-lookup"><span data-stu-id="73b0a-427">The <xref:System.Windows.Controls.ListBox> control implicitly uses the following <xref:System.Windows.DataTemplate> when displaying the *AuctionItem* objects in the collection:</span></span>  
  
 [!code-xaml[DataBindingLab#AuctionItemDataTemplate](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/DataBindingLabApp.xaml#auctionitemdatatemplate)]  
  
 <span data-ttu-id="73b0a-428">使用这两个<xref:System.Windows.DataTemplate>, 生成的 UI 就是在[什么是数据绑定？](#what_is_data_binding)一节中显示的 UI。</span><span class="sxs-lookup"><span data-stu-id="73b0a-428">With the use of those two <xref:System.Windows.DataTemplate>s, the resulting UI is the one shown in the [What Is Data Binding?](#what_is_data_binding) section.</span></span> <span data-ttu-id="73b0a-429">从该屏幕截图中可以看到, 除了允许您将数据放置在控件中外, <xref:System.Windows.DataTemplate>还允许您为数据定义引人注目的视觉对象。</span><span class="sxs-lookup"><span data-stu-id="73b0a-429">As you can see from that screenshot, in addition to letting you place data in your controls, <xref:System.Windows.DataTemplate>s allow you to define compelling visuals for your data.</span></span> <span data-ttu-id="73b0a-430">例如, 在<xref:System.Windows.DataTrigger>上述<xref:System.Windows.DataTemplate>示例中使用了, 这样, 带有*SpecialFeatures*值*突出*显示的*AuctionItem*将显示为橙色边框和星形。</span><span class="sxs-lookup"><span data-stu-id="73b0a-430">For example, <xref:System.Windows.DataTrigger>s are used in the above <xref:System.Windows.DataTemplate> so that *AuctionItem*s with *SpecialFeatures* value of *HighLight* would be displayed with an orange border and a star.</span></span>  
  
 <span data-ttu-id="73b0a-431">有关数据模板的详细信息，请参阅[数据模板化概述](data-templating-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="73b0a-431">For more information about data templates, see the [Data Templating Overview](data-templating-overview.md).</span></span>  
  
<a name="data_validation"></a>   
## <a name="data-validation"></a><span data-ttu-id="73b0a-432">数据验证</span><span class="sxs-lookup"><span data-stu-id="73b0a-432">Data Validation</span></span>  
  
 <span data-ttu-id="73b0a-433">接受用户输入的大多数应用程序都需要具有验证逻辑，以确保用户输入了预期信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-433">Most applications that take user input need to have validation logic to ensure that the user has entered the expected information.</span></span> <span data-ttu-id="73b0a-434">可基于类型、范围、格式或特定于应用程序的其他要求执行验证检查。</span><span class="sxs-lookup"><span data-stu-id="73b0a-434">The validation checks can be based on type, range, format, or other application-specific requirements.</span></span> <span data-ttu-id="73b0a-435">本节讨论了数据验证在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中的工作原理。</span><span class="sxs-lookup"><span data-stu-id="73b0a-435">This section discusses how data validation works in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
### <a name="associating-validation-rules-with-a-binding"></a><span data-ttu-id="73b0a-436">将验证规则与绑定关联</span><span class="sxs-lookup"><span data-stu-id="73b0a-436">Associating Validation Rules with a Binding</span></span>  
 <span data-ttu-id="73b0a-437">数据绑定模型允许您将与您<xref:System.Windows.Data.Binding>的对象相关联<xref:System.Windows.Data.Binding.ValidationRules%2A>。 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</span><span class="sxs-lookup"><span data-stu-id="73b0a-437">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding model allows you to associate <xref:System.Windows.Data.Binding.ValidationRules%2A> with your <xref:System.Windows.Data.Binding> object.</span></span> <span data-ttu-id="73b0a-438">例如, 下面的<xref:System.Windows.Controls.TextBox>示例将绑定到名`StartPrice`为的属性, 并<xref:System.Windows.Data.Binding.ValidationRules%2A?displayProperty=nameWithType>将<xref:System.Windows.Controls.ExceptionValidationRule>对象添加到属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-438">For example, the following example binds a <xref:System.Windows.Controls.TextBox> to a property named `StartPrice` and adds a <xref:System.Windows.Controls.ExceptionValidationRule> object to the <xref:System.Windows.Data.Binding.ValidationRules%2A?displayProperty=nameWithType> property.</span></span>  
  
 [!code-xaml[DataBindingLab#DefaultValidation](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/AddProductWindow.xaml#defaultvalidation)]  
  
 <span data-ttu-id="73b0a-439"><xref:System.Windows.Controls.ValidationRule>对象检查属性的值是否有效。</span><span class="sxs-lookup"><span data-stu-id="73b0a-439">A <xref:System.Windows.Controls.ValidationRule> object checks whether the value of a property is valid.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="73b0a-440">具有以下两种类型的内置<xref:System.Windows.Controls.ValidationRule>对象:</span><span class="sxs-lookup"><span data-stu-id="73b0a-440">has the following two types of built-in <xref:System.Windows.Controls.ValidationRule> objects:</span></span>  
  
- <span data-ttu-id="73b0a-441"><xref:System.Windows.Controls.ExceptionValidationRule>检查在绑定源属性更新过程中引发的异常。</span><span class="sxs-lookup"><span data-stu-id="73b0a-441">A <xref:System.Windows.Controls.ExceptionValidationRule> checks for exceptions thrown during the update of the binding source property.</span></span> <span data-ttu-id="73b0a-442">在以上示例中，`StartPrice` 为整数类型。</span><span class="sxs-lookup"><span data-stu-id="73b0a-442">In the previous example, `StartPrice` is of type integer.</span></span> <span data-ttu-id="73b0a-443">当用户输入的值无法转换为整数时，将引发异常，这会导致将绑定标记为无效。</span><span class="sxs-lookup"><span data-stu-id="73b0a-443">When the user enters a value that cannot be converted to an integer, an exception is thrown, causing the binding to be marked as invalid.</span></span> <span data-ttu-id="73b0a-444">用于显式设置<xref:System.Windows.Controls.ExceptionValidationRule>的替代语法是将<xref:System.Windows.Data.Binding>或<xref:System.Windows.Data.MultiBinding>对象的<xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A>属性设置`true`为。</span><span class="sxs-lookup"><span data-stu-id="73b0a-444">An alternative syntax to setting the <xref:System.Windows.Controls.ExceptionValidationRule> explicitly is to set the <xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A> property to `true` on your <xref:System.Windows.Data.Binding> or <xref:System.Windows.Data.MultiBinding> object.</span></span>  
  
- <span data-ttu-id="73b0a-445">对象检查由<xref:System.ComponentModel.IDataErrorInfo>实现接口的对象引发的错误。 <xref:System.Windows.Controls.DataErrorValidationRule></span><span class="sxs-lookup"><span data-stu-id="73b0a-445">A <xref:System.Windows.Controls.DataErrorValidationRule> object checks for errors that are raised by objects that implement the <xref:System.ComponentModel.IDataErrorInfo> interface.</span></span> <span data-ttu-id="73b0a-446">有关使用此验证规则的示例, 请参阅<xref:System.Windows.Controls.DataErrorValidationRule>。</span><span class="sxs-lookup"><span data-stu-id="73b0a-446">For an example of using this validation rule, see <xref:System.Windows.Controls.DataErrorValidationRule>.</span></span> <span data-ttu-id="73b0a-447">用于显式设置<xref:System.Windows.Controls.DataErrorValidationRule>的替代语法是将<xref:System.Windows.Data.Binding>或<xref:System.Windows.Data.MultiBinding>对象的<xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A>属性设置`true`为。</span><span class="sxs-lookup"><span data-stu-id="73b0a-447">An alternative syntax to setting the <xref:System.Windows.Controls.DataErrorValidationRule> explicitly is to set the <xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A> property to `true` on your <xref:System.Windows.Data.Binding> or <xref:System.Windows.Data.MultiBinding> object.</span></span>  
  
 <span data-ttu-id="73b0a-448">你还可以通过从<xref:System.Windows.Controls.ValidationRule>类派生并<xref:System.Windows.Controls.ValidationRule.Validate%2A>实现方法来创建自己的验证规则。</span><span class="sxs-lookup"><span data-stu-id="73b0a-448">You can also create your own validation rule by deriving from the <xref:System.Windows.Controls.ValidationRule> class and implementing the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method.</span></span> <span data-ttu-id="73b0a-449">下面的示例显示了 "[什么是数据绑定？](#what_is_data_binding) " 部分<xref:System.Windows.Controls.TextBox>中 "*添加产品列表*" 开始日期所使用的规则:</span><span class="sxs-lookup"><span data-stu-id="73b0a-449">The following example shows the rule used by the *Add Product Listing* "Start Date" <xref:System.Windows.Controls.TextBox> from the [What Is Data Binding?](#what_is_data_binding) section:</span></span>  
  
 [!code-csharp[DataBindingLab#2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/FutureDateRule.cs#2)]
 [!code-vb[DataBindingLab#2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/FutureDateRule.vb#2)]  
  
 <span data-ttu-id="73b0a-450">StartDateEntryForm<xref:System.Windows.Controls.TextBox>使用此*FutureDateRule*, 如以下示例中所示:</span><span class="sxs-lookup"><span data-stu-id="73b0a-450">The *StartDateEntryForm* <xref:System.Windows.Controls.TextBox> uses this *FutureDateRule*, as shown in the following example:</span></span>  
  
 [!code-xaml[DataBindingLab#CustomValidation](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/AddProductWindow.xaml#customvalidation)]  
  
 <span data-ttu-id="73b0a-451">请注意, 由于<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值为<xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, 因此绑定引擎将在每次击键时更新源值, 这意味着它还会检查每个<xref:System.Windows.Data.Binding.ValidationRules%2A>击键的集合中的每个规则。</span><span class="sxs-lookup"><span data-stu-id="73b0a-451">Note that because the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value is <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, the binding engine updates the source value on every keystroke, which means it also checks every rule in the <xref:System.Windows.Data.Binding.ValidationRules%2A> collection on every keystroke.</span></span> <span data-ttu-id="73b0a-452">我们会在“验证过程”一节中对此深入讨论。</span><span class="sxs-lookup"><span data-stu-id="73b0a-452">We discuss this further in the Validation Process section.</span></span>  
  
<a name="invalidation_feedback"></a>   
### <a name="providing-visual-feedback"></a><span data-ttu-id="73b0a-453">提供视觉反馈</span><span class="sxs-lookup"><span data-stu-id="73b0a-453">Providing Visual Feedback</span></span>  
 <span data-ttu-id="73b0a-454">如果用户输入的值无效，你可能希望在应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 上提供一些有关错误的反馈。</span><span class="sxs-lookup"><span data-stu-id="73b0a-454">If the user enters an invalid value, you may want to provide some feedback about the error on the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="73b0a-455">提供此类反馈的一种方法是将<xref:System.Windows.Controls.Validation.ErrorTemplate%2A?displayProperty=nameWithType>附加属性设置为自<xref:System.Windows.Controls.ControlTemplate>定义。</span><span class="sxs-lookup"><span data-stu-id="73b0a-455">One way to provide such feedback is to set the <xref:System.Windows.Controls.Validation.ErrorTemplate%2A?displayProperty=nameWithType> attached property to a custom <xref:System.Windows.Controls.ControlTemplate>.</span></span> <span data-ttu-id="73b0a-456">如上一节所示, *StartDateEntryForm* <xref:System.Windows.Controls.TextBox>使用<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>称为*validationTemplate*。</span><span class="sxs-lookup"><span data-stu-id="73b0a-456">As shown in the previous subsection, the *StartDateEntryForm* <xref:System.Windows.Controls.TextBox> uses an <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> called *validationTemplate*.</span></span> <span data-ttu-id="73b0a-457">以下示例显示了 *validationTemplate* 的定义：</span><span class="sxs-lookup"><span data-stu-id="73b0a-457">The following example shows the definition of *validationTemplate*:</span></span>  
  
 [!code-xaml[DataBindingLab#1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/AddProductWindow.xaml#1)]  
  
 <span data-ttu-id="73b0a-458"><xref:System.Windows.Controls.AdornedElementPlaceholder>元素指定要装饰的控件的放置位置。</span><span class="sxs-lookup"><span data-stu-id="73b0a-458">The <xref:System.Windows.Controls.AdornedElementPlaceholder> element specifies where the control being adorned should be placed.</span></span>  
  
 <span data-ttu-id="73b0a-459">此外, 你还可以使用<xref:System.Windows.Controls.ToolTip>来显示错误消息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-459">In addition, you may also use a <xref:System.Windows.Controls.ToolTip> to display the error message.</span></span> <span data-ttu-id="73b0a-460">*StartDateEntryForm*和*StartPriceEntryForm*<xref:System.Windows.Controls.TextBox>es 都使用 style *textStyleTextBox*, 这会创建一个<xref:System.Windows.Controls.ToolTip>显示错误消息的。</span><span class="sxs-lookup"><span data-stu-id="73b0a-460">Both the *StartDateEntryForm* and the *StartPriceEntryForm*<xref:System.Windows.Controls.TextBox>es use the style *textStyleTextBox*, which creates a <xref:System.Windows.Controls.ToolTip> that displays the error message.</span></span> <span data-ttu-id="73b0a-461">以下示例显示了 *textStyleTextBox* 的定义。</span><span class="sxs-lookup"><span data-stu-id="73b0a-461">The following example shows the definition of *textStyleTextBox*.</span></span> <span data-ttu-id="73b0a-462">当绑定元素<xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType>的`true`属性上的一个或多个绑定出错时, 附加属性为。</span><span class="sxs-lookup"><span data-stu-id="73b0a-462">The attached property <xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType> is `true` when one or more of the bindings on the properties of the bound element are in error.</span></span>  
  
 [!code-xaml[DataBindingLab#14](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/DataBindingLabApp.xaml#14)]  
  
 <span data-ttu-id="73b0a-463">如果存在验证<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>错误<xref:System.Windows.Controls.ToolTip>, 则使用自定义和时, *StartDateEntryForm* <xref:System.Windows.Controls.TextBox>如下所示:</span><span class="sxs-lookup"><span data-stu-id="73b0a-463">With the custom <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> and the <xref:System.Windows.Controls.ToolTip>, the *StartDateEntryForm* <xref:System.Windows.Controls.TextBox> looks like the following when there is a validation error:</span></span>  
  
 <span data-ttu-id="73b0a-464">![数据绑定验证错误](./media/databindingdemo-validation.PNG "DataBindingDemo_Validation")</span><span class="sxs-lookup"><span data-stu-id="73b0a-464">![Data binding validation error](./media/databindingdemo-validation.PNG "DataBindingDemo_Validation")</span></span>  
  
 <span data-ttu-id="73b0a-465">如果你<xref:System.Windows.Data.Binding>具有关联的验证规则, 但你未<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>在绑定控件上指定, 则将<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>使用默认值来在发生验证错误时通知用户。</span><span class="sxs-lookup"><span data-stu-id="73b0a-465">If your <xref:System.Windows.Data.Binding> has associated validation rules but you do not specify an <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> on the bound control, a default <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> will be used to notify users when there is a validation error.</span></span> <span data-ttu-id="73b0a-466">默认值<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>是在装饰器层中定义红色边框的控件模板。</span><span class="sxs-lookup"><span data-stu-id="73b0a-466">The default <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> is a control template that defines a red border in the adorner layer.</span></span> <span data-ttu-id="73b0a-467">如果存在验证<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>错误<xref:System.Windows.Controls.ToolTip>, 则默认[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]值为, *StartPriceEntryForm* <xref:System.Windows.Controls.TextBox>的如下所示:</span><span class="sxs-lookup"><span data-stu-id="73b0a-467">With the default <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> and the <xref:System.Windows.Controls.ToolTip>, the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] of the *StartPriceEntryForm* <xref:System.Windows.Controls.TextBox> looks like the following when there is a validation error:</span></span>  
  
 <span data-ttu-id="73b0a-468">![数据绑定验证错误](./media/databindingdemo-validationdefault.PNG "DataBindingDemo_ValidationDefault")</span><span class="sxs-lookup"><span data-stu-id="73b0a-468">![Data binding validation error](./media/databindingdemo-validationdefault.PNG "DataBindingDemo_ValidationDefault")</span></span>  
  
 <span data-ttu-id="73b0a-469">有关如何提供逻辑以验证对话框中所有控件的示例，请参阅[对话框概述](../app-development/dialog-boxes-overview.md)中的“自定义对话框”一节。</span><span class="sxs-lookup"><span data-stu-id="73b0a-469">For an example of how to provide logic to validate all controls in a dialog box, see the Custom Dialog Boxes section in the [Dialog Boxes Overview](../app-development/dialog-boxes-overview.md).</span></span>  
  
### <a name="validation-process"></a><span data-ttu-id="73b0a-470">验证过程</span><span class="sxs-lookup"><span data-stu-id="73b0a-470">Validation Process</span></span>  
 <span data-ttu-id="73b0a-471">通常，在目标的值传输到绑定源属性时会进行验证。</span><span class="sxs-lookup"><span data-stu-id="73b0a-471">Validation usually occurs when the value of a target is transferred to the binding source property.</span></span> <span data-ttu-id="73b0a-472">此操作发生<xref:System.Windows.Data.BindingMode.TwoWay>在<xref:System.Windows.Data.BindingMode.OneWayToSource>和绑定上。</span><span class="sxs-lookup"><span data-stu-id="73b0a-472">This occurs on <xref:System.Windows.Data.BindingMode.TwoWay> and <xref:System.Windows.Data.BindingMode.OneWayToSource> bindings.</span></span> <span data-ttu-id="73b0a-473">重申一下, 源更新的原因取决于<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>属性的值, 如[什么触发器源更新](#what_triggers_source_updates)部分所述。</span><span class="sxs-lookup"><span data-stu-id="73b0a-473">To reiterate, what causes a source update depends on the value of the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property, as described in the [What Triggers Source Updates](#what_triggers_source_updates) section.</span></span>  
  
 <span data-ttu-id="73b0a-474">下面描述了*验证*过程。</span><span class="sxs-lookup"><span data-stu-id="73b0a-474">The following describes the *validation* process.</span></span> <span data-ttu-id="73b0a-475">注意，只要在验证过程中发生验证错误或其他类型的错误，该过程就会中断。</span><span class="sxs-lookup"><span data-stu-id="73b0a-475">Note that if a validation error or other type of error occurs at any time during this process, the process is halted.</span></span>  
  
1. <span data-ttu-id="73b0a-476">绑定引擎检查是否存在<xref:System.Windows.Controls.ValidationRule> <xref:System.Windows.Controls.ValidationStep.RawProposedValue> <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> <xref:System.Windows.Controls.ValidationRule.Validate%2A> 为设置<xref:System.Windows.Controls.ValidationRule>为的自定义对象,在这种情况下,将在每个对象上调用方法,直到其中一个对象出现错误<xref:System.Windows.Data.Binding>或直到全部通过。</span><span class="sxs-lookup"><span data-stu-id="73b0a-476">The binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.RawProposedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> until one of them runs into an error or until all of them pass.</span></span>  
  
2. <span data-ttu-id="73b0a-477">绑定引擎随后会调用转换器（如果存在）。</span><span class="sxs-lookup"><span data-stu-id="73b0a-477">The binding engine then calls the converter, if one exists.</span></span>  
  
3. <span data-ttu-id="73b0a-478">如果转换器成功, 绑定引擎会检查是否有定义的任何自<xref:System.Windows.Controls.ValidationRule>定义对象<xref:System.Windows.Data.Binding>( <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>将其设置<xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue>为), 在这种情况下, <xref:System.Windows.Controls.ValidationRule.Validate%2A>它<xref:System.Windows.Controls.ValidationRule>将对具有设置为<xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue> , 直到其中一个错误发生, 或直到全部通过为止。 <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-478">If the converter succeeds, the binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue> until one of them runs into an error or until all of them pass.</span></span>  
  
4. <span data-ttu-id="73b0a-479">绑定引擎设置源属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-479">The binding engine sets the source property.</span></span>  
  
5. <span data-ttu-id="73b0a-480">绑定<xref:System.Windows.Controls.ValidationRule>引擎检查是否有<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> <xref:System.Windows.Controls.ValidationRule.Validate%2A> <xref:System.Windows.Controls.ValidationStep.UpdatedValue> 为设置为的<xref:System.Windows.Controls.ValidationRule>自定义对象,该对象的设置为,在这种情况下,它将在设置为的每个上调用方法。<xref:System.Windows.Data.Binding><xref:System.Windows.Controls.ValidationStep.UpdatedValue>直到其中一个出现错误, 或直到全部通过为止。</span><span class="sxs-lookup"><span data-stu-id="73b0a-480">The binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> until one of them runs into an error or until all of them pass.</span></span> <span data-ttu-id="73b0a-481">如果与某个绑定相关联, 并且其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为默认值, <xref:System.Windows.Controls.ValidationStep.UpdatedValue> <xref:System.Windows.Controls.DataErrorValidationRule>则此时会检查。 <xref:System.Windows.Controls.DataErrorValidationRule></span><span class="sxs-lookup"><span data-stu-id="73b0a-481">If a <xref:System.Windows.Controls.DataErrorValidationRule> is associated with a binding and its <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to the default, <xref:System.Windows.Controls.ValidationStep.UpdatedValue>, the <xref:System.Windows.Controls.DataErrorValidationRule> is checked at this point.</span></span> <span data-ttu-id="73b0a-482">这也是在检查设置为<xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A> `true`的绑定时的点。</span><span class="sxs-lookup"><span data-stu-id="73b0a-482">This is also the point when bindings that have the <xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A> set to `true` are checked.</span></span>  
  
6. <span data-ttu-id="73b0a-483">绑定<xref:System.Windows.Controls.ValidationRule>引擎检查是否有<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> <xref:System.Windows.Controls.ValidationRule.Validate%2A> <xref:System.Windows.Controls.ValidationStep.CommittedValue> 为设置为的<xref:System.Windows.Controls.ValidationRule>自定义对象,该对象的设置为,在这种情况下,它将在设置为的每个上调用方法。<xref:System.Windows.Data.Binding><xref:System.Windows.Controls.ValidationStep.CommittedValue>直到其中一个出现错误, 或直到全部通过为止。</span><span class="sxs-lookup"><span data-stu-id="73b0a-483">The binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.CommittedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.CommittedValue> until one of them runs into an error or until all of them pass.</span></span>  
  
 <span data-ttu-id="73b0a-484">如果在此过程中的任何时间都未通过, 则绑定引擎将创建<xref:System.Windows.Controls.ValidationError>一个对象<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>并将其添加到绑定元素的集合中。 <xref:System.Windows.Controls.ValidationRule></span><span class="sxs-lookup"><span data-stu-id="73b0a-484">If a <xref:System.Windows.Controls.ValidationRule> does not pass at any time throughout this process, the binding engine creates a <xref:System.Windows.Controls.ValidationError> object and adds it to the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> collection of the bound element.</span></span> <span data-ttu-id="73b0a-485">在绑定引擎运行任何给定<xref:System.Windows.Controls.ValidationRule>步骤的对象之前, 它会删除在<xref:System.Windows.Controls.ValidationError>该步骤中添加到<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>绑定元素的附加属性的任何。</span><span class="sxs-lookup"><span data-stu-id="73b0a-485">Before the binding engine runs the <xref:System.Windows.Controls.ValidationRule> objects at any given step, it removes any <xref:System.Windows.Controls.ValidationError> that was added to the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> attached property of the bound element during that step.</span></span> <span data-ttu-id="73b0a-486">例如, 如果设置为<xref:System.Windows.Controls.ValidationRule> <xref:System.Windows.Controls.ValidationStep.UpdatedValue> " <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>失败" 的, 则下一次执行验证过程时, 绑定<xref:System.Windows.Controls.ValidationRule>引擎会立即删除<xref:System.Windows.Controls.ValidationError> , 然后再调用已<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.UpdatedValue>.</span><span class="sxs-lookup"><span data-stu-id="73b0a-486">For example, if a <xref:System.Windows.Controls.ValidationRule> whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> failed, the next time the validation process occurs, the binding engine removes that <xref:System.Windows.Controls.ValidationError> immediately before it calls any <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue>.</span></span>  
  
 <span data-ttu-id="73b0a-487">如果<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>不为空<xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType> , 则元素的附加属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="73b0a-487">When <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> is not empty, the <xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType> attached property of the element is set to `true`.</span></span> <span data-ttu-id="73b0a-488">此外, 如果<xref:System.Windows.Data.Binding.NotifyOnValidationError%2A>将的<xref:System.Windows.Data.Binding>属性设置为`true`, 则绑定引擎将在元素上引发<xref:System.Windows.Controls.Validation.Error?displayProperty=nameWithType>附加事件。</span><span class="sxs-lookup"><span data-stu-id="73b0a-488">Also, if the <xref:System.Windows.Data.Binding.NotifyOnValidationError%2A> property of the <xref:System.Windows.Data.Binding> is set to `true`, then the binding engine raises the <xref:System.Windows.Controls.Validation.Error?displayProperty=nameWithType> attached event on the element.</span></span>  
  
 <span data-ttu-id="73b0a-489">另请注意, 在任一方向 (目标到源或源到目标) 的有效值传输都将<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>清除附加属性。</span><span class="sxs-lookup"><span data-stu-id="73b0a-489">Also note that a valid value transfer in either direction (target to source or source to target) clears the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> attached property.</span></span>  
  
 <span data-ttu-id="73b0a-490">如果绑定具有与之关联<xref:System.Windows.Controls.ExceptionValidationRule>的, 或<xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A>将属性设置为`true` , 并且在绑定引擎设置源时引发异常, 则绑定<xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>引擎会检查是否存在。</span><span class="sxs-lookup"><span data-stu-id="73b0a-490">If the binding either has an <xref:System.Windows.Controls.ExceptionValidationRule> associated with it, or had the <xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A> property is set to `true` and an exception is thrown when the binding engine sets the source, the binding engine checks to see if there is a <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>.</span></span> <span data-ttu-id="73b0a-491">您可以选择使用<xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>回调提供自定义处理程序来处理异常。</span><span class="sxs-lookup"><span data-stu-id="73b0a-491">You have the option to use the <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A> callback to provide a custom handler for handling exceptions.</span></span> <span data-ttu-id="73b0a-492">如果未<xref:System.Windows.Controls.ValidationError> <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>在上指定, 则绑定引擎将创建一个具有异常的, 并将其添加到绑定元素的集合中。 <xref:System.Windows.Data.Binding> <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A></span><span class="sxs-lookup"><span data-stu-id="73b0a-492">If an <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A> is not specified on the <xref:System.Windows.Data.Binding>, the binding engine creates a <xref:System.Windows.Controls.ValidationError> with the exception and adds it to the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> collection of the bound element.</span></span>  
  
## <a name="debugging-mechanism"></a><span data-ttu-id="73b0a-493">调试机制</span><span class="sxs-lookup"><span data-stu-id="73b0a-493">Debugging Mechanism</span></span>  
 <span data-ttu-id="73b0a-494">您可以对与绑定相关<xref:System.Diagnostics.PresentationTraceSources.TraceLevel%2A?displayProperty=nameWithType>的对象设置附加属性, 以接收有关特定绑定的状态的信息。</span><span class="sxs-lookup"><span data-stu-id="73b0a-494">You can set the attached property <xref:System.Diagnostics.PresentationTraceSources.TraceLevel%2A?displayProperty=nameWithType> on a binding-related object to receive information about the status of a specific binding.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="73b0a-495">请参阅</span><span class="sxs-lookup"><span data-stu-id="73b0a-495">See also</span></span>

- <xref:System.Windows.Controls.DataErrorValidationRule>
- [<span data-ttu-id="73b0a-496">WPF 版本 4.5 中的新增功能</span><span class="sxs-lookup"><span data-stu-id="73b0a-496">What's New in WPF Version 4.5</span></span>](../getting-started/whats-new.md)
- [<span data-ttu-id="73b0a-497">绑定到 LINQ 查询结果</span><span class="sxs-lookup"><span data-stu-id="73b0a-497">Bind to the Results of a LINQ Query</span></span>](how-to-bind-to-the-results-of-a-linq-query.md)
- [<span data-ttu-id="73b0a-498">数据绑定</span><span class="sxs-lookup"><span data-stu-id="73b0a-498">Data Binding</span></span>](../advanced/optimizing-performance-data-binding.md)
- [<span data-ttu-id="73b0a-499">数据绑定演示</span><span class="sxs-lookup"><span data-stu-id="73b0a-499">Data Binding Demo</span></span>](https://go.microsoft.com/fwlink/?LinkID=163703)
- [<span data-ttu-id="73b0a-500">帮助主题</span><span class="sxs-lookup"><span data-stu-id="73b0a-500">How-to Topics</span></span>](data-binding-how-to-topics.md)
- [<span data-ttu-id="73b0a-501">绑定到 ADO.NET 数据源</span><span class="sxs-lookup"><span data-stu-id="73b0a-501">Bind to an ADO.NET Data Source</span></span>](how-to-bind-to-an-ado-net-data-source.md)
