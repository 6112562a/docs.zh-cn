---
title: 数据绑定概述
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- data conversion for binding [WPF]
- binding data [WPF], about data binding
- data binding [WPF], about data binding
- conversion for data binding [WPF]
ms.assetid: c707c95f-7811-401d-956e-2fffd019a211
ms.openlocfilehash: f849cf306f4de0cbaa7623ded4ab7045bb5112a6
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/18/2019
ms.locfileid: "59315317"
---
# <a name="data-binding-overview"></a><span data-ttu-id="7dc84-102">数据绑定概述</span><span class="sxs-lookup"><span data-stu-id="7dc84-102">Data Binding Overview</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="7dc84-103">数据绑定为应用程序呈现数据并与数据交互提供了一种简单且一致的方式。</span><span class="sxs-lookup"><span data-stu-id="7dc84-103">data binding provides a simple and consistent way for applications to present and interact with data.</span></span> <span data-ttu-id="7dc84-104">元素能够以 [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] 对象和 [!INCLUDE[TLA#tla_xml](../../../../includes/tlasharptla-xml-md.md)] 形式绑定到来自各种数据源的数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-104">Elements can be bound to data from a variety of data sources in the form of [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] objects and [!INCLUDE[TLA#tla_xml](../../../../includes/tlasharptla-xml-md.md)].</span></span> <span data-ttu-id="7dc84-105"><xref:System.Windows.Controls.ContentControl>如 s<xref:System.Windows.Controls.Button>并<xref:System.Windows.Controls.ItemsControl>如 s<xref:System.Windows.Controls.ListBox>和<xref:System.Windows.Controls.ListView>具有内置功能，使灵活的样式设置单个数据项的集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-105"><xref:System.Windows.Controls.ContentControl>s such as <xref:System.Windows.Controls.Button> and <xref:System.Windows.Controls.ItemsControl>s such as <xref:System.Windows.Controls.ListBox> and <xref:System.Windows.Controls.ListView> have built-in functionality to enable flexible styling of single data items or collections of data items.</span></span> <span data-ttu-id="7dc84-106">可基于数据生成排序、筛选和分组视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-106">Sort, filter, and group views can be generated on top of the data.</span></span>  
  
 <span data-ttu-id="7dc84-107">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中的数据绑定功能与传统模型相比具有几个优点，包括本质上支持数据绑定的大量属性、灵活的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 数据 UI 表示形式以及业务逻辑与 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的完全分离。</span><span class="sxs-lookup"><span data-stu-id="7dc84-107">The data binding functionality in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] has several advantages over traditional models, including a broad range of properties that inherently support data binding, flexible [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] representation of data, and clean separation of business logic from [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
 <span data-ttu-id="7dc84-108">本主题首先讨论基本概念[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]的使用情况数据绑定，然后<xref:System.Windows.Data.Binding>类和数据绑定的其他功能。</span><span class="sxs-lookup"><span data-stu-id="7dc84-108">This topic first discusses concepts fundamental to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding and then goes into the usage of the <xref:System.Windows.Data.Binding> class and other features of data binding.</span></span>  

<a name="what_is_data_binding"></a>   
## <a name="what-is-data-binding"></a><span data-ttu-id="7dc84-109">什么是数据绑定？</span><span class="sxs-lookup"><span data-stu-id="7dc84-109">What Is Data Binding?</span></span>  
 <span data-ttu-id="7dc84-110">数据绑定是在应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 和业务逻辑之间建立连接的过程。</span><span class="sxs-lookup"><span data-stu-id="7dc84-110">Data binding is the process that establishes a connection between the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] and business logic.</span></span> <span data-ttu-id="7dc84-111">如果绑定具有正确的设置，并且数据提供适当的通知，则在数据更改其值时，绑定到该数据的元素会自动反映更改。</span><span class="sxs-lookup"><span data-stu-id="7dc84-111">If the binding has the correct settings and the data provides the proper notifications, then, when the data changes its value, the elements that are bound to the data reflect changes automatically.</span></span> <span data-ttu-id="7dc84-112">数据绑定还意味着，如果元素中数据的外部表示形式发生更改，则基础数据可以自动进行更新以反映更改。</span><span class="sxs-lookup"><span data-stu-id="7dc84-112">Data binding can also mean that if an outer representation of the data in an element changes, then the underlying data can be automatically updated to reflect the change.</span></span> <span data-ttu-id="7dc84-113">例如，如果用户编辑中的值<xref:System.Windows.Controls.TextBox>元素，则基础数据值自动更新以反映所做的更改。</span><span class="sxs-lookup"><span data-stu-id="7dc84-113">For example, if the user edits the value in a <xref:System.Windows.Controls.TextBox> element, the underlying data value is automatically updated to reflect that change.</span></span>  
  
 <span data-ttu-id="7dc84-114">数据绑定的典型用法是将服务器或本地配置数据放置到窗体或其他 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 控件中。</span><span class="sxs-lookup"><span data-stu-id="7dc84-114">A typical use of data binding is to place server or local configuration data into forms or other [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] controls.</span></span> <span data-ttu-id="7dc84-115">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，此概念得到扩展，包括将大量属性绑定到各种数据源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-115">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], this concept is expanded to include the binding of a broad range of properties to a variety of data sources.</span></span> <span data-ttu-id="7dc84-116">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，元素的依赖属性可以绑定到 [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] 对象（包括 [!INCLUDE[TLA#tla_adonet](../../../../includes/tlasharptla-adonet-md.md)] 对象或与 Web 服务和 Web 属性关联的对象）和 [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] 数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-116">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], dependency properties of elements can be bound to [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] objects (including [!INCLUDE[TLA#tla_adonet](../../../../includes/tlasharptla-adonet-md.md)] objects or objects associated with Web Services and Web properties) and [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data.</span></span>  
  
 <span data-ttu-id="7dc84-117">有关数据绑定的示例，请参阅[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)中的以下应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]：</span><span class="sxs-lookup"><span data-stu-id="7dc84-117">For an example of data binding, take a look at the following application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] from the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703):</span></span>  
  
 <span data-ttu-id="7dc84-118">![数据绑定示例屏幕截图](./media/databinding-databindingdemo.png "DataBinding_DataBindingDemo")</span><span class="sxs-lookup"><span data-stu-id="7dc84-118">![Data binding sample screenshot](./media/databinding-databindingdemo.png "DataBinding_DataBindingDemo")</span></span>  
  
 <span data-ttu-id="7dc84-119">以上是一个显示拍卖项列表的应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="7dc84-119">The above is the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] of an application that displays a list of auction items.</span></span> <span data-ttu-id="7dc84-120">应用程序演示了数据绑定的以下功能：</span><span class="sxs-lookup"><span data-stu-id="7dc84-120">The application demonstrates the following features of data binding:</span></span>  
  
-   <span data-ttu-id="7dc84-121">内容<xref:System.Windows.Controls.ListBox>绑定到的集合*AuctionItem*对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-121">The content of the <xref:System.Windows.Controls.ListBox> is bound to a collection of *AuctionItem* objects.</span></span> <span data-ttu-id="7dc84-122">*AuctionItem* 对象具有 *Description*、*StartPrice*、*StartDate*、*Category*、*SpecialFeatures* 等属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-122">An *AuctionItem* object has properties such as *Description*, *StartPrice*, *StartDate*, *Category*, *SpecialFeatures*, etc.</span></span>  
  
-   <span data-ttu-id="7dc84-123">数据 (*AuctionItem*对象) 中显示<xref:System.Windows.Controls.ListBox>是模板化，以便每个项显示的说明和当前价格。</span><span class="sxs-lookup"><span data-stu-id="7dc84-123">The data (*AuctionItem* objects) displayed in the <xref:System.Windows.Controls.ListBox> is templated so that the description and the current price are shown for each item.</span></span> <span data-ttu-id="7dc84-124">这是使用<xref:System.Windows.DataTemplate>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-124">This is done using a <xref:System.Windows.DataTemplate>.</span></span> <span data-ttu-id="7dc84-125">此外，每个项的外观取决于要显示的 *AuctionItem* 的 *SpecialFeatures* 值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-125">In addition, the appearance of each item depends on the *SpecialFeatures* value of the *AuctionItem* being displayed.</span></span> <span data-ttu-id="7dc84-126">如果 *AuctionItem* 的 *SpecialFeatures* 值为 *Color*，则该项具有蓝色边框。</span><span class="sxs-lookup"><span data-stu-id="7dc84-126">If the *SpecialFeatures* value of the *AuctionItem* is *Color*, the item has a blue border.</span></span> <span data-ttu-id="7dc84-127">如果值为 *Highlight*，则该项具有橙色边框和一个星号。</span><span class="sxs-lookup"><span data-stu-id="7dc84-127">If the value is *Highlight*, the item has an orange border and a star.</span></span> <span data-ttu-id="7dc84-128">[数据模板化](#data_templating)部分提供了数据模板化的相关信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-128">The [Data Templating](#data_templating) section provides information about data templating.</span></span>  
  
-   <span data-ttu-id="7dc84-129">用户可以进行分组、 筛选或排序数据使用<xref:System.Windows.Controls.CheckBox>es 提供。</span><span class="sxs-lookup"><span data-stu-id="7dc84-129">The user can group, filter, or sort the data using the <xref:System.Windows.Controls.CheckBox>es provided.</span></span> <span data-ttu-id="7dc84-130">在上图中，"按类别的组"和"按类别和日期排序" <xref:System.Windows.Controls.CheckBox>es 选择。</span><span class="sxs-lookup"><span data-stu-id="7dc84-130">In the image above, the "Group by category" and "Sort by category and date" <xref:System.Windows.Controls.CheckBox>es are selected.</span></span> <span data-ttu-id="7dc84-131">你可能已注意到，数据按产品类别分组，类别名称按字母顺序排序。</span><span class="sxs-lookup"><span data-stu-id="7dc84-131">You may have noticed that the data is grouped based on the category of the product, and the category name is in alphabetical order.</span></span> <span data-ttu-id="7dc84-132">这些项还按每个类别中的开始日期排序，但难以从图中注意到这一点。</span><span class="sxs-lookup"><span data-stu-id="7dc84-132">It is difficult to notice from the image but the items are also sorted by the start date within each category.</span></span> <span data-ttu-id="7dc84-133">这可使用*集合视图*来实现。</span><span class="sxs-lookup"><span data-stu-id="7dc84-133">This is done using a *collection view*.</span></span> <span data-ttu-id="7dc84-134">[绑定到集合](#binding_to_collections)部分讨论了集合视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-134">The [Binding to Collections](#binding_to_collections) section discusses collection views.</span></span>  
  
-   <span data-ttu-id="7dc84-135">当用户选择某个项，<xref:System.Windows.Controls.ContentControl>显示选定项的详细信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-135">When the user selects an item, the <xref:System.Windows.Controls.ContentControl> displays the details of the selected item.</span></span> <span data-ttu-id="7dc84-136">这称为*主从方案*。</span><span class="sxs-lookup"><span data-stu-id="7dc84-136">This is called the *Master-Detail scenario*.</span></span> <span data-ttu-id="7dc84-137">[主从方案](#master_detail_scenario)部分提供了有关此类型的绑定方案的信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-137">The [Master-Detail Scenario](#master_detail_scenario) section provides information about this type of binding scenario.</span></span>  
  
-   <span data-ttu-id="7dc84-138">类型*StartDate*属性是<xref:System.DateTime>，这会返回一个日期，包括到毫秒的时间。</span><span class="sxs-lookup"><span data-stu-id="7dc84-138">The type of the *StartDate* property is <xref:System.DateTime>, which returns a date that includes the time to the millisecond.</span></span> <span data-ttu-id="7dc84-139">在此应用程序中，使用了一个自定义转换器，以便显示较短的日期字符串。</span><span class="sxs-lookup"><span data-stu-id="7dc84-139">In this application, a custom converter has been used so that a shorter date string is displayed.</span></span> <span data-ttu-id="7dc84-140">[数据转换](#data_conversion)部分提供了有关转换器的信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-140">The [Data Conversion](#data_conversion) section provides information about converters.</span></span>  
  
 <span data-ttu-id="7dc84-141">当用户单击“添加产品”按钮时，会出现以下窗体：</span><span class="sxs-lookup"><span data-stu-id="7dc84-141">When the user clicks the *Add Product* button, the following form comes up:</span></span>  
  
 <span data-ttu-id="7dc84-142">![添加产品清单页](./media/databinding-demo-addproductlisting.png "DataBinding_Demo_AddProductListing")</span><span class="sxs-lookup"><span data-stu-id="7dc84-142">![Add Product Listing page](./media/databinding-demo-addproductlisting.png "DataBinding_Demo_AddProductListing")</span></span>  
  
 <span data-ttu-id="7dc84-143">用户可以编辑窗体中的字段，使用简略预览和详细预览窗格来预览产品清单，然后单击“提交”以添加新的产品清单。</span><span class="sxs-lookup"><span data-stu-id="7dc84-143">The user can edit the fields in the form, preview the product listing using the short preview and the more detailed preview panes, and then click *submit* to add the new product listing.</span></span> <span data-ttu-id="7dc84-144">任何现有的分组、筛选和排序功能都将应用于新项。</span><span class="sxs-lookup"><span data-stu-id="7dc84-144">Any existing grouping, filtering and sorting functionalities will apply to the new entry.</span></span> <span data-ttu-id="7dc84-145">在这种特殊情况下，上图中输入的项会作为 *Computer* 类别中的第二项显示。</span><span class="sxs-lookup"><span data-stu-id="7dc84-145">In this particular case, the item entered in the above image will be displayed as the second item within the *Computer* category.</span></span>  
  
 <span data-ttu-id="7dc84-146">不会显示此映像是中提供的验证逻辑*Start Date* <xref:System.Windows.Controls.TextBox>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-146">Not shown in this image is the validation logic provided in the *Start Date* <xref:System.Windows.Controls.TextBox>.</span></span> <span data-ttu-id="7dc84-147">如果用户输入无效日期 （格式无效或为过去的日期），将通过通知用户<xref:System.Windows.Controls.ToolTip>和一个红色感叹号旁边<xref:System.Windows.Controls.TextBox>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-147">If the user enters an invalid date (invalid formatting or a past date), the user will be notified with a <xref:System.Windows.Controls.ToolTip> and a red exclamation point next to the <xref:System.Windows.Controls.TextBox>.</span></span> <span data-ttu-id="7dc84-148">[数据验证](#data_validation)一节讨论了如何创建验证逻辑。</span><span class="sxs-lookup"><span data-stu-id="7dc84-148">The [Data Validation](#data_validation) section discusses how to create validation logic.</span></span>  
  
 <span data-ttu-id="7dc84-149">在详细介绍数据绑定的上述不同功能之前，我们会先在下一节中讨论一些对理解 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 数据绑定非常重要的基本概念。</span><span class="sxs-lookup"><span data-stu-id="7dc84-149">Before going into the different features of data binding outlined above, we will first discuss in the next section the fundamental concepts that are critical to understanding [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding.</span></span>  
  
## <a name="basic-data-binding-concepts"></a><span data-ttu-id="7dc84-150">数据绑定基本概念</span><span class="sxs-lookup"><span data-stu-id="7dc84-150">Basic Data Binding Concepts</span></span>  
  
 <span data-ttu-id="7dc84-151">不论要绑定什么元素，也不论数据源的特性是什么，每个绑定都始终遵循下图所示的模型：</span><span class="sxs-lookup"><span data-stu-id="7dc84-151">Regardless of what element you are binding and the nature of your data source, each binding always follows the model illustrated by the following figure:</span></span>  
  
 ![显示基本数据绑定模型的关系图。](./media/data-binding-overview/basic-data-binding-diagram.png)  
  
 <span data-ttu-id="7dc84-153">如上图所示，数据绑定实质上是绑定目标与绑定源之间的桥梁。</span><span class="sxs-lookup"><span data-stu-id="7dc84-153">As illustrated by the above figure, data binding is essentially the bridge between your binding target and your binding source.</span></span> <span data-ttu-id="7dc84-154">该图演示了以下基本的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 数据绑定概念：</span><span class="sxs-lookup"><span data-stu-id="7dc84-154">The figure demonstrates the following fundamental [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding concepts:</span></span>  
  
-   <span data-ttu-id="7dc84-155">通常，每个绑定都具有以下四个组件：绑定目标对象、目标属性、绑定源，以及要使用的绑定源中的值路径。</span><span class="sxs-lookup"><span data-stu-id="7dc84-155">Typically, each binding has these four components: a binding target object, a target property, a binding source, and a path to the value in the binding source to use.</span></span> <span data-ttu-id="7dc84-156">例如，如果你想要的内容绑定<xref:System.Windows.Controls.TextBox>到*名称*的属性*员工*对象，您的目标对象是<xref:System.Windows.Controls.TextBox>，目标属性是<xref:System.Windows.Controls.TextBox.Text%2A>属性，要使用的值是*名称*，和源对象是*员工*对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-156">For example, if you want to bind the content of a <xref:System.Windows.Controls.TextBox> to the *Name* property of an *Employee* object, your target object is the <xref:System.Windows.Controls.TextBox>, the target property is the <xref:System.Windows.Controls.TextBox.Text%2A> property, the value to use is *Name*, and the source object is the *Employee* object.</span></span>  
  
-   <span data-ttu-id="7dc84-157">目标属性必须为依赖属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-157">The target property must be a dependency property.</span></span> <span data-ttu-id="7dc84-158">大多数<xref:System.Windows.UIElement>属性是依赖关系属性和大多数依赖项属性，除了只读属性，默认情况下支持数据绑定。</span><span class="sxs-lookup"><span data-stu-id="7dc84-158">Most <xref:System.Windows.UIElement> properties are dependency properties and most dependency properties, except read-only ones, support data binding by default.</span></span> <span data-ttu-id="7dc84-159">(仅<xref:System.Windows.DependencyObject>类型可以定义依赖关系属性和所有<xref:System.Windows.UIElement>派生自<xref:System.Windows.DependencyObject>。)</span><span class="sxs-lookup"><span data-stu-id="7dc84-159">(Only <xref:System.Windows.DependencyObject> types can define dependency properties and all <xref:System.Windows.UIElement>s derive from <xref:System.Windows.DependencyObject>.)</span></span>  
  
-   <span data-ttu-id="7dc84-160">尽管图中并未指出，但请注意，绑定源对象并不限于自定义 [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] 对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-160">Although not specified in the figure, it should be noted that the binding source object is not restricted to being a custom [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] object.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="7dc84-161">数据绑定支持 [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] 对象和 [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] 形式的数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-161">data binding supports data in the form of [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] objects and [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)].</span></span> <span data-ttu-id="7dc84-162">若要提供一些示例，绑定源可以是<xref:System.Windows.UIElement>，任何列表对象、[!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)]与关联的对象[!INCLUDE[TLA#tla_adonet](../../../../includes/tlasharptla-adonet-md.md)]数据或 Web 服务或 XmlNode 包含你[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-162">To provide some examples, your binding source may be a <xref:System.Windows.UIElement>, any list object, a [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] object that is associated with [!INCLUDE[TLA#tla_adonet](../../../../includes/tlasharptla-adonet-md.md)] data or Web Services, or an XmlNode that contains your [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data.</span></span> <span data-ttu-id="7dc84-163">有关详细信息，请参阅[绑定源概述](binding-sources-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-163">For more information, see [Binding Sources Overview](binding-sources-overview.md).</span></span>  
  
 <span data-ttu-id="7dc84-164">在通读其他 [!INCLUDE[TLA#tla_sdk](../../../../includes/tlasharptla-sdk-md.md)] 主题时，请务必记住：在建立绑定时，需要将绑定目标绑定*到*绑定源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-164">As you read through other [!INCLUDE[TLA#tla_sdk](../../../../includes/tlasharptla-sdk-md.md)] topics, it is important to remember that when you are establishing a binding, you are binding a binding target *to* a binding source.</span></span> <span data-ttu-id="7dc84-165">例如，如果您要显示某些基础[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]中的数据<xref:System.Windows.Controls.ListBox>使用数据绑定时，要绑定您<xref:System.Windows.Controls.ListBox>到[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-165">For example, if you are displaying some underlying [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data in a <xref:System.Windows.Controls.ListBox> using data binding, you are binding your <xref:System.Windows.Controls.ListBox> to the [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data.</span></span>  
  
 <span data-ttu-id="7dc84-166">若要建立绑定，请使用<xref:System.Windows.Data.Binding>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-166">To establish a binding, you use the <xref:System.Windows.Data.Binding> object.</span></span> <span data-ttu-id="7dc84-167">本主题的其余部分将讨论的许多相关的概念和一些属性和使用情况的<xref:System.Windows.Data.Binding>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-167">The rest of this topic discusses many of the concepts associated with and some of the properties and usage of the <xref:System.Windows.Data.Binding> object.</span></span>  
  
<a name="direction_of_data_flow"></a>   
### <a name="direction-of-the-data-flow"></a><span data-ttu-id="7dc84-168">数据流的方向</span><span class="sxs-lookup"><span data-stu-id="7dc84-168">Direction of the Data Flow</span></span>  
 <span data-ttu-id="7dc84-169">正如前面提到的以及在上图中箭头所示，绑定的数据流可以进入从绑定目标绑定源 (例如，源值发生更改时用户编辑的值<xref:System.Windows.Controls.TextBox>) 和/或从绑定源到绑定目标 (例如，你<xref:System.Windows.Controls.TextBox>内容更新的是绑定源中的更改) 如果绑定源提供适当的通知。</span><span class="sxs-lookup"><span data-stu-id="7dc84-169">As mentioned previously and as indicated by the arrow in the figure above, the data flow of a binding can go from the binding target to the binding source (for example, the source value changes when a user edits the value of a <xref:System.Windows.Controls.TextBox>) and/or from the binding source to the binding target (for example, your <xref:System.Windows.Controls.TextBox> content gets updated with changes in the binding source) if the binding source provides the proper notifications.</span></span>  
  
 <span data-ttu-id="7dc84-170">可能希望应用程序允许用户更改数据，然后将该数据传播回源对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-170">You may want your application to enable users to change the data and propagate it back to the source object.</span></span> <span data-ttu-id="7dc84-171">或者，可能不希望允许用户更新源数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-171">Or you may not want to enable users to update the source data.</span></span> <span data-ttu-id="7dc84-172">您可以通过设置控制这<xref:System.Windows.Data.Binding.Mode%2A>属性在<xref:System.Windows.Data.Binding>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-172">You can control this by setting the <xref:System.Windows.Data.Binding.Mode%2A> property of your <xref:System.Windows.Data.Binding> object.</span></span> <span data-ttu-id="7dc84-173">下图演示了不同类型的数据流：</span><span class="sxs-lookup"><span data-stu-id="7dc84-173">The following figure illustrates the different types of data flow:</span></span>  
  
 <span data-ttu-id="7dc84-174">![数据绑定数据流](./media/databinding-dataflow.png "DataBinding_DataFlow")</span><span class="sxs-lookup"><span data-stu-id="7dc84-174">![Data binding data flow](./media/databinding-dataflow.png "DataBinding_DataFlow")</span></span>  
  
-   <span data-ttu-id="7dc84-175"><xref:System.Windows.Data.BindingMode.OneWay> 绑定导致更改源属性自动更新目标属性，但对目标属性的更改不会传播回源属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-175"><xref:System.Windows.Data.BindingMode.OneWay> binding causes changes to the source property to automatically update the target property, but changes to the target property are not propagated back to the source property.</span></span> <span data-ttu-id="7dc84-176">如果绑定的控件为隐式只读，则此类型的绑定适用。</span><span class="sxs-lookup"><span data-stu-id="7dc84-176">This type of binding is appropriate if the control being bound is implicitly read-only.</span></span> <span data-ttu-id="7dc84-177">例如，可能绑定到如股票行情自动收录器这样的源，或许目标属性没有用于进行更改的控件接口（如表的数据绑定背景色）。</span><span class="sxs-lookup"><span data-stu-id="7dc84-177">For instance, you may bind to a source such as a stock ticker or perhaps your target property has no control interface provided for making changes, such as a data-bound background color of a table.</span></span> <span data-ttu-id="7dc84-178">如果无需监视目标属性的更改，则使用 <xref:System.Windows.Data.BindingMode.OneWay> 绑定模式可避免 <xref:System.Windows.Data.BindingMode.TwoWay> 绑定模式的系统开销。</span><span class="sxs-lookup"><span data-stu-id="7dc84-178">If there is no need to monitor the changes of the target property, using the <xref:System.Windows.Data.BindingMode.OneWay> binding mode avoids the overhead of the <xref:System.Windows.Data.BindingMode.TwoWay> binding mode.</span></span>  
  
-   <span data-ttu-id="7dc84-179"><xref:System.Windows.Data.BindingMode.TwoWay> 绑定导致更改源属性或自动更新另的目标属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-179"><xref:System.Windows.Data.BindingMode.TwoWay> binding causes changes to either the source property or the target property to automatically update the other.</span></span> <span data-ttu-id="7dc84-180">此类型的绑定适用于可编辑窗体或其他完整交互式的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 方案。</span><span class="sxs-lookup"><span data-stu-id="7dc84-180">This type of binding is appropriate for editable forms or other fully-interactive [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] scenarios.</span></span> <span data-ttu-id="7dc84-181">大多数属性默认为<xref:System.Windows.Data.BindingMode.OneWay>绑定，但某些依赖关系属性 (通常是用户可编辑控件的属性<xref:System.Windows.Controls.TextBox.Text%2A>属性<xref:System.Windows.Controls.TextBox>并<xref:System.Windows.Controls.Primitives.ToggleButton.IsChecked%2A>属性<xref:System.Windows.Controls.CheckBox>) 默认为<xref:System.Windows.Data.BindingMode.TwoWay>绑定。</span><span class="sxs-lookup"><span data-stu-id="7dc84-181">Most properties default to <xref:System.Windows.Data.BindingMode.OneWay> binding, but some dependency properties (typically properties of user-editable controls such as the <xref:System.Windows.Controls.TextBox.Text%2A> property of <xref:System.Windows.Controls.TextBox> and the <xref:System.Windows.Controls.Primitives.ToggleButton.IsChecked%2A> property of <xref:System.Windows.Controls.CheckBox>) default to <xref:System.Windows.Data.BindingMode.TwoWay> binding.</span></span> <span data-ttu-id="7dc84-182">确定依赖属性绑定在默认情况下是单向还是双向的编程方法是：使用 <xref:System.Windows.DependencyProperty.GetMetadata%2A> 获取属性的属性元数据，然后检查 <xref:System.Windows.FrameworkPropertyMetadata.BindsTwoWayByDefault%2A> 属性的布尔值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-182">A programmatic way to determine whether a dependency property binds one-way or two-way by default is to get the property metadata of the property using <xref:System.Windows.DependencyProperty.GetMetadata%2A> and then check the Boolean value of the <xref:System.Windows.FrameworkPropertyMetadata.BindsTwoWayByDefault%2A> property.</span></span>  
  
-   <span data-ttu-id="7dc84-183"><xref:System.Windows.Data.BindingMode.OneWayToSource> 相反<xref:System.Windows.Data.BindingMode.OneWay>绑定; 它的源属性更改时，更新目标属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-183"><xref:System.Windows.Data.BindingMode.OneWayToSource> is the reverse of <xref:System.Windows.Data.BindingMode.OneWay> binding; it updates the source property when the target property changes.</span></span> <span data-ttu-id="7dc84-184">一个示例方案是只需要从 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 重新计算源值的情况。</span><span class="sxs-lookup"><span data-stu-id="7dc84-184">One example scenario is if you only need to re-evaluate the source value from the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
-   <span data-ttu-id="7dc84-185">不在图中所示是<xref:System.Windows.Data.BindingMode.OneTime>绑定，这将导致源属性传入以初始化目标属性，但不是传播后续更改。</span><span class="sxs-lookup"><span data-stu-id="7dc84-185">Not illustrated in the figure is <xref:System.Windows.Data.BindingMode.OneTime> binding, which causes the source property to initialize the target property, but subsequent changes do not propagate.</span></span> <span data-ttu-id="7dc84-186">这意味着，如果数据上下文发生了更改，或者数据上下文中的对象发生了更改，该更改不会反映在目标属性中。</span><span class="sxs-lookup"><span data-stu-id="7dc84-186">This means that if the data context undergoes a change or the object in the data context changes, then the change is not reflected in the target property.</span></span> <span data-ttu-id="7dc84-187">如果你在适合使用当前状态的快照或数据实际为静态数据的位置使用数据，则此类型的绑定适合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-187">This type of binding is appropriate if you are using data where either a snapshot of the current state is appropriate to use or the data is truly static.</span></span> <span data-ttu-id="7dc84-188">如果你想使用源属性中的某个值来初始化目标属性，且提前不知道数据上下文，则此类型的绑定也有用。</span><span class="sxs-lookup"><span data-stu-id="7dc84-188">This type of binding is also useful if you want to initialize your target property with some value from a source property and the data context is not known in advance.</span></span> <span data-ttu-id="7dc84-189">这是实质上是 <xref:System.Windows.Data.BindingMode.OneWay> 绑定的一种简化形式，它在源值不更改的情况下提供更好的性能。</span><span class="sxs-lookup"><span data-stu-id="7dc84-189">This is essentially a simpler form of <xref:System.Windows.Data.BindingMode.OneWay> binding that provides better performance in cases where the source value does not change.</span></span>  
  
 <span data-ttu-id="7dc84-190">请注意，若要检测源更改 (适用于<xref:System.Windows.Data.BindingMode.OneWay>并<xref:System.Windows.Data.BindingMode.TwoWay>绑定)，源必须实现一种合适的属性更改通知机制如<xref:System.ComponentModel.INotifyPropertyChanged>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-190">Note that to detect source changes (applicable to <xref:System.Windows.Data.BindingMode.OneWay> and <xref:System.Windows.Data.BindingMode.TwoWay> bindings), the source must implement a suitable property change notification mechanism such as <xref:System.ComponentModel.INotifyPropertyChanged>.</span></span> <span data-ttu-id="7dc84-191">请参阅[实现属性更改通知](how-to-implement-property-change-notification.md)有关的示例<xref:System.ComponentModel.INotifyPropertyChanged>实现。</span><span class="sxs-lookup"><span data-stu-id="7dc84-191">See [Implement Property Change Notification](how-to-implement-property-change-notification.md) for an example of an <xref:System.ComponentModel.INotifyPropertyChanged> implementation.</span></span>  
  
 <span data-ttu-id="7dc84-192"><xref:System.Windows.Data.Binding.Mode%2A>属性页提供了有关绑定模式和如何指定绑定方向的示例的详细信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-192">The <xref:System.Windows.Data.Binding.Mode%2A> property page provides more information about binding modes and an example of how to specify the direction of a binding.</span></span>  
  
<a name="what_triggers_source_updates"></a>   
### <a name="what-triggers-source-updates"></a><span data-ttu-id="7dc84-193">触发源更新的因素</span><span class="sxs-lookup"><span data-stu-id="7dc84-193">What Triggers Source Updates</span></span>  
 <span data-ttu-id="7dc84-194">绑定<xref:System.Windows.Data.BindingMode.TwoWay>或<xref:System.Windows.Data.BindingMode.OneWayToSource>侦听目标属性中的更改并将其传播回源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-194">Bindings that are <xref:System.Windows.Data.BindingMode.TwoWay> or <xref:System.Windows.Data.BindingMode.OneWayToSource> listen for changes in the target property and propagate them back to the source.</span></span> <span data-ttu-id="7dc84-195">这称为更新源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-195">This is known as updating the source.</span></span> <span data-ttu-id="7dc84-196">例如，可以编辑文本框的文本以更改基础源值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-196">For example, you may edit the text of a TextBox to change the underlying source value.</span></span> <span data-ttu-id="7dc84-197">如在上一部分中所述，通过的值来确定数据流的方向<xref:System.Windows.Data.Binding.Mode%2A>绑定的属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-197">As described in the last section, the direction of the data flow is determined by the value of the <xref:System.Windows.Data.Binding.Mode%2A> property of the binding.</span></span>  
  
 <span data-ttu-id="7dc84-198">但是，源值是在编辑文本的同时进行更新，还是在结束编辑文本并将鼠标指针从文本框移走后才进行更新呢？</span><span class="sxs-lookup"><span data-stu-id="7dc84-198">However, does your source value get updated while you are editing the text or after you finish editing the text and point your mouse away from the TextBox?</span></span> <span data-ttu-id="7dc84-199"><xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>绑定属性确定触发源更新。</span><span class="sxs-lookup"><span data-stu-id="7dc84-199">The <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property of the binding determines what triggers the update of the source.</span></span> <span data-ttu-id="7dc84-200">下图中的右箭头的点说明的角色<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>属性：</span><span class="sxs-lookup"><span data-stu-id="7dc84-200">The dots of the right arrows in the following figure illustrate the role of the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property:</span></span>  
  
 ![图，显示的 UpdateSourceTrigger 属性的角色。](./media/data-binding-overview/data-binding-updatesource-trigger.png)  
  
 <span data-ttu-id="7dc84-202">如果<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值是<xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>，然后值指向的向右箭头<xref:System.Windows.Data.BindingMode.TwoWay>或<xref:System.Windows.Data.BindingMode.OneWayToSource>获取尽快目标属性更改更新绑定。</span><span class="sxs-lookup"><span data-stu-id="7dc84-202">If the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value is <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, then the value pointed to by the right arrow of <xref:System.Windows.Data.BindingMode.TwoWay> or the <xref:System.Windows.Data.BindingMode.OneWayToSource> bindings gets updated as soon as the target property changes.</span></span> <span data-ttu-id="7dc84-203">但是，如果<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值是<xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>，则该值仅获取更新的新值与目标属性失去焦点时。</span><span class="sxs-lookup"><span data-stu-id="7dc84-203">However, if the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value is <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>, then that value only gets updated with the new value when the target property loses focus.</span></span>  
  
 <span data-ttu-id="7dc84-204">类似于<xref:System.Windows.Data.Binding.Mode%2A>属性，不同的依赖属性具有不同的默认<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-204">Similar to the <xref:System.Windows.Data.Binding.Mode%2A> property, different dependency properties have different default <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> values.</span></span> <span data-ttu-id="7dc84-205">大多数依赖属性的默认值为 <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>，而 <xref:System.Windows.Controls.TextBox.Text%2A> 属性的默认值为 <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-205">The default value for most dependency properties is <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, while the <xref:System.Windows.Controls.TextBox.Text%2A> property has a default value of <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>.</span></span> <span data-ttu-id="7dc84-206">这意味着源更新通常会在每当目标属性更改，这是相当不错的<xref:System.Windows.Controls.CheckBox>es 和其他简单控件。</span><span class="sxs-lookup"><span data-stu-id="7dc84-206">This means that source updates usually happen whenever the target property changes, which is fine for <xref:System.Windows.Controls.CheckBox>es and other simple controls.</span></span> <span data-ttu-id="7dc84-207">但对于文本字段，每次击键之后都进行更新会降低性能，用户也没有机会在提交新值之前使用 Backspace 键修改键入错误。</span><span class="sxs-lookup"><span data-stu-id="7dc84-207">However, for text fields, updating after every keystroke can diminish performance and it denies the user the usual opportunity to backspace and fix typing errors before committing to the new value.</span></span> <span data-ttu-id="7dc84-208">这就是为什么<xref:System.Windows.Controls.TextBox.Text%2A>属性具有默认值为<xref:System.Windows.Data.UpdateSourceTrigger.LostFocus>而不是<xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-208">That is why the <xref:System.Windows.Controls.TextBox.Text%2A> property has a default value of <xref:System.Windows.Data.UpdateSourceTrigger.LostFocus> instead of <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>.</span></span>  
  
 <span data-ttu-id="7dc84-209">请参阅<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>属性页，了解有关如何查找默认信息<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>依赖属性的值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-209">See the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property page for information about how to find the default <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value of a dependency property.</span></span>  
  
 <span data-ttu-id="7dc84-210">下表为每个提供的示例方案<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值使用<xref:System.Windows.Controls.TextBox>作为示例：</span><span class="sxs-lookup"><span data-stu-id="7dc84-210">The following table provides an example scenario for each <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value using the <xref:System.Windows.Controls.TextBox> as an example:</span></span>  
  
|<span data-ttu-id="7dc84-211">UpdateSourceTrigger 值</span><span class="sxs-lookup"><span data-stu-id="7dc84-211">UpdateSourceTrigger value</span></span>|<span data-ttu-id="7dc84-212">源值何时进行更新</span><span class="sxs-lookup"><span data-stu-id="7dc84-212">When the Source Value Gets Updated</span></span>|<span data-ttu-id="7dc84-213">文本框的示例方案</span><span class="sxs-lookup"><span data-stu-id="7dc84-213">Example Scenario for TextBox</span></span>|  
|-------------------------------|----------------------------------------|----------------------------------|  
|<span data-ttu-id="7dc84-214">LostFocus (默认为<xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=nameWithType>)</span><span class="sxs-lookup"><span data-stu-id="7dc84-214">LostFocus (default for <xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=nameWithType>)</span></span>|<span data-ttu-id="7dc84-215">当 TextBox 控件失去焦点时</span><span class="sxs-lookup"><span data-stu-id="7dc84-215">When the TextBox control loses focus</span></span>|<span data-ttu-id="7dc84-216">一个<xref:System.Windows.Controls.TextBox>验证逻辑与该键相关联 （请参阅数据验证部分）</span><span class="sxs-lookup"><span data-stu-id="7dc84-216">A <xref:System.Windows.Controls.TextBox> that is associated with validation logic (see Data Validation section)</span></span>|  
|<span data-ttu-id="7dc84-217">PropertyChanged</span><span class="sxs-lookup"><span data-stu-id="7dc84-217">PropertyChanged</span></span>|<span data-ttu-id="7dc84-218">如您将键入 <xref:System.Windows.Controls.TextBox></span><span class="sxs-lookup"><span data-stu-id="7dc84-218">As you type into the <xref:System.Windows.Controls.TextBox></span></span>|<span data-ttu-id="7dc84-219"><xref:System.Windows.Controls.TextBox> 聊天室窗口中的控件</span><span class="sxs-lookup"><span data-stu-id="7dc84-219"><xref:System.Windows.Controls.TextBox> controls in a chat room window</span></span>|  
|<span data-ttu-id="7dc84-220">Explicit</span><span class="sxs-lookup"><span data-stu-id="7dc84-220">Explicit</span></span>|<span data-ttu-id="7dc84-221">当应用程序调用 <xref:System.Windows.Data.BindingExpression.UpdateSource%2A></span><span class="sxs-lookup"><span data-stu-id="7dc84-221">When the application calls <xref:System.Windows.Data.BindingExpression.UpdateSource%2A></span></span>|<span data-ttu-id="7dc84-222"><xref:System.Windows.Controls.TextBox> （仅当用户单击提交按钮时，更新源值） 的可编辑窗体中的控件</span><span class="sxs-lookup"><span data-stu-id="7dc84-222"><xref:System.Windows.Controls.TextBox> controls in an editable form (updates the source values only when the user clicks the submit button)</span></span>|  
  
 <span data-ttu-id="7dc84-223">有关示例，请参阅[控制文本框文本更新源的时间](how-to-control-when-the-textbox-text-updates-the-source.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-223">For an example, see [Control When the TextBox Text Updates the Source](how-to-control-when-the-textbox-text-updates-the-source.md).</span></span>  
  
<a name="creating_a_binding"></a>   
## <a name="creating-a-binding"></a><span data-ttu-id="7dc84-224">创建绑定</span><span class="sxs-lookup"><span data-stu-id="7dc84-224">Creating a Binding</span></span>  
  
 <span data-ttu-id="7dc84-225">可以概括一些前面各节中讨论的概念，在建立绑定使用<xref:System.Windows.Data.Binding>对象，并将每个绑定通常具有四个组件： 绑定到要使用的源值的目标、 目标属性、 绑定源和路径。</span><span class="sxs-lookup"><span data-stu-id="7dc84-225">To recapitulate some of the concepts discussed in the previous sections, you establish a binding using the <xref:System.Windows.Data.Binding> object, and each binding usually has four components: binding target, target property, binding source, and a path to the source value to use.</span></span> <span data-ttu-id="7dc84-226">本节讨论如何设置绑定。</span><span class="sxs-lookup"><span data-stu-id="7dc84-226">This section discusses how to set up a binding.</span></span>  
  
 <span data-ttu-id="7dc84-227">请考虑以下示例，其中的绑定源对象是一个名为 *MyData* 的类，该类在 *SDKSample* 命名空间中定义。</span><span class="sxs-lookup"><span data-stu-id="7dc84-227">Consider the following example, in which the binding source object is a class named *MyData* that is defined in the *SDKSample* namespace.</span></span> <span data-ttu-id="7dc84-228">出于演示目的，*MyData* 类具有一个名为 *ColorName* 的字符串属性，该属性的值设置为“Red”。</span><span class="sxs-lookup"><span data-stu-id="7dc84-228">For demonstration purposes, *MyData* class has a string property named *ColorName*, of which the value is set to "Red".</span></span> <span data-ttu-id="7dc84-229">因此，此示例生成一个具有红色背景的按钮。</span><span class="sxs-lookup"><span data-stu-id="7dc84-229">Thus, this example generates a button with a red background.</span></span>  
  
 [!code-xaml[BindNonTextProperty#1](~/samples/snippets/csharp/VS_Snippets_Wpf/BindNonTextProperty/CS/Page1.xaml#1)]  
  
 <span data-ttu-id="7dc84-230">有关绑定声明语法的详细信息以及如何在代码中设置绑定的示例，请参阅[绑定声明概述](binding-declarations-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-230">For more details on the binding declaration syntax and for examples of how to set up a binding in code, see [Binding Declarations Overview](binding-declarations-overview.md).</span></span>  
  
 <span data-ttu-id="7dc84-231">如果将此示例应用于基本关系图，则生成的图如下所示。</span><span class="sxs-lookup"><span data-stu-id="7dc84-231">If we apply this example to our basic diagram, the resulting figure looks like the following.</span></span> <span data-ttu-id="7dc84-232">这是<xref:System.Windows.Data.BindingMode.OneWay>绑定，因为 Background 属性支持<xref:System.Windows.Data.BindingMode.OneWay>绑定默认情况下。</span><span class="sxs-lookup"><span data-stu-id="7dc84-232">This is a <xref:System.Windows.Data.BindingMode.OneWay> binding because the Background property supports <xref:System.Windows.Data.BindingMode.OneWay> binding by default.</span></span>  
  
 ![图，显示的数据绑定背景属性。](./media/data-binding-overview/data-binding-button-background-example.png)  
  
 <span data-ttu-id="7dc84-234">您可能想知道为什么这样即使*ColorName*属性的类型是字符串时<xref:System.Windows.Controls.Control.Background%2A>属性属于类型<xref:System.Windows.Media.Brush>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-234">You may wonder why this works even though the *ColorName* property is of type string while the <xref:System.Windows.Controls.Control.Background%2A> property is of type <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="7dc84-235">这是由于进行了默认类型转换，此类型转换在[数据转换](#data_conversion)一节中进行讨论。</span><span class="sxs-lookup"><span data-stu-id="7dc84-235">This is default type conversion at work and is discussed in the [Data Conversion](#data_conversion) section.</span></span>  
  
<a name="specifying_the_binding_source"></a>   
### <a name="specifying-the-binding-source"></a><span data-ttu-id="7dc84-236">指定绑定源</span><span class="sxs-lookup"><span data-stu-id="7dc84-236">Specifying the Binding Source</span></span>  
 <span data-ttu-id="7dc84-237">请注意，在上一示例中，绑定源指定通过设置<xref:System.Windows.FrameworkElement.DataContext%2A>属性上的<xref:System.Windows.Controls.DockPanel>元素。</span><span class="sxs-lookup"><span data-stu-id="7dc84-237">Notice that in the previous example, the binding source is specified by setting the <xref:System.Windows.FrameworkElement.DataContext%2A> property on the <xref:System.Windows.Controls.DockPanel> element.</span></span> <span data-ttu-id="7dc84-238"><xref:System.Windows.Controls.Button>然后继承<xref:System.Windows.FrameworkElement.DataContext%2A>值从<xref:System.Windows.Controls.DockPanel>，这是其父元素。</span><span class="sxs-lookup"><span data-stu-id="7dc84-238">The <xref:System.Windows.Controls.Button> then inherits the <xref:System.Windows.FrameworkElement.DataContext%2A> value from the <xref:System.Windows.Controls.DockPanel>, which is its parent element.</span></span> <span data-ttu-id="7dc84-239">重申一下，绑定源对象是绑定的四个必需组件之一。</span><span class="sxs-lookup"><span data-stu-id="7dc84-239">To reiterate, the binding source object is one of the four necessary components of a binding.</span></span> <span data-ttu-id="7dc84-240">因此，如果未指定绑定源对象，则绑定将没有任何作用。</span><span class="sxs-lookup"><span data-stu-id="7dc84-240">Therefore, without the binding source object being specified, the binding would do nothing.</span></span>  
  
 <span data-ttu-id="7dc84-241">可通过多种方法指定绑定源对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-241">There are several ways to specify the binding source object.</span></span> <span data-ttu-id="7dc84-242">使用<xref:System.Windows.FrameworkElement.DataContext%2A>父元素上的属性时要将多个属性绑定到同一源很有用。</span><span class="sxs-lookup"><span data-stu-id="7dc84-242">Using the <xref:System.Windows.FrameworkElement.DataContext%2A> property on a parent element is useful when you are binding multiple properties to the same source.</span></span> <span data-ttu-id="7dc84-243">不过，有时在个别绑定声明中指定绑定源可能更为合适。</span><span class="sxs-lookup"><span data-stu-id="7dc84-243">However, sometimes it may be more appropriate to specify the binding source on individual binding declarations.</span></span> <span data-ttu-id="7dc84-244">对于上述示例中，而不是使用<xref:System.Windows.FrameworkElement.DataContext%2A>属性，可以通过设置指定绑定源<xref:System.Windows.Data.Binding.Source%2A>直接上的按钮，如以下示例所示的绑定声明的属性：</span><span class="sxs-lookup"><span data-stu-id="7dc84-244">For the previous example, instead of using the <xref:System.Windows.FrameworkElement.DataContext%2A> property, you can specify the binding source by setting the <xref:System.Windows.Data.Binding.Source%2A> property directly on the binding declaration of the button, as in the following example:</span></span>  
  
 [!code-xaml[BindNonTextProperty#BackgroundBindingCompact](~/samples/snippets/csharp/VS_Snippets_Wpf/BindNonTextProperty/CS/Page2.xaml#backgroundbindingcompact)]  
  
 <span data-ttu-id="7dc84-245">而不设置<xref:System.Windows.FrameworkElement.DataContext%2A>属性元素上直接，继承<xref:System.Windows.FrameworkElement.DataContext%2A>值从上级 （如第一个示例中的按钮），并显式指定绑定源设置<xref:System.Windows.Data.Binding.Source%2A>上的属性<xref:System.Windows.Data.Binding>（如按钮为最后一个示例） 还可以使用<xref:System.Windows.Data.Binding.ElementName%2A>属性或<xref:System.Windows.Data.Binding.RelativeSource%2A>属性指定绑定源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-245">Other than setting the <xref:System.Windows.FrameworkElement.DataContext%2A> property on an element directly, inheriting the <xref:System.Windows.FrameworkElement.DataContext%2A> value from an ancestor (such as the button in the first example), and explicitly specifying the binding source by setting the <xref:System.Windows.Data.Binding.Source%2A> property on the <xref:System.Windows.Data.Binding> (such as the button the last example), you can also use the <xref:System.Windows.Data.Binding.ElementName%2A> property or the <xref:System.Windows.Data.Binding.RelativeSource%2A> property to specify the binding source.</span></span> <span data-ttu-id="7dc84-246"><xref:System.Windows.Data.Binding.ElementName%2A>属性绑定到其他元素中的应用程序，例如当使用滑块调整按钮的宽度时很有用。</span><span class="sxs-lookup"><span data-stu-id="7dc84-246">The <xref:System.Windows.Data.Binding.ElementName%2A> property is useful when you are binding to other elements in your application, such as when you are using a slider to adjust the width of a button.</span></span> <span data-ttu-id="7dc84-247"><xref:System.Windows.Data.Binding.RelativeSource%2A>属性中指定的绑定时很有用<xref:System.Windows.Controls.ControlTemplate>或<xref:System.Windows.Style>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-247">The <xref:System.Windows.Data.Binding.RelativeSource%2A> property is useful when the binding is specified in a <xref:System.Windows.Controls.ControlTemplate> or a <xref:System.Windows.Style>.</span></span> <span data-ttu-id="7dc84-248">有关详细信息，请参阅[指定绑定源](how-to-specify-the-binding-source.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-248">For more information, see [Specify the Binding Source](how-to-specify-the-binding-source.md).</span></span>  
  
<a name="specifying_the_path_to_the_value"></a>   
### <a name="specifying-the-path-to-the-value"></a><span data-ttu-id="7dc84-249">指定值的路径</span><span class="sxs-lookup"><span data-stu-id="7dc84-249">Specifying the Path to the Value</span></span>  
 <span data-ttu-id="7dc84-250">如果绑定源是一个对象，则使用<xref:System.Windows.Data.Binding.Path%2A>属性来指定要用于绑定的值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-250">If your binding source is an object, you use the <xref:System.Windows.Data.Binding.Path%2A> property to specify the value to use for your binding.</span></span> <span data-ttu-id="7dc84-251">如果要绑定到[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]数据，使用<xref:System.Windows.Data.Binding.XPath%2A>属性指定的值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-251">If you are binding to [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] data, you use the <xref:System.Windows.Data.Binding.XPath%2A> property to specify the value.</span></span> <span data-ttu-id="7dc84-252">在某些情况下，它可能是适用于使用<xref:System.Windows.Data.Binding.Path%2A>属性，即使你的数据是[!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="7dc84-252">In some cases, it may be applicable to use the <xref:System.Windows.Data.Binding.Path%2A> property even when your data is [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)].</span></span> <span data-ttu-id="7dc84-253">例如，如果你想要访问返回的 XmlNode （作为 XPath 查询） 的结果的 Name 属性，则应使用<xref:System.Windows.Data.Binding.Path%2A>属性设置为除<xref:System.Windows.Data.Binding.XPath%2A>属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-253">For example, if you want to access the Name property of a returned XmlNode (as a result of an XPath query), you should use the <xref:System.Windows.Data.Binding.Path%2A> property in addition to the <xref:System.Windows.Data.Binding.XPath%2A> property.</span></span>  
  
 <span data-ttu-id="7dc84-254">有关语法信息和示例，请参阅<xref:System.Windows.Data.Binding.Path%2A>和<xref:System.Windows.Data.Binding.XPath%2A>属性页。</span><span class="sxs-lookup"><span data-stu-id="7dc84-254">For syntax information and examples, see the <xref:System.Windows.Data.Binding.Path%2A> and <xref:System.Windows.Data.Binding.XPath%2A> property pages.</span></span>  
  
 <span data-ttu-id="7dc84-255">请注意，虽然我们已强调<xref:System.Windows.Data.Binding.Path%2A>到要使用的值是你想要绑定到整个对象的情况中的一个绑定的四个必要组件之一，要使用的值将作为绑定源对象相同。</span><span class="sxs-lookup"><span data-stu-id="7dc84-255">Note that although we have emphasized that the <xref:System.Windows.Data.Binding.Path%2A> to the value to use is one of the four necessary components of a binding, in the scenarios which you want to bind to an entire object, the value to use would be the same as the binding source object.</span></span> <span data-ttu-id="7dc84-256">在这些情况下，它是不适宜指定<xref:System.Windows.Data.Binding.Path%2A>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-256">In those cases, it is applicable to not specify a <xref:System.Windows.Data.Binding.Path%2A>.</span></span> <span data-ttu-id="7dc84-257">请看下面的示例：</span><span class="sxs-lookup"><span data-stu-id="7dc84-257">Consider the following example:</span></span>  
  
 [!code-xaml[MasterDetail#EmptyBinding](~/samples/snippets/csharp/VS_Snippets_Wpf/MasterDetail/CSharp/Page1.xaml#emptybinding)]  
  
 <span data-ttu-id="7dc84-258">以上示例使用空绑定语法：{Binding}。</span><span class="sxs-lookup"><span data-stu-id="7dc84-258">The above example uses the empty binding syntax: {Binding}.</span></span> <span data-ttu-id="7dc84-259">在这种情况下，<xref:System.Windows.Controls.ListBox>从父 DockPanel 元素 （不在此示例中所示） 继承 DataContext。</span><span class="sxs-lookup"><span data-stu-id="7dc84-259">In this case, the <xref:System.Windows.Controls.ListBox> inherits the DataContext from a parent DockPanel element (not shown in this example).</span></span> <span data-ttu-id="7dc84-260">未指定路径时，默认为绑定到整个对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-260">When the path is not specified, the default is to bind to the entire object.</span></span> <span data-ttu-id="7dc84-261">换而言之，在此示例中，该路径已被省略，因为我们要绑定<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>到整个对象的属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-261">In other words, in this example, the path has been left out because we are binding the <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property to the entire object.</span></span> <span data-ttu-id="7dc84-262">（有关深入讨论，请参阅[绑定到集合](#binding_to_collections)一节。）</span><span class="sxs-lookup"><span data-stu-id="7dc84-262">(See the [Binding to Collections](#binding_to_collections) section for an in-depth discussion.)</span></span>  
  
 <span data-ttu-id="7dc84-263">除了绑定到集合以外，在希望绑定到整个对象，而不是仅绑定到对象的单个属性时，也可以使用此方案。</span><span class="sxs-lookup"><span data-stu-id="7dc84-263">Other than binding to a collection, this scenario is also useful when you want to bind to an entire object instead of just a single property of an object.</span></span> <span data-ttu-id="7dc84-264">例如，在源对象为类型字符串，并且仅仅希望绑定到该字符串本身时。</span><span class="sxs-lookup"><span data-stu-id="7dc84-264">For example, if your source object is of type string and you simply want to bind to the string itself.</span></span> <span data-ttu-id="7dc84-265">另一种常见情况是希望将一个元素绑定到一个具有多个属性的对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-265">Another common scenario is when you want to bind an element to an object with several properties.</span></span>  
  
 <span data-ttu-id="7dc84-266">请注意，可能需要应用自定义逻辑，以便数据对于绑定的目标属性有意义。</span><span class="sxs-lookup"><span data-stu-id="7dc84-266">Note that you may need to apply custom logic so that the data is meaningful to your bound target property.</span></span> <span data-ttu-id="7dc84-267">自定义逻辑可能采用自定义转换器形式（如果不存在默认的类型转换）。</span><span class="sxs-lookup"><span data-stu-id="7dc84-267">The custom logic may be in the form of a custom converter (if default type conversion does not exist).</span></span> <span data-ttu-id="7dc84-268">有关转换器的信息，请参阅[数据转换](#data_conversion)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-268">See [Data Conversion](#data_conversion) for information about converters.</span></span>  
  
<a name="binding_bindingexpression"></a>   
### <a name="binding-and-bindingexpression"></a><span data-ttu-id="7dc84-269">Binding 和 BindingExpression</span><span class="sxs-lookup"><span data-stu-id="7dc84-269">Binding and BindingExpression</span></span>  
 <span data-ttu-id="7dc84-270">之前的其他功能和数据绑定的用法，它可以用来引入<xref:System.Windows.Data.BindingExpression>类。</span><span class="sxs-lookup"><span data-stu-id="7dc84-270">Before getting into other features and usages of data binding, it would be useful to introduce the <xref:System.Windows.Data.BindingExpression> class.</span></span> <span data-ttu-id="7dc84-271">如前面部分中所见<xref:System.Windows.Data.Binding>类是绑定; 声明的高级类<xref:System.Windows.Data.Binding>类提供了许多允许您指定的绑定特性的属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-271">As you have seen in previous sections, the <xref:System.Windows.Data.Binding> class is the high-level class for the declaration of a binding; the <xref:System.Windows.Data.Binding> class provides many properties that allow you to specify the characteristics of a binding.</span></span> <span data-ttu-id="7dc84-272">相关的类， <xref:System.Windows.Data.BindingExpression>，是保留在源和目标之间连接的基础对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-272">A related class, <xref:System.Windows.Data.BindingExpression>, is the underlying object that maintains the connection between the source and the target.</span></span> <span data-ttu-id="7dc84-273">一个绑定包含了可以在多个绑定表达式之间共享的所有信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-273">A binding contains all the information that can be shared across several binding expressions.</span></span> <span data-ttu-id="7dc84-274">一个<xref:System.Windows.Data.BindingExpression>是不能共享的实例表达式，包含的所有实例信息<xref:System.Windows.Data.Binding>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-274">A <xref:System.Windows.Data.BindingExpression> is an instance expression that cannot be shared and contains all the instance information of the <xref:System.Windows.Data.Binding>.</span></span>  
  
 <span data-ttu-id="7dc84-275">例如，考虑以下内容，其中*myDataObject*的一个实例*MyData*类*myBinding*源<xref:System.Windows.Data.Binding>对象，并且*MyData*类是一个包含名为的字符串属性的定义的类*MyDataProperty*。</span><span class="sxs-lookup"><span data-stu-id="7dc84-275">For example, consider the following, where *myDataObject* is an instance of *MyData* class, *myBinding* is the source <xref:System.Windows.Data.Binding> object, and *MyData* class is a defined class that contains a string property named *MyDataProperty*.</span></span> <span data-ttu-id="7dc84-276">此示例绑定的文本内容*mytext*，实例<xref:System.Windows.Controls.TextBlock>到*MyDataProperty*。</span><span class="sxs-lookup"><span data-stu-id="7dc84-276">This example binds the text content of *mytext*, an instance of <xref:System.Windows.Controls.TextBlock>, to *MyDataProperty*.</span></span>  
  
 [!code-csharp[CodeOnlyBinding#1](~/samples/snippets/csharp/VS_Snippets_Wpf/CodeOnlyBinding/CSharp/binding.cs#1)]
 [!code-vb[CodeOnlyBinding#1](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CodeOnlyBinding/VisualBasic/App.vb#1)]  
  
 <span data-ttu-id="7dc84-277">可以使用同一 *myBinding* 对象来创建其他绑定。</span><span class="sxs-lookup"><span data-stu-id="7dc84-277">You can use the same *myBinding* object to create other bindings.</span></span> <span data-ttu-id="7dc84-278">例如，可以使用 *myBinding* 对象将复选框的文本内容绑定到 *MyDataProperty*。</span><span class="sxs-lookup"><span data-stu-id="7dc84-278">For example, you may use *myBinding* object to bind the text content of a check box to *MyDataProperty*.</span></span> <span data-ttu-id="7dc84-279">在这种情况下，将有两个实例<xref:System.Windows.Data.BindingExpression>共享*myBinding*对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-279">In that scenario, there will be two instances of <xref:System.Windows.Data.BindingExpression> sharing the *myBinding* object.</span></span>  
  
 <span data-ttu-id="7dc84-280">一个<xref:System.Windows.Data.BindingExpression>对象可以通过调用的返回值获得<xref:System.Windows.Data.BindingOperations.GetBindingExpression%2A>数据绑定对象上。</span><span class="sxs-lookup"><span data-stu-id="7dc84-280">A <xref:System.Windows.Data.BindingExpression> object can be obtained through the return value of calling <xref:System.Windows.Data.BindingOperations.GetBindingExpression%2A> on a data-bound object.</span></span> <span data-ttu-id="7dc84-281">以下主题演示一些的用法<xref:System.Windows.Data.BindingExpression>类：</span><span class="sxs-lookup"><span data-stu-id="7dc84-281">The following topics demonstrate some of the usages of the <xref:System.Windows.Data.BindingExpression> class:</span></span>  
  
-   [<span data-ttu-id="7dc84-282">从已绑定的目标属性获取绑定对象</span><span class="sxs-lookup"><span data-stu-id="7dc84-282">Get the Binding Object from a Bound Target Property</span></span>](how-to-get-the-binding-object-from-a-bound-target-property.md)  
  
-   [<span data-ttu-id="7dc84-283">控制文本框文本更新源的时间</span><span class="sxs-lookup"><span data-stu-id="7dc84-283">Control When the TextBox Text Updates the Source</span></span>](how-to-control-when-the-textbox-text-updates-the-source.md)  
  
<a name="data_conversion"></a>   
## <a name="data-conversion"></a><span data-ttu-id="7dc84-284">数据转换</span><span class="sxs-lookup"><span data-stu-id="7dc84-284">Data Conversion</span></span>  
 <span data-ttu-id="7dc84-285">在上一示例中，按钮为红色，因为其<xref:System.Windows.Controls.Control.Background%2A>属性绑定到具有值"Red"的字符串属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-285">In the previous example, the button is red because its <xref:System.Windows.Controls.Control.Background%2A> property is bound to a string property with the value "Red".</span></span> <span data-ttu-id="7dc84-286">这样做的原因是上存在的类型转换器<xref:System.Windows.Media.Brush>要转换到的字符串值类型<xref:System.Windows.Media.Brush>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-286">This works because a type converter is present on the <xref:System.Windows.Media.Brush> type to convert the string value to a <xref:System.Windows.Media.Brush>.</span></span>  
  
 <span data-ttu-id="7dc84-287">若要将此信息添加到[创建绑定](#creating_a_binding)一节的图中，关系图如下所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-287">To add this information to the figure in the [Creating a Binding](#creating_a_binding) section, the diagram looks like the following:</span></span>  
  
 ![图，显示的数据绑定的默认属性。](./media/data-binding-overview/data-binding-button-default-conversion.png)  
  
 <span data-ttu-id="7dc84-289">但是，如果而不是让您的绑定源对象具有类型字符串的属性*颜色*类型的属性<xref:System.Windows.Media.Color>？</span><span class="sxs-lookup"><span data-stu-id="7dc84-289">However, what if instead of having a property of type string your binding source object has a *Color* property of type <xref:System.Windows.Media.Color>?</span></span> <span data-ttu-id="7dc84-290">在这种情况下，为了使绑定能够处理您需要首先*颜色*转换的内容的属性值的<xref:System.Windows.Controls.Control.Background%2A>属性接受。</span><span class="sxs-lookup"><span data-stu-id="7dc84-290">In that case, in order for the binding to work you would need to first turn the *Color* property value into something that the <xref:System.Windows.Controls.Control.Background%2A> property accepts.</span></span> <span data-ttu-id="7dc84-291">需要通过实现来创建自定义转换器<xref:System.Windows.Data.IValueConverter>接口，如以下示例所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-291">You would need to create a custom converter by implementing the <xref:System.Windows.Data.IValueConverter> interface, as in the following example:</span></span>  
  
 [!code-csharp[ColorPicker_snip#16](~/samples/snippets/csharp/VS_Snippets_Wpf/ColorPicker_snip/CSharp/ColorPickerLib/ColorPicker.cs#16)]
 [!code-vb[ColorPicker_snip#16](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ColorPicker_snip/visualbasic/colorpickerlib/colorpicker.vb#16)]  
  
 <span data-ttu-id="7dc84-292"><xref:System.Windows.Data.IValueConverter>参考页提供了详细信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-292">The <xref:System.Windows.Data.IValueConverter> reference page provides more information.</span></span>  
  
 <span data-ttu-id="7dc84-293">现在使用自定义转换器而不是默认转换，关系图如下所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-293">Now the custom converter is used instead of default conversion, and our diagram looks like this:</span></span>  
  
 ![图，显示的数据绑定自定义转换器。](./media/data-binding-overview/data-binding-converter-color-example.png)  
  
 <span data-ttu-id="7dc84-295">重申一下，由于要绑定到的类型中提供了类型转换器，因此可以使用默认转换。</span><span class="sxs-lookup"><span data-stu-id="7dc84-295">To reiterate, default conversions may be available because of type converters that are present in the type being bound to.</span></span> <span data-ttu-id="7dc84-296">此行为取决于目标中可用的类型转换器。</span><span class="sxs-lookup"><span data-stu-id="7dc84-296">This behavior will depend on which type converters are available in the target.</span></span> <span data-ttu-id="7dc84-297">如果无法确定，请创建自己的转换器。</span><span class="sxs-lookup"><span data-stu-id="7dc84-297">If in doubt, create your own converter.</span></span>  
  
 <span data-ttu-id="7dc84-298">下面提供了一些典型方案，在这些方案中，实现数据转换器非常有意义：</span><span class="sxs-lookup"><span data-stu-id="7dc84-298">Following are some typical scenarios where it makes sense to implement a data converter:</span></span>  
  
-   <span data-ttu-id="7dc84-299">数据应根据区域性以不同方式显示。</span><span class="sxs-lookup"><span data-stu-id="7dc84-299">Your data should be displayed differently, depending on culture.</span></span> <span data-ttu-id="7dc84-300">例如，可能需要根据在特定区域性中使用的值或标准，实现货币转换器或日历日期/时间转换器。</span><span class="sxs-lookup"><span data-stu-id="7dc84-300">For instance, you might want to implement a currency converter or a calendar date/time converter based on the values or standards used in a particular culture.</span></span>  
  
-   <span data-ttu-id="7dc84-301">使用的数据不一定会更改属性的文本值，但会更改其他某个值（如图像的源，或显示文本的颜色或样式）。</span><span class="sxs-lookup"><span data-stu-id="7dc84-301">The data being used is not necessarily intended to change the text value of a property, but is instead intended to change some other value, such as the source for an image, or the color or style of the display text.</span></span> <span data-ttu-id="7dc84-302">在这种情况下，可以通过转换可能不合适的属性绑定（如将文本字段绑定到表单元格的 Background 属性）来使用转换器。</span><span class="sxs-lookup"><span data-stu-id="7dc84-302">Converters can be used in this instance by converting the binding of a property that might not seem to be appropriate, such as binding a text field to the Background property of a table cell.</span></span>  
  
-   <span data-ttu-id="7dc84-303">将多个控件或控件的多个属性绑定到相同数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-303">More than one control or to multiple properties of controls are bound to the same data.</span></span> <span data-ttu-id="7dc84-304">在这种情况下，主绑定可能仅显示文本，而其他绑定则处理特定的显示问题，但仍使用同一绑定作为源信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-304">In this case, the primary binding might just display the text, whereas other bindings handle specific display issues but still use the same binding as source information.</span></span>  
  
-   <span data-ttu-id="7dc84-305">到目前为止我们尚未讨论<xref:System.Windows.Data.MultiBinding>，其中的目标属性都有绑定的集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-305">So far we have not yet discussed <xref:System.Windows.Data.MultiBinding>, where a target property has a collection of bindings.</span></span> <span data-ttu-id="7dc84-306">情况下<xref:System.Windows.Data.MultiBinding>，使用自定义<xref:System.Windows.Data.IMultiValueConverter>以生成最终值从绑定的值。</span><span class="sxs-lookup"><span data-stu-id="7dc84-306">In the case of a <xref:System.Windows.Data.MultiBinding>, you use a custom <xref:System.Windows.Data.IMultiValueConverter> to produce a final value from the values of the bindings.</span></span> <span data-ttu-id="7dc84-307">例如，可以从红色、蓝色和绿色的值来计算颜色，这些值可能来自相同绑定源对象，也可能来自不同绑定源对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-307">For example, color may be computed from red, blue, and green values, which can be values from the same or different binding source objects.</span></span> <span data-ttu-id="7dc84-308">请参阅<xref:System.Windows.Data.MultiBinding>类页有关示例和信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-308">See the <xref:System.Windows.Data.MultiBinding> class page for examples and information.</span></span>  
  
<a name="binding_to_collections"></a>   
## <a name="binding-to-collections"></a><span data-ttu-id="7dc84-309">绑定到集合</span><span class="sxs-lookup"><span data-stu-id="7dc84-309">Binding to Collections</span></span>  
  
 <span data-ttu-id="7dc84-310">绑定源对象可以视为其属性包含数据的单个对象，也可以视为通常组合在一起的多态对象的数据集合（如数据库的查询结果）。</span><span class="sxs-lookup"><span data-stu-id="7dc84-310">A binding source object can be treated either as a single object of which the properties contain data or as a data collection of polymorphic objects that are often grouped together (such as the result of a query to a database).</span></span> <span data-ttu-id="7dc84-311">到目前为止，我们仅讨论了绑定到单个对象，但绑定到数据集合才是一种常见方案。</span><span class="sxs-lookup"><span data-stu-id="7dc84-311">So far we've only discussed binding to single objects, however, binding to a data collection is a common scenario.</span></span> <span data-ttu-id="7dc84-312">例如，一种常见方案是使用<xref:System.Windows.Controls.ItemsControl>如<xref:System.Windows.Controls.ListBox>， <xref:System.Windows.Controls.ListView>，或<xref:System.Windows.Controls.TreeView>来显示数据集合，如在应用程序中所示[什么是数据绑定？](#what_is_data_binding)部分。</span><span class="sxs-lookup"><span data-stu-id="7dc84-312">For example, a common scenario is to use an <xref:System.Windows.Controls.ItemsControl> such as a <xref:System.Windows.Controls.ListBox>, <xref:System.Windows.Controls.ListView>, or <xref:System.Windows.Controls.TreeView> to display a data collection, such as in the application shown in the [What Is Data Binding?](#what_is_data_binding) section.</span></span>  
  
 <span data-ttu-id="7dc84-313">幸运的是，基本关系图仍然适用。</span><span class="sxs-lookup"><span data-stu-id="7dc84-313">Fortunately, our basic diagram still applies.</span></span> <span data-ttu-id="7dc84-314">如果要绑定<xref:System.Windows.Controls.ItemsControl>到一个集合，该关系图如下所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-314">If you are binding an <xref:System.Windows.Controls.ItemsControl> to a collection, the diagram looks like this:</span></span>  
  
 ![图，显示的数据绑定 ItemsControl 对象。](./media/data-binding-overview/data-binding-itemscontrol.png)  
  
 <span data-ttu-id="7dc84-316">如要绑定此关系图中所示<xref:System.Windows.Controls.ItemsControl>的集合对象，<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>属性是要使用的属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-316">As shown in this diagram, to bind an <xref:System.Windows.Controls.ItemsControl> to a collection object, <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property is the property to use.</span></span> <span data-ttu-id="7dc84-317">您可以看作<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>属性的内容作为<xref:System.Windows.Controls.ItemsControl>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-317">You can think of <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property as the content of the <xref:System.Windows.Controls.ItemsControl>.</span></span> <span data-ttu-id="7dc84-318">请注意，该绑定是<xref:System.Windows.Data.BindingMode.OneWay>因为<xref:System.Windows.Controls.ItemsControl.ItemsSource%2A>属性支持<xref:System.Windows.Data.BindingMode.OneWay>绑定默认情况下。</span><span class="sxs-lookup"><span data-stu-id="7dc84-318">Note that the binding is <xref:System.Windows.Data.BindingMode.OneWay> because the <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property supports <xref:System.Windows.Data.BindingMode.OneWay> binding by default.</span></span>  
  
<a name="how_to_implement_collections"></a>   
### <a name="how-to-implement-collections"></a><span data-ttu-id="7dc84-319">如何实现集合</span><span class="sxs-lookup"><span data-stu-id="7dc84-319">How to Implement Collections</span></span>  
 <span data-ttu-id="7dc84-320">可以枚举实现任何集合<xref:System.Collections.IEnumerable>接口。</span><span class="sxs-lookup"><span data-stu-id="7dc84-320">You can enumerate over any collection that implements the <xref:System.Collections.IEnumerable> interface.</span></span> <span data-ttu-id="7dc84-321">但是，若要设置动态绑定，以便插入或删除集合中的更新[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]自动，该集合必须实现<xref:System.Collections.Specialized.INotifyCollectionChanged>接口。</span><span class="sxs-lookup"><span data-stu-id="7dc84-321">However, to set up dynamic bindings so that insertions or deletions in the collection update the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] automatically, the collection must implement the <xref:System.Collections.Specialized.INotifyCollectionChanged> interface.</span></span> <span data-ttu-id="7dc84-322">此接口公开一个事件，只要基础集合发生更改，就应该引发该事件。</span><span class="sxs-lookup"><span data-stu-id="7dc84-322">This interface exposes an event that should be raised whenever the underlying collection changes.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="7dc84-323">提供了<xref:System.Collections.ObjectModel.ObservableCollection%601>类，该类是公开的数据集合的内置实现<xref:System.Collections.Specialized.INotifyCollectionChanged>接口。</span><span class="sxs-lookup"><span data-stu-id="7dc84-323">provides the <xref:System.Collections.ObjectModel.ObservableCollection%601> class, which is a built-in implementation of a data collection that exposes the <xref:System.Collections.Specialized.INotifyCollectionChanged> interface.</span></span> <span data-ttu-id="7dc84-324">请注意，若要完全支持传输来自源对象到目标的数据值，支持可绑定属性在集合中的每个对象还必须实现<xref:System.ComponentModel.INotifyPropertyChanged>接口。</span><span class="sxs-lookup"><span data-stu-id="7dc84-324">Note that to fully support transferring data values from source objects to targets, each object in your collection that supports bindable properties must also implement the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="7dc84-325">有关详细信息，请参阅[绑定源概述](binding-sources-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-325">For more information, see [Binding Sources Overview](binding-sources-overview.md).</span></span>  
  
 <span data-ttu-id="7dc84-326">在实现自己的集合之前, 请考虑使用<xref:System.Collections.ObjectModel.ObservableCollection%601>或一个现有集合类，如<xref:System.Collections.Generic.List%601>， <xref:System.Collections.ObjectModel.Collection%601>，和<xref:System.ComponentModel.BindingList%601>，此外还有许多其他。</span><span class="sxs-lookup"><span data-stu-id="7dc84-326">Before implementing your own collection, consider using <xref:System.Collections.ObjectModel.ObservableCollection%601> or one of the existing collection classes, such as <xref:System.Collections.Generic.List%601>, <xref:System.Collections.ObjectModel.Collection%601>, and <xref:System.ComponentModel.BindingList%601>, among many others.</span></span> <span data-ttu-id="7dc84-327">如果有高级的方案，但希望实现自己的集合，请考虑使用<xref:System.Collections.IList>，它提供可单独访问的索引，因此获得最佳性能的对象的非泛型集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-327">If you have an advanced scenario and want to implement your own collection, consider using <xref:System.Collections.IList>, which provides a non-generic collection of objects that can be individually accessed by index and thus the best performance.</span></span>  
  
<a name="collection_views"></a>   
### <a name="collection-views"></a><span data-ttu-id="7dc84-328">集合视图</span><span class="sxs-lookup"><span data-stu-id="7dc84-328">Collection Views</span></span>  
 <span data-ttu-id="7dc84-329">一次你<xref:System.Windows.Controls.ItemsControl>绑定到数据集合，您可能需要排序、 筛选或分组数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-329">Once your <xref:System.Windows.Controls.ItemsControl> is bound to a data collection, you may want to sort, filter, or group the data.</span></span> <span data-ttu-id="7dc84-330">若要执行此操作，应使用集合视图，这是实现的类<xref:System.ComponentModel.ICollectionView>接口。</span><span class="sxs-lookup"><span data-stu-id="7dc84-330">To do that, you use collection views, which are classes that implement the <xref:System.ComponentModel.ICollectionView> interface.</span></span>  

#### <a name="what-are-collection-views"></a><span data-ttu-id="7dc84-331">什么是集合视图？</span><span class="sxs-lookup"><span data-stu-id="7dc84-331">What Are Collection Views?</span></span>  
 <span data-ttu-id="7dc84-332">集合视图这一层基于绑定源集合，它允许基于排序、筛选和分组查询来导航并显示源集合，而无需更改基础源集合本身。</span><span class="sxs-lookup"><span data-stu-id="7dc84-332">A collection view is a layer on top of a binding source collection that allows you to navigate and display the source collection based on sort, filter, and group queries, without having to change the underlying source collection itself.</span></span> <span data-ttu-id="7dc84-333">集合视图还维护一个指向集合中当前项的指针。</span><span class="sxs-lookup"><span data-stu-id="7dc84-333">A collection view also maintains a pointer to the current item in the collection.</span></span> <span data-ttu-id="7dc84-334">如果源集合实现<xref:System.Collections.Specialized.INotifyCollectionChanged>接口，所做的更改引起<xref:System.Collections.Specialized.INotifyCollectionChanged.CollectionChanged>事件传播到视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-334">If the source collection implements the <xref:System.Collections.Specialized.INotifyCollectionChanged> interface, the changes raised by the <xref:System.Collections.Specialized.INotifyCollectionChanged.CollectionChanged> event are propagated to the views.</span></span>  
  
 <span data-ttu-id="7dc84-335">由于视图不会更改基础源集合，因此每个源集合都可以有多个关联的视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-335">Because views do not change the underlying source collections, each source collection can have multiple views associated with it.</span></span> <span data-ttu-id="7dc84-336">例如，可以有 *Task* 对象的集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-336">For example, you may have a collection of *Task* objects.</span></span> <span data-ttu-id="7dc84-337">使用视图，可以通过不同方式显示相同数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-337">With the use of views, you can display that same data in different ways.</span></span> <span data-ttu-id="7dc84-338">例如，可能希望在页面左侧显示按优先级排序的任务，而在页面右侧显示按区域分组的任务。</span><span class="sxs-lookup"><span data-stu-id="7dc84-338">For example, on the left side of your page you may want to show tasks sorted by priority, and on the right side, grouped by area.</span></span>  
  
<a name="how_to_create_a_view"></a>   
#### <a name="how-to-create-a-view"></a><span data-ttu-id="7dc84-339">如何创建视图</span><span class="sxs-lookup"><span data-stu-id="7dc84-339">How to Create a View</span></span>  
 <span data-ttu-id="7dc84-340">创建并使用视图的一种方式是直接实例化视图对象，然后将它用作绑定源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-340">One way to create and use a view is to instantiate the view object directly and then use it as the binding source.</span></span> <span data-ttu-id="7dc84-341">例如，请考虑在[什么是数据绑定？](#what_is_data_binding)一节中显示的[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)应用程序。</span><span class="sxs-lookup"><span data-stu-id="7dc84-341">For example, consider the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703) application shown in the [What Is Data Binding?](#what_is_data_binding) section.</span></span> <span data-ttu-id="7dc84-342">实现应用程序，以便<xref:System.Windows.Controls.ListBox>直接绑定到视图而不是数据收集的数据集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-342">The application is implemented such that the <xref:System.Windows.Controls.ListBox> binds to a view over the data collection instead of the data collection directly.</span></span> <span data-ttu-id="7dc84-343">下面的示例摘自[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)应用程序。</span><span class="sxs-lookup"><span data-stu-id="7dc84-343">The following example is extracted from the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703) application.</span></span> <span data-ttu-id="7dc84-344"><xref:System.Windows.Data.CollectionViewSource>类是[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]继承的类的代理<xref:System.Windows.Data.CollectionView>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-344">The <xref:System.Windows.Data.CollectionViewSource> class is the [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] proxy of a class that inherits from <xref:System.Windows.Data.CollectionView>.</span></span> <span data-ttu-id="7dc84-345">在此特定示例中，<xref:System.Windows.Data.CollectionViewSource.Source%2A>视图的绑定到*AuctionItems*集合 (类型的<xref:System.Collections.ObjectModel.ObservableCollection%601>) 的当前应用程序对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-345">In this particular example, the <xref:System.Windows.Data.CollectionViewSource.Source%2A> of the view is bound to the *AuctionItems* collection (of type <xref:System.Collections.ObjectModel.ObservableCollection%601>) of the current application object.</span></span>  
  
 [!code-xaml[DataBindingLab#WindowResources1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#windowresources1)]  
[!code-xaml[DataBindingLab#CollectionViewSource](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#collectionviewsource)]  
[!code-xaml[DataBindingLab#WindowResources2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#windowresources2)]  
  
 <span data-ttu-id="7dc84-346">资源*listingDataView*然后如用作应用程序中的元素的绑定源<xref:System.Windows.Controls.ListBox>:</span><span class="sxs-lookup"><span data-stu-id="7dc84-346">The resource *listingDataView* then serves as the binding source for elements in the application, such as the <xref:System.Windows.Controls.ListBox>:</span></span>  
  
 [!code-xaml[DataBindingLab#Master1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master1)]  
[!code-xaml[DataBindingLab#Master2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master2)]  
  
 <span data-ttu-id="7dc84-347">若要创建另一个视图相同的集合，可以创建另一个<xref:System.Windows.Data.CollectionViewSource>实例，并为其提供不同`x:Key`名称。</span><span class="sxs-lookup"><span data-stu-id="7dc84-347">To create another view for the same collection, you can create another <xref:System.Windows.Data.CollectionViewSource> instance and give it a different `x:Key` name.</span></span>  
  
 <span data-ttu-id="7dc84-348">下表显示了哪些视图数据类型创建为默认集合视图或<xref:System.Windows.Data.CollectionViewSource>基于源集合类型。</span><span class="sxs-lookup"><span data-stu-id="7dc84-348">The following table shows which view data types are created as the default collection view or by <xref:System.Windows.Data.CollectionViewSource> based on the source collection type.</span></span>  
  
|<span data-ttu-id="7dc84-349">源集合类型</span><span class="sxs-lookup"><span data-stu-id="7dc84-349">Source collection type</span></span>|<span data-ttu-id="7dc84-350">集合视图类型</span><span class="sxs-lookup"><span data-stu-id="7dc84-350">Collection view type</span></span>|<span data-ttu-id="7dc84-351">说明</span><span class="sxs-lookup"><span data-stu-id="7dc84-351">Notes</span></span>|  
|----------------------------|--------------------------|-----------|  
|<xref:System.Collections.IEnumerable>|<span data-ttu-id="7dc84-352">基于内部类型 <xref:System.Windows.Data.CollectionView></span><span class="sxs-lookup"><span data-stu-id="7dc84-352">An internal type based on <xref:System.Windows.Data.CollectionView></span></span>|<span data-ttu-id="7dc84-353">无法对项进行分组。</span><span class="sxs-lookup"><span data-stu-id="7dc84-353">Cannot group items.</span></span>|  
|<xref:System.Collections.IList>|<xref:System.Windows.Data.ListCollectionView>|<span data-ttu-id="7dc84-354">最快。</span><span class="sxs-lookup"><span data-stu-id="7dc84-354">Fastest.</span></span>|  
|<xref:System.ComponentModel.IBindingList>|<xref:System.Windows.Data.BindingListCollectionView>||  
  
##### <a name="using-a-default-view"></a><span data-ttu-id="7dc84-355">使用默认视图</span><span class="sxs-lookup"><span data-stu-id="7dc84-355">Using a Default View</span></span>  
 <span data-ttu-id="7dc84-356">创建并使用集合视图的一种方式是指定集合视图作为绑定源。</span><span class="sxs-lookup"><span data-stu-id="7dc84-356">Specifying a collection view as a binding source is one way to create and use a collection view.</span></span> <span data-ttu-id="7dc84-357">WPF 还会为用作绑定源的每个集合创建一个默认集合视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-357">WPF also creates a default collection view for every collection used as a binding source.</span></span> <span data-ttu-id="7dc84-358">如果直接绑定到集合，WPF 会绑定到该集合的默认视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-358">If you bind directly to a collection, WPF binds to its default view.</span></span> <span data-ttu-id="7dc84-359">请注意，此默认视图由同一集合的所有绑定共享，因此一个绑定控件或代码对默认视图所做的更改（如排序或对当前项指针的更改，下文将对此进行讨论）会反映到同一集合的所有其他绑定中。</span><span class="sxs-lookup"><span data-stu-id="7dc84-359">Note that this default view is shared by all bindings to the same collection, so a change made to a default view by one bound control or code (such as sorting or a change to the current item pointer, discussed later) is reflected in all other bindings to the same collection.</span></span>  
  
 <span data-ttu-id="7dc84-360">若要获取的默认视图，请使用<xref:System.Windows.Data.CollectionViewSource.GetDefaultView%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="7dc84-360">To get the default view, you use the <xref:System.Windows.Data.CollectionViewSource.GetDefaultView%2A> method.</span></span> <span data-ttu-id="7dc84-361">有关示例，请参阅[获取数据集合的默认视图](how-to-get-the-default-view-of-a-data-collection.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-361">For an example, see [Get the Default View of a Data Collection](how-to-get-the-default-view-of-a-data-collection.md).</span></span>  
  
##### <a name="collection-views-with-adonet-datatables"></a><span data-ttu-id="7dc84-362">包含 ADO.NET DataTables 的集合视图</span><span class="sxs-lookup"><span data-stu-id="7dc84-362">Collection Views with ADO.NET DataTables</span></span>  
 <span data-ttu-id="7dc84-363">若要提高性能，ADO.NET 的集合视图<xref:System.Data.DataTable>或<xref:System.Data.DataView>对象将排序和筛选来委派<xref:System.Data.DataView>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-363">To improve performance, collection views for ADO.NET <xref:System.Data.DataTable> or <xref:System.Data.DataView> objects delegate sorting and filtering to the <xref:System.Data.DataView>.</span></span> <span data-ttu-id="7dc84-364">这会导致排序和筛选任务由数据源的所有集合视图分担。</span><span class="sxs-lookup"><span data-stu-id="7dc84-364">This causes sorting and filtering to be shared across all collection views of the data source.</span></span> <span data-ttu-id="7dc84-365">若要启用每个集合视图进行排序和筛选独立，初始化每个集合视图有其自身<xref:System.Data.DataView>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-365">To enable each collection view to sort and filter independently, initialize each collection view with its own <xref:System.Data.DataView> object.</span></span>  
  
#### <a name="sorting"></a><span data-ttu-id="7dc84-366">排序</span><span class="sxs-lookup"><span data-stu-id="7dc84-366">Sorting</span></span>  
 <span data-ttu-id="7dc84-367">如前所述，视图可以将排序顺序应用于集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-367">As mentioned before, views can apply a sort order to a collection.</span></span> <span data-ttu-id="7dc84-368">如同在基础集合中一样，数据可能具有或不具有相关的固有顺序。</span><span class="sxs-lookup"><span data-stu-id="7dc84-368">As it exists in the underlying collection, your data may or may not have a relevant, inherent order.</span></span> <span data-ttu-id="7dc84-369">借助集合视图，可以根据自己提供的比较条件来强制确定顺序，或更改默认顺序。</span><span class="sxs-lookup"><span data-stu-id="7dc84-369">The view over the collection allows you to impose an order, or change the default order, based on comparison criteria that you supply.</span></span> <span data-ttu-id="7dc84-370">由于这是基于客户端的数据视图，因此一种常见情况是用户可能希望根据列对应的值，对多列表格数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="7dc84-370">Because it is a client-based view of the data, a common scenario is that the user might want to sort columns of tabular data per the value that the column corresponds to.</span></span> <span data-ttu-id="7dc84-371">通过使用视图，可以应用这种用户实施的排序，而无需对基础集合进行任何更改，甚至不必再次查询集合内容。</span><span class="sxs-lookup"><span data-stu-id="7dc84-371">Using views, this user-driven sort can be applied, again without making any changes to the underlying collection or even having to requery for the collection content.</span></span> <span data-ttu-id="7dc84-372">有关示例，请参阅[在单击标题时对 GridView 列进行排序](../controls/how-to-sort-a-gridview-column-when-a-header-is-clicked.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-372">For an example, see [Sort a GridView Column When a Header Is Clicked](../controls/how-to-sort-a-gridview-column-when-a-header-is-clicked.md).</span></span>  
  
 <span data-ttu-id="7dc84-373">下面的示例显示了"按类别和日期排序"的排序逻辑<xref:System.Windows.Controls.CheckBox>的应用程序[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]中[什么是数据绑定？](#what_is_data_binding)部分：</span><span class="sxs-lookup"><span data-stu-id="7dc84-373">The following example shows the sorting logic of the "Sort by category and date" <xref:System.Windows.Controls.CheckBox> of the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section:</span></span>  
  
 [!code-csharp[DataBindingLab#8](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#8)]
 [!code-vb[DataBindingLab#8](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#8)]  
  
#### <a name="filtering"></a><span data-ttu-id="7dc84-374">筛选</span><span class="sxs-lookup"><span data-stu-id="7dc84-374">Filtering</span></span>  
 <span data-ttu-id="7dc84-375">视图还可以将筛选器应用于集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-375">Views can also apply a filter to a collection.</span></span> <span data-ttu-id="7dc84-376">这意味着即使集合中可能存在一个项，此特定视图也仅用于显示整个集合的某个子集。</span><span class="sxs-lookup"><span data-stu-id="7dc84-376">This means that although an item might exist in the collection, this particular view is intended to show only a certain subset of the full collection.</span></span> <span data-ttu-id="7dc84-377">可以根据条件在数据中进行筛选。</span><span class="sxs-lookup"><span data-stu-id="7dc84-377">You might filter on a condition in the data.</span></span> <span data-ttu-id="7dc84-378">例如，正如在[什么是数据绑定？](#what_is_data_binding)部分中，"显示仅成交价等于"<xref:System.Windows.Controls.CheckBox>包含逻辑，以便筛选出或大于 25 美元的项。</span><span class="sxs-lookup"><span data-stu-id="7dc84-378">For instance, as is done by the application in the [What Is Data Binding?](#what_is_data_binding) section, the "Show only bargains" <xref:System.Windows.Controls.CheckBox> contains logic to filter out items that cost $25 or more.</span></span> <span data-ttu-id="7dc84-379">执行以下代码来设置*ShowOnlyBargainsFilter*作为<xref:System.Windows.Data.CollectionViewSource.Filter>事件处理程序时，<xref:System.Windows.Controls.CheckBox>处于选中状态：</span><span class="sxs-lookup"><span data-stu-id="7dc84-379">The following code is executed to set *ShowOnlyBargainsFilter* as the <xref:System.Windows.Data.CollectionViewSource.Filter> event handler when that <xref:System.Windows.Controls.CheckBox> is selected:</span></span>  
  
 [!code-csharp[DataBindingLab#10](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#10)]
 [!code-vb[DataBindingLab#10](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#10)]  
  
 <span data-ttu-id="7dc84-380">*ShowOnlyBargainsFilter* 事件处理程序具有以下实现：</span><span class="sxs-lookup"><span data-stu-id="7dc84-380">The *ShowOnlyBargainsFilter* event handler has the following implementation:</span></span>  
  
 [!code-csharp[DataBindingLab#5](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#5)]
 [!code-vb[DataBindingLab#5](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#5)]  
  
 <span data-ttu-id="7dc84-381">如果您正在使用它的<xref:System.Windows.Data.CollectionView>类而不是直接<xref:System.Windows.Data.CollectionViewSource>，将使用<xref:System.Windows.Data.CollectionView.Filter%2A>属性指定一个回调。</span><span class="sxs-lookup"><span data-stu-id="7dc84-381">If you are using one of the <xref:System.Windows.Data.CollectionView> classes directly instead of <xref:System.Windows.Data.CollectionViewSource>, you would use the <xref:System.Windows.Data.CollectionView.Filter%2A> property to specify a callback.</span></span> <span data-ttu-id="7dc84-382">有关示例，请参阅[筛选视图中的数据](how-to-filter-data-in-a-view.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-382">For an example, see [Filter Data in a View](how-to-filter-data-in-a-view.md).</span></span>  
  
#### <a name="grouping"></a><span data-ttu-id="7dc84-383">分组</span><span class="sxs-lookup"><span data-stu-id="7dc84-383">Grouping</span></span>  
 <span data-ttu-id="7dc84-384">除了视图的内部类<xref:System.Collections.IEnumerable>集合中，所有集合视图都支持分组，这样用户就可以分区成逻辑组的集合视图中的集合的功能。</span><span class="sxs-lookup"><span data-stu-id="7dc84-384">Except for the internal class that views an <xref:System.Collections.IEnumerable> collection, all collection views support the functionality of grouping, which allows the user to partition the collection in the collection view into logical groups.</span></span> <span data-ttu-id="7dc84-385">这些组可以是显式的，由用户提供组列表；也可以是隐式的，这些组依据数据动态生成。</span><span class="sxs-lookup"><span data-stu-id="7dc84-385">The groups can be explicit, where the user supplies a list of groups, or implicit, where the groups are generated dynamically depending on the data.</span></span>  
  
 <span data-ttu-id="7dc84-386">下面的示例显示了"按类别的组"的逻辑<xref:System.Windows.Controls.CheckBox>:</span><span class="sxs-lookup"><span data-stu-id="7dc84-386">The following example shows the logic of the "Group by category" <xref:System.Windows.Controls.CheckBox>:</span></span>  
  
 [!code-csharp[DataBindingLab#6](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml.cs#6)]
 [!code-vb[DataBindingLab#6](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/MainWindow.xaml.vb#6)]  
  
 <span data-ttu-id="7dc84-387">有关其他分组示例，请参阅[对实现 GridView 的 ListView 中的项进行分组](../controls/how-to-group-items-in-a-listview-that-implements-a-gridview.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-387">For another grouping example, see [Group Items in a ListView That Implements a GridView](../controls/how-to-group-items-in-a-listview-that-implements-a-gridview.md).</span></span>  
  
#### <a name="current-item-pointers"></a><span data-ttu-id="7dc84-388">当前项指针</span><span class="sxs-lookup"><span data-stu-id="7dc84-388">Current Item Pointers</span></span>  
 <span data-ttu-id="7dc84-389">视图还支持当前项的概念。</span><span class="sxs-lookup"><span data-stu-id="7dc84-389">Views also support the notion of a current item.</span></span> <span data-ttu-id="7dc84-390">可以在集合视图中的对象之间导航。</span><span class="sxs-lookup"><span data-stu-id="7dc84-390">You can navigate through the objects in a collection view.</span></span> <span data-ttu-id="7dc84-391">在导航时，你是在移动项指针，该指针可用于检索存在于集合中特定位置的对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-391">As you navigate, you are moving an item pointer that allows you to retrieve the object that exists at that particular location in the collection.</span></span> <span data-ttu-id="7dc84-392">有关示例，请参阅[在数据集合视图中的对象之间导航](how-to-navigate-through-the-objects-in-a-data-collectionview.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-392">For an example, see [Navigate Through the Objects in a Data CollectionView](how-to-navigate-through-the-objects-in-a-data-collectionview.md).</span></span>  
  
 <span data-ttu-id="7dc84-393">由于 WPF 只通过使用视图（你指定的视图或集合的默认视图）绑定到集合，因此集合的所有绑定都有一个当前项指针。</span><span class="sxs-lookup"><span data-stu-id="7dc84-393">Because WPF binds to a collection only by using a view (either a view you specify, or the collection's default view), all bindings to collections have a current item pointer.</span></span> <span data-ttu-id="7dc84-394">绑定到视图时，`Path` 值中的斜杠（“/”）字符用于指定视图的当前项。</span><span class="sxs-lookup"><span data-stu-id="7dc84-394">When binding to a view, the slash ("/") character in a `Path` value designates the current item of the view.</span></span> <span data-ttu-id="7dc84-395">在下面的示例中，数据上下文是一个集合视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-395">In the following example, the data context is a collection view.</span></span> <span data-ttu-id="7dc84-396">第一行绑定到集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-396">The first line binds to the collection.</span></span> <span data-ttu-id="7dc84-397">第二行绑定到集合中的当前项。</span><span class="sxs-lookup"><span data-stu-id="7dc84-397">The second line binds to the current item in the collection.</span></span> <span data-ttu-id="7dc84-398">第三行绑定到集合中当前项的 `Description` 属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-398">The third line binds to the `Description` property of the current item in the collection.</span></span>  
  
```xaml  
<Button Content="{Binding }" />  
<Button Content="{Binding Path=/}" />  
<Button Content="{Binding Path=/Description}" />   
```  
  
 <span data-ttu-id="7dc84-399">还可以连着使用斜杠和属性语法以遍历集合的分层。</span><span class="sxs-lookup"><span data-stu-id="7dc84-399">The slash and property syntax can also be stacked to traverse a hierarchy of collections.</span></span> <span data-ttu-id="7dc84-400">以下示例绑定到一个名为 `Offices` 的集合的当前项，此集合是源集合的当前项的属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-400">The following example binds to the current item of a collection named `Offices`, which is a property of the current item of the source collection.</span></span>  
  
```xaml  
<Button Content="{Binding /Offices/}" />  
```  
  
 <span data-ttu-id="7dc84-401">当前项指针可能会受对集合应用的任何排序或筛选操作的影响。</span><span class="sxs-lookup"><span data-stu-id="7dc84-401">The current item pointer can be affected by any sorting or filtering that is applied to the collection.</span></span> <span data-ttu-id="7dc84-402">排序操作将当前项指针保留在所选的最后一项上，但集合视图现已围绕此指针重构。</span><span class="sxs-lookup"><span data-stu-id="7dc84-402">Sorting preserves the current item pointer on the last item selected, but the collection view is now restructured around it.</span></span> <span data-ttu-id="7dc84-403">（或许所选项以前曾位于列表的开头，但现在所选项可能位于中间的某个位置。）如果所选内容在筛选之后保留在视图中，则筛选操作会保留所选项。</span><span class="sxs-lookup"><span data-stu-id="7dc84-403">(Perhaps the selected item was at the beginning of the list before, but now the selected item might be somewhere in the middle.) Filtering preserves the selected item if that selection remains in view after the filtering.</span></span> <span data-ttu-id="7dc84-404">否则，当前项指针会设置为经过筛选的集合视图的第一项。</span><span class="sxs-lookup"><span data-stu-id="7dc84-404">Otherwise, the current item pointer is set to the first item of the filtered collection view.</span></span>  
  
<a name="master_detail_scenario"></a>   
#### <a name="master-detail-binding-scenario"></a><span data-ttu-id="7dc84-405">主-从绑定方案</span><span class="sxs-lookup"><span data-stu-id="7dc84-405">Master-Detail Binding Scenario</span></span>  
 <span data-ttu-id="7dc84-406">当前项的概念不仅适用于集合中各项的导航，也适用于主-从绑定方案。</span><span class="sxs-lookup"><span data-stu-id="7dc84-406">The notion of a current item is useful not only for navigation of items in a collection, but also for the master-detail binding scenario.</span></span> <span data-ttu-id="7dc84-407">再考虑一下[什么是数据绑定？](#what_is_data_binding)一节中的应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="7dc84-407">Consider the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section again.</span></span> <span data-ttu-id="7dc84-408">在该应用程序的所选<xref:System.Windows.Controls.ListBox>确定中所示的内容<xref:System.Windows.Controls.ContentControl>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-408">In that application, the selection within the <xref:System.Windows.Controls.ListBox> determines the content shown in the <xref:System.Windows.Controls.ContentControl>.</span></span> <span data-ttu-id="7dc84-409">若要将其放在另一种方法时<xref:System.Windows.Controls.ListBox>选择了项目，<xref:System.Windows.Controls.ContentControl>显示选定项的详细信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-409">To put it in another way, when a <xref:System.Windows.Controls.ListBox> item is selected, the <xref:System.Windows.Controls.ContentControl> shows the details of the selected item.</span></span>  
  
 <span data-ttu-id="7dc84-410">只需将两个或更多控件绑定到同一视图即可实现主-从方案。</span><span class="sxs-lookup"><span data-stu-id="7dc84-410">You can implement the master-detail scenario simply by having two or more controls bound to the same view.</span></span> <span data-ttu-id="7dc84-411">下面的示例摘自[数据绑定演示](https://go.microsoft.com/fwlink/?LinkID=163703)显示的标记<xref:System.Windows.Controls.ListBox>和<xref:System.Windows.Controls.ContentControl>应用程序上看到[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]中[什么是数据绑定？](#what_is_data_binding)部分：</span><span class="sxs-lookup"><span data-stu-id="7dc84-411">The following example from the [Data Binding Demo](https://go.microsoft.com/fwlink/?LinkID=163703) shows the markup of the <xref:System.Windows.Controls.ListBox> and the <xref:System.Windows.Controls.ContentControl> you see on the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section:</span></span>  
  
 [!code-xaml[DataBindingLab#Master1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master1)]  
[!code-xaml[DataBindingLab#Master2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#master2)]  
[!code-xaml[DataBindingLab#Detail](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/MainWindow.xaml#detail)]  
  
 <span data-ttu-id="7dc84-412">请注意，这两个控件都绑定到同一个源，即 *listingDataView* 静态资源（请参阅[如何创建视图](#how_to_create_a_view)一节中此资源的定义）。</span><span class="sxs-lookup"><span data-stu-id="7dc84-412">Notice that both of the controls are bound to the same source, the *listingDataView* static resource (see the definition of this resource in the [How to Create a View section](#how_to_create_a_view)).</span></span> <span data-ttu-id="7dc84-413">这样做的原因时单一实例对象 (<xref:System.Windows.Controls.ContentControl>这种情况下) 绑定到一个集合视图，它会自动将绑定到<xref:System.Windows.Data.CollectionView.CurrentItem%2A>的视图。</span><span class="sxs-lookup"><span data-stu-id="7dc84-413">This works because when a singleton object (the <xref:System.Windows.Controls.ContentControl> in this case) is bound to a collection view, it automatically binds to the <xref:System.Windows.Data.CollectionView.CurrentItem%2A> of the view.</span></span> <span data-ttu-id="7dc84-414">请注意，<xref:System.Windows.Data.CollectionViewSource>对象自动同步货币与所选内容。</span><span class="sxs-lookup"><span data-stu-id="7dc84-414">Note that <xref:System.Windows.Data.CollectionViewSource> objects automatically synchronize currency and selection.</span></span> <span data-ttu-id="7dc84-415">如果列表控件未绑定到<xref:System.Windows.Data.CollectionViewSource>对象与此示例中，则需要设置其<xref:System.Windows.Controls.Primitives.Selector.IsSynchronizedWithCurrentItem%2A>属性设置为`true`为实现此目的。</span><span class="sxs-lookup"><span data-stu-id="7dc84-415">If your list control is not bound to a <xref:System.Windows.Data.CollectionViewSource> object as in this example, then you would need to set its <xref:System.Windows.Controls.Primitives.Selector.IsSynchronizedWithCurrentItem%2A> property to `true` for this to work.</span></span>  
  
 <span data-ttu-id="7dc84-416">有关其他示例，请参阅[绑定到集合并基于选择显示信息](how-to-bind-to-a-collection-and-display-information-based-on-selection.md)和[对分层数据使用主-从模式](how-to-use-the-master-detail-pattern-with-hierarchical-data.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-416">For other examples, see [Bind to a Collection and Display Information Based on Selection](how-to-bind-to-a-collection-and-display-information-based-on-selection.md) and [Use the Master-Detail Pattern with Hierarchical Data](how-to-use-the-master-detail-pattern-with-hierarchical-data.md).</span></span>  
  
 <span data-ttu-id="7dc84-417">你可能已经注意到上述示例使用了一个模板。</span><span class="sxs-lookup"><span data-stu-id="7dc84-417">You may have noticed that the above example uses a template.</span></span> <span data-ttu-id="7dc84-418">事实上，数据不会显示我们也希望而不使用模板的方式 (显式使用的那个<xref:System.Windows.Controls.ContentControl>和隐式使用的那个<xref:System.Windows.Controls.ListBox>)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-418">In fact, the data would not be displayed the way we wish without the use of templates (the one explicitly used by the <xref:System.Windows.Controls.ContentControl> and the one implicitly used by the <xref:System.Windows.Controls.ListBox>).</span></span> <span data-ttu-id="7dc84-419">现在，我们开始介绍下一节中的数据模板化。</span><span class="sxs-lookup"><span data-stu-id="7dc84-419">We now turn to data templating in the next section.</span></span>  
  
<a name="data_templating"></a>   
## <a name="data-templating"></a><span data-ttu-id="7dc84-420">数据模板化</span><span class="sxs-lookup"><span data-stu-id="7dc84-420">Data Templating</span></span>  
 <span data-ttu-id="7dc84-421">如果不使用数据模板，[什么是数据绑定？](#what_is_data_binding)一节中的应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 将如下所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-421">Without the use of data templates, our application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the [What Is Data Binding?](#what_is_data_binding) section would look like the following:</span></span>  
  
 ![没有数据模板的数据绑定演示](./media/data-binding-overview/data-binding-demo-templates.png)  
  
 <span data-ttu-id="7dc84-423">上一节中的示例中所示同时<xref:System.Windows.Controls.ListBox>控件和<xref:System.Windows.Controls.ContentControl>绑定到整个集合对象 （或更具体地说，集合对象视图） 的*AuctionItem*s。</span><span class="sxs-lookup"><span data-stu-id="7dc84-423">As shown in the example in the previous section, both the <xref:System.Windows.Controls.ListBox> control and the <xref:System.Windows.Controls.ContentControl> are bound to the entire collection object (or more specifically, the view over the collection object) of *AuctionItem*s.</span></span> <span data-ttu-id="7dc84-424">如果没有特殊说明如何显示数据集合的<xref:System.Windows.Controls.ListBox>显示基础集合中的每个对象的字符串表示形式和<xref:System.Windows.Controls.ContentControl>显示它所绑定到的对象的字符串表示形式。</span><span class="sxs-lookup"><span data-stu-id="7dc84-424">Without specific instructions of how to display the data collection, the <xref:System.Windows.Controls.ListBox> is displaying a string representation of each object in the underlying collection and the <xref:System.Windows.Controls.ContentControl> is displaying a string representation of the object it is bound to.</span></span>  
  
 <span data-ttu-id="7dc84-425">若要解决该问题，应用程序定义<xref:System.Windows.DataTemplate>s。</span><span class="sxs-lookup"><span data-stu-id="7dc84-425">To solve that problem, the application defines <xref:System.Windows.DataTemplate>s.</span></span> <span data-ttu-id="7dc84-426">上一节中的示例中所示<xref:System.Windows.Controls.ContentControl>显式地使用*detailsProductListingTemplate*<xref:System.Windows.DataTemplate>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-426">As shown in the example in the previous section, the <xref:System.Windows.Controls.ContentControl> explicitly uses the *detailsProductListingTemplate*<xref:System.Windows.DataTemplate>.</span></span> <span data-ttu-id="7dc84-427"><xref:System.Windows.Controls.ListBox>控制隐式使用以下<xref:System.Windows.DataTemplate>显示时*AuctionItem*集合中的对象：</span><span class="sxs-lookup"><span data-stu-id="7dc84-427">The <xref:System.Windows.Controls.ListBox> control implicitly uses the following <xref:System.Windows.DataTemplate> when displaying the *AuctionItem* objects in the collection:</span></span>  
  
 [!code-xaml[DataBindingLab#AuctionItemDataTemplate](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/DataBindingLabApp.xaml#auctionitemdatatemplate)]  
  
 <span data-ttu-id="7dc84-428">通过使用这两个<xref:System.Windows.DataTemplate>s，生成的 UI 是中所示[什么是数据绑定？](#what_is_data_binding)部分。</span><span class="sxs-lookup"><span data-stu-id="7dc84-428">With the use of those two <xref:System.Windows.DataTemplate>s, the resulting UI is the one shown in the [What Is Data Binding?](#what_is_data_binding) section.</span></span> <span data-ttu-id="7dc84-429">您可以看到屏幕快照，除了让您将数据放在控件中<xref:System.Windows.DataTemplate>s 允许您定义引人注目的视觉对象，为你的数据。</span><span class="sxs-lookup"><span data-stu-id="7dc84-429">As you can see from that screenshot, in addition to letting you place data in your controls, <xref:System.Windows.DataTemplate>s allow you to define compelling visuals for your data.</span></span> <span data-ttu-id="7dc84-430">例如，<xref:System.Windows.DataTrigger>更高版本中使用了<xref:System.Windows.DataTemplate>以便*AuctionItem*s *SpecialFeatures*的值*突出显示*会显示为带有橙色边框和一个星号。</span><span class="sxs-lookup"><span data-stu-id="7dc84-430">For example, <xref:System.Windows.DataTrigger>s are used in the above <xref:System.Windows.DataTemplate> so that *AuctionItem*s with *SpecialFeatures* value of *HighLight* would be displayed with an orange border and a star.</span></span>  
  
 <span data-ttu-id="7dc84-431">有关数据模板的详细信息，请参阅[数据模板化概述](data-templating-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="7dc84-431">For more information about data templates, see the [Data Templating Overview](data-templating-overview.md).</span></span>  
  
<a name="data_validation"></a>   
## <a name="data-validation"></a><span data-ttu-id="7dc84-432">数据验证</span><span class="sxs-lookup"><span data-stu-id="7dc84-432">Data Validation</span></span>  
  
 <span data-ttu-id="7dc84-433">接受用户输入的大多数应用程序都需要具有验证逻辑，以确保用户输入了预期信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-433">Most applications that take user input need to have validation logic to ensure that the user has entered the expected information.</span></span> <span data-ttu-id="7dc84-434">可基于类型、范围、格式或特定于应用程序的其他要求执行验证检查。</span><span class="sxs-lookup"><span data-stu-id="7dc84-434">The validation checks can be based on type, range, format, or other application-specific requirements.</span></span> <span data-ttu-id="7dc84-435">本节讨论了数据验证在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中的工作原理。</span><span class="sxs-lookup"><span data-stu-id="7dc84-435">This section discusses how data validation works in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
### <a name="associating-validation-rules-with-a-binding"></a><span data-ttu-id="7dc84-436">将验证规则与绑定关联</span><span class="sxs-lookup"><span data-stu-id="7dc84-436">Associating Validation Rules with a Binding</span></span>  
 <span data-ttu-id="7dc84-437">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]数据绑定模型，可将相关联<xref:System.Windows.Data.Binding.ValidationRules%2A>与你<xref:System.Windows.Data.Binding>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-437">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] data binding model allows you to associate <xref:System.Windows.Data.Binding.ValidationRules%2A> with your <xref:System.Windows.Data.Binding> object.</span></span> <span data-ttu-id="7dc84-438">例如，下面的示例将绑定<xref:System.Windows.Controls.TextBox>到名为的属性`StartPrice`，并添加<xref:System.Windows.Controls.ExceptionValidationRule>对象传递给<xref:System.Windows.Data.Binding.ValidationRules%2A?displayProperty=nameWithType>属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-438">For example, the following example binds a <xref:System.Windows.Controls.TextBox> to a property named `StartPrice` and adds a <xref:System.Windows.Controls.ExceptionValidationRule> object to the <xref:System.Windows.Data.Binding.ValidationRules%2A?displayProperty=nameWithType> property.</span></span>  
  
 [!code-xaml[DataBindingLab#DefaultValidation](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/AddProductWindow.xaml#defaultvalidation)]  
  
 <span data-ttu-id="7dc84-439">一个<xref:System.Windows.Controls.ValidationRule>对象检查属性的值是否有效。</span><span class="sxs-lookup"><span data-stu-id="7dc84-439">A <xref:System.Windows.Controls.ValidationRule> object checks whether the value of a property is valid.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="7dc84-440">具有以下两种类型的内置<xref:System.Windows.Controls.ValidationRule>对象：</span><span class="sxs-lookup"><span data-stu-id="7dc84-440">has the following two types of built-in <xref:System.Windows.Controls.ValidationRule> objects:</span></span>  
  
-   <span data-ttu-id="7dc84-441">一个<xref:System.Windows.Controls.ExceptionValidationRule>检查的绑定源属性更新过程中引发的异常。</span><span class="sxs-lookup"><span data-stu-id="7dc84-441">A <xref:System.Windows.Controls.ExceptionValidationRule> checks for exceptions thrown during the update of the binding source property.</span></span> <span data-ttu-id="7dc84-442">在以上示例中，`StartPrice` 为整数类型。</span><span class="sxs-lookup"><span data-stu-id="7dc84-442">In the previous example, `StartPrice` is of type integer.</span></span> <span data-ttu-id="7dc84-443">当用户输入的值无法转换为整数时，将引发异常，这会导致将绑定标记为无效。</span><span class="sxs-lookup"><span data-stu-id="7dc84-443">When the user enters a value that cannot be converted to an integer, an exception is thrown, causing the binding to be marked as invalid.</span></span> <span data-ttu-id="7dc84-444">设置的可选语法<xref:System.Windows.Controls.ExceptionValidationRule>显式是设置<xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A>属性设置为`true`上你<xref:System.Windows.Data.Binding>或<xref:System.Windows.Data.MultiBinding>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-444">An alternative syntax to setting the <xref:System.Windows.Controls.ExceptionValidationRule> explicitly is to set the <xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A> property to `true` on your <xref:System.Windows.Data.Binding> or <xref:System.Windows.Data.MultiBinding> object.</span></span>  
  
-   <span data-ttu-id="7dc84-445">一个<xref:System.Windows.Controls.DataErrorValidationRule>对象由对象实现的对象引发的错误检查<xref:System.ComponentModel.IDataErrorInfo>接口。</span><span class="sxs-lookup"><span data-stu-id="7dc84-445">A <xref:System.Windows.Controls.DataErrorValidationRule> object checks for errors that are raised by objects that implement the <xref:System.ComponentModel.IDataErrorInfo> interface.</span></span> <span data-ttu-id="7dc84-446">使用此验证规则的示例，请参阅<xref:System.Windows.Controls.DataErrorValidationRule>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-446">For an example of using this validation rule, see <xref:System.Windows.Controls.DataErrorValidationRule>.</span></span> <span data-ttu-id="7dc84-447">设置的可选语法<xref:System.Windows.Controls.DataErrorValidationRule>显式是设置<xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A>属性设置为`true`上你<xref:System.Windows.Data.Binding>或<xref:System.Windows.Data.MultiBinding>对象。</span><span class="sxs-lookup"><span data-stu-id="7dc84-447">An alternative syntax to setting the <xref:System.Windows.Controls.DataErrorValidationRule> explicitly is to set the <xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A> property to `true` on your <xref:System.Windows.Data.Binding> or <xref:System.Windows.Data.MultiBinding> object.</span></span>  
  
 <span data-ttu-id="7dc84-448">此外可以通过从派生来创建你自己的验证规则<xref:System.Windows.Controls.ValidationRule>类和实现<xref:System.Windows.Controls.ValidationRule.Validate%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="7dc84-448">You can also create your own validation rule by deriving from the <xref:System.Windows.Controls.ValidationRule> class and implementing the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method.</span></span> <span data-ttu-id="7dc84-449">下面的示例演示使用的规则*添加产品清单*"开始日期"<xref:System.Windows.Controls.TextBox>从[什么是数据绑定？](#what_is_data_binding)部分：</span><span class="sxs-lookup"><span data-stu-id="7dc84-449">The following example shows the rule used by the *Add Product Listing* "Start Date" <xref:System.Windows.Controls.TextBox> from the [What Is Data Binding?](#what_is_data_binding) section:</span></span>  
  
 [!code-csharp[DataBindingLab#2](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/FutureDateRule.cs#2)]
 [!code-vb[DataBindingLab#2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DataBindingLab/VisualBasic/FutureDateRule.vb#2)]  
  
 <span data-ttu-id="7dc84-450">*StartDateEntryForm* <xref:System.Windows.Controls.TextBox>使用此*FutureDateRule*，如以下示例所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-450">The *StartDateEntryForm* <xref:System.Windows.Controls.TextBox> uses this *FutureDateRule*, as shown in the following example:</span></span>  
  
 [!code-xaml[DataBindingLab#CustomValidation](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/AddProductWindow.xaml#customvalidation)]  
  
 <span data-ttu-id="7dc84-451">请注意，由于<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>值是<xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>，绑定引擎都会更新源值在每次击键，这意味着它还检查中的每个规则<xref:System.Windows.Data.Binding.ValidationRules%2A>在每次击键的集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-451">Note that because the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> value is <xref:System.Windows.Data.UpdateSourceTrigger.PropertyChanged>, the binding engine updates the source value on every keystroke, which means it also checks every rule in the <xref:System.Windows.Data.Binding.ValidationRules%2A> collection on every keystroke.</span></span> <span data-ttu-id="7dc84-452">我们会在“验证过程”一节中对此深入讨论。</span><span class="sxs-lookup"><span data-stu-id="7dc84-452">We discuss this further in the Validation Process section.</span></span>  
  
<a name="invalidation_feedback"></a>   
### <a name="providing-visual-feedback"></a><span data-ttu-id="7dc84-453">提供视觉反馈</span><span class="sxs-lookup"><span data-stu-id="7dc84-453">Providing Visual Feedback</span></span>  
 <span data-ttu-id="7dc84-454">如果用户输入的值无效，你可能希望在应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 上提供一些有关错误的反馈。</span><span class="sxs-lookup"><span data-stu-id="7dc84-454">If the user enters an invalid value, you may want to provide some feedback about the error on the application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="7dc84-455">提供此类反馈是设置的一种方法<xref:System.Windows.Controls.Validation.ErrorTemplate%2A?displayProperty=nameWithType>附加属性设置为自定义<xref:System.Windows.Controls.ControlTemplate>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-455">One way to provide such feedback is to set the <xref:System.Windows.Controls.Validation.ErrorTemplate%2A?displayProperty=nameWithType> attached property to a custom <xref:System.Windows.Controls.ControlTemplate>.</span></span> <span data-ttu-id="7dc84-456">在上一小节中所示*StartDateEntryForm* <xref:System.Windows.Controls.TextBox>使用<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>调用*validationTemplate*。</span><span class="sxs-lookup"><span data-stu-id="7dc84-456">As shown in the previous subsection, the *StartDateEntryForm* <xref:System.Windows.Controls.TextBox> uses an <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> called *validationTemplate*.</span></span> <span data-ttu-id="7dc84-457">以下示例显示了 *validationTemplate* 的定义：</span><span class="sxs-lookup"><span data-stu-id="7dc84-457">The following example shows the definition of *validationTemplate*:</span></span>  
  
 [!code-xaml[DataBindingLab#1](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/AddProductWindow.xaml#1)]  
  
 <span data-ttu-id="7dc84-458"><xref:System.Windows.Controls.AdornedElementPlaceholder>元素指定要装饰的控件应放置的位置。</span><span class="sxs-lookup"><span data-stu-id="7dc84-458">The <xref:System.Windows.Controls.AdornedElementPlaceholder> element specifies where the control being adorned should be placed.</span></span>  
  
 <span data-ttu-id="7dc84-459">此外，还可以使用<xref:System.Windows.Controls.ToolTip>显示错误消息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-459">In addition, you may also use a <xref:System.Windows.Controls.ToolTip> to display the error message.</span></span> <span data-ttu-id="7dc84-460">这两个*StartDateEntryForm*并*StartPriceEntryForm*<xref:System.Windows.Controls.TextBox>es 使用样式*textStyleTextBox*，这将创建<xref:System.Windows.Controls.ToolTip>，显示错误消息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-460">Both the *StartDateEntryForm* and the *StartPriceEntryForm*<xref:System.Windows.Controls.TextBox>es use the style *textStyleTextBox*, which creates a <xref:System.Windows.Controls.ToolTip> that displays the error message.</span></span> <span data-ttu-id="7dc84-461">以下示例显示了 *textStyleTextBox* 的定义。</span><span class="sxs-lookup"><span data-stu-id="7dc84-461">The following example shows the definition of *textStyleTextBox*.</span></span> <span data-ttu-id="7dc84-462">附加的属性<xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType>是`true`当一个或多个绑定元素的属性的绑定存在错误。</span><span class="sxs-lookup"><span data-stu-id="7dc84-462">The attached property <xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType> is `true` when one or more of the bindings on the properties of the bound element are in error.</span></span>  
  
 [!code-xaml[DataBindingLab#14](~/samples/snippets/csharp/VS_Snippets_Wpf/DataBindingLab/CSharp/DataBindingLabApp.xaml#14)]  
  
 <span data-ttu-id="7dc84-463">使用的自定义<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>并<xref:System.Windows.Controls.ToolTip>，则*StartDateEntryForm* <xref:System.Windows.Controls.TextBox>验证错误时，看起来如下所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-463">With the custom <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> and the <xref:System.Windows.Controls.ToolTip>, the *StartDateEntryForm* <xref:System.Windows.Controls.TextBox> looks like the following when there is a validation error:</span></span>  
  
 <span data-ttu-id="7dc84-464">![数据绑定验证错误](./media/databindingdemo-validation.PNG "DataBindingDemo_Validation")</span><span class="sxs-lookup"><span data-stu-id="7dc84-464">![Data binding validation error](./media/databindingdemo-validation.PNG "DataBindingDemo_Validation")</span></span>  
  
 <span data-ttu-id="7dc84-465">如果你<xref:System.Windows.Data.Binding>具有关联的验证规则，但不是指定<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>在绑定控件上，默认值<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>将用于验证错误时通知用户。</span><span class="sxs-lookup"><span data-stu-id="7dc84-465">If your <xref:System.Windows.Data.Binding> has associated validation rules but you do not specify an <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> on the bound control, a default <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> will be used to notify users when there is a validation error.</span></span> <span data-ttu-id="7dc84-466">默认值<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>是装饰器层中定义红色边框的控件模板。</span><span class="sxs-lookup"><span data-stu-id="7dc84-466">The default <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> is a control template that defines a red border in the adorner layer.</span></span> <span data-ttu-id="7dc84-467">默认值<xref:System.Windows.Controls.Validation.ErrorTemplate%2A>并<xref:System.Windows.Controls.ToolTip>，则[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]的*StartPriceEntryForm* <xref:System.Windows.Controls.TextBox>验证错误时，看起来如下所示：</span><span class="sxs-lookup"><span data-stu-id="7dc84-467">With the default <xref:System.Windows.Controls.Validation.ErrorTemplate%2A> and the <xref:System.Windows.Controls.ToolTip>, the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] of the *StartPriceEntryForm* <xref:System.Windows.Controls.TextBox> looks like the following when there is a validation error:</span></span>  
  
 <span data-ttu-id="7dc84-468">![数据绑定验证错误](./media/databindingdemo-validationdefault.PNG "DataBindingDemo_ValidationDefault")</span><span class="sxs-lookup"><span data-stu-id="7dc84-468">![Data binding validation error](./media/databindingdemo-validationdefault.PNG "DataBindingDemo_ValidationDefault")</span></span>  
  
 <span data-ttu-id="7dc84-469">有关如何提供逻辑以验证对话框中所有控件的示例，请参阅[对话框概述](../app-development/dialog-boxes-overview.md)中的“自定义对话框”一节。</span><span class="sxs-lookup"><span data-stu-id="7dc84-469">For an example of how to provide logic to validate all controls in a dialog box, see the Custom Dialog Boxes section in the [Dialog Boxes Overview](../app-development/dialog-boxes-overview.md).</span></span>  
  
### <a name="validation-process"></a><span data-ttu-id="7dc84-470">验证过程</span><span class="sxs-lookup"><span data-stu-id="7dc84-470">Validation Process</span></span>  
 <span data-ttu-id="7dc84-471">通常，在目标的值传输到绑定源属性时会进行验证。</span><span class="sxs-lookup"><span data-stu-id="7dc84-471">Validation usually occurs when the value of a target is transferred to the binding source property.</span></span> <span data-ttu-id="7dc84-472">在将发生这种情况<xref:System.Windows.Data.BindingMode.TwoWay>和<xref:System.Windows.Data.BindingMode.OneWayToSource>绑定。</span><span class="sxs-lookup"><span data-stu-id="7dc84-472">This occurs on <xref:System.Windows.Data.BindingMode.TwoWay> and <xref:System.Windows.Data.BindingMode.OneWayToSource> bindings.</span></span> <span data-ttu-id="7dc84-473">重申一下，哪些因素会导致源更新依赖于的值<xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A>属性，如中所述[触发源更新](#what_triggers_source_updates)部分。</span><span class="sxs-lookup"><span data-stu-id="7dc84-473">To reiterate, what causes a source update depends on the value of the <xref:System.Windows.Data.Binding.UpdateSourceTrigger%2A> property, as described in the [What Triggers Source Updates](#what_triggers_source_updates) section.</span></span>  
  
 <span data-ttu-id="7dc84-474">下面描述了*验证*过程。</span><span class="sxs-lookup"><span data-stu-id="7dc84-474">The following describes the *validation* process.</span></span> <span data-ttu-id="7dc84-475">注意，只要在验证过程中发生验证错误或其他类型的错误，该过程就会中断。</span><span class="sxs-lookup"><span data-stu-id="7dc84-475">Note that if a validation error or other type of error occurs at any time during this process, the process is halted.</span></span>  
  
1. <span data-ttu-id="7dc84-476">绑定引擎会检查是否有任何自定义<xref:System.Windows.Controls.ValidationRule>对象定义其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.RawProposedValue>为该<xref:System.Windows.Data.Binding>，在这种情况下它将调用<xref:System.Windows.Controls.ValidationRule.Validate%2A>上每个方法<xref:System.Windows.Controls.ValidationRule>到其中一个运行时遇到错误或直到全部规则都通过为止。</span><span class="sxs-lookup"><span data-stu-id="7dc84-476">The binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.RawProposedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> until one of them runs into an error or until all of them pass.</span></span>  
  
2. <span data-ttu-id="7dc84-477">绑定引擎随后会调用转换器（如果存在）。</span><span class="sxs-lookup"><span data-stu-id="7dc84-477">The binding engine then calls the converter, if one exists.</span></span>  
  
3. <span data-ttu-id="7dc84-478">如果转换器成功，绑定引擎会检查是否有任何自定义<xref:System.Windows.Controls.ValidationRule>对象定义其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue>为该<xref:System.Windows.Data.Binding>，在这种情况下它将调用<xref:System.Windows.Controls.ValidationRule.Validate%2A>上每个方法<xref:System.Windows.Controls.ValidationRule>具有<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue>直到其中一个运行一个规则出错或者全部规则都通过。</span><span class="sxs-lookup"><span data-stu-id="7dc84-478">If the converter succeeds, the binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.ConvertedProposedValue> until one of them runs into an error or until all of them pass.</span></span>  
  
4. <span data-ttu-id="7dc84-479">绑定引擎设置源属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-479">The binding engine sets the source property.</span></span>  
  
5. <span data-ttu-id="7dc84-480">绑定引擎会检查是否有任何自定义<xref:System.Windows.Controls.ValidationRule>对象定义其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.UpdatedValue>为该<xref:System.Windows.Data.Binding>，在这种情况下它将调用<xref:System.Windows.Controls.ValidationRule.Validate%2A>上每个方法<xref:System.Windows.Controls.ValidationRule>具有<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.UpdatedValue>直到其中一个运行一个规则出错或者全部规则都通过。</span><span class="sxs-lookup"><span data-stu-id="7dc84-480">The binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> until one of them runs into an error or until all of them pass.</span></span> <span data-ttu-id="7dc84-481">如果<xref:System.Windows.Controls.DataErrorValidationRule>与绑定相关联并将其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为默认情况下， <xref:System.Windows.Controls.ValidationStep.UpdatedValue>，则<xref:System.Windows.Controls.DataErrorValidationRule>此时检查。</span><span class="sxs-lookup"><span data-stu-id="7dc84-481">If a <xref:System.Windows.Controls.DataErrorValidationRule> is associated with a binding and its <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to the default, <xref:System.Windows.Controls.ValidationStep.UpdatedValue>, the <xref:System.Windows.Controls.DataErrorValidationRule> is checked at this point.</span></span> <span data-ttu-id="7dc84-482">这也是点时具有的绑定<xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A>设置为`true`检查。</span><span class="sxs-lookup"><span data-stu-id="7dc84-482">This is also the point when bindings that have the <xref:System.Windows.Data.Binding.ValidatesOnDataErrors%2A> set to `true` are checked.</span></span>  
  
6. <span data-ttu-id="7dc84-483">绑定引擎会检查是否有任何自定义<xref:System.Windows.Controls.ValidationRule>对象定义其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.CommittedValue>为该<xref:System.Windows.Data.Binding>，在这种情况下它将调用<xref:System.Windows.Controls.ValidationRule.Validate%2A>上每个方法<xref:System.Windows.Controls.ValidationRule>具有<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.CommittedValue>直到其中一个运行一个规则出错或者全部规则都通过。</span><span class="sxs-lookup"><span data-stu-id="7dc84-483">The binding engine checks if there are any custom <xref:System.Windows.Controls.ValidationRule> objects defined whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.CommittedValue> for that <xref:System.Windows.Data.Binding>, in which case it calls the <xref:System.Windows.Controls.ValidationRule.Validate%2A> method on each <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.CommittedValue> until one of them runs into an error or until all of them pass.</span></span>  
  
 <span data-ttu-id="7dc84-484">如果<xref:System.Windows.Controls.ValidationRule>没有通过在此过程的任意时间，绑定引擎创建<xref:System.Windows.Controls.ValidationError>对象，并将其添加到<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>的绑定元素集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-484">If a <xref:System.Windows.Controls.ValidationRule> does not pass at any time throughout this process, the binding engine creates a <xref:System.Windows.Controls.ValidationError> object and adds it to the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> collection of the bound element.</span></span> <span data-ttu-id="7dc84-485">之前绑定引擎在运行<xref:System.Windows.Controls.ValidationRule>对象在任何给定的步骤，它会删除任何<xref:System.Windows.Controls.ValidationError>已添加到<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>在该步骤附加属性的绑定元素。</span><span class="sxs-lookup"><span data-stu-id="7dc84-485">Before the binding engine runs the <xref:System.Windows.Controls.ValidationRule> objects at any given step, it removes any <xref:System.Windows.Controls.ValidationError> that was added to the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> attached property of the bound element during that step.</span></span> <span data-ttu-id="7dc84-486">例如，如果<xref:System.Windows.Controls.ValidationRule>其<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.UpdatedValue>失败下, 一次验证过程时，绑定引擎会移除该<xref:System.Windows.Controls.ValidationError>立即之前调用任意<xref:System.Windows.Controls.ValidationRule>具有<xref:System.Windows.Controls.ValidationRule.ValidationStep%2A>设置为<xref:System.Windows.Controls.ValidationStep.UpdatedValue>.</span><span class="sxs-lookup"><span data-stu-id="7dc84-486">For example, if a <xref:System.Windows.Controls.ValidationRule> whose <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> is set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue> failed, the next time the validation process occurs, the binding engine removes that <xref:System.Windows.Controls.ValidationError> immediately before it calls any <xref:System.Windows.Controls.ValidationRule> that has <xref:System.Windows.Controls.ValidationRule.ValidationStep%2A> set to <xref:System.Windows.Controls.ValidationStep.UpdatedValue>.</span></span>  
  
 <span data-ttu-id="7dc84-487">当<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>不为空，<xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType>元素的附加的属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="7dc84-487">When <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> is not empty, the <xref:System.Windows.Controls.Validation.HasError%2A?displayProperty=nameWithType> attached property of the element is set to `true`.</span></span> <span data-ttu-id="7dc84-488">此外，如果<xref:System.Windows.Data.Binding.NotifyOnValidationError%2A>的属性<xref:System.Windows.Data.Binding>设置为`true`，然后，绑定引擎会引发<xref:System.Windows.Controls.Validation.Error?displayProperty=nameWithType>附加在元素上的事件。</span><span class="sxs-lookup"><span data-stu-id="7dc84-488">Also, if the <xref:System.Windows.Data.Binding.NotifyOnValidationError%2A> property of the <xref:System.Windows.Data.Binding> is set to `true`, then the binding engine raises the <xref:System.Windows.Controls.Validation.Error?displayProperty=nameWithType> attached event on the element.</span></span>  
  
 <span data-ttu-id="7dc84-489">另请注意，在任一方向 （从目标到源或源到目标） 的有效值传输清除<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>附加属性。</span><span class="sxs-lookup"><span data-stu-id="7dc84-489">Also note that a valid value transfer in either direction (target to source or source to target) clears the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> attached property.</span></span>  
  
 <span data-ttu-id="7dc84-490">如果绑定具有<xref:System.Windows.Controls.ExceptionValidationRule>与之关联，或具有<xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A>属性设置为`true`，绑定引擎设置源时，将引发异常，绑定引擎检查是否有<xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>。</span><span class="sxs-lookup"><span data-stu-id="7dc84-490">If the binding either has an <xref:System.Windows.Controls.ExceptionValidationRule> associated with it, or had the <xref:System.Windows.Data.Binding.ValidatesOnExceptions%2A> property is set to `true` and an exception is thrown when the binding engine sets the source, the binding engine checks to see if there is a <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>.</span></span> <span data-ttu-id="7dc84-491">可以选择使用<xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>回调以提供自定义处理程序处理异常。</span><span class="sxs-lookup"><span data-stu-id="7dc84-491">You have the option to use the <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A> callback to provide a custom handler for handling exceptions.</span></span> <span data-ttu-id="7dc84-492">如果<xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A>中未指定<xref:System.Windows.Data.Binding>，绑定引擎就会创建<xref:System.Windows.Controls.ValidationError>与该异常并将其添加到<xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType>的绑定元素集合。</span><span class="sxs-lookup"><span data-stu-id="7dc84-492">If an <xref:System.Windows.Data.Binding.UpdateSourceExceptionFilter%2A> is not specified on the <xref:System.Windows.Data.Binding>, the binding engine creates a <xref:System.Windows.Controls.ValidationError> with the exception and adds it to the <xref:System.Windows.Controls.Validation.Errors%2A?displayProperty=nameWithType> collection of the bound element.</span></span>  
  
## <a name="debugging-mechanism"></a><span data-ttu-id="7dc84-493">调试机制</span><span class="sxs-lookup"><span data-stu-id="7dc84-493">Debugging Mechanism</span></span>  
 <span data-ttu-id="7dc84-494">可以设置附加的属性<xref:System.Diagnostics.PresentationTraceSources.TraceLevel%2A?displayProperty=nameWithType>上与绑定相关的对象，以接收特定绑定状态信息。</span><span class="sxs-lookup"><span data-stu-id="7dc84-494">You can set the attached property <xref:System.Diagnostics.PresentationTraceSources.TraceLevel%2A?displayProperty=nameWithType> on a binding-related object to receive information about the status of a specific binding.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7dc84-495">请参阅</span><span class="sxs-lookup"><span data-stu-id="7dc84-495">See also</span></span>

- <xref:System.Windows.Controls.DataErrorValidationRule>
- [<span data-ttu-id="7dc84-496">WPF 版本 4.5 中的新增功能</span><span class="sxs-lookup"><span data-stu-id="7dc84-496">What's New in WPF Version 4.5</span></span>](../getting-started/whats-new.md)
- [<span data-ttu-id="7dc84-497">绑定到 LINQ 查询结果</span><span class="sxs-lookup"><span data-stu-id="7dc84-497">Bind to the Results of a LINQ Query</span></span>](how-to-bind-to-the-results-of-a-linq-query.md)
- [<span data-ttu-id="7dc84-498">数据绑定</span><span class="sxs-lookup"><span data-stu-id="7dc84-498">Data Binding</span></span>](../advanced/optimizing-performance-data-binding.md)
- [<span data-ttu-id="7dc84-499">数据绑定演示</span><span class="sxs-lookup"><span data-stu-id="7dc84-499">Data Binding Demo</span></span>](https://go.microsoft.com/fwlink/?LinkID=163703)
- [<span data-ttu-id="7dc84-500">帮助主题</span><span class="sxs-lookup"><span data-stu-id="7dc84-500">How-to Topics</span></span>](data-binding-how-to-topics.md)
- [<span data-ttu-id="7dc84-501">绑定到 ADO.NET 数据源</span><span class="sxs-lookup"><span data-stu-id="7dc84-501">Bind to an ADO.NET Data Source</span></span>](how-to-bind-to-an-ado-net-data-source.md)
