---
title: .NET Framework 中的传输层安全性 (TLS) 最佳做法
description: 介绍在 .NET Framework 中使用传输层安全性 (TLS) 的最佳做法
ms.date: 10/22/2018
helpviewer_keywords:
- sending data, Internet security
- protocols, Internet security
- Network security
- network resources, Internet security
- receiving data, Internet security
- authentication [.NET Framework], Internet security
- Internet, security
- security [.NET Framework], Internet
- permissions [.NET Framework], Internet
ms.openlocfilehash: cb2dd26d3f111e8de0dc9c7904837d9b053d17bb
ms.sourcegitcommit: 160a88c8087b0e63606e6e35f9bd57fa5f69c168
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/09/2019
ms.locfileid: "57724708"
---
# <a name="transport-layer-security-tls-best-practices-with-the-net-framework"></a><span data-ttu-id="311c1-103">.NET Framework 中的传输层安全性 (TLS) 最佳做法</span><span class="sxs-lookup"><span data-stu-id="311c1-103">Transport Layer Security (TLS) best practices with the .NET Framework</span></span>

<span data-ttu-id="311c1-104">传输层安全性 (TLS) 协议是一个行业标准，旨在帮助保护通过 Internet 所传输信息的私密性。</span><span class="sxs-lookup"><span data-stu-id="311c1-104">The Transport Layer Security (TLS) protocol is an industry standard designed to help protect the privacy of information communicated over the Internet.</span></span> <span data-ttu-id="311c1-105">[TLS 1.2](https://tools.ietf.org/html/rfc5246) 标准与以前版本相比在安全性方面有了很多提升。</span><span class="sxs-lookup"><span data-stu-id="311c1-105">[TLS 1.2](https://tools.ietf.org/html/rfc5246) is a standard that provides security improvements over previous versions.</span></span> <span data-ttu-id="311c1-106">TLS 1.2 最终将被最新发布的标准 [TLS 1.3](https://tools.ietf.org/html/rfc8446) 取代，后者速度更快，安全性更高。</span><span class="sxs-lookup"><span data-stu-id="311c1-106">TLS 1.2 will eventually be replaced by the newest released standard [TLS 1.3](https://tools.ietf.org/html/rfc8446) which is faster and has improved security.</span></span> <span data-ttu-id="311c1-107">文本介绍了如何保护使用 TLS 协议的 .NET Framework 应用程序安全的建议。</span><span class="sxs-lookup"><span data-stu-id="311c1-107">This article presents recommendations to secure .NET Framework applications that use the TLS protocol.</span></span>

<span data-ttu-id="311c1-108">为确保 .NET Framework 应用程序的安全性，TLS 版本不应被硬编码。</span><span class="sxs-lookup"><span data-stu-id="311c1-108">To ensure .NET Framework applications remain secure, the TLS version should **not** be hardcoded.</span></span> <span data-ttu-id="311c1-109">.NET Framework 应用程序应使用操作系统 (OS) 支持的 TLS 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-109">.NET Framework applications should use the TLS version the operating system (OS) supports.</span></span>

<span data-ttu-id="311c1-110">此文档面向以下开发人员：</span><span class="sxs-lookup"><span data-stu-id="311c1-110">This document targets developers who are:</span></span>

- <span data-ttu-id="311c1-111">直接使用 <xref:System.Net> API（例如，<xref:System.Net.Http.HttpClient?displayProperty=nameWithType> 和 <xref:System.Net.Security.SslStream?displayProperty=nameWithType>）。</span><span class="sxs-lookup"><span data-stu-id="311c1-111">Directly using the <xref:System.Net> APIs (for example, <xref:System.Net.Http.HttpClient?displayProperty=nameWithType> and <xref:System.Net.Security.SslStream?displayProperty=nameWithType>).</span></span>
- <span data-ttu-id="311c1-112">直接使用 WCF 客户端和使用 <xref:System.ServiceModel?displayProperty=nameWithType> 命名空间的服务。</span><span class="sxs-lookup"><span data-stu-id="311c1-112">Directly using WCF clients and services using the <xref:System.ServiceModel?displayProperty=nameWithType> namespace.</span></span>
- <span data-ttu-id="311c1-113">使用 [Azure 云服务](https://azure.microsoft.com/services/cloud-services/) Web 和辅助角色来托管和运行你的应用程序。</span><span class="sxs-lookup"><span data-stu-id="311c1-113">Using [Azure Cloud Services](https://azure.microsoft.com/services/cloud-services/) Web and Worker roles to host and run your application.</span></span> <span data-ttu-id="311c1-114">请参阅 [Azure 云服务](#azure-cloud-services)部分。</span><span class="sxs-lookup"><span data-stu-id="311c1-114">See the [Azure Cloud Services](#azure-cloud-services) section.</span></span>

<span data-ttu-id="311c1-115">我们建议：</span><span class="sxs-lookup"><span data-stu-id="311c1-115">We recommend that you:</span></span>

- <span data-ttu-id="311c1-116">在你的应用上面向 NET Framework 4.7 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-116">Target .NET Framework 4.7 or later versions on your apps.</span></span> <span data-ttu-id="311c1-117">在你的 WCF 应用上面向 NET Framework 4.7.1 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-117">Target .NET Framework 4.7.1 or later versions on your WCF apps.</span></span>
- <span data-ttu-id="311c1-118">不要指定 TLS 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-118">Do not specify the TLS version.</span></span> <span data-ttu-id="311c1-119">配置你的代码，让操作系统来决定 TLS 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-119">Configure your code to let the OS decide on the TLS version.</span></span>
- <span data-ttu-id="311c1-120">执行全面的代码审核，以验证你未指定 TLS 或 SSL 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-120">Perform a thorough code audit to verify you're not specifying a TLS or SSL version.</span></span>

<span data-ttu-id="311c1-121">当你的应用让操作系统来选择 TLS 版本时：</span><span class="sxs-lookup"><span data-stu-id="311c1-121">When your app lets the OS choose the TLS version:</span></span>

- <span data-ttu-id="311c1-122">它将会自动利用以后添加的新协议（例如 TLS 1.3）。</span><span class="sxs-lookup"><span data-stu-id="311c1-122">It automatically takes advantage of new protocols added in the future, such as TLS 1.3.</span></span>
- <span data-ttu-id="311c1-123">操作系统将阻止发现不安全的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-123">The OS blocks protocols that are discovered not to be secure.</span></span>

<span data-ttu-id="311c1-124">[审核代码并对代码进行更改](#audit-your-code-and-make-code-changes)这一部分介绍了如何审核和更新你的代码。</span><span class="sxs-lookup"><span data-stu-id="311c1-124">The section [Audit your code and make code changes](#audit-your-code-and-make-code-changes) covers auditing and updating your code.</span></span>

<span data-ttu-id="311c1-125">本文阐释如何针对应用所面向并在其上运行的 .NET Framework 的版本启用可用的最强安全性。</span><span class="sxs-lookup"><span data-stu-id="311c1-125">This article explains how to enable the strongest security available for the version of the .NET Framework that your app targets and runs on.</span></span> <span data-ttu-id="311c1-126">当应用显式设置安全协议和版本时，它将选择退出任何其他替代项，并选择退出 .NET Framework 和操作系统默认行为。</span><span class="sxs-lookup"><span data-stu-id="311c1-126">When an app explicitly sets a security protocol and version, it opts out of any other alternative, and opts out of .NET Framework and OS default behavior.</span></span> <span data-ttu-id="311c1-127">如果你希望应用能够协商 TLS 1.2 连接，请显式设置为较低的 TLS 版本，以阻止 TLS 1.2 连接。</span><span class="sxs-lookup"><span data-stu-id="311c1-127">If you want your app to be able to negotiate a TLS 1.2 connection, explicitly setting to a lower TLS version prevents a TLS 1.2 connection.</span></span>

<span data-ttu-id="311c1-128">如果无法避免硬编码协议版本，我们强烈建议你指定 TLS 1.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-128">If you can't avoid hardcoding a protocol version, we strongly recommend that you specify TLS 1.2.</span></span> <span data-ttu-id="311c1-129">有关标识和删除 TLS 1.0 依赖项的指南，请下载[解决 TLS 1.0 问题](https://www.microsoft.com/download/details.aspx?id=55266)白皮书。</span><span class="sxs-lookup"><span data-stu-id="311c1-129">For guidance on identifying and removing TLS 1.0 dependencies, download the [Solving the TLS 1.0 Problem](https://www.microsoft.com/download/details.aspx?id=55266) whitepaper.</span></span>

<span data-ttu-id="311c1-130">WCF 支持 TLS1.0、1.1 和 1.2 作为 .NET Framework 4.7 中的默认设置。</span><span class="sxs-lookup"><span data-stu-id="311c1-130">WCF Supports TLS1.0, 1.1 and 1.2 as the default in .NET Framework 4.7.</span></span> <span data-ttu-id="311c1-131">从 .NET Framework 4.7.1 开始，WCF 默认为操作系统配置的版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-131">Starting with .NET Framework 4.7.1, WCF defaults to the operating system configured version.</span></span> <span data-ttu-id="311c1-132">如果某个应用程序使用 `SslProtocols.None` 显式配置，则在使用 NetTcp 传输时，WCF 将使用操作系统默认设置。</span><span class="sxs-lookup"><span data-stu-id="311c1-132">If an application is explicitly configured with `SslProtocols.None`, WCF uses the operating system default setting when using the NetTcp transport.</span></span>

<span data-ttu-id="311c1-133">你可以在 GitHub 问题 [.NET Framework 中的传输层安全性 (TLS) 最佳做法](https://github.com/dotnet/docs/issues/4675)中提问有关此文档的问题。</span><span class="sxs-lookup"><span data-stu-id="311c1-133">You can ask questions about this document in the GitHub issue [Transport Layer Security (TLS) best practices with the .NET Framework](https://github.com/dotnet/docs/issues/4675).</span></span>

## <a name="audit-your-code-and-make-code-changes"></a><span data-ttu-id="311c1-134">审核代码并对代码进行更改</span><span class="sxs-lookup"><span data-stu-id="311c1-134">Audit your code and make code changes</span></span>

<span data-ttu-id="311c1-135">对于 ASP.NET 应用程序，检查 _web.config_ 的 `<system.web><httpRuntime targetFramework>` 元素，以验证你所使用的是 .NET Framework 的目标版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-135">For ASP.NET applications, inspect the `<system.web><httpRuntime targetFramework>` element of _web.config_ to verify you're using the intended version of the .NET Framework.</span></span>

<span data-ttu-id="311c1-136">有关 Windows 窗体和其他应用程序，请参阅[如何：面向 .NET Framework 的某个版本](/visualstudio/ide/how-to-target-a-version-of-the-dotnet-framework)。</span><span class="sxs-lookup"><span data-stu-id="311c1-136">For Windows Forms and other applications, see [How to: Target a Version of the .NET Framework](/visualstudio/ide/how-to-target-a-version-of-the-dotnet-framework).</span></span>

<span data-ttu-id="311c1-137">使用以下部分验证你未使用特定 TLS 或 SSL 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-137">Use the following sections to verify you're not using a specific TLS or SSL version.</span></span>

## <a name="if-your-app-targets-net-framework-47-or-later-versions"></a><span data-ttu-id="311c1-138">如果你的应用面向 .NET Framework 4.7 或更高版本</span><span class="sxs-lookup"><span data-stu-id="311c1-138">If your app targets .NET Framework 4.7 or later versions</span></span>

<span data-ttu-id="311c1-139">以下部分说明如何验证你未使用特定 TLS 或 SSL 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-139">The following sections show how to verify you're not using a specific TLS or SSL version.</span></span>

### <a name="for-http-networking"></a><span data-ttu-id="311c1-140">对于 HTTP 网络</span><span class="sxs-lookup"><span data-stu-id="311c1-140">For HTTP networking</span></span>

<span data-ttu-id="311c1-141"><xref:System.Net.ServicePointManager>，使用 .NET Framework 4.7 和更高版本，默认为由操作系统选择最佳安全协议和版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-141"><xref:System.Net.ServicePointManager>, using .NET Framework 4.7 and later versions, defaults to the OS choosing the best security protocol and version.</span></span> <span data-ttu-id="311c1-142">若要获取默认操作系统最佳选择，如有可能，请不要设置 <xref:System.Net.ServicePointManager.SecurityProtocol> 属性的值。</span><span class="sxs-lookup"><span data-stu-id="311c1-142">To get the default OS best choice, if possible, don't set a value for the <xref:System.Net.ServicePointManager.SecurityProtocol> property.</span></span> <span data-ttu-id="311c1-143">否则，将其设置为 <xref:System.Net.SecurityProtocolType.SystemDefault>。</span><span class="sxs-lookup"><span data-stu-id="311c1-143">Otherwise, set it to <xref:System.Net.SecurityProtocolType.SystemDefault>.</span></span>

<span data-ttu-id="311c1-144">针对 HTTP 网络的面向 .NET Framework 4.7 或更高版本的情况，本文剩余部分与此不相关。</span><span class="sxs-lookup"><span data-stu-id="311c1-144">The remainder of this article is not relevant when targeting .NET Framework 4.7 or later versions for HTTP networking.</span></span>

### <a name="for-tcp-sockets-networking"></a><span data-ttu-id="311c1-145">对于 TCP 套接字网络</span><span class="sxs-lookup"><span data-stu-id="311c1-145">For TCP sockets networking</span></span>

<span data-ttu-id="311c1-146"><xref:System.Net.Security.SslStream>，使用 .NET Framework 4.7 和更高版本，默认为由操作系统选择最佳安全协议和版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-146"><xref:System.Net.Security.SslStream>, using .NET Framework 4.7 and later versions, defaults to the OS choosing the best security protocol and version.</span></span> <span data-ttu-id="311c1-147">若要获取默认操作系统最佳选择，如有可能，请不要使用采取显式 <xref:System.Security.Authentication.SslProtocols> 参数的 <xref:System.Net.Security.SslStream> 的方法重载。</span><span class="sxs-lookup"><span data-stu-id="311c1-147">To get the default OS best choice, if possible, don't use the method overloads of <xref:System.Net.Security.SslStream> that take an explicit <xref:System.Security.Authentication.SslProtocols> parameter.</span></span> <span data-ttu-id="311c1-148">否则，将传递 <xref:System.Security.Authentication.SslProtocols.None?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="311c1-148">Otherwise, pass <xref:System.Security.Authentication.SslProtocols.None?displayProperty=nameWithType>.</span></span> <span data-ttu-id="311c1-149">建议不要使用 <xref:System.Security.Authentication.SslProtocols.Default>；设置 `SslProtocols.Default` 会强制使用 SSL 3.0 /TLS 1.0，而不使用 TLS 1.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-149">We recommend that you don't use <xref:System.Security.Authentication.SslProtocols.Default>; setting `SslProtocols.Default` forces the use of SSL 3.0 /TLS 1.0 and prevents TLS 1.2.</span></span>

<span data-ttu-id="311c1-150">不要设置 <xref:System.Net.ServicePointManager.SecurityProtocol> 属性的值（针对 HTTP 网络）。</span><span class="sxs-lookup"><span data-stu-id="311c1-150">Don't set a value for the <xref:System.Net.ServicePointManager.SecurityProtocol> property (for HTTP networking).</span></span>

<span data-ttu-id="311c1-151">不要使用采取显式 <xref:System.Security.Authentication.SslProtocols> 参数的 <xref:System.Net.Security.SslStream> 的方法重载（针对 TCP 套接字网络）。</span><span class="sxs-lookup"><span data-stu-id="311c1-151">Don't use the method overloads of <xref:System.Net.Security.SslStream> that take an explicit <xref:System.Security.Authentication.SslProtocols> parameter (for TCP sockets networking).</span></span> <span data-ttu-id="311c1-152">当你将应用重定向到 .NET Framework 4.7 或更高版本时，将遵循最佳做法建议。</span><span class="sxs-lookup"><span data-stu-id="311c1-152">When you retarget your app to .NET Framework 4.7 or later versions, you'll be following the best practices recommendation.</span></span>

<span data-ttu-id="311c1-153">针对 TCP 套接字网络的面向 .NET Framework 4.7 或更高版本的情况，本主题剩余部分与此不相关。</span><span class="sxs-lookup"><span data-stu-id="311c1-153">The remainder of this topic is not relevant when targeting .NET Framework 4.7 or later versions for TCP sockets networking.</span></span>

<a name="wcf-tcp-cert"></a>

### <a name="for-wcf-tcp-transport-using-transport-security-with-certificate-credentials"></a><span data-ttu-id="311c1-154">对于使用具有证书凭据的传输安全性的 WCF TCP 传输</span><span class="sxs-lookup"><span data-stu-id="311c1-154">For WCF TCP transport using transport security with certificate credentials</span></span>

<span data-ttu-id="311c1-155">WCF 使用与 .NET Framework 的其余部分相同的网络堆栈。</span><span class="sxs-lookup"><span data-stu-id="311c1-155">WCF uses the same networking stack as the rest of the .NET Framework.</span></span>

<span data-ttu-id="311c1-156">如果你面向 4.7.1，则 WCF 将被配置为默认由操作系统选择最佳安全协议（除非显式对其配置）：</span><span class="sxs-lookup"><span data-stu-id="311c1-156">If you are targeting 4.7.1, WCF is configured to allow the OS to choose the best security protocol by default unless explicitly configured:</span></span>

- <span data-ttu-id="311c1-157">在你的应用程序配置文件中。</span><span class="sxs-lookup"><span data-stu-id="311c1-157">In your application configuration file.</span></span>
- <span data-ttu-id="311c1-158">或者，在你的源代码中的应用程序中。</span><span class="sxs-lookup"><span data-stu-id="311c1-158">**Or**, in your application in the source code.</span></span>

<span data-ttu-id="311c1-159">默认情况下，.NET Framework 4.7 和更高版本将被配置为使用 TLS 1.2，并允许使用 TLS 1.1 或 TLS 1.0 进行连接。</span><span class="sxs-lookup"><span data-stu-id="311c1-159">By default, .NET Framework 4.7 and later versions is configured to use TLS 1.2 and allows connections using TLS 1.1 or TLS 1.0.</span></span> <span data-ttu-id="311c1-160">通过将你的绑定配置为使用 <xref:System.Security.Authentication.SslProtocols.None?displayProperty=nameWithType> 来配置 WCF，以允许操作系统选择最佳安全协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-160">Configure WCF to allow the OS to choose the best security protocol by configuring your binding to use <xref:System.Security.Authentication.SslProtocols.None?displayProperty=nameWithType>.</span></span> <span data-ttu-id="311c1-161">可在 <xref:System.ServiceModel.TcpTransportSecurity.SslProtocols> 上进行此设置。</span><span class="sxs-lookup"><span data-stu-id="311c1-161">This can be set on <xref:System.ServiceModel.TcpTransportSecurity.SslProtocols>.</span></span> <span data-ttu-id="311c1-162">`SslProtocols.None` 可以从 <xref:System.ServiceModel.NetTcpSecurity.Transport> 中进行访问。</span><span class="sxs-lookup"><span data-stu-id="311c1-162">`SslProtocols.None` can be accessed from <xref:System.ServiceModel.NetTcpSecurity.Transport>.</span></span> <span data-ttu-id="311c1-163">`NetTcpSecurity.Transport` 可以从 <xref:System.ServiceModel.NetTcpBinding.Security> 中进行访问。</span><span class="sxs-lookup"><span data-stu-id="311c1-163">`NetTcpSecurity.Transport` can be accessed from <xref:System.ServiceModel.NetTcpBinding.Security>.</span></span>

<span data-ttu-id="311c1-164">如果你使用自定义绑定：</span><span class="sxs-lookup"><span data-stu-id="311c1-164">If you're using a custom binding:</span></span>

- <span data-ttu-id="311c1-165">通过将 <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement.SslProtocols> 设置为使用 <xref:System.Security.Authentication.SslProtocols.None?displayProperty=nameWithType> 来配置 WCF，以允许操作系统选择最佳安全协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-165">Configure WCF to allow the OS to choose the best security protocol by setting <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement.SslProtocols> to use <xref:System.Security.Authentication.SslProtocols.None?displayProperty=nameWithType>.</span></span>
- <span data-ttu-id="311c1-166">或者，配置在配置路径 `system.serviceModel/bindings/customBinding/binding/sslStreamSecurity:sslProtocols` 中使用的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-166">**Or** configure the protocol used with the configuration path `system.serviceModel/bindings/customBinding/binding/sslStreamSecurity:sslProtocols`.</span></span>

<span data-ttu-id="311c1-167">如果你没有使用自定义绑定，且正使用配置来设置你的 WCF 绑定，则设置配置路径 `system.serviceModel/bindings/netTcpBinding/binding/security/transport:sslProtocols` 中使用的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-167">If you're **not** using a custom binding **and** you're setting your WCF binding using configuration, set the protocol used with the configuration path `system.serviceModel/bindings/netTcpBinding/binding/security/transport:sslProtocols`.</span></span>

### <a name="for-wcf-message-security-with-certificate-credentials"></a><span data-ttu-id="311c1-168">对于具有证书凭据的 WCF 消息安全性</span><span class="sxs-lookup"><span data-stu-id="311c1-168">For WCF Message Security with certificate credentials</span></span>

<span data-ttu-id="311c1-169">默认情况下，.NET Framework 4.7 和更高版本使用 <xref:System.Net.ServicePointManager.SecurityProtocol> 属性中指定的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-169">.NET Framework 4.7 and later versions by default uses the protocol specified in the <xref:System.Net.ServicePointManager.SecurityProtocol> property.</span></span> <span data-ttu-id="311c1-170">当 [AppContextSwitch](../configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md) `Switch.System.ServiceModel.DisableUsingServicePointManagerSecurityProtocols` 被设置为 `true` 时，WCF 将选择最佳协议（最高至 TLS 1.0）。</span><span class="sxs-lookup"><span data-stu-id="311c1-170">When the [AppContextSwitch](../configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md) `Switch.System.ServiceModel.DisableUsingServicePointManagerSecurityProtocols` is set to `true`, WCF chooses the best protocol, up to TLS 1.0.</span></span>

## <a name="if-your-app-targets-a-net-framework-version-earlier-than-47"></a><span data-ttu-id="311c1-171">如果你的应用面向 .NET Framework 4.7 之前的版本</span><span class="sxs-lookup"><span data-stu-id="311c1-171">If your app targets a .NET Framework version earlier than 4.7</span></span>

<span data-ttu-id="311c1-172">使用以下部分审核你的代码，以验证你未设置特定 TLS 或 SSL 版本：</span><span class="sxs-lookup"><span data-stu-id="311c1-172">Audit your code to verify you're not setting a specific TLS or SSL version using the following sections:</span></span>

### <a name="for-net-framework-46---462-and-not-wcf"></a><span data-ttu-id="311c1-173">对于 .NET Framework 4.6 - 4.6.2（而不是 WFC）</span><span class="sxs-lookup"><span data-stu-id="311c1-173">For .NET Framework 4.6 - 4.6.2 and not WCF</span></span>

<span data-ttu-id="311c1-174">将 `DontEnableSystemDefaultTlsVersions` `AppContext` 开关设置为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-174">Set the `DontEnableSystemDefaultTlsVersions` `AppContext` switch to `false`.</span></span> <span data-ttu-id="311c1-175">请参阅[通过 AppContext 开关配置安全性](#configuring-security-via-appcontext-switches)。</span><span class="sxs-lookup"><span data-stu-id="311c1-175">See [Configuring security via AppContext switches](#configuring-security-via-appcontext-switches).</span></span>

### <a name="for-wcf-using-net-framework-46---462-using-tcp-transport-security-with-certificate-credentials"></a><span data-ttu-id="311c1-176">对于使用具有证书凭据的 TCP 传输安全性的 .NET Framework 4.6 - 4.6.2 的 WCF</span><span class="sxs-lookup"><span data-stu-id="311c1-176">For WCF using .NET Framework 4.6 - 4.6.2 using TCP transport security with Certificate Credentials</span></span>

<span data-ttu-id="311c1-177">必须安装最新的操作系统修补程序。</span><span class="sxs-lookup"><span data-stu-id="311c1-177">You must install the latest OS patches.</span></span> <span data-ttu-id="311c1-178">请参阅[安全更新](#security-updates)。</span><span class="sxs-lookup"><span data-stu-id="311c1-178">See [Security updates](#security-updates).</span></span>

<span data-ttu-id="311c1-179">除非显式配置协议版本，否则 WCF 框架将自动选择高至 TLS 1.2 的最高协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-179">The WCF framework automatically chooses the highest protocol available up to TLS 1.2 unless you explicitly configure a protocol version.</span></span> <span data-ttu-id="311c1-180">有关详细信息，请参阅上一部分[对于使用具有证书凭据的传输安全性的 WCF TCP 传输](#wcf-tcp-cert)。</span><span class="sxs-lookup"><span data-stu-id="311c1-180">For more information, see the preceding section [For WCF TCP transport using transport security with certificate credentials](#wcf-tcp-cert).</span></span>

### <a name="for-net-framework-35---452-and-not-wcf"></a><span data-ttu-id="311c1-181">对于 .NET Framework 3.5 - 4.5.2（而不是 WFC）</span><span class="sxs-lookup"><span data-stu-id="311c1-181">For .NET Framework 3.5 - 4.5.2 and not WCF</span></span>

<span data-ttu-id="311c1-182">我们建议将你的应用升级到 .NET Framework 4.7 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-182">We recommend you upgrade your app to .NET Framework 4.7 or later versions.</span></span> <span data-ttu-id="311c1-183">如果不能升级，请执行以下步骤。</span><span class="sxs-lookup"><span data-stu-id="311c1-183">If you cannot upgrade, take the following steps.</span></span> <span data-ttu-id="311c1-184">在未来的某个时间点，如果不升级到 .NET Framework 4.7 或更高版本，你的应用程序可能会无法使用。</span><span class="sxs-lookup"><span data-stu-id="311c1-184">At some point in the future, your application may fail until you upgrade to .NET Framework 4.7 or later versions.</span></span>

<span data-ttu-id="311c1-185">将 [SchUseStrongCrypto](#schusestrongcrypto) 和 [SystemDefaultTlsVersions](#systemdefaulttlsversions) 注册表项设置为 1。</span><span class="sxs-lookup"><span data-stu-id="311c1-185">Set the [SchUseStrongCrypto](#schusestrongcrypto) and [SystemDefaultTlsVersions](#systemdefaulttlsversions) registry keys to 1.</span></span> <span data-ttu-id="311c1-186">请参阅[通过 Windows 注册表配置安全性](#configuring-security-via-the-windows-registry)。</span><span class="sxs-lookup"><span data-stu-id="311c1-186">See [Configuring security via the Windows Registry](#configuring-security-via-the-windows-registry).</span></span> <span data-ttu-id="311c1-187">.NET Framework 3.5 版本仅在传递显式 TLS 值时才支持 `SchUseStrongCrypto` 标志。</span><span class="sxs-lookup"><span data-stu-id="311c1-187">The .NET Framework version 3.5 supports the `SchUseStrongCrypto` flag only when an explicit TLS value is passed.</span></span>

<span data-ttu-id="311c1-188">如果在 .NET Framework 3.5 上运行，则需安装热修补程序，以便你的程序可以指定 TLS 1.2：</span><span class="sxs-lookup"><span data-stu-id="311c1-188">If you are running on .NET Framework 3.5, you need to install a hot patch so that TLS 1.2 can be specified by your program:</span></span>

| [<span data-ttu-id="311c1-189">KB3154518</span><span class="sxs-lookup"><span data-stu-id="311c1-189">KB3154518</span></span>](https://support.microsoft.com/kb/3154518) | <span data-ttu-id="311c1-190">可靠性汇总 HR-1605 - 在 Windows 7 SP1 和 Server 2008 R2 SP1 上的 .NET Framework 3.5.1 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-190">Reliability Rollup HR-1605 - Support for TLS System Default Versions included in the .NET Framework 3.5.1 on Windows 7 SP1 and Server 2008 R2 SP1</span></span> |
| --- | --- |
| [<span data-ttu-id="311c1-191">KB3154519</span><span class="sxs-lookup"><span data-stu-id="311c1-191">KB3154519</span></span>](https://support.microsoft.com/kb/3154519) | <span data-ttu-id="311c1-192">可靠性汇总 HR-1605 - 在 Windows Server 2012 上的 .NET Framework 3.5 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-192">Reliability Rollup HR-1605 - Support for TLS System Default Versions included in the .NET Framework 3.5 on Windows Server 2012</span></span> |
| [<span data-ttu-id="311c1-193">KB3154520</span><span class="sxs-lookup"><span data-stu-id="311c1-193">KB3154520</span></span>](https://support.microsoft.com/kb/3154520) | <span data-ttu-id="311c1-194">可靠性汇总 HR-1605 - 在 Windows 8.1 and Windows Server 2012 R2 上的 .NET Framework 3.5 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-194">Reliability Rollup HR-1605 -Support for TLS System Default Versions included in the .NET Framework 3.5 on Windows 8.1 and Windows Server 2012 R2</span></span> |
| [<span data-ttu-id="311c1-195">KB3156421</span><span class="sxs-lookup"><span data-stu-id="311c1-195">KB3156421</span></span>](https://support.microsoft.com/kb/3156421) | <span data-ttu-id="311c1-196">1605 修补程序汇总 3154521 - 针对 Windows 上的 .NET Framework 4.5.2 和 4.5.1</span><span class="sxs-lookup"><span data-stu-id="311c1-196">1605 Hotfix rollup 3154521 for the .NET Framework 4.5.2 and 4.5.1 on Windows</span></span> |

### <a name="for-wcf-using-net-framework-35---452-using-tcp-transport-security-with-certificate-credentials"></a><span data-ttu-id="311c1-197">对于使用具有证书凭据的 TCP 传输安全性的 .NET Framework 3.5 - 4.5.2 的 WCF</span><span class="sxs-lookup"><span data-stu-id="311c1-197">For WCF using .NET Framework 3.5 - 4.5.2 using TCP transport security with Certificate Credentials</span></span>

<span data-ttu-id="311c1-198">WCF 框架的这些版本被硬编码为使用值 SSL 3.0 和 TLS 1.0。</span><span class="sxs-lookup"><span data-stu-id="311c1-198">These versions of the WCF framework are hardcoded to use values SSL 3.0 and TLS 1.0.</span></span> <span data-ttu-id="311c1-199">这些值不能更改。</span><span class="sxs-lookup"><span data-stu-id="311c1-199">These values cannot be changed.</span></span> <span data-ttu-id="311c1-200">必须更新和重定向到 NET Framework 4.6 或更高版本，以使用 TLS 1.1 和 TLS 1.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-200">You must update and retarget to NET Framework 4.6 or later versions to use TLS 1.1 and 1.2.</span></span>

## <a name="if-your-app-targets-net-framework-35"></a><span data-ttu-id="311c1-201">如果应用面向 .NET Framework 3.5</span><span class="sxs-lookup"><span data-stu-id="311c1-201">If your app targets .NET Framework 3.5</span></span>

<span data-ttu-id="311c1-202">如果必须显式设置安全协议，而不是由 .NET Framework 或操作系统选择安全协议，请将 `SecurityProtocolTypeExtensions` 和 `SslProtocolsExtension` 枚举添加到你的代码中。</span><span class="sxs-lookup"><span data-stu-id="311c1-202">If you must explicitly set a security protocol instead of letting the .NET framework or the OS pick the security protocol, add `SecurityProtocolTypeExtensions` and `SslProtocolsExtension` enumerations to your code.</span></span> <span data-ttu-id="311c1-203">`SecurityProtocolTypeExtensions` 和 `SslProtocolsExtension` 包含 `Tls12`、`Tls11` 的值和 `SystemDefault` 值。</span><span class="sxs-lookup"><span data-stu-id="311c1-203">`SecurityProtocolTypeExtensions` and `SslProtocolsExtension` include values for `Tls12`, `Tls11`, and the `SystemDefault` value.</span></span> <span data-ttu-id="311c1-204">请参阅[在 Windows 8.1 和 Windows Server 2012 R2 上的 .NET Framework 3.5 中包含对 TLS 系统默认版本的支持](https://support.microsoft.com/help/3154520/support-for-tls-system-default-versions-included-in-the--net-framework)。</span><span class="sxs-lookup"><span data-stu-id="311c1-204">See [Support for TLS System Default Versions included in .NET Framework 3.5 on Windows 8.1 and Windows Server 2012 R2](https://support.microsoft.com/help/3154520/support-for-tls-system-default-versions-included-in-the--net-framework).</span></span>

<a name="configuring-security-via-appcontext-switches"></a>

## <a name="configuring-security-via-appcontext-switches-for-net-framework-46-or-later-versions"></a><span data-ttu-id="311c1-205">通过 AppContext 开关配置安全性（适用于 .NET Framework 4.6 或更高版本）</span><span class="sxs-lookup"><span data-stu-id="311c1-205">Configuring security via AppContext switches (for .NET Framework 4.6 or later versions)</span></span>

<span data-ttu-id="311c1-206">如果你的应用面向 .NET Framework 4.6 或更高版本或在其上运行，则请关注本节中所述的 [AppContext](../configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md) 开关。</span><span class="sxs-lookup"><span data-stu-id="311c1-206">The [AppContext](../configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md) switches described in this section are relevant if your app targets, or runs on, .NET Framework 4.6 or later versions.</span></span> <span data-ttu-id="311c1-207">无论它们是默认设置还是对其显式设置，开关均应为 `false`（如有可能）。</span><span class="sxs-lookup"><span data-stu-id="311c1-207">Whether by default, or by setting them explicitly, the switches should be `false` if possible.</span></span> <span data-ttu-id="311c1-208">如果希望通过一个或这两个开关配置安全性，则不要在你的代码中指定安全协议值，执行此操作将会替代此开关。</span><span class="sxs-lookup"><span data-stu-id="311c1-208">If you want to configure security via one or both switches, then don't specify a security protocol value in your code; doing so would override the switch(es).</span></span>

<span data-ttu-id="311c1-209">无论你使用 HTTP 网络 (<xref:System.Net.ServicePointManager>) 还是使用 TCP 套接字网络 (<xref:System.Net.Security.SslStream>)，开关都具有相同的效果。</span><span class="sxs-lookup"><span data-stu-id="311c1-209">The switches have the same effect whether you're doing HTTP networking (<xref:System.Net.ServicePointManager>) or TCP sockets networking (<xref:System.Net.Security.SslStream>).</span></span>

### <a name="switchsystemnetdontenableschusestrongcrypto"></a><span data-ttu-id="311c1-210">Switch.System.Net.DontEnableSchUseStrongCrypto</span><span class="sxs-lookup"><span data-stu-id="311c1-210">Switch.System.Net.DontEnableSchUseStrongCrypto</span></span>

<span data-ttu-id="311c1-211">`Switch.System.Net.DontEnableSchUseStrongCrypto` 的值为 `false` 将导致你的应用使用强加密。</span><span class="sxs-lookup"><span data-stu-id="311c1-211">A value of `false` for `Switch.System.Net.DontEnableSchUseStrongCrypto` causes your app to use strong cryptography.</span></span> <span data-ttu-id="311c1-212">`DontEnableSchUseStrongCrypto` 的值为 `false` 将使用更为安全的网络协议（TLS 1.2、TLS 1.1 和 TLS 1.0），并阻止不安全的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-212">A value of `false` for `DontEnableSchUseStrongCrypto` uses more secure network protocols (TLS 1.2, TLS 1.1, and TLS 1.0) and blocks protocols that are not secure.</span></span> <span data-ttu-id="311c1-213">有关详细信息，请参阅 [SCH_USE_STRONG_CRYPTO 标志](#the-sch_use_strong_crypto-flag)。</span><span class="sxs-lookup"><span data-stu-id="311c1-213">For more info, see [The SCH_USE_STRONG_CRYPTO flag](#the-sch_use_strong_crypto-flag).</span></span> <span data-ttu-id="311c1-214">值为 `true` 将为你的应用禁用强加密。</span><span class="sxs-lookup"><span data-stu-id="311c1-214">A value of `true` disables strong cryptography for your app.</span></span>

<span data-ttu-id="311c1-215">如果你的应用面向 .NET Framework 4.6 或更高版本，则该开关默认为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-215">If your app targets .NET Framework 4.6 or later versions, this switch defaults to `false`.</span></span> <span data-ttu-id="311c1-216">这是我们建议使用的安全默认值。</span><span class="sxs-lookup"><span data-stu-id="311c1-216">That's a secure default, which we recommend.</span></span> <span data-ttu-id="311c1-217">如果你的应用在 .NET Framework 4.6 上运行，但面向早期版本，则开关默认为 `true`。</span><span class="sxs-lookup"><span data-stu-id="311c1-217">If your app runs on .NET Framework 4.6, but targets an earlier version, the switch defaults to `true`.</span></span> <span data-ttu-id="311c1-218">在这种情况下，应显式将其设置为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-218">In that case, you should explicitly set it to `false`.</span></span>

<span data-ttu-id="311c1-219">如果需要连接到不支持强加密且无法升级的旧服务，则 `DontEnableSchUseStrongCrypto` 的值只能为 `true`。</span><span class="sxs-lookup"><span data-stu-id="311c1-219">`DontEnableSchUseStrongCrypto` should only have a value of `true` if you need to connect to legacy services that don't support strong cryptography and can't be upgraded.</span></span>

### <a name="switchsystemnetdontenablesystemdefaulttlsversions"></a><span data-ttu-id="311c1-220">Switch.System.Net.DontEnableSystemDefaultTlsVersions</span><span class="sxs-lookup"><span data-stu-id="311c1-220">Switch.System.Net.DontEnableSystemDefaultTlsVersions</span></span>

<span data-ttu-id="311c1-221">`Switch.System.Net.DontEnableSystemDefaultTlsVersions` 的值为 `false` 将导致你的应用允许操作系统选择协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-221">A value of `false` for `Switch.System.Net.DontEnableSystemDefaultTlsVersions` causes your app to allow the operating system to choose the protocol.</span></span> <span data-ttu-id="311c1-222">值为 `true` 将导致你的应用使用由 .NET Framework 选取的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-222">A value of `true` causes your app to use protocols picked by the .NET Framework.</span></span>

<span data-ttu-id="311c1-223">如果你的应用面向 .NET Framework 4.7 或更高版本，则此开关默认为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-223">If your app targets .NET Framework 4.7 or later versions, this switch defaults to `false`.</span></span> <span data-ttu-id="311c1-224">这是我们建议使用的安全默认值。</span><span class="sxs-lookup"><span data-stu-id="311c1-224">That's a secure default that we recommend.</span></span> <span data-ttu-id="311c1-225">如果你的应用在 .NET Framework 4.7 或更高版本上运行，但面向早期版本，则开关默认为 `true`。</span><span class="sxs-lookup"><span data-stu-id="311c1-225">If your app runs on .NET Framework 4.7 or later versions, but targets an earlier version, the switch defaults to `true`.</span></span> <span data-ttu-id="311c1-226">在这种情况下，应显式将其设置为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-226">In that case, you should explicitly set it to `false`.</span></span>

### <a name="switchsystemservicemodeldisableusingservicepointmanagersecurityprotocols"></a><span data-ttu-id="311c1-227">Switch.System.ServiceModel.DisableUsingServicePointManagerSecurityProtocols</span><span class="sxs-lookup"><span data-stu-id="311c1-227">Switch.System.ServiceModel.DisableUsingServicePointManagerSecurityProtocols</span></span>

<span data-ttu-id="311c1-228">`Switch.System.ServiceModel.DisableUsingServicePointManagerSecurityProtocols` 的值为 `false` 将导致你的应用程序使用 `ServicePointManager.SecurityProtocols` 中定义的值，以确保使用证书凭据的消息的安全性。</span><span class="sxs-lookup"><span data-stu-id="311c1-228">A value of `false` for `Switch.System.ServiceModel.DisableUsingServicePointManagerSecurityProtocols` causes your application to use the value defined in `ServicePointManager.SecurityProtocols` for message security using certificate credentials.</span></span> <span data-ttu-id="311c1-229">值为 `true` 将使用可用的最高协议（高至 TLS1.0）</span><span class="sxs-lookup"><span data-stu-id="311c1-229">A value of `true` uses the highest protocol available, up to TLS1.0</span></span>

<span data-ttu-id="311c1-230">对于面向 .NET Framework 4.7 和更高版本的应用程序，此值默认为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-230">For applications targeting .NET Framework 4.7 and later versions, this value defaults to `false`.</span></span> <span data-ttu-id="311c1-231">对于面向 .NET Framework 4.6.2 和早期版本的应用程序，此值默认为 `true`。</span><span class="sxs-lookup"><span data-stu-id="311c1-231">For applications targeting .NET Framework 4.6.2 and earlier, this value defaults to `true`.</span></span>

### <a name="switchsystemservicemodeldontenablesystemdefaulttlsversions"></a><span data-ttu-id="311c1-232">Switch.System.ServiceModel.DontEnableSystemDefaultTlsVersions</span><span class="sxs-lookup"><span data-stu-id="311c1-232">Switch.System.ServiceModel.DontEnableSystemDefaultTlsVersions</span></span>

<span data-ttu-id="311c1-233">`Switch.System.ServiceModel.DontEnableSystemDefaultTlsVersions` 的值为 `false` 将设置默认配置，以允许操作系统选择协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-233">A value of `false` for `Switch.System.ServiceModel.DontEnableSystemDefaultTlsVersions` sets the default configuration to allow the operating system to choose the protocol.</span></span> <span data-ttu-id="311c1-234">值为 `true` 会将默认值设置为可用的最高协议（高至 TLS1.2）。</span><span class="sxs-lookup"><span data-stu-id="311c1-234">A value of `true` sets the default to the highest protocol available, up to TLS1.2.</span></span>

<span data-ttu-id="311c1-235">对于面向 .NET Framework 4.7.1 和更高版本的应用程序，此值默认为 `false`。</span><span class="sxs-lookup"><span data-stu-id="311c1-235">For applications targeting .NET Framework 4.7.1 and later versions, this value defaults to `false`.</span></span> <span data-ttu-id="311c1-236">对于面向 .NET Framework 4.7 和早期版本的应用程序，此值默认为 `true`。</span><span class="sxs-lookup"><span data-stu-id="311c1-236">For applications targeting .NET Framework 4.7 and earlier, this value defaults to `true`.</span></span>

<span data-ttu-id="311c1-237">有关 TLS 协议的详细信息，请参阅[缓解措施：TLS 协议](../migration-guide/mitigation-tls-protocols.md)。</span><span class="sxs-lookup"><span data-stu-id="311c1-237">For more information about TLS protocols, see [Mitigation: TLS Protocols](../migration-guide/mitigation-tls-protocols.md).</span></span> <span data-ttu-id="311c1-238">有关 `AppContext` 开关的详细信息，请参阅 [`<AppContextSwitchOverrides> Element`](../configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md)。</span><span class="sxs-lookup"><span data-stu-id="311c1-238">For more information about `AppContext` switches, see [`<AppContextSwitchOverrides> Element`](../configure-apps/file-schema/runtime/appcontextswitchoverrides-element.md).</span></span>

## <a name="configuring-security-via-the-windows-registry"></a><span data-ttu-id="311c1-239">通过 Windows 注册表配置安全性</span><span class="sxs-lookup"><span data-stu-id="311c1-239">Configuring security via the Windows Registry</span></span>

> [!WARNING]
> <span data-ttu-id="311c1-240">设置注册表项会影响系统上的所有应用程序。</span><span class="sxs-lookup"><span data-stu-id="311c1-240">Setting registry keys affects all applications on the system.</span></span> <span data-ttu-id="311c1-241">仅当你完全控制计算机并可以控制对注册表的更改时才可使用此选项。</span><span class="sxs-lookup"><span data-stu-id="311c1-241">Use this option only if you are in full control of the machine and can control changes to the registry.</span></span>

<span data-ttu-id="311c1-242">如果不能设置一个或两个 `AppContext` 开关，可以使用本节中所述的 Windows 注册表项来控制应用所使用的安全协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-242">If setting one or both `AppContext` switches isn't an option, you can control the security protocols that your app uses with the Windows Registry keys described in this section.</span></span> <span data-ttu-id="311c1-243">如果你的应用在 .NET Framework 4.5.2 或之前的版本上运行或你无法编辑配置文件，则可能无法使用一个或两个 `AppContext` 开关。</span><span class="sxs-lookup"><span data-stu-id="311c1-243">You might not be able to use one or both the `AppContext` switches if your app runs on .NET Framework 4.5.2 or earlier versions, or if you can't edit the configuration file.</span></span> <span data-ttu-id="311c1-244">如果想要在注册表中配置安全性，则不要在你的代码中指定安全协议，这样做将会替代该注册表设置。</span><span class="sxs-lookup"><span data-stu-id="311c1-244">If you want to configure security with the registry, don't specify a security protocol value in your code; doing so overrides the registry setting.</span></span>

<span data-ttu-id="311c1-245">注册表项的名称类似于相应 `AppContext` 开关的名称，但其不带预置的 `DontEnable`。</span><span class="sxs-lookup"><span data-stu-id="311c1-245">The names of the registry keys are similar to the names of the corresponding `AppContext` switches but without a `DontEnable` prepended to the name.</span></span> <span data-ttu-id="311c1-246">例如，`AppContext` 开关 `DontEnableSchUseStrongCrypto` 是名为 [SchUseStrongCrypto](#schusestrongcrypto) 的注册表项。</span><span class="sxs-lookup"><span data-stu-id="311c1-246">For example, the `AppContext` switch `DontEnableSchUseStrongCrypto` is the registry key called [SchUseStrongCrypto](#schusestrongcrypto).</span></span>

<span data-ttu-id="311c1-247">这些注册表项适用于安装了最新安全修补程序的所有 .NET Framework 版本。</span><span class="sxs-lookup"><span data-stu-id="311c1-247">These keys are available in all .NET Framework versions for which there's a recent security patch.</span></span> <span data-ttu-id="311c1-248">请参阅[安全更新](#security-updates)。</span><span class="sxs-lookup"><span data-stu-id="311c1-248">See [Security updates](#security-updates).</span></span>

<span data-ttu-id="311c1-249">无论你使用 HTTP 网络 (<xref:System.Net.ServicePointManager>) 还是使用 TCP 套接字网络 (<xref:System.Net.Security.SslStream>)，下面介绍的所有注册表项都具有相同的效果。</span><span class="sxs-lookup"><span data-stu-id="311c1-249">All of the registry keys described below have the same effect whether you're doing HTTP networking (<xref:System.Net.ServicePointManager>) or TCP sockets networking (<xref:System.Net.Security.SslStream>).</span></span>

### <a name="schusestrongcrypto"></a><span data-ttu-id="311c1-250">SchUseStrongCrypto</span><span class="sxs-lookup"><span data-stu-id="311c1-250">SchUseStrongCrypto</span></span>

<span data-ttu-id="311c1-251">`HKEY_LOCAL_MACHINE\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\<VERSION>: SchUseStrongCrypto` 注册表项具有类型为 DWORD 的值。</span><span class="sxs-lookup"><span data-stu-id="311c1-251">The `HKEY_LOCAL_MACHINE\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\<VERSION>: SchUseStrongCrypto` registry key has a value of type DWORD.</span></span> <span data-ttu-id="311c1-252">值为 1 将导致你的应用使用强加密。</span><span class="sxs-lookup"><span data-stu-id="311c1-252">A value of 1 causes your app to use strong cryptography.</span></span> <span data-ttu-id="311c1-253">强加密会使用更为安全的网络协议（TLS 1.2、TLS 1.1 和 TLS 1.0），并阻止不安全的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-253">The strong cryptography uses more secure network protocols (TLS 1.2, TLS 1.1, and TLS 1.0) and blocks protocols that are not secure.</span></span> <span data-ttu-id="311c1-254">值为 0 将禁用强加密。</span><span class="sxs-lookup"><span data-stu-id="311c1-254">A value of 0 disables strong cryptography.</span></span> <span data-ttu-id="311c1-255">有关详细信息，请参阅 [SCH_USE_STRONG_CRYPTO 标志](#the-sch_use_strong_crypto-flag)。</span><span class="sxs-lookup"><span data-stu-id="311c1-255">For more information, see [The SCH_USE_STRONG_CRYPTO flag](#the-sch_use_strong_crypto-flag).</span></span>

<span data-ttu-id="311c1-256">如果你的应用面向 .NET Framework 4.6 或更高版本，则此注册表项默认值为 1。</span><span class="sxs-lookup"><span data-stu-id="311c1-256">If your app targets .NET Framework 4.6 or later versions, this key defaults to a value of 1.</span></span> <span data-ttu-id="311c1-257">这是我们建议使用的安全默认值。</span><span class="sxs-lookup"><span data-stu-id="311c1-257">That's a secure default that we recommend.</span></span> <span data-ttu-id="311c1-258">如果你的应用在 .NET Framework 4.6 上运行，但面向早期版本，则注册表项默认为 0。</span><span class="sxs-lookup"><span data-stu-id="311c1-258">If your app runs on .NET Framework 4.6, but targets an earlier version, then the key defaults to 0.</span></span> <span data-ttu-id="311c1-259">在这种情况下，应显式将其值设置为 1。</span><span class="sxs-lookup"><span data-stu-id="311c1-259">In that case, you should explicitly set its value to 1.</span></span>

<span data-ttu-id="311c1-260">如果需要连接到不支持强加密且无法升级的旧服务，则此注册表项的值只能为 0。</span><span class="sxs-lookup"><span data-stu-id="311c1-260">This key should only have a value of 0 if you need to connect to legacy services that don't support strong cryptography and can't be upgraded.</span></span>

### <a name="systemdefaulttlsversions"></a><span data-ttu-id="311c1-261">SystemDefaultTlsVersions</span><span class="sxs-lookup"><span data-stu-id="311c1-261">SystemDefaultTlsVersions</span></span>

<span data-ttu-id="311c1-262">`HKEY_LOCAL_MACHINE\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\<VERSION>: SystemDefaultTlsVersions` 注册表项具有类型为 DWORD 的值。</span><span class="sxs-lookup"><span data-stu-id="311c1-262">The `HKEY_LOCAL_MACHINE\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\<VERSION>: SystemDefaultTlsVersions` registry key has a value of type DWORD.</span></span> <span data-ttu-id="311c1-263">值为 1 将导致你的应用允许操作系统选择协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-263">A value of 1 causes your app to allow the operating system to choose the protocol.</span></span> <span data-ttu-id="311c1-264">值为 0 将导致你的应用使用由 .NET Framework 选取的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-264">A value of 0 causes your app to use protocols picked by the .NET Framework.</span></span>

<span data-ttu-id="311c1-265">`<VERSION>` 必须为 v4.0.30319（对于 .NET Framework 4 和更高版本）或 v2.0.50727（对于 .NET Framework 3.5）。</span><span class="sxs-lookup"><span data-stu-id="311c1-265">`<VERSION>` must be v4.0.30319 (for .NET Framework 4 and above) or v2.0.50727 (for .NET Framework 3.5).</span></span>

<span data-ttu-id="311c1-266">如果你的应用面向 .NET Framework 4.7 或更高版本，则此注册表项默认值为 1。</span><span class="sxs-lookup"><span data-stu-id="311c1-266">If your app targets .NET Framework 4.7 or later versions, this key defaults to a value of 1.</span></span> <span data-ttu-id="311c1-267">这是我们建议使用的安全默认值。</span><span class="sxs-lookup"><span data-stu-id="311c1-267">That's a secure default that we recommend.</span></span> <span data-ttu-id="311c1-268">如果你的应用在 .NET Framework 4.7 或更高版本上运行，但面向早期版本，则注册表项默认值为 0。</span><span class="sxs-lookup"><span data-stu-id="311c1-268">If your app runs on .NET Framework 4.7 or later versions, but targets an earlier version, the key defaults to 0.</span></span> <span data-ttu-id="311c1-269">在这种情况下，应显式将其值设置为 1。</span><span class="sxs-lookup"><span data-stu-id="311c1-269">In that case, you should explicitly set its value to 1.</span></span>

<span data-ttu-id="311c1-270">有关详细信息，请参阅 [Windows 10 版本 1511 和 Windows Server 2016 Technical Preview 4 的累积更新：2016 年 5 月 10 日](https://support.microsoft.com/help/3156421/cumulative-update-for-windows-10-version-1511-and-windows-server-2016)。</span><span class="sxs-lookup"><span data-stu-id="311c1-270">For more info, see [Cumulative Update for Windows 10 Version 1511 and Windows Server 2016 Technical Preview 4: May 10, 2016](https://support.microsoft.com/help/3156421/cumulative-update-for-windows-10-version-1511-and-windows-server-2016).</span></span>

<span data-ttu-id="311c1-271">有关 .NET Framework 3.5.1 中的详细信息，请参阅[在 Windows 7 SP1 和 Server 2008 R2 SP1 上的 .NET Framework 3.5.1 中包含对 TLS 系统默认版本的支持](https://support.microsoft.com/help/3154518/support-for-tls-system-default-versions-included-in-the--net-framework)。</span><span class="sxs-lookup"><span data-stu-id="311c1-271">For more information with .NET framework 3.5.1, see [Support for TLS System Default Versions included in .NET Framework 3.5.1 on Windows 7 SP1 and Server 2008 R2 SP1](https://support.microsoft.com/help/3154518/support-for-tls-system-default-versions-included-in-the--net-framework).</span></span>

<span data-ttu-id="311c1-272">以下 .REG 文件将注册表项及其变量设置为其最安全的值：</span><span class="sxs-lookup"><span data-stu-id="311c1-272">The following _.REG_ file sets the registry keys and their variants to their most safe values:</span></span>

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\.NETFramework\v2.0.50727]
"SystemDefaultTlsVersions"=dword:00000001
"SchUseStrongCrypto"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\.NETFramework\v4.0.30319]
"SystemDefaultTlsVersions"=dword:00000001
"SchUseStrongCrypto"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v2.0.50727]
"SystemDefaultTlsVersions"=dword:00000001
"SchUseStrongCrypto"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319]
"SystemDefaultTlsVersions"=dword:00000001
"SchUseStrongCrypto"=dword:00000001
```

## <a name="configuring-schannel-protocols-in-the-windows-registry"></a><span data-ttu-id="311c1-273">在 Windows 注册表中配置 Schannel 协议</span><span class="sxs-lookup"><span data-stu-id="311c1-273">Configuring Schannel protocols in the Windows Registry</span></span>

<span data-ttu-id="311c1-274">可以使用注册表细化控制你的客户端和/或服务器应用协商的协议。</span><span class="sxs-lookup"><span data-stu-id="311c1-274">You can use the registry for fine-grained control over the protocols that your client and/or server app negotiates.</span></span> <span data-ttu-id="311c1-275">你的应用的网络将遍历 Schannel（它是[安全通道](/windows/desktop/SecAuthN/secure-channel)的另一个名称）。</span><span class="sxs-lookup"><span data-stu-id="311c1-275">Your app's networking goes through Schannel (which is another name for [Secure Channel](/windows/desktop/SecAuthN/secure-channel).</span></span> <span data-ttu-id="311c1-276">通过配置 `Schannel`，可以配置你的应用的行为。</span><span class="sxs-lookup"><span data-stu-id="311c1-276">By configuring `Schannel`, you can configure your app's behavior.</span></span>

<span data-ttu-id="311c1-277">从 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols` 注册表项开始。</span><span class="sxs-lookup"><span data-stu-id="311c1-277">Start with the `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols` registry key.</span></span> <span data-ttu-id="311c1-278">在该注册表项下，可以在集 `SSL 2.0`、`SSL 3.0`、`TLS 1.0`、`TLS 1.1` 和 `TLS 1.2` 中创建任何子项。</span><span class="sxs-lookup"><span data-stu-id="311c1-278">Under that key you can create any subkeys in the set `SSL 2.0`, `SSL 3.0`, `TLS 1.0`, `TLS 1.1`, and `TLS 1.2`.</span></span> <span data-ttu-id="311c1-279">在每个子项下，可以创建子项 `Client` 和/或 `Server`。</span><span class="sxs-lookup"><span data-stu-id="311c1-279">Under each of those subkeys, you can create subkeys `Client` and/or `Server`.</span></span> <span data-ttu-id="311c1-280">在 `Client` 和 `Server` 下，可以创建 DWORD 值 `DisabledByDefault`（0 或 1）和 `Enabled`（0 或 0xFFFFFFFF）。</span><span class="sxs-lookup"><span data-stu-id="311c1-280">Under `Client` and `Server`, you can create DWORD values `DisabledByDefault` (0 or 1) and `Enabled` (0 or 0xFFFFFFFF).</span></span>

## <a name="the-sch_use_strong_crypto-flag"></a><span data-ttu-id="311c1-281">SCH_USE_STRONG_CRYPTO 标志</span><span class="sxs-lookup"><span data-stu-id="311c1-281">The SCH_USE_STRONG_CRYPTO flag</span></span>

<span data-ttu-id="311c1-282">启用后（默认情况下，通过 `AppContext` 开关或 Windows 注册表启动），当你的应用请求 TLS 安全协议时，.NET Framework 将使用 `SCH_USE_STRONG_CRYPTO` 标志。</span><span class="sxs-lookup"><span data-stu-id="311c1-282">When it's enabled (by default, by an `AppContext` switch, or by the Windows Registry), the .NET Framework uses the `SCH_USE_STRONG_CRYPTO` flag when your app requests a TLS security protocol.</span></span> <span data-ttu-id="311c1-283">可以通过 `AppContext` 开关或注册表来默认启用 `SCH_USE_STRONG_CRYPTO` 标志。</span><span class="sxs-lookup"><span data-stu-id="311c1-283">The `SCH_USE_STRONG_CRYPTO` flag can be enabled by default, with the `AppContext` switch, or with the Registry.</span></span> <span data-ttu-id="311c1-284">操作系统将标志传递到 `Schannel`，以指示它禁用已知弱加密算法、密码套件和 TLS/SSL 协议版本（否则，可能会启用该协议以获得更好的互操作性）。</span><span class="sxs-lookup"><span data-stu-id="311c1-284">The OS passes the flag to `Schannel`to instruct it to disable known weak cryptographic algorithms, cipher suites, and TLS/SSL protocol versions that may be otherwise enabled for better interoperability.</span></span> <span data-ttu-id="311c1-285">有关详细信息，请参见:</span><span class="sxs-lookup"><span data-stu-id="311c1-285">For more information, see:</span></span>

- [<span data-ttu-id="311c1-286">安全通道</span><span class="sxs-lookup"><span data-stu-id="311c1-286">Secure Channel</span></span>](/windows/desktop/SecAuthN/secure-channel)
- [<span data-ttu-id="311c1-287">SCHANNEL_CRED 结构</span><span class="sxs-lookup"><span data-stu-id="311c1-287">SCHANNEL_CRED structure</span></span>](/windows/desktop/api/schannel/ns-schannel-_schannel_cred)

<span data-ttu-id="311c1-288">当你显式使用 <xref:System.Net.SecurityProtocolType> 或 <xref:System.Security.Authentication.SslProtocols> 的 `Tls` (TLS 1.0)、`Tls11` 或 `Tls12` 枚举的值时，`SCH_USE_STRONG_CRYPTO` 标志还将被传递到 `Schannel`。</span><span class="sxs-lookup"><span data-stu-id="311c1-288">The `SCH_USE_STRONG_CRYPTO` flag is also passed to `Schannel` when you explicitly use the `Tls` (TLS 1.0), `Tls11`, or `Tls12` enumerated values of <xref:System.Net.SecurityProtocolType> or <xref:System.Security.Authentication.SslProtocols>.</span></span>

## <a name="security-updates"></a><span data-ttu-id="311c1-289">安全更新</span><span class="sxs-lookup"><span data-stu-id="311c1-289">Security updates</span></span>

<span data-ttu-id="311c1-290">本文中的最佳做法将取决于最新安装的安全更新。</span><span class="sxs-lookup"><span data-stu-id="311c1-290">The best practices in this article depend on recent security updates being installed.</span></span> <span data-ttu-id="311c1-291">这些更新包括使用高级 .NET Framework 4.7 和更高版本的功能。</span><span class="sxs-lookup"><span data-stu-id="311c1-291">These updates include the ability to use advanced .NET Framework 4.7 and later features.</span></span> <span data-ttu-id="311c1-292">如果你的应用在 .NET Framework 4.7 和更高版本上运行，则最新安全更新很重要（即使它面向早期版本）。</span><span class="sxs-lookup"><span data-stu-id="311c1-292">Recent security updates are important if your app runs on .NET Framework 4.7 and later versions (even if it targets an earlier version).</span></span>

<span data-ttu-id="311c1-293">若要更新 .NET Framework，以允许操作系统选择要使用的 TLS 的最佳版本，必须至少安装：</span><span class="sxs-lookup"><span data-stu-id="311c1-293">To update the .NET Framework to allow the operating system to choose the best version of TLS to use, you must install at least:</span></span>

- <span data-ttu-id="311c1-294">[.NET Framework 2017 年 8 月质量汇总预览](https://devblogs.microsoft.com/dotnet/net-framework-august-2017-preview-of-quality-rollup/)。</span><span class="sxs-lookup"><span data-stu-id="311c1-294">The [.NET Framework August 2017 Preview of Quality Rollup](https://devblogs.microsoft.com/dotnet/net-framework-august-2017-preview-of-quality-rollup/).</span></span>
- <span data-ttu-id="311c1-295">或 [.NET Framework 2017 年 9 月安全和质量汇总](https://devblogs.microsoft.com/dotnet/net-framework-september-2017-security-and-quality-rollup/)。</span><span class="sxs-lookup"><span data-stu-id="311c1-295">**Or** the [.NET Framework September 2017 Security and Quality Rollup](https://devblogs.microsoft.com/dotnet/net-framework-september-2017-security-and-quality-rollup/).</span></span>

<span data-ttu-id="311c1-296">另请参阅：</span><span class="sxs-lookup"><span data-stu-id="311c1-296">See also:</span></span>

- [<span data-ttu-id="311c1-297">.NET Framework 版本和依赖关系</span><span class="sxs-lookup"><span data-stu-id="311c1-297">.NET Framework Versions and Dependencies</span></span>](../migration-guide/versions-and-dependencies.md)
- <span data-ttu-id="311c1-298">[如何：确定已安装的 .NET Framework 版本](../migration-guide/how-to-determine-which-versions-are-installed.md)。</span><span class="sxs-lookup"><span data-stu-id="311c1-298">[How to: Determine Which .NET Framework Versions Are Installed](../migration-guide/how-to-determine-which-versions-are-installed.md).</span></span>

## <a name="support-for-tls-12"></a><span data-ttu-id="311c1-299">支持 TLS 1.2</span><span class="sxs-lookup"><span data-stu-id="311c1-299">Support for TLS 1.2</span></span>

<span data-ttu-id="311c1-300">为使你的应用与 TLS 1.2 协商，操作系统和 .NET Framework 版本均需支持 TLS 1.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-300">For your app to negotiate TLS 1.2, the OS and the .NET Framework version both need to support TLS 1.2.</span></span>

<span data-ttu-id="311c1-301">**支持 TLS 1.2 的操作系统要求**</span><span class="sxs-lookup"><span data-stu-id="311c1-301">**Operating system requirements to support TLS 1.2**</span></span>

<span data-ttu-id="311c1-302">若要在支持它们的系统上启用或重新启用 TLS 1.2 和/或 TLS 1.1，请参阅[传输层安全性 (TLS) 注册表设置](/windows-server/security/tls/tls-registry-settings)。</span><span class="sxs-lookup"><span data-stu-id="311c1-302">To enable or re-enable TLS 1.2 and/or TLS 1.1 on a system that supports them, see [Transport Layer Security (TLS) registry settings](/windows-server/security/tls/tls-registry-settings).</span></span>

| <span data-ttu-id="311c1-303">操作系统</span><span class="sxs-lookup"><span data-stu-id="311c1-303">**OS**</span></span> | <span data-ttu-id="311c1-304">TLS 1.2 支持</span><span class="sxs-lookup"><span data-stu-id="311c1-304">**TLS 1.2 support**</span></span> |
| --- | --- |
| <span data-ttu-id="311c1-305">Windows 10</span><span class="sxs-lookup"><span data-stu-id="311c1-305">Windows 10</span></span><br><span data-ttu-id="311c1-306">Windows 2016 Server</span><span class="sxs-lookup"><span data-stu-id="311c1-306">Windows Server 2016</span></span> | <span data-ttu-id="311c1-307">默认情况下支持和启用。</span><span class="sxs-lookup"><span data-stu-id="311c1-307">Supported, and enabled by default.</span></span> |
| <span data-ttu-id="311c1-308">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="311c1-308">Windows 8.1</span></span><br><span data-ttu-id="311c1-309">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="311c1-309">Windows Server 2012 R2</span></span> | <span data-ttu-id="311c1-310">默认情况下支持和启用。</span><span class="sxs-lookup"><span data-stu-id="311c1-310">Supported, and enabled by default.</span></span> |
| <span data-ttu-id="311c1-311">Windows 8.0</span><span class="sxs-lookup"><span data-stu-id="311c1-311">Windows 8.0</span></span><br><span data-ttu-id="311c1-312">Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="311c1-312">Windows Server 2012</span></span> | <span data-ttu-id="311c1-313">默认情况下支持和启用。</span><span class="sxs-lookup"><span data-stu-id="311c1-313">Supported, and enabled by default.</span></span> |
| <span data-ttu-id="311c1-314">Windows 7 SP1</span><span class="sxs-lookup"><span data-stu-id="311c1-314">Windows 7 SP1</span></span><br><span data-ttu-id="311c1-315">Windows Server 2008 R2 SP1</span><span class="sxs-lookup"><span data-stu-id="311c1-315">Windows Server 2008 R2 SP1</span></span> | <span data-ttu-id="311c1-316">默认情况下支持但不启用。</span><span class="sxs-lookup"><span data-stu-id="311c1-316">Supported, but not enabled by default.</span></span> <span data-ttu-id="311c1-317">请参阅[传输层安全性 (TLS) 注册表设置](/windows-server/security/tls/tls-registry-settings)网页，以详细了解如何启用 TLS 1.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-317">See the [Transport Layer Security (TLS) registry settings](/windows-server/security/tls/tls-registry-settings) web page for details on how to enable TLS 1.2.</span></span> |
| <span data-ttu-id="311c1-318">Windows Server 2008</span><span class="sxs-lookup"><span data-stu-id="311c1-318">Windows Server 2008</span></span> | <span data-ttu-id="311c1-319">支持 TLS 1.2 和 TLS 1.1 需要更新。</span><span class="sxs-lookup"><span data-stu-id="311c1-319">Support for TLS 1.2 and TLS 1.1 requires an update.</span></span> <span data-ttu-id="311c1-320">请参阅[更新以在 Windows Server 2008 SP2 中添加对 TLS 1.1 和 TLS 1.2 的支持](https://support.microsoft.com/help/4019276/update-to-add-support-for-tls-1-1-and-tls-1-2-in-windows-server-2008-s)。</span><span class="sxs-lookup"><span data-stu-id="311c1-320">See [Update to add support for TLS 1.1 and TLS 1.2 in Windows Server 2008 SP2](https://support.microsoft.com/help/4019276/update-to-add-support-for-tls-1-1-and-tls-1-2-in-windows-server-2008-s).</span></span> |
| <span data-ttu-id="311c1-321">Windows Vista</span><span class="sxs-lookup"><span data-stu-id="311c1-321">Windows Vista</span></span> | <span data-ttu-id="311c1-322">不支持。</span><span class="sxs-lookup"><span data-stu-id="311c1-322">Not supported.</span></span> |

<span data-ttu-id="311c1-323">若要详细了解在每个版本的 Windows 上默认启用的 TLS/SSL 协议，请参阅 [TLS/SSL 中的协议 (Schannel SSP)](/windows/desktop/SecAuthN/protocols-in-tls-ssl--schannel-ssp-)。</span><span class="sxs-lookup"><span data-stu-id="311c1-323">For information about which TLS/SSL protocols are enabled by default on each version of Windows, see [Protocols in TLS/SSL (Schannel SSP)](/windows/desktop/SecAuthN/protocols-in-tls-ssl--schannel-ssp-).</span></span>

<span data-ttu-id="311c1-324">**在 .NET Framework 3.5 中支持 TLS 1.2 的要求**</span><span class="sxs-lookup"><span data-stu-id="311c1-324">**Requirements to support TLS 1.2 with .NET Framework 3.5**</span></span>

<span data-ttu-id="311c1-325">下表显示在 .NET Framework 3.5 中支持 TLS 1.2 所需的操作系统更新。</span><span class="sxs-lookup"><span data-stu-id="311c1-325">This table shows the OS update you'll need to support TLS 1.2 with .NET Framework 3.5.</span></span> <span data-ttu-id="311c1-326">我们建议你应用所有操作系统更新。</span><span class="sxs-lookup"><span data-stu-id="311c1-326">We recommend you apply all OS updates.</span></span>

| <span data-ttu-id="311c1-327">操作系统</span><span class="sxs-lookup"><span data-stu-id="311c1-327">**OS**</span></span> | <span data-ttu-id="311c1-328">**.NET Framework 3.5 中支持 TLS 1.2 所需的最低更新**</span><span class="sxs-lookup"><span data-stu-id="311c1-328">**Minimum update needed to support TLS 1.2 with .NET Framework 3.5**</span></span> |
| --- | --- |
| <span data-ttu-id="311c1-329">Windows 10</span><span class="sxs-lookup"><span data-stu-id="311c1-329">Windows 10</span></span><br><span data-ttu-id="311c1-330">Windows 2016 Server</span><span class="sxs-lookup"><span data-stu-id="311c1-330">Windows Server 2016</span></span> | [<span data-ttu-id="311c1-331">Windows 10 版本 1511 和 Windows Server 2016 Technical Preview 4 的累积更新：2016 年 5 月 10 日</span><span class="sxs-lookup"><span data-stu-id="311c1-331">Cumulative Update for Windows 10 Version 1511 and Windows Server 2016 Technical Preview 4: May 10, 2016</span></span>](https://support.microsoft.com/help/3156421/cumulative-update-for-windows-10-version-1511-and-windows-server-2016) |
| <span data-ttu-id="311c1-332">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="311c1-332">Windows 8.1</span></span><br><span data-ttu-id="311c1-333">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="311c1-333">Windows Server 2012 R2</span></span> | [<span data-ttu-id="311c1-334">在 Windows 8.1 和 Windows Server 2012 R2 上的 .NET Framework 3.5 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-334">Support for TLS System Default Versions included in the .NET Framework 3.5 on Windows 8.1 and Windows Server 2012 R2</span></span>](https://support.microsoft.com/help/3154520/support-for-tls-system-default-versions-included-in-the--net-framework) |
| <span data-ttu-id="311c1-335">Windows 8.0</span><span class="sxs-lookup"><span data-stu-id="311c1-335">Windows 8.0</span></span><br><span data-ttu-id="311c1-336">Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="311c1-336">Windows Server 2012</span></span> | [<span data-ttu-id="311c1-337">在 Windows Server 2012 R2 上的 .NET Framework 3.5 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-337">Support for TLS System Default Versions included in the .NET Framework 3.5 on Windows Server 2012</span></span>](https://support.microsoft.com/help/3154519/support-for-tls-system-default-versions-included-in-the--net-framework) |
| <span data-ttu-id="311c1-338">Windows 7 SP1</span><span class="sxs-lookup"><span data-stu-id="311c1-338">Windows 7 SP1</span></span><br><span data-ttu-id="311c1-339">Windows Server 2008 R2 SP1</span><span class="sxs-lookup"><span data-stu-id="311c1-339">Windows Server 2008 R2 SP1</span></span> | [<span data-ttu-id="311c1-340">在 Windows 7 SP1 和 Server 2008 R2 SP1 上的 .NET Framework 3.5.1 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-340">Support for TLS System Default Versions included in the .NET Framework 3.5.1 on Windows 7 SP1 and Server 2008 R2 SP1</span></span>](https://support.microsoft.com/help/3154518/support-for-tls-system-default-versions-included-in-the--net-framework) |
| <span data-ttu-id="311c1-341">Windows Server 2008</span><span class="sxs-lookup"><span data-stu-id="311c1-341">Windows Server 2008</span></span> | [<span data-ttu-id="311c1-342">在 Windows Vista SP2 和 Server 2008 SP2 上的 .NET Framework 2.0 SP2 中包含对 TLS 系统默认版本的支持</span><span class="sxs-lookup"><span data-stu-id="311c1-342">Support for TLS System Default Versions included in the .NET Framework 2.0 SP2 on Windows Vista SP2 and Server 2008 SP2</span></span>](https://support.microsoft.com/help/3154517/support-for-tls-system-default-versions-included-in-the--net-framework) |
| <span data-ttu-id="311c1-343">Windows Vista</span><span class="sxs-lookup"><span data-stu-id="311c1-343">Windows Vista</span></span> | <span data-ttu-id="311c1-344">不支持</span><span class="sxs-lookup"><span data-stu-id="311c1-344">Not supported</span></span> |

## <a name="azure-cloud-services"></a><span data-ttu-id="311c1-345">Azure 云服务</span><span class="sxs-lookup"><span data-stu-id="311c1-345">Azure Cloud Services</span></span>

<span data-ttu-id="311c1-346">如果你使用 [Azure 云服务](https://azure.microsoft.com/services/cloud-services/) Web 角色和辅助角色来托管和运行应用程序，则需要考虑一些注意事项，以支持 TLS 1.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-346">If you are using [Azure Cloud Services](https://azure.microsoft.com/services/cloud-services/) Web and Worker roles to host and run your application, there are some considerations that you need to take into account to support TLS 1.2.</span></span>

### <a name="net-framework-47-is-not-installed-on-azure-guest-os-by-default"></a><span data-ttu-id="311c1-347">默认情况下在 Azure 来宾操作系统上未安装 .NET Framework 4.7</span><span class="sxs-lookup"><span data-stu-id="311c1-347">.NET Framework 4.7 is not installed on Azure Guest OS by default</span></span>

<span data-ttu-id="311c1-348">在最新的 Azure 来宾操作系统系列 5 版本（Windows Server 2016）中安装的最新版本是 4.6.2。</span><span class="sxs-lookup"><span data-stu-id="311c1-348">The latest version installed in the latest Azure Guest OS Family 5 release (Windows Server 2016) is 4.6.2.</span></span> <span data-ttu-id="311c1-349">若要查看每个 Azure 来宾操作系统上所安装的 .NET Framework 版本，请参阅 [Azure 来宾操作系统版本和 SDK 兼容性矩阵](https://docs.microsoft.com/azure/cloud-services/cloud-services-guestos-update-matrix)。</span><span class="sxs-lookup"><span data-stu-id="311c1-349">To see which versions of .NET Framework are installed on each Azure Guest OS, see the [Azure Guest OS releases and SDK compatibility matrix](https://docs.microsoft.com/azure/cloud-services/cloud-services-guestos-update-matrix).</span></span>

<span data-ttu-id="311c1-350">如果你的应用程序面向的 .NET Framework 版本在 Azure 来宾操作系统上不可用，则需自行安装它。</span><span class="sxs-lookup"><span data-stu-id="311c1-350">If your app targets a .NET Framework version that is not available on the Azure Guest OS version, then you need to install it yourself.</span></span> <span data-ttu-id="311c1-351">请参阅[在 Azure 云服务角色上安装 .NET](https://docs.microsoft.com/azure/cloud-services/cloud-services-dotnet-install-dotnet)。</span><span class="sxs-lookup"><span data-stu-id="311c1-351">See [Install .NET on Azure Cloud Service Roles](https://docs.microsoft.com/azure/cloud-services/cloud-services-dotnet-install-dotnet).</span></span> <span data-ttu-id="311c1-352">如果框架安装需要重启，则在进入“就绪”状态前，服务角色可能也会重启。</span><span class="sxs-lookup"><span data-stu-id="311c1-352">If the framework installation requires a restart, the service roles might also restart before entering the Ready state.</span></span>

### <a name="azure-guest-os-registry-settings"></a><span data-ttu-id="311c1-353">Azure 来宾操作系统注册表设置</span><span class="sxs-lookup"><span data-stu-id="311c1-353">Azure Guest OS registry settings</span></span>

<span data-ttu-id="311c1-354">[Azure 云服务](https://azure.microsoft.com/services/cloud-services/)的 Azure 来宾操作系统系列 5 图像已经具有将值设置为 1 的 `SchUseStrongCrypto` 注册表项。</span><span class="sxs-lookup"><span data-stu-id="311c1-354">The Azure Guest OS Family 5 image for [Azure Cloud Services](https://azure.microsoft.com/services/cloud-services/) already has the `SchUseStrongCrypto` registry key set to a value of 1.</span></span> <span data-ttu-id="311c1-355">有关详细信息，请参阅 [SchUseStrongCrypto](#schusestrongcrypto)。</span><span class="sxs-lookup"><span data-stu-id="311c1-355">For more information, see [SchUseStrongCrypto](#schusestrongcrypto).</span></span>

<span data-ttu-id="311c1-356">将 [SystemDefaultTlsVersions](#systemdefaulttlsversions) 注册表项设置为 1。</span><span class="sxs-lookup"><span data-stu-id="311c1-356">Set the [SystemDefaultTlsVersions](#systemdefaulttlsversions) registry key to 1.</span></span> <span data-ttu-id="311c1-357">请参阅[通过 Windows 注册表配置安全性](#configuring-security-via-the-windows-registry)。</span><span class="sxs-lookup"><span data-stu-id="311c1-357">See [Configuring security via the Windows Registry](#configuring-security-via-the-windows-registry).</span></span>
