---
title: 启用事务流
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], enabling flow
ms.assetid: a03f5041-5049-43f4-897c-e0292d4718f7
ms.openlocfilehash: 8aff6afb09c97d7d01f5e7b7f1b92ae24bb99fb7
ms.sourcegitcommit: fbb8a593a511ce667992502a3ce6d8f65c594edf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/16/2019
ms.locfileid: "74141762"
---
# <a name="enabling-transaction-flow"></a><span data-ttu-id="320c2-102">启用事务流</span><span class="sxs-lookup"><span data-stu-id="320c2-102">Enabling Transaction Flow</span></span>
<span data-ttu-id="320c2-103">Windows Communication Foundation （WCF）提供了非常灵活的选项来控制事务流。</span><span class="sxs-lookup"><span data-stu-id="320c2-103">Windows Communication Foundation (WCF) provides highly flexible options for controlling transaction flow.</span></span> <span data-ttu-id="320c2-104">服务事务流设置可以使用属性与配置的组合来表示。</span><span class="sxs-lookup"><span data-stu-id="320c2-104">A service's transaction flow settings can be expressed using a combination of attributes and configuration.</span></span>  
  
## <a name="transaction-flow-settings"></a><span data-ttu-id="320c2-105">事务流设置</span><span class="sxs-lookup"><span data-stu-id="320c2-105">Transaction Flow Settings</span></span>  
 <span data-ttu-id="320c2-106">服务终结点的事务流设置根据下列三个值的交集生成：</span><span class="sxs-lookup"><span data-stu-id="320c2-106">Transaction flow settings are generated for a service endpoint as a result of the intersection of the following three values:</span></span>  
  
- <span data-ttu-id="320c2-107">为服务协定中的每个方法指定的 <xref:System.ServiceModel.TransactionFlowAttribute> 属性。</span><span class="sxs-lookup"><span data-stu-id="320c2-107">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specified for each method in the service contract.</span></span>  
  
- <span data-ttu-id="320c2-108">特定绑定中的 `TransactionFlow` 绑定属性。</span><span class="sxs-lookup"><span data-stu-id="320c2-108">The `TransactionFlow` binding property in the specific binding.</span></span>  
  
- <span data-ttu-id="320c2-109">特定绑定中的 `TransactionFlowProtocol` 绑定属性。</span><span class="sxs-lookup"><span data-stu-id="320c2-109">The `TransactionFlowProtocol` binding property in the specific binding.</span></span> <span data-ttu-id="320c2-110">`TransactionFlowProtocol` 绑定属性允许您在可用于流动事务的两个不同事务协议之间进行选择。</span><span class="sxs-lookup"><span data-stu-id="320c2-110">The `TransactionFlowProtocol` binding property enables you to choose among two different transaction protocols that you can use to flow a transaction.</span></span> <span data-ttu-id="320c2-111">后面几节将对这些协议逐一进行简要描述。</span><span class="sxs-lookup"><span data-stu-id="320c2-111">The following sections briefly describe each of them.</span></span>  
  
### <a name="ws-atomictransaction-protocol"></a><span data-ttu-id="320c2-112">WS-AtomicTransaction 协议</span><span class="sxs-lookup"><span data-stu-id="320c2-112">WS-AtomicTransaction Protocol</span></span>  
 <span data-ttu-id="320c2-113">WS-AtomicTransaction (WS-AT) 协议对于要求第三方协议堆栈具有互操作性时的情形非常有用。</span><span class="sxs-lookup"><span data-stu-id="320c2-113">The WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required.</span></span>  
  
### <a name="oletransactions-protocol"></a><span data-ttu-id="320c2-114">OleTransactions 协议</span><span class="sxs-lookup"><span data-stu-id="320c2-114">OleTransactions Protocol</span></span>  
 <span data-ttu-id="320c2-115">OleTransactions 协议对于如下的情形非常有用：即不要求第三方协议堆栈具有互操作性，并且服务部署人员预先知道 WS-AT 协议服务将在本地禁用或者现有网络拓扑不支持使用 WS-AT。</span><span class="sxs-lookup"><span data-stu-id="320c2-115">The OleTransactions protocol is useful for scenarios when interoperability with third-party protocol stacks is not required, and the deployer of a service knows in advance that the WS-AT protocol service is disabled locally or the existing network topology does not favor the usage of WS-AT.</span></span>  
  
 <span data-ttu-id="320c2-116">下表列出了可以使用这些不同组合生成的不同类型的事务流。</span><span class="sxs-lookup"><span data-stu-id="320c2-116">The following table shows the different types of transaction flows that can be generated using these various combinations.</span></span>  
  
|<span data-ttu-id="320c2-117">TransactionFlow</span><span class="sxs-lookup"><span data-stu-id="320c2-117">TransactionFlow</span></span><br /><br /> <span data-ttu-id="320c2-118">绑定</span><span class="sxs-lookup"><span data-stu-id="320c2-118">binding</span></span>|<span data-ttu-id="320c2-119">TransactionFlow 绑定属性</span><span class="sxs-lookup"><span data-stu-id="320c2-119">TransactionFlow binding property</span></span>|<span data-ttu-id="320c2-120">TransactionFlowProtocol 绑定协议</span><span class="sxs-lookup"><span data-stu-id="320c2-120">TransactionFlowProtocol binding protocol</span></span>|<span data-ttu-id="320c2-121">事务流的类型</span><span class="sxs-lookup"><span data-stu-id="320c2-121">Type of transaction flow</span></span>|  
|---------------------------------|--------------------------------------|----------------------------------------------|------------------------------|  
|<span data-ttu-id="320c2-122">强制</span><span class="sxs-lookup"><span data-stu-id="320c2-122">Mandatory</span></span>|<span data-ttu-id="320c2-123">true</span><span class="sxs-lookup"><span data-stu-id="320c2-123">true</span></span>|<span data-ttu-id="320c2-124">WS-AT</span><span class="sxs-lookup"><span data-stu-id="320c2-124">WS-AT</span></span>|<span data-ttu-id="320c2-125">事务必须以可以互操作的 WS-AT 格式流动。</span><span class="sxs-lookup"><span data-stu-id="320c2-125">Transaction must be flowed in the interoperable WS-AT format.</span></span>|  
|<span data-ttu-id="320c2-126">强制</span><span class="sxs-lookup"><span data-stu-id="320c2-126">Mandatory</span></span>|<span data-ttu-id="320c2-127">true</span><span class="sxs-lookup"><span data-stu-id="320c2-127">true</span></span>|<span data-ttu-id="320c2-128">OleTransactions</span><span class="sxs-lookup"><span data-stu-id="320c2-128">OleTransactions</span></span>|<span data-ttu-id="320c2-129">事务必须以 WCF OleTransactions 格式流动。</span><span class="sxs-lookup"><span data-stu-id="320c2-129">Transaction must be flowed in the WCF OleTransactions format.</span></span>|  
|<span data-ttu-id="320c2-130">强制</span><span class="sxs-lookup"><span data-stu-id="320c2-130">Mandatory</span></span>|<span data-ttu-id="320c2-131">False</span><span class="sxs-lookup"><span data-stu-id="320c2-131">false</span></span>|<span data-ttu-id="320c2-132">不适用</span><span class="sxs-lookup"><span data-stu-id="320c2-132">Not applicable</span></span>|<span data-ttu-id="320c2-133">不适用，因为这是无效的配置。</span><span class="sxs-lookup"><span data-stu-id="320c2-133">Not applicable because this is an invalid configuration.</span></span>|  
|<span data-ttu-id="320c2-134">Allowed</span><span class="sxs-lookup"><span data-stu-id="320c2-134">Allowed</span></span>|<span data-ttu-id="320c2-135">true</span><span class="sxs-lookup"><span data-stu-id="320c2-135">true</span></span>|<span data-ttu-id="320c2-136">WS-AT</span><span class="sxs-lookup"><span data-stu-id="320c2-136">WS-AT</span></span>|<span data-ttu-id="320c2-137">事务可以以可互操作的 WS-AT 格式流动。</span><span class="sxs-lookup"><span data-stu-id="320c2-137">Transaction may be flowed in the interoperable WS-AT format.</span></span>|  
|<span data-ttu-id="320c2-138">Allowed</span><span class="sxs-lookup"><span data-stu-id="320c2-138">Allowed</span></span>|<span data-ttu-id="320c2-139">true</span><span class="sxs-lookup"><span data-stu-id="320c2-139">true</span></span>|<span data-ttu-id="320c2-140">OleTransactions</span><span class="sxs-lookup"><span data-stu-id="320c2-140">OleTransactions</span></span>|<span data-ttu-id="320c2-141">事务可能以 WCF OleTransactions 格式流动。</span><span class="sxs-lookup"><span data-stu-id="320c2-141">Transaction may be flowed in the WCF OleTransactions format.</span></span>|  
|<span data-ttu-id="320c2-142">Allowed</span><span class="sxs-lookup"><span data-stu-id="320c2-142">Allowed</span></span>|<span data-ttu-id="320c2-143">False</span><span class="sxs-lookup"><span data-stu-id="320c2-143">false</span></span>|<span data-ttu-id="320c2-144">任意值</span><span class="sxs-lookup"><span data-stu-id="320c2-144">Any value</span></span>|<span data-ttu-id="320c2-145">不流动事务。</span><span class="sxs-lookup"><span data-stu-id="320c2-145">A transaction is not flowed.</span></span>|  
|<span data-ttu-id="320c2-146">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="320c2-146">NotAllowed</span></span>|<span data-ttu-id="320c2-147">任意值</span><span class="sxs-lookup"><span data-stu-id="320c2-147">Any value</span></span>|<span data-ttu-id="320c2-148">任意值</span><span class="sxs-lookup"><span data-stu-id="320c2-148">Any value</span></span>|<span data-ttu-id="320c2-149">不流动事务。</span><span class="sxs-lookup"><span data-stu-id="320c2-149">A transaction is not flowed.</span></span>|  
  
 <span data-ttu-id="320c2-150">下表对消息处理结果做了总结。</span><span class="sxs-lookup"><span data-stu-id="320c2-150">The following table summarizes the message processing result.</span></span>  
  
|<span data-ttu-id="320c2-151">传入消息</span><span class="sxs-lookup"><span data-stu-id="320c2-151">Incoming message</span></span>|<span data-ttu-id="320c2-152">TransactionFlow 设置</span><span class="sxs-lookup"><span data-stu-id="320c2-152">TransactionFlow setting</span></span>|<span data-ttu-id="320c2-153">事务标头</span><span class="sxs-lookup"><span data-stu-id="320c2-153">Transaction header</span></span>|<span data-ttu-id="320c2-154">消息处理结果</span><span class="sxs-lookup"><span data-stu-id="320c2-154">Message processing result</span></span>|  
|----------------------|-----------------------------|------------------------|-------------------------------|  
|<span data-ttu-id="320c2-155">事务与预期的协议格式匹配</span><span class="sxs-lookup"><span data-stu-id="320c2-155">Transaction matches expected protocol format</span></span>|<span data-ttu-id="320c2-156">Allowed 或 Mandatory</span><span class="sxs-lookup"><span data-stu-id="320c2-156">Allowed or Mandatory</span></span>|<span data-ttu-id="320c2-157">`MustUnderstand` 等于 `true`。</span><span class="sxs-lookup"><span data-stu-id="320c2-157">`MustUnderstand` equals `true`.</span></span>|<span data-ttu-id="320c2-158">过程</span><span class="sxs-lookup"><span data-stu-id="320c2-158">Process</span></span>|  
|<span data-ttu-id="320c2-159">事务不与预期的协议格式匹配</span><span class="sxs-lookup"><span data-stu-id="320c2-159">Transaction does not match expected protocol format</span></span>|<span data-ttu-id="320c2-160">强制</span><span class="sxs-lookup"><span data-stu-id="320c2-160">Mandatory</span></span>|<span data-ttu-id="320c2-161">`MustUnderstand` 等于 `false`。</span><span class="sxs-lookup"><span data-stu-id="320c2-161">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="320c2-162">因要求一个事务而拒绝</span><span class="sxs-lookup"><span data-stu-id="320c2-162">Rejected because a transaction is required</span></span>|  
|<span data-ttu-id="320c2-163">事务不与预期的协议格式匹配</span><span class="sxs-lookup"><span data-stu-id="320c2-163">Transaction does not match expected protocol format</span></span>|<span data-ttu-id="320c2-164">Allowed</span><span class="sxs-lookup"><span data-stu-id="320c2-164">Allowed</span></span>|<span data-ttu-id="320c2-165">`MustUnderstand` 等于 `false`。</span><span class="sxs-lookup"><span data-stu-id="320c2-165">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="320c2-166">因无法理解标头而拒绝</span><span class="sxs-lookup"><span data-stu-id="320c2-166">Rejected because the header is not understood</span></span>|  
|<span data-ttu-id="320c2-167">使用任何协议格式的事务</span><span class="sxs-lookup"><span data-stu-id="320c2-167">Transaction using any protocol format</span></span>|<span data-ttu-id="320c2-168">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="320c2-168">NotAllowed</span></span>|<span data-ttu-id="320c2-169">`MustUnderstand` 等于 `false`。</span><span class="sxs-lookup"><span data-stu-id="320c2-169">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="320c2-170">因无法理解标头而拒绝</span><span class="sxs-lookup"><span data-stu-id="320c2-170">Rejected because the header is not understood</span></span>|  
|<span data-ttu-id="320c2-171">无事务</span><span class="sxs-lookup"><span data-stu-id="320c2-171">No transaction</span></span>|<span data-ttu-id="320c2-172">强制</span><span class="sxs-lookup"><span data-stu-id="320c2-172">Mandatory</span></span>|<span data-ttu-id="320c2-173">不可用</span><span class="sxs-lookup"><span data-stu-id="320c2-173">N/A</span></span>|<span data-ttu-id="320c2-174">因要求一个事务而拒绝</span><span class="sxs-lookup"><span data-stu-id="320c2-174">Rejected because a transaction is required</span></span>|  
|<span data-ttu-id="320c2-175">无事务</span><span class="sxs-lookup"><span data-stu-id="320c2-175">No transaction</span></span>|<span data-ttu-id="320c2-176">Allowed</span><span class="sxs-lookup"><span data-stu-id="320c2-176">Allowed</span></span>|<span data-ttu-id="320c2-177">不可用</span><span class="sxs-lookup"><span data-stu-id="320c2-177">N/A</span></span>|<span data-ttu-id="320c2-178">过程</span><span class="sxs-lookup"><span data-stu-id="320c2-178">Process</span></span>|  
|<span data-ttu-id="320c2-179">无事务</span><span class="sxs-lookup"><span data-stu-id="320c2-179">No transaction</span></span>|<span data-ttu-id="320c2-180">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="320c2-180">NotAllowed</span></span>|<span data-ttu-id="320c2-181">不可用</span><span class="sxs-lookup"><span data-stu-id="320c2-181">N/A</span></span>|<span data-ttu-id="320c2-182">过程</span><span class="sxs-lookup"><span data-stu-id="320c2-182">Process</span></span>|  
  
 <span data-ttu-id="320c2-183">虽然协定上的每个方法都有不同的事务流需求，但事务流协议设置的范围处于绑定级别。</span><span class="sxs-lookup"><span data-stu-id="320c2-183">While each method on a contract can have different transaction flow requirements, the transaction flow protocol setting is scoped at the level of the binding.</span></span> <span data-ttu-id="320c2-184">这意味着，共享同一个终结点（并因此共享同一绑定）的所有方法也共享允许或要求事务流的同一个策略以及同一个事务协议（如果适用）。</span><span class="sxs-lookup"><span data-stu-id="320c2-184">This means that all methods that share the same endpoint (and therefore the same binding) also share the same policy allowing or requiring transaction flow, as well as the same transaction protocol if applicable.</span></span>  
  
## <a name="enabling-transaction-flow-at-the-method-level"></a><span data-ttu-id="320c2-185">在方法级别启用事务流</span><span class="sxs-lookup"><span data-stu-id="320c2-185">Enabling Transaction Flow at the Method Level</span></span>  
 <span data-ttu-id="320c2-186">对于服务协定中的所有方法，事务流要求并不总是相同。</span><span class="sxs-lookup"><span data-stu-id="320c2-186">Transaction flow requirements are not always the same for all methods in a service contract.</span></span> <span data-ttu-id="320c2-187">因此，WCF 还提供基于特性的机制，以允许表示每个方法的事务流首选项。</span><span class="sxs-lookup"><span data-stu-id="320c2-187">Therefore, WCF also provides an attribute-based mechanism to allow each method's transaction flow preferences to be expressed.</span></span> <span data-ttu-id="320c2-188">这通过指定服务操作接受事务标头所处的级别的 <xref:System.ServiceModel.TransactionFlowAttribute> 来实现。</span><span class="sxs-lookup"><span data-stu-id="320c2-188">This is achieved by the <xref:System.ServiceModel.TransactionFlowAttribute> that specifies the level in which a service operation accepts a transaction header.</span></span> <span data-ttu-id="320c2-189">如果需要启用事务流，则应使用此属性标记服务协定方法。</span><span class="sxs-lookup"><span data-stu-id="320c2-189">You should mark your service contract methods with this attribute if you want to enable transaction flow.</span></span> <span data-ttu-id="320c2-190">此属性采用 <xref:System.ServiceModel.TransactionFlowOption> 枚举值之一，其中默认值为 <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>。</span><span class="sxs-lookup"><span data-stu-id="320c2-190">This attribute takes one of the values of the <xref:System.ServiceModel.TransactionFlowOption> enumeration, in which the default value is <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span> <span data-ttu-id="320c2-191">如果指定除 <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> 以外的任何值，则要求该方法不要成为单向方法。</span><span class="sxs-lookup"><span data-stu-id="320c2-191">If any value except <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> is specified, the method is required to not be one-way.</span></span> <span data-ttu-id="320c2-192">开发人员可以使用此属性在设计时指定方法级别的事务流需求或约束。</span><span class="sxs-lookup"><span data-stu-id="320c2-192">A developer can use this attribute to specify method-level transaction flow requirements or constraints at design time.</span></span>  
  
## <a name="enabling-transaction-flow-at-the-endpoint-level"></a><span data-ttu-id="320c2-193">在终结点级别启用事务流</span><span class="sxs-lookup"><span data-stu-id="320c2-193">Enabling Transaction Flow at the Endpoint Level</span></span>  
 <span data-ttu-id="320c2-194">除了提供 <xref:System.ServiceModel.TransactionFlowAttribute> 特性的方法级别事务流设置外，WCF 还为事务流提供了一个终结点范围的设置，以允许管理员在更高级别控制事务流。</span><span class="sxs-lookup"><span data-stu-id="320c2-194">In addition to the method-level transaction flow setting  the <xref:System.ServiceModel.TransactionFlowAttribute> attribute provides, WCF provides an endpoint-wide setting for transaction flow to allow administrators to control transaction flow at a higher level.</span></span>  
  
 <span data-ttu-id="320c2-195">这可以通过 <xref:System.ServiceModel.Channels.TransactionFlowBindingElement> 来实现，该类允许您在终结点绑定设置中启用或禁用传入事务流，并允许指定传入事务所需的事务协议格式。</span><span class="sxs-lookup"><span data-stu-id="320c2-195">This is achieved by the <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, which enables you to enable or disable incoming transaction flow in an endpoint’s binding settings, as well as to specify the desired transaction protocol format for incoming transactions.</span></span>  
  
 <span data-ttu-id="320c2-196">如果该绑定已禁用事务流，但对服务协定的操作之一要求一个传入事务，则将在服务启动时引发验证异常。</span><span class="sxs-lookup"><span data-stu-id="320c2-196">If the binding has disabled transaction flow, but one of the operations on a service contract requires an incoming transaction, then a validation exception is thrown at service startup.</span></span>  
  
 <span data-ttu-id="320c2-197">WCF 提供的大多数持续绑定都包含 `transactionFlow` 和 `transactionProtocol` 属性，使你能够将特定的绑定配置为接受传入事务。</span><span class="sxs-lookup"><span data-stu-id="320c2-197">Most of the standing bindings WCF provides contain the `transactionFlow` and `transactionProtocol` attributes to enable you to configure the specific binding to accept incoming transactions.</span></span> <span data-ttu-id="320c2-198">有关设置配置元素的详细信息，请参阅[\<绑定 >](../../configure-apps/file-schema/wcf/bindings.md)。</span><span class="sxs-lookup"><span data-stu-id="320c2-198">For more information about setting the configuration elements, see [\<binding>](../../configure-apps/file-schema/wcf/bindings.md).</span></span>  
  
 <span data-ttu-id="320c2-199">管理员或部署人员可以使用终结点级别的事务流在部署时使用配置文件来配置事务流需求或约束。</span><span class="sxs-lookup"><span data-stu-id="320c2-199">An administrator or deployer can use endpoint-level transaction flow to configure transaction flow requirements or constraints at deployment time using the configuration file.</span></span>  
  
## <a name="security"></a><span data-ttu-id="320c2-200">安全</span><span class="sxs-lookup"><span data-stu-id="320c2-200">Security</span></span>  
 <span data-ttu-id="320c2-201">若要确保系统的安全性和完整性，你必须在应用程序之间流动事务时保护消息交换。</span><span class="sxs-lookup"><span data-stu-id="320c2-201">To ensure system security and integrity, you must secure message exchanges when flowing transactions between applications.</span></span> <span data-ttu-id="320c2-202">你不应向无资格参与某一事务的任何应用程序流动或透露该事务的详细信息。</span><span class="sxs-lookup"><span data-stu-id="320c2-202">You should not flow or disclose transaction details to any application that is not entitled to participate in the same transaction.</span></span>  
  
 <span data-ttu-id="320c2-203">使用元数据交换将 WCF 客户端生成到未知或不受信任的 Web 服务时，在可能的情况下，对这些 Web 服务上的操作的调用应禁止显示当前事务。</span><span class="sxs-lookup"><span data-stu-id="320c2-203">When generating WCF clients to unknown or untrusted Web services through the use of metadata exchange, calls to operations on these Web services should suppress the current transaction if possible.</span></span> <span data-ttu-id="320c2-204">下面的示例演示如何执行此操作。</span><span class="sxs-lookup"><span data-stu-id="320c2-204">The following example demonstrates how to do this.</span></span>  
  
```csharp
//client code which has an ambient transaction  
using (TransactionScope scope = new TransactionScope(TransactionScopeOption.Suppress))  
{  
    // No transaction will flow to this operation  
    untrustedProxy.Operation1(...);  
    scope.Complete();  
}  
//remainder of client code  
```  
  
 <span data-ttu-id="320c2-205">此外，还应将这些服务配置为仅接受来自它们已对其进行身份验证和授权的客户端的传入事务。</span><span class="sxs-lookup"><span data-stu-id="320c2-205">In addition, services should be configured to accept incoming transactions only from clients that they have authenticated and authorized.</span></span> <span data-ttu-id="320c2-206">如果传入事务来自高度受信任的客户端，则应仅接受传入事务。</span><span class="sxs-lookup"><span data-stu-id="320c2-206">Incoming transactions should only be accepted if they come from highly trusted clients.</span></span>  
  
## <a name="policy-assertions"></a><span data-ttu-id="320c2-207">策略断言</span><span class="sxs-lookup"><span data-stu-id="320c2-207">Policy Assertions</span></span>  
 <span data-ttu-id="320c2-208">WCF 使用策略断言来控制事务流。</span><span class="sxs-lookup"><span data-stu-id="320c2-208">WCF uses policy assertions to control transaction flow.</span></span> <span data-ttu-id="320c2-209">可以在服务的策略文档中找到策略断言，该断言是通过聚合协定、配置和属性而生成的。</span><span class="sxs-lookup"><span data-stu-id="320c2-209">Policy assertions can be found in a service’s policy document, which is generated by aggregating contracts, configuration, and attributes.</span></span> <span data-ttu-id="320c2-210">客户端可以使用 HTTP GET 或 WS-MetadataExchange 请求-回复来获取服务的策略文档。</span><span class="sxs-lookup"><span data-stu-id="320c2-210">The client can obtain the service’s policy document using an HTTP GET or a WS-MetadataExchange request-reply.</span></span> <span data-ttu-id="320c2-211">然后，客户端可以通过处理策略文档来确定服务协定上的哪些操作可以支持或要求事务流。</span><span class="sxs-lookup"><span data-stu-id="320c2-211">Clients can then process the policy document to determine which operations on a service contract may support or require transaction flow.</span></span>  
  
 <span data-ttu-id="320c2-212">事务流策略断言通过指定客户端应发送给服务以表示事务的 SOAP 标头来影响事务流。</span><span class="sxs-lookup"><span data-stu-id="320c2-212">Transaction flow policy assertions affect transaction flow by specifying the SOAP headers that a client should send to a service to represent a transaction.</span></span> <span data-ttu-id="320c2-213">所有事务标头都必须标记为 `MustUnderstand` 等于 `true`。</span><span class="sxs-lookup"><span data-stu-id="320c2-213">All transaction headers must be marked with `MustUnderstand` equal to `true`.</span></span> <span data-ttu-id="320c2-214">以其他方式标记标头的任何消息都将被拒绝，并出现 SOAP 错误。</span><span class="sxs-lookup"><span data-stu-id="320c2-214">Any message with a header marked otherwise is rejected with a SOAP fault.</span></span>  
  
 <span data-ttu-id="320c2-215">一个操作上只能出现一个与事务相关的策略断言。</span><span class="sxs-lookup"><span data-stu-id="320c2-215">Only one transaction-related policy assertion can be present on a single operation.</span></span> <span data-ttu-id="320c2-216">操作上具有多个事务断言的策略文档被视为无效，并被 WCF 拒绝。</span><span class="sxs-lookup"><span data-stu-id="320c2-216">Policy documents with more than one transaction assertion on an operation are considered invalid and are rejected by WCF.</span></span> <span data-ttu-id="320c2-217">此外，每个端口类型内仅可出现一个事务协议。</span><span class="sxs-lookup"><span data-stu-id="320c2-217">In addition, only a single transaction protocol can be present inside each port type.</span></span> <span data-ttu-id="320c2-218">在单个端口类型内引用多个事务协议的操作的策略文档被视为无效，并被工作的[元数据实用工具（svcutil.exe）](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)拒绝。</span><span class="sxs-lookup"><span data-stu-id="320c2-218">Policy documents with operations referencing more than one transaction protocol inside a single port type are considered invalid, and are rejected by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="320c2-219">事务断言出现在输出消息或单向输入消息上的策略文档也将被视为无效。</span><span class="sxs-lookup"><span data-stu-id="320c2-219">Policy documents with transaction assertions present on output messages or one-way input messages are also considered invalid.</span></span>
