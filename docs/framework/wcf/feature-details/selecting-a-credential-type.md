---
title: 选择凭据类型
ms.date: 03/30/2017
ms.assetid: bf707063-3f30-4304-ab53-0e63413728a8
ms.openlocfilehash: 6737f7daeb37e2e296ca0429d73b963743c409a2
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/24/2020
ms.locfileid: "76746149"
---
# <a name="selecting-a-credential-type"></a><span data-ttu-id="96ee1-102">选择凭据类型</span><span class="sxs-lookup"><span data-stu-id="96ee1-102">Selecting a Credential Type</span></span>
<span data-ttu-id="96ee1-103">*凭据*是 WINDOWS COMMUNICATION FOUNDATION （WCF）用于建立声明的标识或功能的数据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-103">*Credentials* are the data Windows Communication Foundation (WCF) uses to establish either a claimed identity or capabilities.</span></span> <span data-ttu-id="96ee1-104">例如，护照就是政府颁发的用以证明国家或地区的公民身份的凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-104">For example, a passport is a credential a government issues to prove citizenship in a country or region.</span></span> <span data-ttu-id="96ee1-105">在 WCF 中，凭据可以采用多种形式，例如用户名令牌和 x.509 证书。</span><span class="sxs-lookup"><span data-stu-id="96ee1-105">In WCF, credentials can take many forms, such as user name tokens and X.509 certificates.</span></span> <span data-ttu-id="96ee1-106">本主题讨论凭据、凭据在 WCF 中的使用方式以及如何为应用程序选择正确的凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-106">This topic discusses credentials, how they are used in WCF, and how to select the right credential for your application.</span></span>  
  
 <span data-ttu-id="96ee1-107">在许多国家和地区，驾驶执照就是凭据的一个示例。</span><span class="sxs-lookup"><span data-stu-id="96ee1-107">In many countries and regions, a driver’s license is an example of a credential.</span></span> <span data-ttu-id="96ee1-108">该执照中包含表示个人身份和能力的数据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-108">A license contains data that represents a person's identity and capabilities.</span></span> <span data-ttu-id="96ee1-109">它以持有人照片的形式包含所有权证明。</span><span class="sxs-lookup"><span data-stu-id="96ee1-109">It contains proof of possession in the form of the possessor's picture.</span></span> <span data-ttu-id="96ee1-110">该执照由受信任的颁发机构颁发，通常是获得许可的政府部门。</span><span class="sxs-lookup"><span data-stu-id="96ee1-110">The license is issued by a trusted authority, usually a governmental department of licensing.</span></span> <span data-ttu-id="96ee1-111">该执照采用密封形式且包含一张全息图，表明它未经改动或伪造。</span><span class="sxs-lookup"><span data-stu-id="96ee1-111">The license is sealed, and can contain a hologram, showing that it has not been tampered with or counterfeited.</span></span>  
  
 <span data-ttu-id="96ee1-112">提交凭据涉及出示数据以及数据的所有权证明。</span><span class="sxs-lookup"><span data-stu-id="96ee1-112">Presenting a credential involves presenting both the data and proof of possession of the data.</span></span> <span data-ttu-id="96ee1-113">WCF 在传输和消息安全级别支持多种凭据类型。</span><span class="sxs-lookup"><span data-stu-id="96ee1-113">WCF supports a variety of credential types at both the transport and message security levels.</span></span> <span data-ttu-id="96ee1-114">例如，请考虑 WCF 中支持的两种凭据类型：用户名和（x.509）证书凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-114">For example, consider two types of credentials supported in WCF: user name and (X.509) certificate credentials.</span></span>  
  
 <span data-ttu-id="96ee1-115">对于用户名凭据，用户名表示已声明的标识，密码提供所有权证明。</span><span class="sxs-lookup"><span data-stu-id="96ee1-115">For the user name credential, the user name represents the claimed identity and the password provides proof of possession.</span></span> <span data-ttu-id="96ee1-116">这种情况下，受信任的颁发机构则是验证用户名和密码的系统。</span><span class="sxs-lookup"><span data-stu-id="96ee1-116">The trusted authority in this case is the system that validates the user name and password.</span></span>  
  
 <span data-ttu-id="96ee1-117">使用 x.509 证书凭据，证书中的使用者名称、使用者备用名称或特定字段可用作标识声明，而其他字段（例如 `Valid From` 和 `Valid To` 字段）指定证书的有效性。</span><span class="sxs-lookup"><span data-stu-id="96ee1-117">With an X.509 certificate credential, the subject name, subject alternative name or specific fields within the certificate can be used as claims of identity, while other fields, such as the `Valid From` and `Valid To` fields, specify the validity of the certificate.</span></span>  
  
## <a name="transport-credential-types"></a><span data-ttu-id="96ee1-118">传输凭据类型</span><span class="sxs-lookup"><span data-stu-id="96ee1-118">Transport Credential Types</span></span>  
 <span data-ttu-id="96ee1-119">下表列出了在传输安全模式下可以由绑定使用的客户端凭据的可能类型。</span><span class="sxs-lookup"><span data-stu-id="96ee1-119">The following table shows the possible types of client credentials that can be used by a binding in transport security mode.</span></span> <span data-ttu-id="96ee1-120">创建服务时，将 `ClientCredentialType` 属性设置为这些值之一以指定凭据类型，客户端必须提供该凭据才能与您的服务进行通信。</span><span class="sxs-lookup"><span data-stu-id="96ee1-120">When creating a service, set the `ClientCredentialType` property to one of these values to specify the type of credential that the client must supply to communicate with your service.</span></span> <span data-ttu-id="96ee1-121">可以在代码或配置文件中设置这些类型。</span><span class="sxs-lookup"><span data-stu-id="96ee1-121">You can set the types in either code or configuration files.</span></span>  
  
|<span data-ttu-id="96ee1-122">设置</span><span class="sxs-lookup"><span data-stu-id="96ee1-122">Setting</span></span>|<span data-ttu-id="96ee1-123">说明</span><span class="sxs-lookup"><span data-stu-id="96ee1-123">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="96ee1-124">无</span><span class="sxs-lookup"><span data-stu-id="96ee1-124">None</span></span>|<span data-ttu-id="96ee1-125">指定客户端不需要提供任何凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-125">Specifies that the client does not need to present any credential.</span></span> <span data-ttu-id="96ee1-126">这相当于匿名客户端。</span><span class="sxs-lookup"><span data-stu-id="96ee1-126">This translates to an anonymous client.</span></span>|  
|<span data-ttu-id="96ee1-127">基本</span><span class="sxs-lookup"><span data-stu-id="96ee1-127">Basic</span></span>|<span data-ttu-id="96ee1-128">为客户端指定基本身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-128">Specifies basic authentication for the client.</span></span> <span data-ttu-id="96ee1-129">有关其他信息，请参阅 RFC2617-[HTTP authentication：基本和摘要式身份验证](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt)。</span><span class="sxs-lookup"><span data-stu-id="96ee1-129">For additional information, see RFC2617—[HTTP Authentication: Basic and Digest Authentication](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).</span></span>|  
|<span data-ttu-id="96ee1-130">摘要</span><span class="sxs-lookup"><span data-stu-id="96ee1-130">Digest</span></span>|<span data-ttu-id="96ee1-131">为客户端指定摘要式身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-131">Specifies digest authentication for the client.</span></span> <span data-ttu-id="96ee1-132">有关其他信息，请参阅 RFC2617-[HTTP authentication：基本和摘要式身份验证](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt)。</span><span class="sxs-lookup"><span data-stu-id="96ee1-132">For additional information, see RFC2617—[HTTP Authentication: Basic and Digest Authentication](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).</span></span>|  
|<span data-ttu-id="96ee1-133">Ntlm</span><span class="sxs-lookup"><span data-stu-id="96ee1-133">Ntlm</span></span>|<span data-ttu-id="96ee1-134">指定 NT LAN Manager (NTLM) 身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-134">Specifies NT LAN Manager (NTLM) authentication.</span></span> <span data-ttu-id="96ee1-135">在由于某种原因无法使用 Kerberos 身份验证时使用。</span><span class="sxs-lookup"><span data-stu-id="96ee1-135">This is used when you cannot use Kerberos authentication for some reason.</span></span> <span data-ttu-id="96ee1-136">你还可以通过将 <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> 属性设置为 `false`来禁用其用作回退，这将导致 WCF 在使用 NTLM 时尽力引发异常。</span><span class="sxs-lookup"><span data-stu-id="96ee1-136">You can also disable its use as a fallback by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false`, which causes WCF to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="96ee1-137">请注意，将此属性设置为 `false` 可能不阻止通过网络发送 NTLM 凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-137">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>|  
|<span data-ttu-id="96ee1-138">Windows</span><span class="sxs-lookup"><span data-stu-id="96ee1-138">Windows</span></span>|<span data-ttu-id="96ee1-139">指定 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-139">Specifies Windows authentication.</span></span> <span data-ttu-id="96ee1-140">若要在 Windows 域上仅指定 Kerberos 协议，则将 <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> 属性设置为 `false`（默认值为 `true`）。</span><span class="sxs-lookup"><span data-stu-id="96ee1-140">To specify only the Kerberos protocol on a Windows domain, set the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false` (the default is `true`).</span></span>|  
|<span data-ttu-id="96ee1-141">证书</span><span class="sxs-lookup"><span data-stu-id="96ee1-141">Certificate</span></span>|<span data-ttu-id="96ee1-142">使用 X.509 证书执行客户端身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-142">Performs client authentication using an X.509 certificate.</span></span>|  
|<span data-ttu-id="96ee1-143">密码</span><span class="sxs-lookup"><span data-stu-id="96ee1-143">Password</span></span>|<span data-ttu-id="96ee1-144">用户必须提供用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="96ee1-144">User must supply a user name and password.</span></span> <span data-ttu-id="96ee1-145">使用 Windows 身份验证或其他自定义解决方案验证用户名/密码对。</span><span class="sxs-lookup"><span data-stu-id="96ee1-145">Validate the user name/password pair using Windows authentication or another custom solution.</span></span>|  
  
### <a name="message-client-credential-types"></a><span data-ttu-id="96ee1-146">消息客户端凭据类型</span><span class="sxs-lookup"><span data-stu-id="96ee1-146">Message Client Credential Types</span></span>  
 <span data-ttu-id="96ee1-147">下表列出了在创建使用消息安全的应用程序时可以使用的可能的凭据类型。</span><span class="sxs-lookup"><span data-stu-id="96ee1-147">The following table shows the possible credential types that you can use when creating an application that uses message security.</span></span> <span data-ttu-id="96ee1-148">可以在代码或配置文件中使用这些值。</span><span class="sxs-lookup"><span data-stu-id="96ee1-148">You can use these values in either code or configuration files.</span></span>  
  
|<span data-ttu-id="96ee1-149">设置</span><span class="sxs-lookup"><span data-stu-id="96ee1-149">Setting</span></span>|<span data-ttu-id="96ee1-150">说明</span><span class="sxs-lookup"><span data-stu-id="96ee1-150">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="96ee1-151">无</span><span class="sxs-lookup"><span data-stu-id="96ee1-151">None</span></span>|<span data-ttu-id="96ee1-152">指定客户端不需要提供凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-152">Specifies that the client does not need to present a credential.</span></span> <span data-ttu-id="96ee1-153">这相当于匿名客户端。</span><span class="sxs-lookup"><span data-stu-id="96ee1-153">This translates to an anonymous client.</span></span>|  
|<span data-ttu-id="96ee1-154">Windows</span><span class="sxs-lookup"><span data-stu-id="96ee1-154">Windows</span></span>|<span data-ttu-id="96ee1-155">允许在使用 Windows 凭据建立的安全上下文中交换 SOAP 消息。</span><span class="sxs-lookup"><span data-stu-id="96ee1-155">Allows SOAP message exchanges to occur under the security context established with a Windows credential.</span></span>|  
|<span data-ttu-id="96ee1-156">用户名</span><span class="sxs-lookup"><span data-stu-id="96ee1-156">Username</span></span>|<span data-ttu-id="96ee1-157">允许服务可以要求使用用户名凭据对客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-157">Allows the service to require that the client be authenticated with a user name credential.</span></span> <span data-ttu-id="96ee1-158">请注意，WCF 不允许对用户名进行任何加密操作，例如生成签名或加密数据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-158">Note that WCF does not allow any cryptographic operations with user names, such as generating a signature or encrypting data.</span></span> <span data-ttu-id="96ee1-159">WCF 可确保在使用用户名凭据时确保传输的安全性。</span><span class="sxs-lookup"><span data-stu-id="96ee1-159">WCF ensures that the transport is secured when using user name credentials.</span></span>|  
|<span data-ttu-id="96ee1-160">证书</span><span class="sxs-lookup"><span data-stu-id="96ee1-160">Certificate</span></span>|<span data-ttu-id="96ee1-161">允许服务可以要求使用 X.509 证书对客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-161">Allows the service to require that the client be authenticated using an X.509 certificate.</span></span>|  
|<span data-ttu-id="96ee1-162">已颁发的令牌</span><span class="sxs-lookup"><span data-stu-id="96ee1-162">Issued Token</span></span>|<span data-ttu-id="96ee1-163">根据安全策略配置的自定义令牌类型。</span><span class="sxs-lookup"><span data-stu-id="96ee1-163">A custom token type configured according to a security policy.</span></span> <span data-ttu-id="96ee1-164">默认令牌类型为安全断言标记语言 (SAML)。</span><span class="sxs-lookup"><span data-stu-id="96ee1-164">The default token type is Security Assertions Markup Language (SAML).</span></span> <span data-ttu-id="96ee1-165">令牌由安全令牌服务颁发。</span><span class="sxs-lookup"><span data-stu-id="96ee1-165">The token is issued by a secure token service.</span></span> <span data-ttu-id="96ee1-166">有关详细信息，请参阅[联合和颁发的令牌](../../../../docs/framework/wcf/feature-details/federation-and-issued-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="96ee1-166">For more information, see [Federation and Issued Tokens](../../../../docs/framework/wcf/feature-details/federation-and-issued-tokens.md).</span></span>|  
  
### <a name="negotiation-model-of-service-credentials"></a><span data-ttu-id="96ee1-167">服务凭据的协商模型</span><span class="sxs-lookup"><span data-stu-id="96ee1-167">Negotiation Model of Service Credentials</span></span>  
 <span data-ttu-id="96ee1-168">*协商*是通过交换凭据在客户端和服务之间建立信任关系的过程。</span><span class="sxs-lookup"><span data-stu-id="96ee1-168">*Negotiation* is the process of establishing trust between a client and a service by exchanging credentials.</span></span> <span data-ttu-id="96ee1-169">该过程在客户端和服务之间以迭代方式进行，以便仅公开协商过程下一步所需的信息。</span><span class="sxs-lookup"><span data-stu-id="96ee1-169">The process is performed iteratively between the client and the service, so as to disclose only the information necessary for the next step in the negotiation process.</span></span> <span data-ttu-id="96ee1-170">实际上，最终结果是将服务凭据传递给要在后续操作中使用的客户端。</span><span class="sxs-lookup"><span data-stu-id="96ee1-170">In practice, the end result is the delivery of a service's credential to the client to be used in subsequent operations.</span></span>  
  
 <span data-ttu-id="96ee1-171">但有一个例外，默认情况下，在使用消息级安全性时，WCF 中系统提供的绑定会自动协商服务凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-171">With one exception, by default the system-provided bindings in WCF negotiate the service credential automatically when using message-level security.</span></span> <span data-ttu-id="96ee1-172">（例外情况是 <xref:System.ServiceModel.BasicHttpBinding>，默认情况下不启用安全性。）若要禁用此行为，请参阅 "<xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A>" 和 "<xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A>" 属性。</span><span class="sxs-lookup"><span data-stu-id="96ee1-172">(The exception is the <xref:System.ServiceModel.BasicHttpBinding>, which does not enable security by default.) To disable this behavior, see the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> and <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> properties.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="96ee1-173">当 SSL 安全与 .NET Framework 3.5 及更高版本一起使用时，WCF 客户端将使用其证书存储区中的中间证书和 SSL 协商期间收到的中间证书，在服务的证书.</span><span class="sxs-lookup"><span data-stu-id="96ee1-173">When SSL security is used with .NET Framework 3.5 and later, a WCF client uses both the intermediate certificates in its certificate store and the intermediate certificates received during SSL negotiation to perform certificate chain validation on the service's certificate.</span></span> <span data-ttu-id="96ee1-174">.NET Framework 3.0 仅使用本地证书存储区中安装的中间证书。</span><span class="sxs-lookup"><span data-stu-id="96ee1-174">.NET Framework 3.0 only uses the intermediate certificates installed in the local certificate store.</span></span>  
  
#### <a name="out-of-band-negotiation"></a><span data-ttu-id="96ee1-175">带外协商</span><span class="sxs-lookup"><span data-stu-id="96ee1-175">Out-of-Band Negotiation</span></span>  
 <span data-ttu-id="96ee1-176">如果禁用自动协商，则在将任何消息发送到服务之前必须向客户端提供服务凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-176">If automatic negotiation is disabled, the service credential must be provisioned at the client prior to sending any messages to the service.</span></span> <span data-ttu-id="96ee1-177">这也称为*带*外设置。</span><span class="sxs-lookup"><span data-stu-id="96ee1-177">This is also known as an *out-of-band* provisioning.</span></span> <span data-ttu-id="96ee1-178">例如，如果指定的凭据类型为证书，且禁用了自动协商，则客户端必须联系服务所有者以在运行客户端应用程序的计算机上接收和安装证书。</span><span class="sxs-lookup"><span data-stu-id="96ee1-178">For example, if the specified credential type is a certificate, and automatic negotiation is disabled, the client must contact the service owner to receive and install the certificate on the computer running the client application.</span></span> <span data-ttu-id="96ee1-179">例如，当要严格控制哪些客户端可以访问企业对企业方案中的服务时，可以执行上述操作。</span><span class="sxs-lookup"><span data-stu-id="96ee1-179">This can be done, for example, when you want to strictly control which clients can access a service in a business-to-business scenario.</span></span> <span data-ttu-id="96ee1-180">此带外协商可以通过电子邮件完成，而 x.509 证书则使用 Microsoft 管理控制台（MMC）证书管理单元之类的工具存储在 Windows 证书存储中。</span><span class="sxs-lookup"><span data-stu-id="96ee1-180">This out-of-band-negotiation can be done in email, and the X.509 certificate is stored in Windows certificate store, using a tool such as the Microsoft Management Console (MMC) Certificates snap-in.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="96ee1-181"><xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> 属性用于提供使用证书的服务，该证书通过带外协商实现。</span><span class="sxs-lookup"><span data-stu-id="96ee1-181">The <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property is used to provide the service with a certificate that was attained through out-of-band negotiation.</span></span> <span data-ttu-id="96ee1-182">这是使用 <xref:System.ServiceModel.BasicHttpBinding> 类时所必需的，因为绑定不允许自动协商。</span><span class="sxs-lookup"><span data-stu-id="96ee1-182">This is necessary when using the <xref:System.ServiceModel.BasicHttpBinding> class because the binding does not allow automated negotiation.</span></span> <span data-ttu-id="96ee1-183">该属性还可用于不相关的双工方案中。</span><span class="sxs-lookup"><span data-stu-id="96ee1-183">The property is also used in an uncorrelated duplex scenario.</span></span> <span data-ttu-id="96ee1-184">在此方案中，无需客户端先向服务器发送请求，服务器就将消息发送到客户端。</span><span class="sxs-lookup"><span data-stu-id="96ee1-184">This is a scenario where a server sends a message to the client without requiring the client to send a request to the server first.</span></span> <span data-ttu-id="96ee1-185">由于服务器没有来自客户端的请求，因此它必须使用客户端的证书加密发送到客户端的消息。</span><span class="sxs-lookup"><span data-stu-id="96ee1-185">Because the server does not have a request from the client, it must use the client's certificate to encrypt the message to the client.</span></span>  
  
## <a name="setting-credential-values"></a><span data-ttu-id="96ee1-186">设置凭据值</span><span class="sxs-lookup"><span data-stu-id="96ee1-186">Setting Credential Values</span></span>  
 <span data-ttu-id="96ee1-187">选择安全模式后，就必须指定实际凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-187">Once you select a security mode, you must specify the actual credentials.</span></span> <span data-ttu-id="96ee1-188">例如，如果将凭据类型设置为“证书”，那么必须将特定的凭据（例如特定的 X.509 凭据）与服务或客户端相关联。</span><span class="sxs-lookup"><span data-stu-id="96ee1-188">For example, if the credential type is set to "certificate," then you must associate a specific credential (such as a specific X.509 certificate) with the service or client.</span></span>  
  
 <span data-ttu-id="96ee1-189">根据是对服务进行编程还是对客户端进行编程，设置凭据的方法会略有不同。</span><span class="sxs-lookup"><span data-stu-id="96ee1-189">Depending on whether you are programming a service or a client, the method for setting the credential value differs slightly.</span></span>  
  
### <a name="setting-service-credentials"></a><span data-ttu-id="96ee1-190">设置服务凭据</span><span class="sxs-lookup"><span data-stu-id="96ee1-190">Setting Service Credentials</span></span>  
 <span data-ttu-id="96ee1-191">如果使用的是传输模式，且使用 HTTP 作为传输，则必须使用 Internet Information Services (IIS)，或使用证书配置端口。</span><span class="sxs-lookup"><span data-stu-id="96ee1-191">If you are using transport mode, and you are using HTTP as the transport, you must use either Internet Information Services (IIS) or configure the port with a certificate.</span></span> <span data-ttu-id="96ee1-192">有关详细信息，请参阅[传输安全性概述](../../../../docs/framework/wcf/feature-details/transport-security-overview.md)和[HTTP 传输安全](../../../../docs/framework/wcf/feature-details/http-transport-security.md)。</span><span class="sxs-lookup"><span data-stu-id="96ee1-192">For more information, see [Transport Security Overview](../../../../docs/framework/wcf/feature-details/transport-security-overview.md) and [HTTP Transport Security](../../../../docs/framework/wcf/feature-details/http-transport-security.md).</span></span>  
  
 <span data-ttu-id="96ee1-193">若要在代码中使用凭据配置服务，则创建 <xref:System.ServiceModel.ServiceHost> 类的一个实例，并使用 <xref:System.ServiceModel.Description.ServiceCredentials> 类指定适当的凭据，该类可通过 <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> 属性访问。</span><span class="sxs-lookup"><span data-stu-id="96ee1-193">To provision a service with credentials in code, create an instance of the <xref:System.ServiceModel.ServiceHost> class and specify the appropriate credential using the <xref:System.ServiceModel.Description.ServiceCredentials> class, accessed through the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property.</span></span>  
  
#### <a name="setting-a-certificate"></a><span data-ttu-id="96ee1-194">设置证书</span><span class="sxs-lookup"><span data-stu-id="96ee1-194">Setting a Certificate</span></span>  
 <span data-ttu-id="96ee1-195">若要使用 X.509 证书（用于对客户端的服务进行身份验证）配置服务，则使用 <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> 类的 <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> 方法。</span><span class="sxs-lookup"><span data-stu-id="96ee1-195">To provision a service with an X.509 certificate to be used to authenticate the service to clients, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class.</span></span>  
  
 <span data-ttu-id="96ee1-196">若要使用客户端证书配置服务，则使用 <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> 类的 <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential> 方法。</span><span class="sxs-lookup"><span data-stu-id="96ee1-196">To provision a service with a client certificate, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential> class.</span></span>  
  
#### <a name="setting-windows-credentials"></a><span data-ttu-id="96ee1-197">设置 Windows 凭据</span><span class="sxs-lookup"><span data-stu-id="96ee1-197">Setting Windows Credentials</span></span>  
 <span data-ttu-id="96ee1-198">如果客户端指定了有效的用户名和密码，则使用该凭据对客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-198">If the client specifies a valid user name and password, that credential is used to authenticate the client.</span></span> <span data-ttu-id="96ee1-199">否则，使用当前已登录用户的凭据。</span><span class="sxs-lookup"><span data-stu-id="96ee1-199">Otherwise, the current logged-on user's credentials are used.</span></span>  
  
### <a name="setting-client-credentials"></a><span data-ttu-id="96ee1-200">设置客户端凭据</span><span class="sxs-lookup"><span data-stu-id="96ee1-200">Setting Client Credentials</span></span>  
 <span data-ttu-id="96ee1-201">在 WCF 中，客户端应用程序使用 WCF 客户端连接到服务。</span><span class="sxs-lookup"><span data-stu-id="96ee1-201">In WCF, client applications use a WCF client to connect to services.</span></span> <span data-ttu-id="96ee1-202">每个客户端都派生自 <xref:System.ServiceModel.ClientBase%601> 类，且客户端上的 <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> 属性允许客户端凭据的各种值的规范。</span><span class="sxs-lookup"><span data-stu-id="96ee1-202">Every client derives from the <xref:System.ServiceModel.ClientBase%601> class, and the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property on the client allows the specification of various values of client credentials.</span></span>  
  
#### <a name="setting-a-certificate"></a><span data-ttu-id="96ee1-203">设置证书</span><span class="sxs-lookup"><span data-stu-id="96ee1-203">Setting a Certificate</span></span>  
 <span data-ttu-id="96ee1-204">若要使用 X.509 证书（用于对服务的客户端进行身份验证）配置服务，则使用 <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> 类的 <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential> 方法。</span><span class="sxs-lookup"><span data-stu-id="96ee1-204">To provision a service with an X.509 certificate that is used to authenticate the client to a service, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential> class.</span></span>  
  
## <a name="how-client-credentials-are-used-to-authenticate-a-client-to-the-service"></a><span data-ttu-id="96ee1-205">如何使用客户端凭据对服务的客户端进行身份验证</span><span class="sxs-lookup"><span data-stu-id="96ee1-205">How Client Credentials Are Used to Authenticate a Client to the Service</span></span>  
 <span data-ttu-id="96ee1-206">使用 <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> 属性或 <xref:System.ServiceModel.ChannelFactory.Credentials%2A> 属性提供与服务进行通信所需的客户端凭据信息。</span><span class="sxs-lookup"><span data-stu-id="96ee1-206">Client credential information required to communicate with a service is provided using either the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property or the <xref:System.ServiceModel.ChannelFactory.Credentials%2A> property.</span></span> <span data-ttu-id="96ee1-207">安全通道使用此信息对服务的客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-207">The security channel uses this information to authenticate the client to the service.</span></span> <span data-ttu-id="96ee1-208">身份验证可通过以下两种模式之一来实现：</span><span class="sxs-lookup"><span data-stu-id="96ee1-208">Authentication is accomplished through one of two modes:</span></span>  
  
- <span data-ttu-id="96ee1-209">在发送第一条消息之前使用一次客户端凭据，使用 WCF 客户端实例建立安全上下文。</span><span class="sxs-lookup"><span data-stu-id="96ee1-209">The client credentials are used once before the first message is sent, using the WCF client instance to establish a security context.</span></span> <span data-ttu-id="96ee1-210">然后，所有的应用程序消息都通过安全上下文受到保护。</span><span class="sxs-lookup"><span data-stu-id="96ee1-210">All application messages are then secured through the security context.</span></span>  
  
- <span data-ttu-id="96ee1-211">客户端凭据用于对发送到服务的每个应用程序消息进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="96ee1-211">The client credentials are used to authenticate every application message sent to the service.</span></span> <span data-ttu-id="96ee1-212">在这种情况下，未在客户端和服务之间建立上下文。</span><span class="sxs-lookup"><span data-stu-id="96ee1-212">In this case, no context is established between the client and the service.</span></span>  
  
### <a name="established-identities-cannot-be-changed"></a><span data-ttu-id="96ee1-213">已建立的标识无法更改</span><span class="sxs-lookup"><span data-stu-id="96ee1-213">Established Identities Cannot Be Changed</span></span>  
 <span data-ttu-id="96ee1-214">使用第一种方法时，已建立的上下文将与客户端标识永久关联。</span><span class="sxs-lookup"><span data-stu-id="96ee1-214">When the first method is used, the established context is permanently associated with the client identity.</span></span> <span data-ttu-id="96ee1-215">也就是说，一旦建立了安全上下文，就无法更改与客户端相关联的标识。</span><span class="sxs-lookup"><span data-stu-id="96ee1-215">That is, once the security context has been established, the identity associated with the client cannot be changed.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="96ee1-216">无法切换标识时，要格外注意一种情况（即启用建立安全上下文时的默认行为）。</span><span class="sxs-lookup"><span data-stu-id="96ee1-216">There is a situation to be aware of when the identity cannot be switched (that is, when establish security context is on, the default behavior).</span></span> <span data-ttu-id="96ee1-217">如果创建与第二个服务进行通信的服务，则无法更改用于向第二个服务打开 WCF 客户端的标识。</span><span class="sxs-lookup"><span data-stu-id="96ee1-217">If you create a service that communicates with a second service, the identity used to open the WCF client to the second service cannot be changed.</span></span> <span data-ttu-id="96ee1-218">如果允许多个客户端使用第一个服务，且该服务访问第二个服务时将模拟客户端，则这将成为问题所在。</span><span class="sxs-lookup"><span data-stu-id="96ee1-218">This becomes a problem if multiple clients are allowed to use the first service and the service impersonates the clients when accessing the second service.</span></span> <span data-ttu-id="96ee1-219">如果该服务重新使用所有调用方的相同客户端，则对第二个服务的所有调用都是以第一个调用方的标识进行的，该标识用于打开第二个服务的客户端。</span><span class="sxs-lookup"><span data-stu-id="96ee1-219">If the service reuses the same client for all callers, all calls to the second service are done under the identity of the first caller that was used to open the client to the second service.</span></span> <span data-ttu-id="96ee1-220">换言之，该服务将第一个客户端的标识用于它的所有客户端以与第二个服务进行通信。</span><span class="sxs-lookup"><span data-stu-id="96ee1-220">In other words, the service uses the identity of the first client for all its clients to communicate with the second service.</span></span> <span data-ttu-id="96ee1-221">这可以导致特权提升。</span><span class="sxs-lookup"><span data-stu-id="96ee1-221">This can lead to the elevation of privilege.</span></span> <span data-ttu-id="96ee1-222">如果这不是服务所需的行为，就必须跟踪每个调用方并为每个单独的调用方创建第二个服务的新客户端，并确保该服务仅使用正确调用方的正确客户端与第二个服务进行通信。</span><span class="sxs-lookup"><span data-stu-id="96ee1-222">If this is not the desired behavior of your service, you must track each caller and create a new client to the second service for every distinct caller, and ensure that the service uses only the right client for the right caller to communicate with the second service.</span></span>  
  
 <span data-ttu-id="96ee1-223">有关凭据和安全会话的详细信息，请参阅安全[会话的安全注意事项](../../../../docs/framework/wcf/feature-details/security-considerations-for-secure-sessions.md)。</span><span class="sxs-lookup"><span data-stu-id="96ee1-223">For more information about credentials and secure sessions, see [Security Considerations for Secure Sessions](../../../../docs/framework/wcf/feature-details/security-considerations-for-secure-sessions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="96ee1-224">另请参阅</span><span class="sxs-lookup"><span data-stu-id="96ee1-224">See also</span></span>

- <xref:System.ServiceModel.ClientBase%601?displayProperty=nameWithType>
- <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.ClientCredentials.ClientCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.BasicHttpMessageSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.HttpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverHttp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverMsmq.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverTcp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.TcpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A?displayProperty=nameWithType>
- [<span data-ttu-id="96ee1-225">安全性概念</span><span class="sxs-lookup"><span data-stu-id="96ee1-225">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [<span data-ttu-id="96ee1-226">保护服务和客户端的安全</span><span class="sxs-lookup"><span data-stu-id="96ee1-226">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
- [<span data-ttu-id="96ee1-227">WCF 安全编程</span><span class="sxs-lookup"><span data-stu-id="96ee1-227">Programming WCF Security</span></span>](../../../../docs/framework/wcf/feature-details/programming-wcf-security.md)
- [<span data-ttu-id="96ee1-228">HTTP 传输安全性</span><span class="sxs-lookup"><span data-stu-id="96ee1-228">HTTP Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/http-transport-security.md)
