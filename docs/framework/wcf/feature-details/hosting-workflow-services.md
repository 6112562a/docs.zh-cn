---
title: 承载工作流服务
ms.date: 03/30/2017
ms.assetid: 2d55217e-8697-4113-94ce-10b60863342e
ms.openlocfilehash: c933fd2bd46588ccd5c6115fbc2efca72bfadca4
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2019
ms.locfileid: "54594507"
---
# <a name="hosting-workflow-services"></a><span data-ttu-id="28e02-102">承载工作流服务</span><span class="sxs-lookup"><span data-stu-id="28e02-102">Hosting Workflow Services</span></span>
<span data-ttu-id="28e02-103">工作流服务在承载后才能对传入消息做出响应。</span><span class="sxs-lookup"><span data-stu-id="28e02-103">A workflow service must be hosted for it to respond to incoming messages.</span></span> <span data-ttu-id="28e02-104">工作流服务使用的是 WCF 消息传递基础结构，因此承载的方式也类似。</span><span class="sxs-lookup"><span data-stu-id="28e02-104">Workflow services use the WCF messaging infrastructure and are therefore hosted in similar ways.</span></span> <span data-ttu-id="28e02-105">类似于 WCF 服务，工作流服务可以托管在任何托管应用程序在 Internet 信息服务 (IIS) 或 Windows 进程激活服务 (WAS) 下。</span><span class="sxs-lookup"><span data-stu-id="28e02-105">Like WCF services, workflow services can be hosted in any managed application, under Internet Information Services (IIS), or under Windows Process Activation Services (WAS).</span></span> <span data-ttu-id="28e02-106">此外，可以在 Windows Server App Fabric 下承载工作流服务。</span><span class="sxs-lookup"><span data-stu-id="28e02-106">In addition, workflow services can be hosted under Windows Server App Fabric.</span></span> <span data-ttu-id="28e02-107">有关 Windows Server App Fabric 的详细信息请参阅[Windows Server App Fabric 文档](https://go.microsoft.com/fwlink/?LinkId=193037)， [AppFabric 承载功能](https://go.microsoft.com/fwlink/?LinkId=196494)，并[AppFabric 承载概念](https://go.microsoft.com/fwlink/?LinkId=196495)。</span><span class="sxs-lookup"><span data-stu-id="28e02-107">For more information about Windows Server App Fabric see [Windows Server App Fabric documentation](https://go.microsoft.com/fwlink/?LinkId=193037), [AppFabric Hosting Features](https://go.microsoft.com/fwlink/?LinkId=196494), and [AppFabric Hosting Concepts](https://go.microsoft.com/fwlink/?LinkId=196495).</span></span> <span data-ttu-id="28e02-108">服务承载 WCF 的各种不同方法的详细信息，请参阅[托管服务](../../../../docs/framework/wcf/hosting-services.md)。</span><span class="sxs-lookup"><span data-stu-id="28e02-108">For more information about the various ways to host WCF services see [Hosting Services](../../../../docs/framework/wcf/hosting-services.md).</span></span>

## <a name="hosting-in-a-managed-application"></a><span data-ttu-id="28e02-109">在托管应用程序中承载</span><span class="sxs-lookup"><span data-stu-id="28e02-109">Hosting in a managed application</span></span>
 <span data-ttu-id="28e02-110">若要在托管应用程序中承载工作流服务，请使用 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 类。</span><span class="sxs-lookup"><span data-stu-id="28e02-110">To host a workflow service in a managed application, use the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class.</span></span> <span data-ttu-id="28e02-111"><xref:System.ServiceModel.Activities.WorkflowServiceHost> 构造函数可用于指定单一工作流服务实例、工作流服务定义或使用工作流消息传递活动的活动。</span><span class="sxs-lookup"><span data-stu-id="28e02-111">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> constructor allows you to specify a singleton workflow service instance, a workflow service definition, or an activity that uses the workflow messaging activities.</span></span> <span data-ttu-id="28e02-112">调用 <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> 将导致服务开始侦听传入消息。</span><span class="sxs-lookup"><span data-stu-id="28e02-112">Calling <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> causes the service to start listening for incoming messages.</span></span>

## <a name="hosting-under-iis-or-was"></a><span data-ttu-id="28e02-113">在 IIS 或 WAS 下承载</span><span class="sxs-lookup"><span data-stu-id="28e02-113">Hosting under IIS or WAS</span></span>
 <span data-ttu-id="28e02-114">在 IIS 或 WAS 下承载工作流服务时，涉及到创建虚拟目录以及将定义服务及其行为的文件放在该虚拟目录中。</span><span class="sxs-lookup"><span data-stu-id="28e02-114">Hosting a workflow service under IIS or WAS involves creating a virtual directory and placing files in the virtual directory that define the service and its behavior.</span></span> <span data-ttu-id="28e02-115">此时可能出现以下几种情况：</span><span class="sxs-lookup"><span data-stu-id="28e02-115">When hosting a workflow service under IIS or WAS there are several possibilities:</span></span>

-   <span data-ttu-id="28e02-116">将定义工作流服务的 .xamlx 文件放在 IIS/WAS 虚拟目录中，同时放入指定服务行为、终结点和其他配置元素的 Web.config 文件。</span><span class="sxs-lookup"><span data-stu-id="28e02-116">Place a .xamlx file that defines the workflow service in an IIS/WAS virtual directory along with a Web.config file that specifies the service behaviors, endpoints, and other configuration elements.</span></span>

-   <span data-ttu-id="28e02-117">将定义工作流服务的 .xamlx 文件放在一个 IIS/WAS 虚拟目录中。</span><span class="sxs-lookup"><span data-stu-id="28e02-117">Place a .xamlx file that defines the workflow service in an IIS/WAS virtual directory.</span></span> <span data-ttu-id="28e02-118">.xamlx 文件指定要公开的终结点。</span><span class="sxs-lookup"><span data-stu-id="28e02-118">The .xamlx file specifies the endpoints to expose.</span></span> <span data-ttu-id="28e02-119">终结点将在 `WorkflowService.Endpoints` 元素中指定，如下面的示例所示。</span><span class="sxs-lookup"><span data-stu-id="28e02-119">Endpoints are specified in a `WorkflowService.Endpoints` element as shown in the following example.</span></span>

    ```xml
    <WorkflowService xmlns="http://schemas.microsoft.com/netfx/2009/xaml/servicemodel"  xmlns:p1="http://schemas.microsoft.com/netfx/2009/xaml/activities" xmlns:sad="clr-namespace:System.Activities.Debugger;assembly=System.Activities" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
      <WorkflowService.Endpoints>
        <Endpoint ServiceContractName="IWorkFlowEchoService" AddressUri="">
          <Endpoint.Binding>
            <BasicHttpBinding />
          </Endpoint.Binding>
        </Endpoint>
      </WorkflowService.Endpoints>
    <!-- ... -->
    </WorkflowService>
    ```

    > [!NOTE]
    > <span data-ttu-id="28e02-120">不能在 .xamlx 文件中指定行为，因此，如果需要指定行为设置，则必须使用 Web.config。</span><span class="sxs-lookup"><span data-stu-id="28e02-120">Behaviors cannot be specified in a .xamlx file, so you must use a Web.config if you need to specify behavior settings.</span></span>

-   <span data-ttu-id="28e02-121">将定义工作流服务的 .xamlx 文件放在一个 IIS/WAS 虚拟目录中。</span><span class="sxs-lookup"><span data-stu-id="28e02-121">Place a .xamlx file that defines the workflow service in an IIS/WAS virtual directory.</span></span> <span data-ttu-id="28e02-122">另外，将一个 .svc 文件放在该虚拟目录中。</span><span class="sxs-lookup"><span data-stu-id="28e02-122">In addition, place a .svc file in the virtual directory.</span></span> <span data-ttu-id="28e02-123">使用 .svc 文件可以指定自定义 Web 服务主机工厂、应用自定义行为或者从自定义位置加载配置。</span><span class="sxs-lookup"><span data-stu-id="28e02-123">The .svc file allows you to specify a custom Web service host factory, apply custom behavior, or load configuration from a custom location.</span></span>

-   <span data-ttu-id="28e02-124">将一个程序集放在 IIS/WAS 虚拟目录中，该程序集包含一个使用 WCF 消息传递活动的活动。</span><span class="sxs-lookup"><span data-stu-id="28e02-124">Place an assembly in the IIS/WAS virtual directory that contains an activity that uses the WCF messaging activities.</span></span>

 <span data-ttu-id="28e02-125">定义工作流服务的.xamlx 文件必须包含 <`Service`> 根元素或包含派生自任何类型的根元素<xref:System.Workflow.ComponentModel.Activity>。</span><span class="sxs-lookup"><span data-stu-id="28e02-125">A .xamlx file that defines a workflow service must contain a <`Service`> root element or a root element that contains any type derived from <xref:System.Workflow.ComponentModel.Activity>.</span></span> <span data-ttu-id="28e02-126">使用 Visual Studio 活动模板时，将创建.xamlx 文件。</span><span class="sxs-lookup"><span data-stu-id="28e02-126">When using the Visual Studio activity template, a .xamlx file is created.</span></span> <span data-ttu-id="28e02-127">使用 WCF 工作流服务模板时，将创建.xamlx 文件。</span><span class="sxs-lookup"><span data-stu-id="28e02-127">When using the WCF Workflow Service template, a .xamlx file is created.</span></span>

## <a name="hosting-workflow-services-under-windows-server-app-fabric"></a><span data-ttu-id="28e02-128">在 Windows Server App Fabric 下承载工作流服务</span><span class="sxs-lookup"><span data-stu-id="28e02-128">Hosting Workflow Services under Windows Server App Fabric</span></span>
 <span data-ttu-id="28e02-129">在 Windows Server App Fabric 下承载工作流服务的方式与在 IIS/WAS 下的承载方式相同。</span><span class="sxs-lookup"><span data-stu-id="28e02-129">Hosting a workflow service under Windows Server App Fabric is done in the same way as hosting under IIS/WAS.</span></span> <span data-ttu-id="28e02-130">唯一区别在于会安装 Windows Server App Fabric。</span><span class="sxs-lookup"><span data-stu-id="28e02-130">The only difference is the fact that Windows Server App Fabric is installed.</span></span> <span data-ttu-id="28e02-131">Windows Server App Fabric 提供了添加到 Internet 信息服务管理器的工具，以及 powershell commandlets。</span><span class="sxs-lookup"><span data-stu-id="28e02-131">Windows Server App Fabric provides tools that are added to Internet Information Services Manager, as well as powershell commandlets.</span></span> <span data-ttu-id="28e02-132">这些工具可简化工作流服务和 WCF 服务的部署、管理和跟踪。</span><span class="sxs-lookup"><span data-stu-id="28e02-132">These tools simplify deploying, managing, and tracking of workflow services and WCF services.</span></span>

## <a name="referencing-custom-activities"></a><span data-ttu-id="28e02-133">引用自定义活动</span><span class="sxs-lookup"><span data-stu-id="28e02-133">Referencing Custom Activities</span></span>
 <span data-ttu-id="28e02-134">必须将对自定义活动的引用添加到 <`Assemblies`> 部分下 <`System.Web.Compilation`>，以便加载到应用程序域，并且 XAML 反序列化程序能够找到各类型。</span><span class="sxs-lookup"><span data-stu-id="28e02-134">References to custom activities must be added to the <`Assemblies`> section under <`System.Web.Compilation`> so that they are loaded into the Application Domain and the XAML deserializer is able to locate the types.</span></span> <span data-ttu-id="28e02-135">可以在应用程序级别进行这些设置；如果要将这些设置应用于计算机上的所有应用程序，则可在根 Web.config 中进行这些设置。</span><span class="sxs-lookup"><span data-stu-id="28e02-135">These settings can be made at the application level or in the root Web.config if the settings should be applied to all applications on the machine.</span></span>

## <a name="deployment"></a><span data-ttu-id="28e02-136">部署</span><span class="sxs-lookup"><span data-stu-id="28e02-136">Deployment</span></span>
 <span data-ttu-id="28e02-137">系统中已经创建 Web 部署工具，以方便部署作业。</span><span class="sxs-lookup"><span data-stu-id="28e02-137">The Web Deployment tool has been created to make the job of deployment easier.</span></span> <span data-ttu-id="28e02-138">通过使用该工具，可以在 IIS 6.0 和 IIS 7.0 之间迁移应用程序，同步服务器场，并打包、存档和部署 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="28e02-138">The tool allows you to migrate applications between IIS 6.0 and IIS 7.0, synchronize server farms, and package, archive and deploy Web applications.</span></span> <span data-ttu-id="28e02-139">有关详细信息，请参阅[MS 部署工具](https://go.microsoft.com/fwlink/?LinkId=178690)。</span><span class="sxs-lookup"><span data-stu-id="28e02-139">For more information, see [MS Deployment Tool](https://go.microsoft.com/fwlink/?LinkId=178690).</span></span>

## <a name="see-also"></a><span data-ttu-id="28e02-140">请参阅</span><span class="sxs-lookup"><span data-stu-id="28e02-140">See also</span></span>

- [<span data-ttu-id="28e02-141">工作流服务主机内部机制</span><span class="sxs-lookup"><span data-stu-id="28e02-141">Workflow Service Host Internals</span></span>](../../../../docs/framework/wcf/feature-details/workflow-service-host-internals.md)
- [<span data-ttu-id="28e02-142">配置 WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="28e02-142">Configuring WorkflowServiceHost</span></span>](../../../../docs/framework/wcf/feature-details/configuring-workflowservicehost.md)