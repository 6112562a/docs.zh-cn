---
title: 工作流控制终结点
ms.date: 03/30/2017
ms.assetid: 1b883334-1590-4fbb-b0d6-65197efe0700
ms.openlocfilehash: 3c826147d9d3ad452957230adb8f32659b4d1352
ms.sourcegitcommit: 37616676fde89153f563a485fc6159fc57326fc2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/23/2019
ms.locfileid: "69988547"
---
# <a name="workflow-control-endpoint"></a><span data-ttu-id="ecd55-102">工作流控制终结点</span><span class="sxs-lookup"><span data-stu-id="ecd55-102">Workflow Control Endpoint</span></span>
<span data-ttu-id="ecd55-103">开发人员可以使用工作流控制终结点调用控制操作，从而远程控制使用 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 承载的工作流实例。</span><span class="sxs-lookup"><span data-stu-id="ecd55-103">The workflow control endpoint allows developers to call control operations to remotely control workflow instances hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="ecd55-104">可以利用此功能以编程方式执行控制操作，如挂起、继续和终止。</span><span class="sxs-lookup"><span data-stu-id="ecd55-104">This feature can be used to programmatically perform control operations like suspend, resume, and terminate.</span></span>  
  
> [!WARNING]
> <span data-ttu-id="ecd55-105">如果在事务中使用工作流控制终结点, 并且所控制的工作<xref:System.Activities.Statements.Persist>流包含活动, 则工作流实例将被阻止, 直到事务超时。</span><span class="sxs-lookup"><span data-stu-id="ecd55-105">If using the workflow control endpoint within a transaction and the workflow being controlled contains a <xref:System.Activities.Statements.Persist> activity, the workflow instance will block until the transaction times out.</span></span>  
  
## <a name="workflow-instance-management"></a><span data-ttu-id="ecd55-106">工作流实例管理</span><span class="sxs-lookup"><span data-stu-id="ecd55-106">Workflow Instance Management</span></span>  
 [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]<span data-ttu-id="ecd55-107">可定义名为 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 的新协定。</span><span class="sxs-lookup"><span data-stu-id="ecd55-107">defines a new contract called <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement>.</span></span> <span data-ttu-id="ecd55-108">此协定将定义一系列控制操作，这些操作使您能够远程控制由 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 承载的工作流实例。</span><span class="sxs-lookup"><span data-stu-id="ecd55-108">This contract defines a series of control operations that allow you remotely control workflow instances hosted by <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="ecd55-109"><xref:System.ServiceModel.Activities.WorkflowControlEndpoint> 是提供 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 协定的实现的标准终结点。</span><span class="sxs-lookup"><span data-stu-id="ecd55-109"><xref:System.ServiceModel.Activities.WorkflowControlEndpoint> is a standard endpoint that provides an implementation of the <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> contract.</span></span> <span data-ttu-id="ecd55-110"><xref:System.ServiceModel.Activities.WorkflowControlClient> 是一个类，用于将控制操作发送到 <xref:System.ServiceModel.Activities.WorkflowControlEndpoint>。</span><span class="sxs-lookup"><span data-stu-id="ecd55-110"><xref:System.ServiceModel.Activities.WorkflowControlClient> is a class that is used to send the control operations to the <xref:System.ServiceModel.Activities.WorkflowControlEndpoint>.</span></span>  
  
 <span data-ttu-id="ecd55-111">工作流实例可以是以下状态之一：</span><span class="sxs-lookup"><span data-stu-id="ecd55-111">Workflow instances can be in one of the following states:</span></span>  
  
 <span data-ttu-id="ecd55-112">活动的</span><span class="sxs-lookup"><span data-stu-id="ecd55-112">Active</span></span>  
 <span data-ttu-id="ecd55-113">工作流达到完成状态之前并且不处于挂起状态时的状态。</span><span class="sxs-lookup"><span data-stu-id="ecd55-113">The state of a workflow instance before it reaches the completed state and when it is not in the suspended state.</span></span> <span data-ttu-id="ecd55-114">在这种状态下，工作流实例运行并处理应用程序消息。</span><span class="sxs-lookup"><span data-stu-id="ecd55-114">While in this state, the workflow instance runs and processes application messages.</span></span>  
  
 <span data-ttu-id="ecd55-115">挂起的</span><span class="sxs-lookup"><span data-stu-id="ecd55-115">Suspended</span></span>  
 <span data-ttu-id="ecd55-116">处于此状态时，即使有尚未开始运行或已部分运行的活动，工作流实例仍不运行。</span><span class="sxs-lookup"><span data-stu-id="ecd55-116">While in this state, the workflow instance does not run even if there are activities that have not started running or have partially run.</span></span>  
  
 <span data-ttu-id="ecd55-117">已完成</span><span class="sxs-lookup"><span data-stu-id="ecd55-117">Completed</span></span>  
 <span data-ttu-id="ecd55-118">工作流实例的最终状态。</span><span class="sxs-lookup"><span data-stu-id="ecd55-118">The final state of a workflow instance.</span></span> <span data-ttu-id="ecd55-119">工作流实例达到完成状态后，就无法再运行。</span><span class="sxs-lookup"><span data-stu-id="ecd55-119">The workflow instance cannot run after reaching the completed state.</span></span>  
  
## <a name="iworkflowinstancemanagement"></a><span data-ttu-id="ecd55-120">IWorkflowInstanceManagement</span><span class="sxs-lookup"><span data-stu-id="ecd55-120">IWorkflowInstanceManagement</span></span>  
 <span data-ttu-id="ecd55-121"><xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 接口将定义一组具有同步和异步版本的控制操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-121">The <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> interface defines a set of control operations with synchronous and asynchronous versions.</span></span> <span data-ttu-id="ecd55-122">事务处理版本要求使用识别事务处理的绑定。</span><span class="sxs-lookup"><span data-stu-id="ecd55-122">The transacted versions require use of a transaction-aware binding.</span></span> <span data-ttu-id="ecd55-123">下表列出了支持的控制操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-123">The following table lists the control operations supported.</span></span>  
  
|<span data-ttu-id="ecd55-124">控制操作</span><span class="sxs-lookup"><span data-stu-id="ecd55-124">Control Operation</span></span>|<span data-ttu-id="ecd55-125">描述</span><span class="sxs-lookup"><span data-stu-id="ecd55-125">Description</span></span>|  
|-----------------------|-----------------|  
|<span data-ttu-id="ecd55-126">中止</span><span class="sxs-lookup"><span data-stu-id="ecd55-126">Abort</span></span>|<span data-ttu-id="ecd55-127">强制停止执行工作流实例。</span><span class="sxs-lookup"><span data-stu-id="ecd55-127">Forcefully stops the execution of the workflow instance.</span></span>|  
|<span data-ttu-id="ecd55-128">取消</span><span class="sxs-lookup"><span data-stu-id="ecd55-128">Cancel</span></span>|<span data-ttu-id="ecd55-129">将工作流实例从活动或挂起状态转换为完成状态。</span><span class="sxs-lookup"><span data-stu-id="ecd55-129">Transitions a workflow instance from the active or suspended state to the completed state.</span></span>|  
|<span data-ttu-id="ecd55-130">运行</span><span class="sxs-lookup"><span data-stu-id="ecd55-130">Run</span></span>|<span data-ttu-id="ecd55-131">向工作流实例提供执行的机会。</span><span class="sxs-lookup"><span data-stu-id="ecd55-131">Provides a workflow instance the opportunity to execute.</span></span>|  
|<span data-ttu-id="ecd55-132">挂起</span><span class="sxs-lookup"><span data-stu-id="ecd55-132">Suspend</span></span>|<span data-ttu-id="ecd55-133">将工作流实例从活动状态转换为挂起状态。</span><span class="sxs-lookup"><span data-stu-id="ecd55-133">Transitions a workflow instance from the active state to the suspended state.</span></span>|  
|<span data-ttu-id="ecd55-134">终止</span><span class="sxs-lookup"><span data-stu-id="ecd55-134">Terminate</span></span>|<span data-ttu-id="ecd55-135">将工作流实例从活动或挂起状态转换为完成状态。</span><span class="sxs-lookup"><span data-stu-id="ecd55-135">Transitions a workflow instance from the active or suspended state to the completed state.</span></span>|  
|<span data-ttu-id="ecd55-136">取消挂起</span><span class="sxs-lookup"><span data-stu-id="ecd55-136">Unsuspend</span></span>|<span data-ttu-id="ecd55-137">将工作流实例从挂起状态转换为活动状态。</span><span class="sxs-lookup"><span data-stu-id="ecd55-137">Transitions a workflow instance from the suspended state to the active state.</span></span>|  
|<span data-ttu-id="ecd55-138">TransactedCancel</span><span class="sxs-lookup"><span data-stu-id="ecd55-138">TransactedCancel</span></span>|<span data-ttu-id="ecd55-139">在某个事务（从客户端流入或在本地创建）下执行取消操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-139">Performs the Cancel operation under a transaction (flowed in from the client or created locally).</span></span> <span data-ttu-id="ecd55-140">如果系统维护了工作流实例的持久状态，则工作流实例必须在执行此操作期间存在。</span><span class="sxs-lookup"><span data-stu-id="ecd55-140">If the system maintains the durable state of the workflow instance, the workflow instance must be persisted during execution of this operation.</span></span>|  
|<span data-ttu-id="ecd55-141">TransactedRun</span><span class="sxs-lookup"><span data-stu-id="ecd55-141">TransactedRun</span></span>|<span data-ttu-id="ecd55-142">在某个事务（从客户端流入或在本地创建）下执行运行操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-142">Performs the Run operation under a transaction (flowed in from the client or created locally).</span></span> <span data-ttu-id="ecd55-143">如果系统维护了工作流实例的持久状态，则工作流实例必须在执行此操作期间存在。</span><span class="sxs-lookup"><span data-stu-id="ecd55-143">If the system maintains the durable state of the workflow instance, the workflow instance must be persisted during execution of this operation.</span></span>|  
|<span data-ttu-id="ecd55-144">TransactedSuspend</span><span class="sxs-lookup"><span data-stu-id="ecd55-144">TransactedSuspend</span></span>|<span data-ttu-id="ecd55-145">在某个事务（从客户端流入或在本地创建）下执行挂起操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-145">Performs the Suspend operation under a transaction (flowed in from the client or created locally).</span></span> <span data-ttu-id="ecd55-146">如果系统维护了工作流实例的持久状态，则工作流实例必须在执行此操作期间存在。</span><span class="sxs-lookup"><span data-stu-id="ecd55-146">If the system maintains the durable state of the workflow instance, the workflow instance must be persisted during execution of this operation.</span></span>|  
|<span data-ttu-id="ecd55-147">TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="ecd55-147">TransactedTerminate</span></span>|<span data-ttu-id="ecd55-148">在某个事务（从客户端流入或在本地创建）下执行终止操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-148">Performs the Terminate operation under a transaction (flowed in from the client or created locally).</span></span> <span data-ttu-id="ecd55-149">如果系统维护了工作流实例的持久状态，则工作流实例必须在执行此操作期间存在。</span><span class="sxs-lookup"><span data-stu-id="ecd55-149">If the system maintains the durable state of the workflow instance, the workflow instance must be persisted during execution of this operation.</span></span>|  
|<span data-ttu-id="ecd55-150">TransactedUnsuspend</span><span class="sxs-lookup"><span data-stu-id="ecd55-150">TransactedUnsuspend</span></span>|<span data-ttu-id="ecd55-151">在某个事务（从客户端流入或在本地创建）下执行取消挂起操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-151">Performs the Unsuspend operation under a transaction (flowed in from the client or created locally).</span></span> <span data-ttu-id="ecd55-152">如果系统维护了工作流实例的持久状态，则工作流实例必须在执行此操作期间存在。</span><span class="sxs-lookup"><span data-stu-id="ecd55-152">If the system maintains the durable state of the workflow instance, the workflow instance must be persisted during execution of this operation.</span></span>|  
  
 <span data-ttu-id="ecd55-153"><xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 协定无法用于创建新工作流实例，它只能管理现有工作流实例。</span><span class="sxs-lookup"><span data-stu-id="ecd55-153">The <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> contract does not provide a means to create a new workflow instance, only to manage existing workflow instances.</span></span> <span data-ttu-id="ecd55-154">有关远程创建新工作流实例的详细信息, 请参阅[工作流服务主机扩展性](../../../../docs/framework/wcf/feature-details/workflow-service-host-extensibility.md)。</span><span class="sxs-lookup"><span data-stu-id="ecd55-154">For more information about remotely creating a new workflow instance, see [Workflow Service Host Extensibility](../../../../docs/framework/wcf/feature-details/workflow-service-host-extensibility.md).</span></span>  
  
## <a name="workflowcontrolendpoint"></a><span data-ttu-id="ecd55-155">WorkflowControlEndpoint</span><span class="sxs-lookup"><span data-stu-id="ecd55-155">WorkflowControlEndpoint</span></span>  
 <span data-ttu-id="ecd55-156"><xref:System.ServiceModel.Activities.WorkflowControlEndpoint> 是具有固定协定 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 的标准终结点。</span><span class="sxs-lookup"><span data-stu-id="ecd55-156"><xref:System.ServiceModel.Activities.WorkflowControlEndpoint> is a standard endpoint with a fixed contract, <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement>.</span></span> <span data-ttu-id="ecd55-157">将此终结点添加到 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 实例后，可以使用此终结点将命令操作发送到由主机实例承载的任何工作流实例。</span><span class="sxs-lookup"><span data-stu-id="ecd55-157">When added to a <xref:System.ServiceModel.Activities.WorkflowServiceHost> instance, this endpoint can then be used to send command operations to any workflow instance hosted by the host instance.</span></span> <span data-ttu-id="ecd55-158">有关标准终结点的详细信息, 请参阅[标准终结点](../../../../docs/framework/wcf/feature-details/standard-endpoints.md)。</span><span class="sxs-lookup"><span data-stu-id="ecd55-158">For more information about standard endpoints, see [Standard Endpoints](../../../../docs/framework/wcf/feature-details/standard-endpoints.md).</span></span>  
  
## <a name="workflowcontrolclient"></a><span data-ttu-id="ecd55-159">WorkflowControlClient</span><span class="sxs-lookup"><span data-stu-id="ecd55-159">WorkflowControlClient</span></span>  
 <span data-ttu-id="ecd55-160"><xref:System.ServiceModel.Activities.WorkflowControlClient> 是一个类，可用于将控制消息发送到位于 <xref:System.ServiceModel.Activities.WorkflowControlEndpoint> 上的 <xref:System.ServiceModel.Activities.WorkflowServiceHost>。</span><span class="sxs-lookup"><span data-stu-id="ecd55-160"><xref:System.ServiceModel.Activities.WorkflowControlClient> is a class that allows you to send control messages to a <xref:System.ServiceModel.Activities.WorkflowControlEndpoint> on a <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="ecd55-161">它对于 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 协定支持的每个操作包含一个方法，但事务处理的操作除外。</span><span class="sxs-lookup"><span data-stu-id="ecd55-161">It contains a method for each of the operations supported by the <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> contract except for the transacted operations.</span></span> <span data-ttu-id="ecd55-162"><xref:System.ServiceModel.Activities.WorkflowControlClient> 使用环境事务来确定是否应使用事务处理的操作。</span><span class="sxs-lookup"><span data-stu-id="ecd55-162"><xref:System.ServiceModel.Activities.WorkflowControlClient> uses the ambient transaction to determine whether a transacted operation should be used.</span></span>
