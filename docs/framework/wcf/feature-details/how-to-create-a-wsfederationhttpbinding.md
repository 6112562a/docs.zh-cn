---
title: 如何：创建 WSFederationHttpBinding
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: e54897d7-aa6c-46ec-a278-b2430c8c2e10
ms.openlocfilehash: 9728c908331d5eabcff04d094e7fcbe42f636963
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/22/2019
ms.locfileid: "69911212"
---
# <a name="how-to-create-a-wsfederationhttpbinding"></a><span data-ttu-id="3f56c-102">如何：创建 WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="3f56c-102">How to: Create a WSFederationHttpBinding</span></span>

<span data-ttu-id="3f56c-103">在 Windows Communication Foundation (WCF) 中, <xref:System.ServiceModel.WSFederationHttpBinding>类 ([\<](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)在配置中为 wsFederationHttpBinding >) 提供了一种用于公开联合服务的机制。</span><span class="sxs-lookup"><span data-stu-id="3f56c-103">In Windows Communication Foundation (WCF), the <xref:System.ServiceModel.WSFederationHttpBinding> class ([\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) in configuration) provides a mechanism for exposing a federated service.</span></span> <span data-ttu-id="3f56c-104">即，服务要求客户端使用安全令牌服务颁发的安全令牌进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="3f56c-104">That is, a service that requires clients to authenticate using a security token issued by a security token service.</span></span> <span data-ttu-id="3f56c-105">本主题演示如何通过代码和配置来设置 <xref:System.ServiceModel.WSFederationHttpBinding>。</span><span class="sxs-lookup"><span data-stu-id="3f56c-105">This topic shows how to set up a <xref:System.ServiceModel.WSFederationHttpBinding> in both code and configuration.</span></span> <span data-ttu-id="3f56c-106">绑定一经创建，你就可以设置一个终结点来使用该绑定。</span><span class="sxs-lookup"><span data-stu-id="3f56c-106">Once the binding is created, you can set up an endpoint to use that binding.</span></span>

 <span data-ttu-id="3f56c-107">基本步骤概述如下：</span><span class="sxs-lookup"><span data-stu-id="3f56c-107">The basic steps are outlined as follows:</span></span>

1. <span data-ttu-id="3f56c-108">选择一种安全模式。</span><span class="sxs-lookup"><span data-stu-id="3f56c-108">Select a security mode.</span></span> <span data-ttu-id="3f56c-109"><xref:System.ServiceModel.WSFederationHttpBinding> 支持 `Message`，它在消息级提供端对端的安全（即使跨多个跃点也是如此），还支持 `TransportWithMessageCredential`，它在客户端和服务可以通过 HTTPS 直接连接的情况下提供较好的性能。</span><span class="sxs-lookup"><span data-stu-id="3f56c-109">The <xref:System.ServiceModel.WSFederationHttpBinding> supports `Message`, which provides end-to-end security at the message level, even across multiple hops, and `TransportWithMessageCredential`, which provides better performance in cases where the client and the service can make a direct connection over HTTPS.</span></span>

    > [!NOTE]
    > <span data-ttu-id="3f56c-110"><xref:System.ServiceModel.WSFederationHttpBinding> 还支持 `None` 作为安全模式。</span><span class="sxs-lookup"><span data-stu-id="3f56c-110">The <xref:System.ServiceModel.WSFederationHttpBinding> also supports `None` as a security mode.</span></span> <span data-ttu-id="3f56c-111">此模式不安全，仅用于调试目的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-111">This mode is not secure and is provided for debugging purposes only.</span></span> <span data-ttu-id="3f56c-112">如果在<xref:System.ServiceModel.WSFederationHttpBinding>部署服务终结点时将其安全模式设置`None`为, 则生成的客户端绑定 (由 " [svcutil.exe" 元数据实用工具 ()](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)生成) 是一个<xref:System.ServiceModel.WSHttpBinding>安全模式为`None`.</span><span class="sxs-lookup"><span data-stu-id="3f56c-112">If a service endpoint is deployed with a <xref:System.ServiceModel.WSFederationHttpBinding> with its security mode set to `None`, the resulting client binding (generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)) is a <xref:System.ServiceModel.WSHttpBinding> with a security mode of `None`.</span></span>

     <span data-ttu-id="3f56c-113">与其他系统提供的绑定不同，使用 `WSFederationHttpBinding` 时无需选择客户端凭据类型。</span><span class="sxs-lookup"><span data-stu-id="3f56c-113">Unlike other system-provided bindings, it is not necessary to select a client credential type when using the `WSFederationHttpBinding`.</span></span> <span data-ttu-id="3f56c-114">这是因为客户端凭据类型始终为已颁发令牌。</span><span class="sxs-lookup"><span data-stu-id="3f56c-114">This is because the client credential type is always an issued token.</span></span> <span data-ttu-id="3f56c-115">WCF 从指定的颁发者获取一个令牌, 并将该令牌提供给服务以对客户端进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="3f56c-115">WCF acquires a token from a specified issuer and presents that token to the service to authenticate the client.</span></span>

2. <span data-ttu-id="3f56c-116">在联合客户端上，将 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> 属性设置为安全令牌服务的 URL。</span><span class="sxs-lookup"><span data-stu-id="3f56c-116">On federated clients, set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> property to the URL of the security token service.</span></span> <span data-ttu-id="3f56c-117">将 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> 设置为要使用的绑定，以便与安全令牌服务进行通信。</span><span class="sxs-lookup"><span data-stu-id="3f56c-117">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> to the binding to use to communicate with the security token service.</span></span>

3. <span data-ttu-id="3f56c-118">可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-118">Optional.</span></span> <span data-ttu-id="3f56c-119">将 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> 属性设置为令牌类型的统一资源标识符 (URI)。</span><span class="sxs-lookup"><span data-stu-id="3f56c-119">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> property to the Uniform Resource Identifier (URI) of a token type.</span></span> <span data-ttu-id="3f56c-120">在联合服务上，指定服务期望使用的令牌类型。</span><span class="sxs-lookup"><span data-stu-id="3f56c-120">On federated services, specify the token type that the service expects.</span></span> <span data-ttu-id="3f56c-121">在联合客户端上，指定客户端向安全令牌服务请求的令牌类型。</span><span class="sxs-lookup"><span data-stu-id="3f56c-121">On federated clients, specify the token type the client requests from the security token service.</span></span>

     <span data-ttu-id="3f56c-122">如果未指定令牌类型，则默认情况下，客户端将在无令牌类型 URI 的情况下生成 WS-Trust 请求安全令牌 (RST)，而服务希望使用安全断言标记语言 (SAML) 1.1 令牌进行客户端身份验证。</span><span class="sxs-lookup"><span data-stu-id="3f56c-122">If no token type is specified, clients generate WS-Trust Request Security Tokens (RSTs) without a token type URI, and services expect client authentication using a Security Assertions Markup Language (SAML) 1.1 token by default.</span></span>

     <span data-ttu-id="3f56c-123">SAML 1.1 令牌的 URI 是`http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`。</span><span class="sxs-lookup"><span data-stu-id="3f56c-123">The URI for a SAML 1.1 token is `http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`.</span></span>

4. <span data-ttu-id="3f56c-124">可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-124">Optional.</span></span> <span data-ttu-id="3f56c-125">在联合服务上，将 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerMetadataAddress%2A> 属性设置为安全令牌服务的元数据 URL。</span><span class="sxs-lookup"><span data-stu-id="3f56c-125">On federated services, set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerMetadataAddress%2A> property to the metadata URL of a security token service.</span></span> <span data-ttu-id="3f56c-126">使用元数据终结点，服务的客户端可以选择一个适合的绑定/终结点对，前提是将服务配置为发布元数据。</span><span class="sxs-lookup"><span data-stu-id="3f56c-126">The metadata endpoint enables clients of the service to select an appropriate binding/endpoint pair, if the service is configured to publish metadata.</span></span> <span data-ttu-id="3f56c-127">有关发布元数据的详细信息, 请参阅[发布元数据](publishing-metadata.md)。</span><span class="sxs-lookup"><span data-stu-id="3f56c-127">For more information about publishing metadata, see [Publishing Metadata](publishing-metadata.md).</span></span>

 <span data-ttu-id="3f56c-128">你还可以设置其他属性，包括已颁发令牌中用作校验密钥的密钥类型、在客户端和服务之间使用的算法套件、是协商还是显式指定服务凭据、服务期望已颁发令牌中包含的任何特定声明，以及必须添加到由客户端发送到安全令牌服务的请求的其他 XML 元素。</span><span class="sxs-lookup"><span data-stu-id="3f56c-128">You can also set other properties, including the type of key used as a proof key in the issued token, the algorithm suite to use between the client and the service, whether to negotiate or explicitly specify the service credential, any specific claims the service expects the issued token to contain, and any additional XML elements that must be added to the request the client sends to the security token service.</span></span>

> [!NOTE]
> <span data-ttu-id="3f56c-129">仅当 `NegotiateServiceCredential` 设置为 `SecurityMode` 时，`Message` 属性才是相关的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-129">The `NegotiateServiceCredential` property is only relevant when the `SecurityMode` is set to `Message`.</span></span> <span data-ttu-id="3f56c-130">如果将 `SecurityMode` 设置为 `TransportWithMessageCredential`，则将忽略 `NegotiateServiceCredential` 属性。</span><span class="sxs-lookup"><span data-stu-id="3f56c-130">If `SecurityMode` is set to `TransportWithMessageCredential`, then the `NegotiateServiceCredential` property is ignored.</span></span>

## <a name="to-configure-a-wsfederationhttpbinding-in-code"></a><span data-ttu-id="3f56c-131">以代码方式配置 WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="3f56c-131">To configure a WSFederationHttpBinding in code</span></span>

1. <span data-ttu-id="3f56c-132">创建 <xref:System.ServiceModel.WSFederationHttpBinding>的一个实例。</span><span class="sxs-lookup"><span data-stu-id="3f56c-132">Create an instance of the <xref:System.ServiceModel.WSFederationHttpBinding>.</span></span>

2. <span data-ttu-id="3f56c-133">根据需要将 <xref:System.ServiceModel.WSFederationHttpSecurity.Mode%2A> 属性设置为 <xref:System.ServiceModel.WSFederationHttpSecurityMode> 或 <xref:System.ServiceModel.WSFederationHttpSecurityMode.Message>。</span><span class="sxs-lookup"><span data-stu-id="3f56c-133">Set the <xref:System.ServiceModel.WSFederationHttpSecurity.Mode%2A> property to <xref:System.ServiceModel.WSFederationHttpSecurityMode> or <xref:System.ServiceModel.WSFederationHttpSecurityMode.Message> as required.</span></span> <span data-ttu-id="3f56c-134">如果需要除<xref:System.ServiceModel.Security.SecurityAlgorithmSuite.Basic256%2A>之外的算法套件, 请<xref:System.ServiceModel.FederatedMessageSecurityOverHttp.AlgorithmSuite%2A>将属性设置为从中<xref:System.ServiceModel.Security.SecurityAlgorithmSuite>获取的值。</span><span class="sxs-lookup"><span data-stu-id="3f56c-134">If an algorithm suite other than <xref:System.ServiceModel.Security.SecurityAlgorithmSuite.Basic256%2A> is required, set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.AlgorithmSuite%2A> property to a value taken from <xref:System.ServiceModel.Security.SecurityAlgorithmSuite>.</span></span>

3. <span data-ttu-id="3f56c-135">根据需要设置 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="3f56c-135">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> property as appropriate.</span></span>

4. <span data-ttu-id="3f56c-136">将属性设置<xref:System.IdentityModel.Tokens.SecurityKeyType> 为`SymmetricKey`或。 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A>`AsymmetricKey`</span><span class="sxs-lookup"><span data-stu-id="3f56c-136">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> property to <xref:System.IdentityModel.Tokens.SecurityKeyType>`SymmetricKey` or .`AsymmetricKey`</span></span> <span data-ttu-id="3f56c-137">根据需要。</span><span class="sxs-lookup"><span data-stu-id="3f56c-137">as required.</span></span>

5. <span data-ttu-id="3f56c-138">将 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> 属性设置为适当的值。</span><span class="sxs-lookup"><span data-stu-id="3f56c-138">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> property to the appropriate value.</span></span> <span data-ttu-id="3f56c-139">如果未设置任何值, 则 WCF 默认`http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`为, 这表示 SAML 1.1 令牌。</span><span class="sxs-lookup"><span data-stu-id="3f56c-139">If no value is set, WCF defaults to `http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`, which indicates SAML 1.1 tokens.</span></span>

6. <span data-ttu-id="3f56c-140">如果未指定本地颁发者则在客户端上是必需的；在服务上是可选的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-140">Required on the client if no local issuer is specified; optional on the service.</span></span> <span data-ttu-id="3f56c-141">创建一个包含安全令牌服务的地址和标识信息的 <xref:System.ServiceModel.EndpointAddress>，然后将 <xref:System.ServiceModel.EndpointAddress> 实例分配给 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="3f56c-141">Create an <xref:System.ServiceModel.EndpointAddress> that contains the address and identity information of the security token service and assign the <xref:System.ServiceModel.EndpointAddress> instance to the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> property.</span></span>

7. <span data-ttu-id="3f56c-142">如果未指定本地颁发者则在客户端上是必需的；不能在服务上使用。</span><span class="sxs-lookup"><span data-stu-id="3f56c-142">Required on the client if no local issuer is specified; not used on the service.</span></span> <span data-ttu-id="3f56c-143">为创建<xref:System.ServiceModel.Channels.Binding>一个<xref:System.ServiceModel.Channels.Binding> ,并<xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A>将该实例分配给属性。 `SecurityTokenService`</span><span class="sxs-lookup"><span data-stu-id="3f56c-143">Create a <xref:System.ServiceModel.Channels.Binding> for the `SecurityTokenService` and assign the <xref:System.ServiceModel.Channels.Binding> instance to the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> property.</span></span>

8. <span data-ttu-id="3f56c-144">不能在客户端上使用；在服务上可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-144">Not used on the client; optional on the service.</span></span> <span data-ttu-id="3f56c-145">为安全令牌服务的元数据创建一个 <xref:System.ServiceModel.EndpointAddress> 实例，然后将其分配给 `IssuerMetadataAddress` 属性。</span><span class="sxs-lookup"><span data-stu-id="3f56c-145">Create an <xref:System.ServiceModel.EndpointAddress> instance for the metadata of the security token service and assign it to the `IssuerMetadataAddress` property.</span></span>

9. <span data-ttu-id="3f56c-146">在客户端和服务上都是可选的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-146">Optional on both the client and the service.</span></span> <span data-ttu-id="3f56c-147">创建一个或多个 <xref:System.ServiceModel.Security.Tokens.ClaimTypeRequirement> 实例，并将其添加到 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.ClaimTypeRequirements%2A> 属性返回的集合中。</span><span class="sxs-lookup"><span data-stu-id="3f56c-147">Create and add one or more <xref:System.ServiceModel.Security.Tokens.ClaimTypeRequirement> instances to the collection returned by the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.ClaimTypeRequirements%2A> property.</span></span>

10. <span data-ttu-id="3f56c-148">在客户端和服务上都是可选的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-148">Optional on both the client and the service.</span></span> <span data-ttu-id="3f56c-149">创建一个或多个 <xref:System.Xml.XmlElement> 实例，并将其添加到 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.TokenRequestParameters%2A> 属性返回的集合中。</span><span class="sxs-lookup"><span data-stu-id="3f56c-149">Create and add one or more <xref:System.Xml.XmlElement> instances to the collection returned by the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.TokenRequestParameters%2A> property.</span></span>

## <a name="to-create-a-federated-endpoint-in-configuration"></a><span data-ttu-id="3f56c-150">在配置中创建联合终结点</span><span class="sxs-lookup"><span data-stu-id="3f56c-150">To create a federated endpoint in configuration</span></span>

1. <span data-ttu-id="3f56c-151">在应用程序配置文件中, 将[ \<](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) wsFederationHttpBinding > 创建为绑定 > 元素的子元素。 [ \<](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</span><span class="sxs-lookup"><span data-stu-id="3f56c-151">Create a [\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) as a child of the [\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element in the application configuration file.</span></span>

2. <span data-ttu-id="3f56c-152">`name` [创建\<绑定 >](../../../../docs/framework/misc/binding.md)元素[ \<作为 wsFederationHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)的子元素, 并将属性设置为合适的值。</span><span class="sxs-lookup"><span data-stu-id="3f56c-152">Create a [\<binding>](../../../../docs/framework/misc/binding.md) element as a child of [\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) and set the `name` attribute to an appropriate value.</span></span>

3. <span data-ttu-id="3f56c-153">创建元素作为[ \<binding >](../../../../docs/framework/misc/binding.md)元素的子元素。 `<security>`</span><span class="sxs-lookup"><span data-stu-id="3f56c-153">Create a `<security>` element as a child of the [\<binding>](../../../../docs/framework/misc/binding.md) element.</span></span>

4. <span data-ttu-id="3f56c-154">根据需要将 `mode` 元素的 `<security>` 属性设置为 `Message` 或 `TransportWithMessageCredential` 的一个值。</span><span class="sxs-lookup"><span data-stu-id="3f56c-154">Set the `mode` attribute on the `<security>` element to a value of `Message` or `TransportWithMessageCredential`, as required.</span></span>

5. <span data-ttu-id="3f56c-155">创建一个 `<message>` 元素，作为 `<security>` 元素的子元素。</span><span class="sxs-lookup"><span data-stu-id="3f56c-155">Create a `<message>` element as a child of the `<security>` element.</span></span>

6. <span data-ttu-id="3f56c-156">可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-156">Optional.</span></span> <span data-ttu-id="3f56c-157">将 `algorithmSuite` 元素的 `<message>` 属性设置为适当的值。</span><span class="sxs-lookup"><span data-stu-id="3f56c-157">Set the `algorithmSuite` attribute on the `<message>` element with an appropriate value.</span></span> <span data-ttu-id="3f56c-158">默认值为 `Basic256`。</span><span class="sxs-lookup"><span data-stu-id="3f56c-158">The default is `Basic256`.</span></span>

7. <span data-ttu-id="3f56c-159">可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-159">Optional.</span></span> <span data-ttu-id="3f56c-160">如果需要非对称校验密钥，请将 `issuedKeyType` 元素的 `<message>` 属性设置为 `AsymmetricKey`。</span><span class="sxs-lookup"><span data-stu-id="3f56c-160">If an asymmetric proof key is required, set the `issuedKeyType` attribute of the `<message>` element to `AsymmetricKey`.</span></span> <span data-ttu-id="3f56c-161">默认值为 `SymmetricKey`。</span><span class="sxs-lookup"><span data-stu-id="3f56c-161">The default is `SymmetricKey`.</span></span>

8. <span data-ttu-id="3f56c-162">可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-162">Optional.</span></span> <span data-ttu-id="3f56c-163">设置 `issuedTokenType` 元素的 `<message>` 属性。</span><span class="sxs-lookup"><span data-stu-id="3f56c-163">Set the `issuedTokenType` attribute on the `<message>` element.</span></span>

9. <span data-ttu-id="3f56c-164">如果未指定本地颁发者则在客户端上是必需的；在服务上是可选的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-164">Required on the client if no local issuer is specified; optional on the service.</span></span> <span data-ttu-id="3f56c-165">创建一个 `<issuer>` 元素，作为 `<message>` 元素的子元素。</span><span class="sxs-lookup"><span data-stu-id="3f56c-165">Create an `<issuer>` element as a child of the `<message>` element.</span></span>

10. <span data-ttu-id="3f56c-166">将 `address` 属性设置为 `<issuer>` 元素，并指定安全令牌服务接受令牌请求的地址。</span><span class="sxs-lookup"><span data-stu-id="3f56c-166">Set the `address` attribute to the `<issuer>` element and specify the address at which the security token service accepts token requests.</span></span>

11. <span data-ttu-id="3f56c-167">可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-167">Optional.</span></span> <span data-ttu-id="3f56c-168">添加一个 `<identity>` 子元素，并指定安全令牌服务的标识。</span><span class="sxs-lookup"><span data-stu-id="3f56c-168">Add an `<identity>` child element and specify the identity of the security token service</span></span>

12. <span data-ttu-id="3f56c-169">有关详细信息, 请参阅[服务标识和身份验证](service-identity-and-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="3f56c-169">For more information, see [Service Identity and Authentication](service-identity-and-authentication.md).</span></span>

13. <span data-ttu-id="3f56c-170">如果未指定本地颁发者则在客户端上是必需的；不能在服务上使用。</span><span class="sxs-lookup"><span data-stu-id="3f56c-170">Required on the client if no local issuer is specified; not used on the service.</span></span> <span data-ttu-id="3f56c-171">在可用于与 security token service 通信的绑定部分中创建[绑定>元素。\<](../../../../docs/framework/misc/binding.md)</span><span class="sxs-lookup"><span data-stu-id="3f56c-171">Create a [\<binding>](../../../../docs/framework/misc/binding.md) element in the bindings section that can be used to communicate with the security token service.</span></span> <span data-ttu-id="3f56c-172">有关创建绑定的详细信息, 请参阅[如何:在配置](../../../../docs/framework/wcf/how-to-specify-a-service-binding-in-configuration.md)中指定服务绑定。</span><span class="sxs-lookup"><span data-stu-id="3f56c-172">For more information about creating a binding, see [How to: Specify a Service Binding in Configuration](../../../../docs/framework/wcf/how-to-specify-a-service-binding-in-configuration.md).</span></span>

14. <span data-ttu-id="3f56c-173">通过设置 `binding` 元素的 `bindingConfiguration` 和 `<issuer>` 属性，来指定在上一步创建的绑定。</span><span class="sxs-lookup"><span data-stu-id="3f56c-173">Specify the binding created in the previous step by setting the `binding` and `bindingConfiguration` attributes of the `<issuer>` element.</span></span>

15. <span data-ttu-id="3f56c-174">不能在客户端上使用；在服务上可选。</span><span class="sxs-lookup"><span data-stu-id="3f56c-174">Not used on the client; optional on the service.</span></span> <span data-ttu-id="3f56c-175">创建一个`<issuerMetadata>`元素作为 <`message`> 元素的子元素。</span><span class="sxs-lookup"><span data-stu-id="3f56c-175">Create an `<issuerMetadata>` element as a child of the <`message`> element.</span></span> <span data-ttu-id="3f56c-176">然后，在 `address` 元素的 `<issuerMetadata>` 属性中，指定安全令牌服务将要发布其元数据的地址。</span><span class="sxs-lookup"><span data-stu-id="3f56c-176">Then, in an `address` attribute on the `<issuerMetadata>` element, specify the address at which the security token service is to publish its metadata.</span></span> <span data-ttu-id="3f56c-177">还可以选择添加一个 `<identity>` 子元素，并指定安全令牌服务的标识。</span><span class="sxs-lookup"><span data-stu-id="3f56c-177">Optionally, add an `<identity>` child element and specify the identity of the security token service.</span></span>

16. <span data-ttu-id="3f56c-178">在客户端和服务上都是可选的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-178">Optional on both the client and the service.</span></span> <span data-ttu-id="3f56c-179">添加一个 `<claimTypeRequirements>` 元素，将其作为 `<message>` 元素的子元素。</span><span class="sxs-lookup"><span data-stu-id="3f56c-179">Add a `<claimTypeRequirements>` element as a child of the `<message>` element.</span></span> <span data-ttu-id="3f56c-180">通过将[ \<添加 >](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-claimtyperequirements.md)元素添加到`<claimTypeRequirements>`元素`claimType`并使用特性指定声明类型, 指定服务所依赖的必需和可选声明。</span><span class="sxs-lookup"><span data-stu-id="3f56c-180">Specify required and optional claims that the service relies on by adding [\<add>](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-claimtyperequirements.md) elements to the `<claimTypeRequirements>` element and specifying the claim type with the `claimType` attribute.</span></span> <span data-ttu-id="3f56c-181">通过设置 `isOptional` 属性来指定给定的声明是必选的还是可选的。</span><span class="sxs-lookup"><span data-stu-id="3f56c-181">Specify whether a given claim is required or optional by setting the `isOptional` attribute.</span></span>

## <a name="example"></a><span data-ttu-id="3f56c-182">示例</span><span class="sxs-lookup"><span data-stu-id="3f56c-182">Example</span></span>

<span data-ttu-id="3f56c-183">下面的代码示例演示强制设置 `WSFederationHttpBinding` 的代码。</span><span class="sxs-lookup"><span data-stu-id="3f56c-183">The following code sample shows code for setting up a `WSFederationHttpBinding` imperatively.</span></span>

[!code-csharp[c_FederationBinding#2](~/samples/snippets/csharp/VS_Snippets_CFX/c_federationbinding/cs/source.cs#2)]
[!code-vb[c_FederationBinding#2](~/samples/snippets/visualbasic/VS_Snippets_CFX/c_federationbinding/vb/source.vb#2)]

## <a name="see-also"></a><span data-ttu-id="3f56c-184">请参阅</span><span class="sxs-lookup"><span data-stu-id="3f56c-184">See also</span></span>

- [<span data-ttu-id="3f56c-185">联合</span><span class="sxs-lookup"><span data-stu-id="3f56c-185">Federation</span></span>](federation.md)
- [<span data-ttu-id="3f56c-186">联合示例</span><span class="sxs-lookup"><span data-stu-id="3f56c-186">Federation Sample</span></span>](../../../../docs/framework/wcf/samples/federation-sample.md)
- [<span data-ttu-id="3f56c-187">如何：在 WSFederationHttpBinding 上禁用安全会话</span><span class="sxs-lookup"><span data-stu-id="3f56c-187">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)
