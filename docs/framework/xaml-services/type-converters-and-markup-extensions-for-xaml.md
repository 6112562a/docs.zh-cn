---
title: XAML 的类型转换器和标记扩展
ms.date: 03/30/2017
helpviewer_keywords:
- XAML [XAML Services], type converter services
- XAML [XAML Services], value converters
- XAML [XAML Services], markup extension services
- value converters for XAML [XAML Services]
- XAML [XAML Services], service context
ms.assetid: db07a952-05ce-4aa4-b6f9-aac7397d0326
ms.openlocfilehash: dee5ec65993cf20cb57377694f61af092b0ccf26
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/22/2019
ms.locfileid: "69939694"
---
# <a name="type-converters-and-markup-extensions-for-xaml"></a><span data-ttu-id="0af46-102">XAML 的类型转换器和标记扩展</span><span class="sxs-lookup"><span data-stu-id="0af46-102">Type Converters and Markup Extensions for XAML</span></span>
<span data-ttu-id="0af46-103">类型转换器和标记扩展是 XAML 类型系统和 XAML 编写器用来生成对象图组件的两种技术。</span><span class="sxs-lookup"><span data-stu-id="0af46-103">Type converters and markup extensions are two techniques that XAML type systems and XAML writers use to generate object graph components.</span></span> <span data-ttu-id="0af46-104">尽管类型转换器和标记扩展共享一些特征，但它们在 XAML 节点流中以不同的方式表示。</span><span class="sxs-lookup"><span data-stu-id="0af46-104">Although they share some characteristics, type converters and markup extensions are represented differently in a XAML node stream.</span></span> <span data-ttu-id="0af46-105">在本文档集中，类型转换器、标记扩展和类似的构造有时统称为值转换器。</span><span class="sxs-lookup"><span data-stu-id="0af46-105">In this documentation set, type converters, markup extensions, and similar constructs are sometimes collectively referred to as value converters.</span></span>  
  
<a name="value_converters"></a>   
## <a name="value-converters"></a><span data-ttu-id="0af46-106">值转换器</span><span class="sxs-lookup"><span data-stu-id="0af46-106">Value Converters</span></span>  
 <span data-ttu-id="0af46-107">在 XAML 中，值转换器能用于各种方案。</span><span class="sxs-lookup"><span data-stu-id="0af46-107">In XAML, value converters are used for various scenarios.</span></span> <span data-ttu-id="0af46-108">以下列表显示了 XAML 中不同类型的值转换器：</span><span class="sxs-lookup"><span data-stu-id="0af46-108">The following list shows the different types of value converters in XAML:</span></span>  
  
- <span data-ttu-id="0af46-109">类型转换器</span><span class="sxs-lookup"><span data-stu-id="0af46-109">Type converter</span></span>  
  
- <span data-ttu-id="0af46-110">标记扩展</span><span class="sxs-lookup"><span data-stu-id="0af46-110">Markup extension</span></span>  
  
- <span data-ttu-id="0af46-111">值序列化程序</span><span class="sxs-lookup"><span data-stu-id="0af46-111">Value serializer</span></span>  
  
- <span data-ttu-id="0af46-112">为 XAML 文本语法提供逻辑的相关类或支持类</span><span class="sxs-lookup"><span data-stu-id="0af46-112">Related class or support class that provides the logic for a XAML text syntax</span></span>  
  
<a name="type_converters"></a>   
## <a name="type-converters"></a><span data-ttu-id="0af46-113">类型转换器</span><span class="sxs-lookup"><span data-stu-id="0af46-113">Type Converters</span></span>  
 <span data-ttu-id="0af46-114">在 .NET Framework XAML 服务定义中，类型转换器是从 CLR <xref:System.ComponentModel.TypeConverter> 类派生的类。</span><span class="sxs-lookup"><span data-stu-id="0af46-114">In the .NET Framework XAML Services definition, type converters are classes that derive from the CLR <xref:System.ComponentModel.TypeConverter> class.</span></span> <span data-ttu-id="0af46-115"><xref:System.ComponentModel.TypeConverter>是 XAML 存在之前在 Microsoft .NET 框架中的类。</span><span class="sxs-lookup"><span data-stu-id="0af46-115"><xref:System.ComponentModel.TypeConverter> is a class that was in the Microsoft .NET Framework before XAML existed.</span></span> <span data-ttu-id="0af46-116">其最初目的是支持 IDE 属性的属性窗口和类似的基于文本的编辑形式。</span><span class="sxs-lookup"><span data-stu-id="0af46-116">Its original purpose was to support property windows and similar text-based editing metaphors for IDE properties.</span></span> <span data-ttu-id="0af46-117">对 .NET Framework 引入 XAML 则使用 <xref:System.ComponentModel.TypeConverter> 将文本语法（如某一特性值或 XAML 值节点中的）转换为对象。</span><span class="sxs-lookup"><span data-stu-id="0af46-117">The introduction of XAML to .NET Framework uses <xref:System.ComponentModel.TypeConverter> to convert a text syntax (as found in an attribute value or a XAML value node) into an object.</span></span> <span data-ttu-id="0af46-118"><xref:System.ComponentModel.TypeConverter> 还可用于将对象值序列化为文本语法。</span><span class="sxs-lookup"><span data-stu-id="0af46-118"><xref:System.ComponentModel.TypeConverter> can also be used to serialize an object value to text syntax.</span></span> <span data-ttu-id="0af46-119"><xref:System.ComponentModel.TypeConverter>还在 Windows Presentation Foundation (WPF) 和 Windows Communication Foundation (WCF) 中的以前的特定于框架的 XAML 实现中使用。</span><span class="sxs-lookup"><span data-stu-id="0af46-119"><xref:System.ComponentModel.TypeConverter> was also used in previous framework-specific XAML implementations in Windows Presentation Foundation (WPF) and Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="0af46-120">有关 XAML 中 <xref:System.ComponentModel.TypeConverter> 的更多信息，请参见 [Type Converters for XAML Overview](type-converters-for-xaml-overview.md)中特定于框架的 XAML 实现。</span><span class="sxs-lookup"><span data-stu-id="0af46-120">For more information about the <xref:System.ComponentModel.TypeConverter> in XAML, see [Type Converters for XAML Overview](type-converters-for-xaml-overview.md).</span></span>  
  
<a name="markup_extensions"></a>   
## <a name="markup-extensions"></a><span data-ttu-id="0af46-121">标记扩展</span><span class="sxs-lookup"><span data-stu-id="0af46-121">Markup Extensions</span></span>  
 <span data-ttu-id="0af46-122">在 .NET Framework XAML 服务实现中，标记扩展是从 <xref:System.Windows.Markup.MarkupExtension> 类派生的类。</span><span class="sxs-lookup"><span data-stu-id="0af46-122">In the .NET Framework XAML Services implementation, markup extensions are classes that derive from the <xref:System.Windows.Markup.MarkupExtension> class.</span></span> <span data-ttu-id="0af46-123">标记扩展是此窗体中一个源于 XAML 语言的概念。</span><span class="sxs-lookup"><span data-stu-id="0af46-123">Markup extensions are a concept that in this form is originated by the XAML language.</span></span> <span data-ttu-id="0af46-124">你可以将标记扩展视为类似于可扩展转义序列的东西，它会调入服务类以提供其逻辑。</span><span class="sxs-lookup"><span data-stu-id="0af46-124">You can think of a markup extension as being something like an extensible escape sequence that calls into a service class to provide its logic.</span></span> <span data-ttu-id="0af46-125">就标记而言，XAML 处理器普遍通过以文本字符串中一个左大括号 ({) 开头的文本序列来识别标记扩展。</span><span class="sxs-lookup"><span data-stu-id="0af46-125">In terms of markup, XAML processors universally recognize a markup extension by a text sequence that starts with an opening brace ({) in a text string.</span></span>  
  
 <span data-ttu-id="0af46-126">标记扩展不同于类型转换器。</span><span class="sxs-lookup"><span data-stu-id="0af46-126">Markup extensions differ from type converters.</span></span> <span data-ttu-id="0af46-127">类型转换器通常与类型或成员相关联。</span><span class="sxs-lookup"><span data-stu-id="0af46-127">Type converters are typically associated with types or members.</span></span> <span data-ttu-id="0af46-128">当创建对象图或进行序列化期间遇到与那些实体相关联的文本语法时会调用它们。</span><span class="sxs-lookup"><span data-stu-id="0af46-128">They are invoked when an object graph creation or a serialization encounters text syntax that is associated with those entities.</span></span>  
  
 <span data-ttu-id="0af46-129">标记扩展与单一支持服务类相关联，但可以应用于任意成员值。</span><span class="sxs-lookup"><span data-stu-id="0af46-129">Markup extensions are associated with a single supporting service class, but can be applied for any member value.</span></span> <span data-ttu-id="0af46-130">（但是，通过使用服务上下文，你可以实现你的标记扩展以有意将其应用限制为仅对某些成员或目标类型进行应用。）标记扩展可以替代类型转换器关联。</span><span class="sxs-lookup"><span data-stu-id="0af46-130">(However, you can implement your markup extension to deliberately restrict its use to certain members or destination types, by using service context.) Markup extensions can override a type converter association.</span></span> <span data-ttu-id="0af46-131">或者，可将其用于为本来不支持文本语法的成员指定特性值。</span><span class="sxs-lookup"><span data-stu-id="0af46-131">Or you can use them to specify an attribute value for members that would not otherwise support a text syntax.</span></span>  
  
 <span data-ttu-id="0af46-132">有关 XAML 的标记扩展实现模式的详细信息，请参阅 [Markup Extensions for XAML Overview](markup-extensions-for-xaml-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="0af46-132">For more information about the markup extension implementation pattern for XAML, see [Markup Extensions for XAML Overview](markup-extensions-for-xaml-overview.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="0af46-133"><xref:System.Windows.Markup.MarkupExtension> 和 <xref:System.Windows.Markup.ValueSerializer> 类型都在 <xref:System.Windows.Markup> 命名空间内而不是在 <xref:System.Xaml> 命名空间内。</span><span class="sxs-lookup"><span data-stu-id="0af46-133">The <xref:System.Windows.Markup.MarkupExtension> and <xref:System.Windows.Markup.ValueSerializer> types are both in the <xref:System.Windows.Markup> namespace and not in the <xref:System.Xaml> namespace.</span></span> <span data-ttu-id="0af46-134">这并不意味着这些类型是特定于 WPF 或 Windows 窗体技术的, 否则会填充包含字符串`Windows`的 CLR 命名空间。</span><span class="sxs-lookup"><span data-stu-id="0af46-134">This does not imply that these types are specific to either the WPF or Windows Forms technologies that otherwise populate CLR namespaces that contain the string `Windows`.</span></span> <span data-ttu-id="0af46-135"><xref:System.Windows.Markup.MarkupExtension> 和 <xref:System.Windows.Markup.ValueSerializer> 都在 System.Xaml 程序集中，并且没有特定的框架依赖关系。</span><span class="sxs-lookup"><span data-stu-id="0af46-135"><xref:System.Windows.Markup.MarkupExtension> and <xref:System.Windows.Markup.ValueSerializer> are in the System.Xaml assembly and have no specific framework dependency.</span></span> <span data-ttu-id="0af46-136">这些类型存在于 .NET Framework 3.0 的 CLR 命名空间中, 并保留在 .NET Framework 4 的 CLR 命名空间中, 以避免破坏现有 WPF 项目中的引用。</span><span class="sxs-lookup"><span data-stu-id="0af46-136">These types existed in the CLR namespace for .NET Framework 3.0 and remain in the CLR namespace in .NET Framework 4 to avoid breaking references in existing WPF projects.</span></span> <span data-ttu-id="0af46-137">有关详细信息，请参阅 [Types Migrated from WPF to System.Xaml](types-migrated-from-wpf-to-system-xaml.md)。</span><span class="sxs-lookup"><span data-stu-id="0af46-137">For more information, see [Types Migrated from WPF to System.Xaml](types-migrated-from-wpf-to-system-xaml.md).</span></span>  
  
<a name="value_serializers"></a>   
## <a name="value-serializers"></a><span data-ttu-id="0af46-138">值序列化程序</span><span class="sxs-lookup"><span data-stu-id="0af46-138">Value Serializers</span></span>  
 <span data-ttu-id="0af46-139"><xref:System.Windows.Markup.ValueSerializer> 是针对将对象转换为字符串进行了优化的专用的类型转换器。</span><span class="sxs-lookup"><span data-stu-id="0af46-139">A <xref:System.Windows.Markup.ValueSerializer> is a specialized type converter that is optimized for converting an object to a string.</span></span> <span data-ttu-id="0af46-140">XAML 的 <xref:System.Windows.Markup.ValueSerializer> 可能完全不会实现 `ConvertFrom` 方法。</span><span class="sxs-lookup"><span data-stu-id="0af46-140">A <xref:System.Windows.Markup.ValueSerializer> for XAML might not implement the `ConvertFrom` method at all.</span></span> <span data-ttu-id="0af46-141"><xref:System.Windows.Markup.ValueSerializer> 实现以类似于 <xref:System.ComponentModel.TypeConverter> 实现的方式获取服务。</span><span class="sxs-lookup"><span data-stu-id="0af46-141">A <xref:System.Windows.Markup.ValueSerializer> implementation obtains services in a manner that is like a <xref:System.ComponentModel.TypeConverter> implementation.</span></span> <span data-ttu-id="0af46-142">虚方法提供了一个输入 `context` 参数。</span><span class="sxs-lookup"><span data-stu-id="0af46-142">The virtual methods provide an input `context` parameter.</span></span> <span data-ttu-id="0af46-143">`context` 参数的类型为 <xref:System.Windows.Markup.IValueSerializerContext>，它继承自 <xref:System.IServiceProvider> 接口，并具有 <xref:System.IServiceProvider.GetService%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="0af46-143">The `context` parameter is of type <xref:System.Windows.Markup.IValueSerializerContext>, which inherits from the <xref:System.IServiceProvider> interface and has a <xref:System.IServiceProvider.GetService%2A> method.</span></span>  
  
 <span data-ttu-id="0af46-144">在 XAML 类型系统中，对于使用 XAML 节点循环处理进行序列化的 XAML 编写器实现，由其自身的 <xref:System.Xaml.XamlType.ValueSerializer%2A?displayProperty=nameWithType> 属性报告与某一类型或成员相关联的值转换器。</span><span class="sxs-lookup"><span data-stu-id="0af46-144">In the XAML type system and for XAML writer implementations that use XAML node loop processing for serialization, a value converter that is associated with a type or member is reported by its own <xref:System.Xaml.XamlType.ValueSerializer%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0af46-145">执行序列化的 XAML 编写器的含义是，如果存在 <xref:System.Xaml.XamlType.TypeConverter%2A?displayProperty=nameWithType> 和 <xref:System.Xaml.XamlType.ValueSerializer%2A?displayProperty=nameWithType> ，则类型转换器应用于加载路径，值序列化应用于保存路径。</span><span class="sxs-lookup"><span data-stu-id="0af46-145">The meaning to XAML writers that perform serialization is that if a <xref:System.Xaml.XamlType.TypeConverter%2A?displayProperty=nameWithType> and <xref:System.Xaml.XamlType.ValueSerializer%2A?displayProperty=nameWithType> exist, the type converter should be used for the load path and the value serializer should be used for the save path.</span></span> <span data-ttu-id="0af46-146">如果 <xref:System.Xaml.XamlType.TypeConverter%2A?displayProperty=nameWithType> 存在但 <xref:System.Xaml.XamlType.ValueSerializer%2A?displayProperty=nameWithType> 为 `null`，则类型转换器也用于保存路径。</span><span class="sxs-lookup"><span data-stu-id="0af46-146">If <xref:System.Xaml.XamlType.TypeConverter%2A?displayProperty=nameWithType> exists but <xref:System.Xaml.XamlType.ValueSerializer%2A?displayProperty=nameWithType> is `null`, the type converter is also used for the save path.</span></span>  
  
<a name="other_value_converters"></a>   
## <a name="other-value-converters"></a><span data-ttu-id="0af46-147">其他值转换器</span><span class="sxs-lookup"><span data-stu-id="0af46-147">Other Value Converters</span></span>  
 <span data-ttu-id="0af46-148">值转换器具有超越类型转换器或标记扩展的特定模式的可扩展性。</span><span class="sxs-lookup"><span data-stu-id="0af46-148">A value converter is extensible beyond the specific patterns of a type converter or a markup extension.</span></span> <span data-ttu-id="0af46-149">但是，此自定义也需要由 .NET Framework XAML 服务提供的 XAML 类型系统的重新定义。</span><span class="sxs-lookup"><span data-stu-id="0af46-149">However, this customization would also require the redefinition of the XAML type system as provided by .NET Framework XAML Services.</span></span> <span data-ttu-id="0af46-150">现有的 XAML 类型系统具有针对类型转换器、标记扩展和值序列化程序（而无针对值转换的自定义窗体的）的表示形式和报告系统。</span><span class="sxs-lookup"><span data-stu-id="0af46-150">The existing XAML type system has representations and reporting systems for type converters, markup extensions, and value serializers, but not for custom forms of value conversion.</span></span> <span data-ttu-id="0af46-151">如果你想要创建自定义值转换器，请使用 <xref:System.Xaml.Schema.XamlValueConverter%601> 类型。</span><span class="sxs-lookup"><span data-stu-id="0af46-151">If you want to create custom value converters, use the <xref:System.Xaml.Schema.XamlValueConverter%601> type.</span></span>  
  
<a name="type_converters_and_markup_extensions_in_combination"></a>   
## <a name="type-converters-and-markup-extensions-in-combination"></a><span data-ttu-id="0af46-152">组合使用类型转换器和标记扩展</span><span class="sxs-lookup"><span data-stu-id="0af46-152">Type Converters and Markup Extensions in Combination</span></span>  
 <span data-ttu-id="0af46-153">标记扩展和类型转换器在 XAML 中用于不同情况。</span><span class="sxs-lookup"><span data-stu-id="0af46-153">Markup extensions and type converters are used for different situations in XAML.</span></span> <span data-ttu-id="0af46-154">尽管上下文可用于标记扩展用途，但通常不会在标记扩展实现中检查属性的类型转换行为（其中标记扩展提供了一个值）。</span><span class="sxs-lookup"><span data-stu-id="0af46-154">Although context is available for markup extension usages, type conversion behavior of properties where a markup extension provides a value is generally is not checked in the markup extension implementations.</span></span> <span data-ttu-id="0af46-155">换言之，即使标记扩展返回一个文本字符串作为其 `ProvideValue` 输出，该字符串上应用于特定属性或属性值类型的类型转换行为也不会被调用。</span><span class="sxs-lookup"><span data-stu-id="0af46-155">In other words, even if a markup extension returns a text string as its `ProvideValue` output, type conversion behavior on that string as applied to a specific property or property value type is not invoked.</span></span> <span data-ttu-id="0af46-156">通常，标记扩展的目的是处理字符串并返回不涉及任意类型转换器的对象。</span><span class="sxs-lookup"><span data-stu-id="0af46-156">Generally, the purpose of a markup extension is to process a string and return an object without any type converter involved.</span></span>  
  
<a name="service_context_for_a_value_converter"></a>   
## <a name="service-context-for-a-value-converter"></a><span data-ttu-id="0af46-157">值转换器的服务上下文</span><span class="sxs-lookup"><span data-stu-id="0af46-157">Service Context for a Value Converter</span></span>  
 <span data-ttu-id="0af46-158">当实现值转换器时，你经常需要访问在其中应用了值转换器的上下文。</span><span class="sxs-lookup"><span data-stu-id="0af46-158">When you implement a value converter, you often need access to a context in which the value converter is applied.</span></span> <span data-ttu-id="0af46-159">此上下文称为服务上下文。</span><span class="sxs-lookup"><span data-stu-id="0af46-159">This context is known as the service context.</span></span> <span data-ttu-id="0af46-160">服务上下文可能包括如下信息：活动的 XAML 架构上下文、对 XAML 架构上下文和 XAML 对象编写器提供的类型映射系统的访问权限等等。</span><span class="sxs-lookup"><span data-stu-id="0af46-160">The service context might include information such as the active XAML schema context, access to the type mapping system that the XAML schema context and XAML object writer provide, and so on.</span></span> <span data-ttu-id="0af46-161">有关可用与值转换器的服务上下文和如何访问服务上下文可能会提供的服务的详细信息，请参阅[可供类型转换器和标记扩展使用的服务上下文](service-contexts-available-to-type-converters-and-markup-extensions.md)。</span><span class="sxs-lookup"><span data-stu-id="0af46-161">For more information about the service contexts available for a value converter and how to access the services that a service context might provide, see [Service Contexts Available to Type Converters and Markup Extensions](service-contexts-available-to-type-converters-and-markup-extensions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0af46-162">请参阅</span><span class="sxs-lookup"><span data-stu-id="0af46-162">See also</span></span>

- <xref:System.Windows.Markup.MarkupExtension>
- <xref:System.Xaml.XamlObjectWriter>
- [<span data-ttu-id="0af46-163">XAML 的标记扩展概述</span><span class="sxs-lookup"><span data-stu-id="0af46-163">Markup Extensions for XAML Overview</span></span>](markup-extensions-for-xaml-overview.md)
- [<span data-ttu-id="0af46-164">XAML 的类型转换器概述</span><span class="sxs-lookup"><span data-stu-id="0af46-164">Type Converters for XAML Overview</span></span>](type-converters-for-xaml-overview.md)
- [<span data-ttu-id="0af46-165">Service Contexts Available to Type Converters and Markup Extensions</span><span class="sxs-lookup"><span data-stu-id="0af46-165">Service Contexts Available to Type Converters and Markup Extensions</span></span>](service-contexts-available-to-type-converters-and-markup-extensions.md)
