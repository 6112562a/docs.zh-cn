---
title: XAML 中的空白处理
ms.date: 03/30/2017
helpviewer_keywords:
- East Asian characters [XAML Services]
- XAML [XAML Services], white-space processing
- white-space processing in XAML [XAML Services]
- characters [XAML Services], East Asian
ms.assetid: cc9cc377-7544-4fd0-b65b-117b90bb0b23
ms.openlocfilehash: 05f28c9115326424164b92e1b704c52bba31cf35
ms.sourcegitcommit: c2d9718996402993cf31541f11e95531bc68bad0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/27/2020
ms.locfileid: "81432844"
---
# <a name="white-space-processing-in-xaml"></a><span data-ttu-id="33941-102">XAML 中的空白处理</span><span class="sxs-lookup"><span data-stu-id="33941-102">White-space processing in XAML</span></span>

<span data-ttu-id="33941-103">XAML 的语言规则规定，[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]重要的空白必须由处理器实现处理。</span><span class="sxs-lookup"><span data-stu-id="33941-103">The language rules for XAML state that significant white space must be processed by a [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] processor implementation.</span></span> <span data-ttu-id="33941-104">本文记录这些 XAML 语言规则。</span><span class="sxs-lookup"><span data-stu-id="33941-104">This article documents these XAML language rules.</span></span> <span data-ttu-id="33941-105">它还记录了由 XAML 处理器和 XAML 写入器[!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)]实现序列化定义的其他空白处理。</span><span class="sxs-lookup"><span data-stu-id="33941-105">It also documents additional white-space handling that is defined by the [!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)] implementation of the XAML processor and the XAML writer for serialization.</span></span>

## <a name="white-space-definition"></a><span data-ttu-id="33941-106">空白定义</span><span class="sxs-lookup"><span data-stu-id="33941-106">White-space definition</span></span>

<span data-ttu-id="33941-107">与 XML 一致，中[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]的空白字符是空格、换行符和选项卡。它们分别对应于 Unicode 值 0020、000A 和 0009。</span><span class="sxs-lookup"><span data-stu-id="33941-107">Consistent with XML, white-space characters in [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] are space, linefeed, and tab. These correspond to the Unicode values 0020, 000A, and 0009 respectively.</span></span>

## <a name="white-space-normalization"></a><span data-ttu-id="33941-108">空白规范化</span><span class="sxs-lookup"><span data-stu-id="33941-108">White-space normalization</span></span>

<span data-ttu-id="33941-109">默认情况下，当[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]处理器处理[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]文件时，将发生以下空白规范化：</span><span class="sxs-lookup"><span data-stu-id="33941-109">By default the following white-space normalization occurs when a [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] processor processes a [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] file:</span></span>

1. <span data-ttu-id="33941-110">删除中文字符间的换行符。</span><span class="sxs-lookup"><span data-stu-id="33941-110">Linefeed characters between East Asian characters are removed.</span></span> <span data-ttu-id="33941-111">有关此术语的定义，请稍后参阅本主题中的“中文字符”一节。</span><span class="sxs-lookup"><span data-stu-id="33941-111">See the "East Asian Characters" section later in this topic for a definition of this term.</span></span>

2. <span data-ttu-id="33941-112">所有空白字符（空格、换行符、选项卡）都将转换为空格。</span><span class="sxs-lookup"><span data-stu-id="33941-112">All white-space characters (space, linefeed, tab) are converted into spaces.</span></span>

3. <span data-ttu-id="33941-113">删除所有连续的空格，并替换为一个空格。</span><span class="sxs-lookup"><span data-stu-id="33941-113">All consecutive spaces are deleted and replaced by one space.</span></span>

4. <span data-ttu-id="33941-114">删除开始标记后紧跟的一个空格。</span><span class="sxs-lookup"><span data-stu-id="33941-114">A space immediately following the start tag is deleted.</span></span>

5. <span data-ttu-id="33941-115">删除结束标记前紧跟的一个空格。</span><span class="sxs-lookup"><span data-stu-id="33941-115">A space immediately before the end tag is deleted.</span></span>

<span data-ttu-id="33941-116">“默认”对应于由 [xml: space](xml-space-handling.md) 属性的默认值表示的状态。</span><span class="sxs-lookup"><span data-stu-id="33941-116">"Default" corresponds to the state denoted by the default value of the [xml:space](xml-space-handling.md) attribute.</span></span>

## <a name="white-space-in-inner-text-and-string-primitives"></a><span data-ttu-id="33941-117">内部文本中的空白和字符串基元</span><span class="sxs-lookup"><span data-stu-id="33941-117">White space in inner text, and string primitives</span></span>

<span data-ttu-id="33941-118">先前的标准化规则适用于 XAML 元素中找到的内部文本。</span><span class="sxs-lookup"><span data-stu-id="33941-118">The previous normalization rules apply to inner text that is found within XAML  elements.</span></span> <span data-ttu-id="33941-119">标准化后，XAML 处理器将所有内部文本转换为适当的类型，如下所示：</span><span class="sxs-lookup"><span data-stu-id="33941-119">After normalization, a XAML  processor converts any inner text into an appropriate type as follows:</span></span>

- <span data-ttu-id="33941-120">如果属性的类型不是一个集合，但不直接是 <xref:System.Object> 类型，则 XAML 处理器会尝试使用其类型转换器来转换为该类型。</span><span class="sxs-lookup"><span data-stu-id="33941-120">If the type of the property is not a collection but is not directly an <xref:System.Object> type, the XAML  processor attempts to convert to that type by using its type converter.</span></span> <span data-ttu-id="33941-121">此处的转换失败将导致编译时错误。</span><span class="sxs-lookup"><span data-stu-id="33941-121">A failed conversion here causes a compile-time error.</span></span>

- <span data-ttu-id="33941-122">如果该属性的类型是一个集合，并且内部文本是连续的（无干扰元素标记），则内部文本解析为单个 <xref:System.String>。</span><span class="sxs-lookup"><span data-stu-id="33941-122">If the type of the property is a collection and the inner text is contiguous (no intervening element tags), the inner text is parsed as a single <xref:System.String>.</span></span> <span data-ttu-id="33941-123">如果集合类型不能接受 <xref:System.String>，这也会导致编译时错误。</span><span class="sxs-lookup"><span data-stu-id="33941-123">If the collection type cannot accept <xref:System.String>, this also causes a compile-time error.</span></span>

- <span data-ttu-id="33941-124">如果该属性的类型为 <xref:System.Object>，则内部文本解析为单个 <xref:System.String>。</span><span class="sxs-lookup"><span data-stu-id="33941-124">If the type of the property is <xref:System.Object>, the inner text is parsed as a single <xref:System.String>.</span></span> <span data-ttu-id="33941-125">如果存在干扰元素标记，这将导致编译时错误，因为 <xref:System.Object> 类型表示单个对象（<xref:System.String> 或其他）。</span><span class="sxs-lookup"><span data-stu-id="33941-125">If there are intervening element tags, this causes a compile-time error because the <xref:System.Object> type implies a single object (<xref:System.String> or otherwise).</span></span>

- <span data-ttu-id="33941-126">如果属性的类型是一个集合，并且内部文本是不连续的，则第一个子字符串将转换为 <xref:System.String> 并添加为集合项，干扰元素将添加为集合项，并且最后尾随的子字符串（如果有）将作为第三个 <xref:System.String> 项添加到集合。</span><span class="sxs-lookup"><span data-stu-id="33941-126">If the type of the property is a collection, and the inner text is not contiguous, the first substring is converted into a <xref:System.String> and added as a collection item, the intervening element is added as a collection item, and finally the trailing substring (if any) is added to the collection as a third <xref:System.String> item.</span></span>

## <a name="preserving-white-space"></a><span data-ttu-id="33941-127">保留空白</span><span class="sxs-lookup"><span data-stu-id="33941-127">Preserving white space</span></span>

<span data-ttu-id="33941-128">有几个技术用于保留源[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]中的空白，以便最终呈现不受[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]处理器空白规范化的影响。</span><span class="sxs-lookup"><span data-stu-id="33941-128">There are several techniques for preserving white space in the source [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] for eventual presentation that are not affected by [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] processor white-space normalization.</span></span>

<span data-ttu-id="33941-129">**xml：space="保留"：** 在需要空白保留的元素级别指定此属性。</span><span class="sxs-lookup"><span data-stu-id="33941-129">**xml:space="preserve"**: Specify this attribute at the level of the element where white-space preservation is desired.</span></span> <span data-ttu-id="33941-130">这样保留了所有的空格，其中包括可能由代码编辑应用程序添加到“优质打印”对齐元素以作为可视化直观嵌套的空格。</span><span class="sxs-lookup"><span data-stu-id="33941-130">This preserves all white space, which includes the spaces that might be added by code-editing applications to "pretty-print" align elements as a visually intuitive nesting.</span></span> <span data-ttu-id="33941-131">但是，是否呈现这些空白是由包含元素的内容模型决定的。</span><span class="sxs-lookup"><span data-stu-id="33941-131">However, whether those spaces render is determined by the content model for the containing element.</span></span> <span data-ttu-id="33941-132">避免在`xml:space="preserve"`根级别指定，因为无论如何设置属性，大多数对象模型都不认为空白很重要。</span><span class="sxs-lookup"><span data-stu-id="33941-132">Avoid specifying `xml:space="preserve"` at the root level because most object models do not consider white space as significant regardless of how you set the attribute.</span></span> <span data-ttu-id="33941-133">全局设置 `xml:space` 可能对 XAML 在某些实现中的处理（特别是序列化）产生性能后果。</span><span class="sxs-lookup"><span data-stu-id="33941-133">Setting `xml:space` globally may have performance consequences on XAML processing (particularly serialization) in some implementations.</span></span> <span data-ttu-id="33941-134">最好仅将属性设置为在字符串中呈现空白或为空白重要集合的元素级别。</span><span class="sxs-lookup"><span data-stu-id="33941-134">It is a better practice to only set the attribute specifically at the level of elements that render white space within strings, or are white-space significant collections.</span></span>

<span data-ttu-id="33941-135">**实体和非破断空格**：[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]支持将任何 Unicode 实体放置在文本对象模型中。</span><span class="sxs-lookup"><span data-stu-id="33941-135">**Entities and non-breaking spaces**: [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] supports placing any Unicode entity within a text object model.</span></span> <span data-ttu-id="33941-136">您可以使用专用实体，如非中断空间（&\#160;在 UTF-8 编码中）。</span><span class="sxs-lookup"><span data-stu-id="33941-136">You can use dedicated entities such as nonbreaking space (&\#160; in UTF-8 encoding).</span></span> <span data-ttu-id="33941-137">还可以使用支持不间断空格字符的富文本控件。</span><span class="sxs-lookup"><span data-stu-id="33941-137">You can also use rich text controls that support nonbreaking space characters.</span></span> <span data-ttu-id="33941-138">如果使用实体来模拟布局特征（例如缩进），则应当小心，因为实体的运行时输出将根据更大数量的因素变化，而不是根据在典型布局系统中产生缩进结果的能力，如面板和边距的正确使用。</span><span class="sxs-lookup"><span data-stu-id="33941-138">You should be cautious if you are using entities to simulate layout characteristics such as indention, because the run-time output of the entities will vary based on a greater number of factors than would the capabilities for producing indention results in a typical layout system, such as proper use of panels and margins.</span></span> <span data-ttu-id="33941-139">例如，实体映射到字体，并且可以响应用户的字体选择更改大小。</span><span class="sxs-lookup"><span data-stu-id="33941-139">For instance, entities are mapped to fonts and can change size in response to user font selection.</span></span>

## <a name="east-asian-characters"></a><span data-ttu-id="33941-140">东亚字符</span><span class="sxs-lookup"><span data-stu-id="33941-140">East Asian characters</span></span>

<span data-ttu-id="33941-141">"东亚字符"定义为一组 Unicode 字符范围 U+20000 到 U+2FFFD 和 U=30000 到 U+3FFFD。</span><span class="sxs-lookup"><span data-stu-id="33941-141">"East Asian characters" is defined as a set of Unicode character ranges U+20000 to U+2FFFD and U+30000 to U+3FFFD.</span></span> <span data-ttu-id="33941-142">此子集有时也称为“CJK 表意文字”。</span><span class="sxs-lookup"><span data-stu-id="33941-142">This subset is also sometimes referred to as "CJK ideographs".</span></span> <span data-ttu-id="33941-143">有关详细信息，请参阅 <https://www.unicode.org>。</span><span class="sxs-lookup"><span data-stu-id="33941-143">For more information, see <https://www.unicode.org>.</span></span>

## <a name="white-space-and-text-content-models"></a><span data-ttu-id="33941-144">空白和文本内容模型</span><span class="sxs-lookup"><span data-stu-id="33941-144">White space and text content models</span></span>

<span data-ttu-id="33941-145">实际上，保留空白只是所有可能内容模型的子集所关心的。</span><span class="sxs-lookup"><span data-stu-id="33941-145">In practice, preserving white space is only of concern for a subset of all possible content models.</span></span> <span data-ttu-id="33941-146">该子集由内容模型组成，这些模型可以采用某种形式的单独 <xref:System.String> 类型、专用 <xref:System.String> 集合，或 <xref:System.String> 和 <xref:System.Collections.IList> 或 <xref:System.Collections.Generic.ICollection%601> 集合中其他类型的混合。</span><span class="sxs-lookup"><span data-stu-id="33941-146">That subset is composed of content models that can take a singleton <xref:System.String> type in some form, a dedicated <xref:System.String> collection, or a mixture of <xref:System.String> and other types in an <xref:System.Collections.IList> or <xref:System.Collections.Generic.ICollection%601> collection.</span></span>

### <a name="white-space-and-text-content-models-in-wpf"></a><span data-ttu-id="33941-147">WPF 中的空白和文本内容模型</span><span class="sxs-lookup"><span data-stu-id="33941-147">White space and text content models in WPF</span></span>

<span data-ttu-id="33941-148">为了便于说明，此部分的其余部分引用由 WPF 定义的特定类型。</span><span class="sxs-lookup"><span data-stu-id="33941-148">For illustration purposes, the remainder of this section references particular types that are defined by WPF.</span></span> <span data-ttu-id="33941-149">本文中描述的空白处理功能与 .NET XAML 服务和 WPF 相关。</span><span class="sxs-lookup"><span data-stu-id="33941-149">The white-space handling features that are described in this article are pertinent to both .NET XAML Services and WPF.</span></span> <span data-ttu-id="33941-150">若要查看运行中的此行为，可以使用一些 WPF XAML 标记进行试验，在对象图中查看结果，然后重新序列化为标记。</span><span class="sxs-lookup"><span data-stu-id="33941-150">To see this behavior in action, you might experiment with some WPF XAML markup, view the results in an object graph, and then serialize back to markup again.</span></span>

<span data-ttu-id="33941-151">即使对于可以采用字符串的内容模型，这些内容模型中的默认行为是保留的任何空白都不被视为重要。</span><span class="sxs-lookup"><span data-stu-id="33941-151">Even for content models that can take strings, the default behavior within these content models is that any white space that remains is not treated as significant.</span></span> <span data-ttu-id="33941-152">例如，<xref:System.Windows.Controls.ListBox>采用 ，<xref:System.Collections.IList>但空格（如每个<xref:System.Windows.Controls.ListBoxItem>）之间的换行符不保留且不呈现。</span><span class="sxs-lookup"><span data-stu-id="33941-152">For example, <xref:System.Windows.Controls.ListBox> takes an <xref:System.Collections.IList>, but the white space (such as linefeeds between each <xref:System.Windows.Controls.ListBoxItem>) is not preserved and not rendered.</span></span> <span data-ttu-id="33941-153">如果尝试使用换行符作为 <xref:System.Windows.Controls.ListBoxItem> 项的字符串之间的分隔符，则完全不适用；由换行符分隔的字符串将被视为一个字符串和一个项。</span><span class="sxs-lookup"><span data-stu-id="33941-153">If you attempt to use linefeeds as separators between strings for <xref:System.Windows.Controls.ListBoxItem> items, it does not work at all; the strings that are separated by the linefeeds are treated as one string and one item.</span></span>

<span data-ttu-id="33941-154">那些确实将空白视为重要集合通常是流文档模型的一部分。</span><span class="sxs-lookup"><span data-stu-id="33941-154">Those collections that do treat white space as significant are typically part of the flow document model.</span></span> <span data-ttu-id="33941-155">支持空白保存行为的主要集合是<xref:System.Windows.Documents.InlineCollection>。</span><span class="sxs-lookup"><span data-stu-id="33941-155">The primary collection that supports white-space preservation behavior is <xref:System.Windows.Documents.InlineCollection>.</span></span> <span data-ttu-id="33941-156">此集合类使用 声明<xref:System.Windows.Markup.WhitespaceSignificantCollectionAttribute>。找到此属性后，[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]处理器会将集合中的空白视为重要空间。</span><span class="sxs-lookup"><span data-stu-id="33941-156">This collection class is declared with the <xref:System.Windows.Markup.WhitespaceSignificantCollectionAttribute>; when this attribute is found, the [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] processor will treat white space within the collection as significant.</span></span> <span data-ttu-id="33941-157">表示集合中的`xml:space="preserve"`和空白的组合是保留和呈现所有空白。 <xref:System.Windows.Markup.WhitespaceSignificantCollectionAttribute></span><span class="sxs-lookup"><span data-stu-id="33941-157">The combination of `xml:space="preserve"` and white space within a <xref:System.Windows.Markup.WhitespaceSignificantCollectionAttribute> denoted collection is that all white space is preserved and rendered.</span></span> <span data-ttu-id="33941-158">中`xml:space="default"`<xref:System.Windows.Markup.WhitespaceSignificantCollectionAttribute>的空白和空白的组合会导致前面描述的初始空白规范化，该规范化在某些位置留下一个空格，这些空间将保留并呈现。</span><span class="sxs-lookup"><span data-stu-id="33941-158">The combination of `xml:space="default"` and white space within a <xref:System.Windows.Markup.WhitespaceSignificantCollectionAttribute> causes the initial white-space normalization described earlier, which leaves one space in certain positions, and those spaces are preserved and rendered.</span></span> <span data-ttu-id="33941-159">需要哪种行为由你决定，并且应有选择地使用 `xml:space` 以启用需要的行为。</span><span class="sxs-lookup"><span data-stu-id="33941-159">Which behavior is desirable is up to you, and you should use `xml:space` selectively to enable the behavior that you want.</span></span>

<span data-ttu-id="33941-160">此外，某些内联元素表示流文档模型中的换行符，即使在空白重要集合中，也不应引入额外的空间。</span><span class="sxs-lookup"><span data-stu-id="33941-160">Also, certain inline elements that connote a line break in a flow document model should deliberately not introduce an extra space even in a white-space significant collection.</span></span> <span data-ttu-id="33941-161">例如，<xref:System.Windows.Documents.LineBreak>元素的用途与 HTML 中的\<BR/> 标记相同，对于标记中的可读性，通常由<xref:System.Windows.Documents.LineBreak>创作的换行符与任何后续文本分隔。</span><span class="sxs-lookup"><span data-stu-id="33941-161">For example, the <xref:System.Windows.Documents.LineBreak> element has the same purpose as the \<BR/> tag in HTML, and for readability in markup, typically a <xref:System.Windows.Documents.LineBreak> is separated from any subsequent text by an authored linefeed.</span></span> <span data-ttu-id="33941-162">不应标准化该换行符以使它成为后续行中的前导空格。</span><span class="sxs-lookup"><span data-stu-id="33941-162">That linefeed should not be normalized to become a leading space in the subsequent line.</span></span> <span data-ttu-id="33941-163">为了启用<xref:System.Windows.Documents.LineBreak>该行为，元素的类定义应用 ，<xref:System.Windows.Markup.TrimSurroundingWhitespaceAttribute>[!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]然后由处理器解释该定义意味着周围的<xref:System.Windows.Documents.LineBreak>空白始终被修剪。</span><span class="sxs-lookup"><span data-stu-id="33941-163">To enable that behavior, the class definition for the <xref:System.Windows.Documents.LineBreak> element applies the <xref:System.Windows.Markup.TrimSurroundingWhitespaceAttribute>, which is then interpreted by the [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] processor to mean that white space surrounding <xref:System.Windows.Documents.LineBreak> is always trimmed.</span></span>

## <a name="see-also"></a><span data-ttu-id="33941-164">请参阅</span><span class="sxs-lookup"><span data-stu-id="33941-164">See also</span></span>

- [<span data-ttu-id="33941-165">XAML 概述 （WPF）</span><span class="sxs-lookup"><span data-stu-id="33941-165">XAML overview (WPF)</span></span>](../fundamentals/xaml.md)
- [<span data-ttu-id="33941-166">XML字符实体和XAML</span><span class="sxs-lookup"><span data-stu-id="33941-166">XML character entities and XAML</span></span>](xml-character-entities.md)
- [<span data-ttu-id="33941-167">xml：XAML 中的空间处理</span><span class="sxs-lookup"><span data-stu-id="33941-167">xml:space handling in XAML</span></span>](xml-space-handling.md)
