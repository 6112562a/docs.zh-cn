---
title: 声明语句 (Visual Basic)
ms.date: 07/20/2015
f1_keywords:
- vb.Declare
- vb.Lib
- vb.Any
helpviewer_keywords:
- Lib keyword [Visual Basic]
- declaring procedures [Visual Basic], Declare statement
- functions [Visual Basic], function procedures
- declarations [Visual Basic], procedures
- procedures [Visual Basic], declaration
- procedures [Visual Basic], external
- Alias keyword [Visual Basic]
- external references [Visual Basic], Visual Basic
- DLLs, declaring procedures
- Declare statement [Visual Basic]
- declarations [Visual Basic], external
- Visual Basic code, Function procedures
- As keyword [Visual Basic], in Declare statement
- resources [Visual Basic], declaring
- Public keyword [Visual Basic], Declare statement
- platform invoke, Visual Basic external references
- Sub procedures [Visual Basic], declarations
- APIs, declaring API functions
- Visual Basic code, Sub procedures
- Function procedures [Visual Basic], declaring
ms.assetid: d3f21fb0-b804-4c99-97ed-583b23894cf1
ms.openlocfilehash: 5f9ac99078d64387acee9160118928ad8de1764c
ms.sourcegitcommit: 3630c2515809e6f4b7dbb697a3354efec105a5cd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/25/2019
ms.locfileid: "58411533"
---
# <a name="declare-statement"></a><span data-ttu-id="fb992-102">Declare Statement</span><span class="sxs-lookup"><span data-stu-id="fb992-102">Declare Statement</span></span>
<span data-ttu-id="fb992-103">声明对外部文件中实现的过程的引用。</span><span class="sxs-lookup"><span data-stu-id="fb992-103">Declares a reference to a procedure implemented in an external file.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="fb992-104">语法</span><span class="sxs-lookup"><span data-stu-id="fb992-104">Syntax</span></span>  
  
```  
[ <attributelist> ] [ accessmodifier ] [ Shadows ] [ Overloads ] _  
Declare [ charsetmodifier ] [ Sub ] name Lib "libname" _  
[ Alias "aliasname" ] [ ([ parameterlist ]) ]  
' -or-  
[ <attributelist> ] [ accessmodifier ] [ Shadows ] [ Overloads ] _  
Declare [ charsetmodifier ] [ Function ] name Lib "libname" _  
[ Alias "aliasname" ] [ ([ parameterlist ]) ] [ As returntype ]  
```  
  
## <a name="parts"></a><span data-ttu-id="fb992-105">部件</span><span class="sxs-lookup"><span data-stu-id="fb992-105">Parts</span></span>  
  
|<span data-ttu-id="fb992-106">术语</span><span class="sxs-lookup"><span data-stu-id="fb992-106">Term</span></span>|<span data-ttu-id="fb992-107">定义</span><span class="sxs-lookup"><span data-stu-id="fb992-107">Definition</span></span>|  
|---|---|  
|`attributelist`|<span data-ttu-id="fb992-108">可选。</span><span class="sxs-lookup"><span data-stu-id="fb992-108">Optional.</span></span> <span data-ttu-id="fb992-109">请参阅[属性列表](../../../visual-basic/language-reference/statements/attribute-list.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-109">See [Attribute List](../../../visual-basic/language-reference/statements/attribute-list.md).</span></span>|  
|`accessmodifier`|<span data-ttu-id="fb992-110">可选。</span><span class="sxs-lookup"><span data-stu-id="fb992-110">Optional.</span></span> <span data-ttu-id="fb992-111">可以是以下各项之一：</span><span class="sxs-lookup"><span data-stu-id="fb992-111">Can be one of the following:</span></span><br /><br /> <span data-ttu-id="fb992-112">-   [Public](../../../visual-basic/language-reference/modifiers/public.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-112">-   [Public](../../../visual-basic/language-reference/modifiers/public.md)</span></span><br /><span data-ttu-id="fb992-113">-   [受保护](../../../visual-basic/language-reference/modifiers/protected.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-113">-   [Protected](../../../visual-basic/language-reference/modifiers/protected.md)</span></span><br /><span data-ttu-id="fb992-114">-   [友元](../../../visual-basic/language-reference/modifiers/friend.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-114">-   [Friend](../../../visual-basic/language-reference/modifiers/friend.md)</span></span><br /><span data-ttu-id="fb992-115">-   [专用](../../../visual-basic/language-reference/modifiers/private.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-115">-   [Private](../../../visual-basic/language-reference/modifiers/private.md)</span></span><br /><span data-ttu-id="fb992-116">- [受保护的友元](../../language-reference/modifiers/protected-friend.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-116">- [Protected Friend](../../language-reference/modifiers/protected-friend.md)</span></span><br /><span data-ttu-id="fb992-117">- [专用受保护](../../language-reference/modifiers/private-protected.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-117">- [Private Protected](../../language-reference/modifiers/private-protected.md)</span></span><br /><br /> <span data-ttu-id="fb992-118">请参阅 [Access levels in Visual Basic](../../../visual-basic/programming-guide/language-features/declared-elements/access-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-118">See [Access levels in Visual Basic](../../../visual-basic/programming-guide/language-features/declared-elements/access-levels.md).</span></span>|  
|`Shadows`|<span data-ttu-id="fb992-119">可选。</span><span class="sxs-lookup"><span data-stu-id="fb992-119">Optional.</span></span> <span data-ttu-id="fb992-120">请参阅[Shadows](../../../visual-basic/language-reference/modifiers/shadows.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-120">See [Shadows](../../../visual-basic/language-reference/modifiers/shadows.md).</span></span>|  
|`charsetmodifier`|<span data-ttu-id="fb992-121">可选。</span><span class="sxs-lookup"><span data-stu-id="fb992-121">Optional.</span></span> <span data-ttu-id="fb992-122">指定字符集和文件搜索信息。</span><span class="sxs-lookup"><span data-stu-id="fb992-122">Specifies character set and file search information.</span></span> <span data-ttu-id="fb992-123">可以是以下各项之一：</span><span class="sxs-lookup"><span data-stu-id="fb992-123">Can be one of the following:</span></span><br /><br /> <span data-ttu-id="fb992-124">-   [Ansi](../../../visual-basic/language-reference/modifiers/ansi.md) （默认值）</span><span class="sxs-lookup"><span data-stu-id="fb992-124">-   [Ansi](../../../visual-basic/language-reference/modifiers/ansi.md) (default)</span></span><br /><span data-ttu-id="fb992-125">-   [Unicode](../../../visual-basic/language-reference/modifiers/unicode.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-125">-   [Unicode](../../../visual-basic/language-reference/modifiers/unicode.md)</span></span><br /><span data-ttu-id="fb992-126">-   [自动](../../../visual-basic/language-reference/modifiers/auto.md)</span><span class="sxs-lookup"><span data-stu-id="fb992-126">-   [Auto](../../../visual-basic/language-reference/modifiers/auto.md)</span></span>|  
|`Sub`|<span data-ttu-id="fb992-127">（可选），但`Sub`或`Function`必须出现。</span><span class="sxs-lookup"><span data-stu-id="fb992-127">Optional, but either `Sub` or `Function` must appear.</span></span> <span data-ttu-id="fb992-128">指示外部过程不返回值。</span><span class="sxs-lookup"><span data-stu-id="fb992-128">Indicates that the external procedure does not return a value.</span></span>|  
|`Function`|<span data-ttu-id="fb992-129">（可选），但`Sub`或`Function`必须出现。</span><span class="sxs-lookup"><span data-stu-id="fb992-129">Optional, but either `Sub` or `Function` must appear.</span></span> <span data-ttu-id="fb992-130">指示外部过程返回一个值。</span><span class="sxs-lookup"><span data-stu-id="fb992-130">Indicates that the external procedure returns a value.</span></span>|  
|`name`|<span data-ttu-id="fb992-131">必需。</span><span class="sxs-lookup"><span data-stu-id="fb992-131">Required.</span></span> <span data-ttu-id="fb992-132">此外部引用的名称。</span><span class="sxs-lookup"><span data-stu-id="fb992-132">Name of this external reference.</span></span> <span data-ttu-id="fb992-133">有关详细信息，请参阅[声明的元素名称](../../../visual-basic/programming-guide/language-features/declared-elements/declared-element-names.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-133">For more information, see [Declared Element Names](../../../visual-basic/programming-guide/language-features/declared-elements/declared-element-names.md).</span></span>|  
|`Lib`|<span data-ttu-id="fb992-134">必需。</span><span class="sxs-lookup"><span data-stu-id="fb992-134">Required.</span></span> <span data-ttu-id="fb992-135">引入了`Lib`子句，用于标识包含外部过程的外部文件 （DLL 或代码资源）。</span><span class="sxs-lookup"><span data-stu-id="fb992-135">Introduces a `Lib` clause, which identifies the external file (DLL or code resource) that contains an external procedure.</span></span>|  
|`libname`|<span data-ttu-id="fb992-136">必需。</span><span class="sxs-lookup"><span data-stu-id="fb992-136">Required.</span></span> <span data-ttu-id="fb992-137">包含声明的过程的文件的名称。</span><span class="sxs-lookup"><span data-stu-id="fb992-137">Name of the file that contains the declared procedure.</span></span>|  
|`Alias`|<span data-ttu-id="fb992-138">可选。</span><span class="sxs-lookup"><span data-stu-id="fb992-138">Optional.</span></span> <span data-ttu-id="fb992-139">指示所声明的过程，不能通过中指定的名称在其文件中进行标识`name`。</span><span class="sxs-lookup"><span data-stu-id="fb992-139">Indicates that the procedure being declared cannot be identified within its file by the name specified in `name`.</span></span> <span data-ttu-id="fb992-140">指定在其标识`aliasname`。</span><span class="sxs-lookup"><span data-stu-id="fb992-140">You specify its identification in `aliasname`.</span></span>|  
|`aliasname`|<span data-ttu-id="fb992-141">如果在使用需要`Alias`关键字。</span><span class="sxs-lookup"><span data-stu-id="fb992-141">Required if you use the `Alias` keyword.</span></span> <span data-ttu-id="fb992-142">标识过程的两种方式之一的字符串：</span><span class="sxs-lookup"><span data-stu-id="fb992-142">String that identifies the procedure in one of two ways:</span></span><br /><br /> <span data-ttu-id="fb992-143">在其文件中，用引号括起来的过程的入口点名称 (`""`)</span><span class="sxs-lookup"><span data-stu-id="fb992-143">The entry point name of the procedure within its file, within quotes (`""`)</span></span><br /><br /> <span data-ttu-id="fb992-144">或</span><span class="sxs-lookup"><span data-stu-id="fb992-144">-or-</span></span><br /><br /> <span data-ttu-id="fb992-145">数字符号 (`#`) 后跟一个整数，指定在其文件内的过程的入口点的序号</span><span class="sxs-lookup"><span data-stu-id="fb992-145">A number sign (`#`) followed by an integer specifying the ordinal number of the procedure's entry point within its file</span></span>|  
|`parameterlist`|<span data-ttu-id="fb992-146">所需的过程如果采用参数。</span><span class="sxs-lookup"><span data-stu-id="fb992-146">Required if the procedure takes parameters.</span></span> <span data-ttu-id="fb992-147">请参阅[参数列表](../../../visual-basic/language-reference/statements/parameter-list.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-147">See [Parameter List](../../../visual-basic/language-reference/statements/parameter-list.md).</span></span>|  
|`returntype`|<span data-ttu-id="fb992-148">需要`Function`指定并`Option Strict`是`On`。</span><span class="sxs-lookup"><span data-stu-id="fb992-148">Required if `Function` is specified and `Option Strict` is `On`.</span></span> <span data-ttu-id="fb992-149">该过程返回的值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="fb992-149">Data type of the value returned by the procedure.</span></span>|  
  
## <a name="remarks"></a><span data-ttu-id="fb992-150">备注</span><span class="sxs-lookup"><span data-stu-id="fb992-150">Remarks</span></span>  
 <span data-ttu-id="fb992-151">有时您需要调用在文件中 （如 DLL 或代码资源） 在项目外部定义的过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-151">Sometimes you need to call a procedure defined in a file (such as a DLL or code resource) outside your project.</span></span> <span data-ttu-id="fb992-152">执行此操作时，Visual Basic 编译器不能正确调用该过程所需的信息，如该过程所在的位置、 如何标识、 其调用的序列和返回类型和字符串字符集，它使用的访问。</span><span class="sxs-lookup"><span data-stu-id="fb992-152">When you do this, the Visual Basic compiler does not have access to the information it needs to call the procedure correctly, such as where the procedure is located, how it is identified, its calling sequence and return type, and the string character set it uses.</span></span> <span data-ttu-id="fb992-153">`Declare`语句创建对外部过程的引用，并提供这些必需的信息。</span><span class="sxs-lookup"><span data-stu-id="fb992-153">The `Declare` statement creates a reference to an external procedure and supplies this necessary information.</span></span>  
  
 <span data-ttu-id="fb992-154">只能在模块级别使用 `Declare`。</span><span class="sxs-lookup"><span data-stu-id="fb992-154">You can use `Declare` only at module level.</span></span> <span data-ttu-id="fb992-155">这意味着*声明上下文*的外部引用必须是类、 结构或模块，并且不能为源文件、 命名空间、 接口、 过程或块。</span><span class="sxs-lookup"><span data-stu-id="fb992-155">This means the *declaration context* for an external reference must be a class, structure, or module, and cannot be a source file, namespace, interface, procedure, or block.</span></span> <span data-ttu-id="fb992-156">有关详细信息，请参阅[声明上下文和默认访问级别](../../../visual-basic/language-reference/statements/declaration-contexts-and-default-access-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-156">For more information, see [Declaration Contexts and Default Access Levels](../../../visual-basic/language-reference/statements/declaration-contexts-and-default-access-levels.md).</span></span>  
  
 <span data-ttu-id="fb992-157">外部引用默认为[公共](../../../visual-basic/language-reference/modifiers/public.md)访问。</span><span class="sxs-lookup"><span data-stu-id="fb992-157">External references default to [Public](../../../visual-basic/language-reference/modifiers/public.md) access.</span></span> <span data-ttu-id="fb992-158">您可以调整其访问级别和访问修饰符。</span><span class="sxs-lookup"><span data-stu-id="fb992-158">You can adjust their access levels with the access modifiers.</span></span>  
  
## <a name="rules"></a><span data-ttu-id="fb992-159">规则</span><span class="sxs-lookup"><span data-stu-id="fb992-159">Rules</span></span>  
  
-   <span data-ttu-id="fb992-160">**特性。**</span><span class="sxs-lookup"><span data-stu-id="fb992-160">**Attributes.**</span></span> <span data-ttu-id="fb992-161">可以将特性应用于外部引用。</span><span class="sxs-lookup"><span data-stu-id="fb992-161">You can apply attributes to an external reference.</span></span> <span data-ttu-id="fb992-162">在应用任何特性都有效，仅在你的项目中，不是外部文件中。</span><span class="sxs-lookup"><span data-stu-id="fb992-162">Any attribute you apply has effect only in your project, not in the external file.</span></span>  
  
-   <span data-ttu-id="fb992-163">**修饰符。**</span><span class="sxs-lookup"><span data-stu-id="fb992-163">**Modifiers.**</span></span> <span data-ttu-id="fb992-164">外部过程是隐式[共享](../../../visual-basic/language-reference/modifiers/shared.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-164">External procedures are implicitly [Shared](../../../visual-basic/language-reference/modifiers/shared.md).</span></span> <span data-ttu-id="fb992-165">不能使用`Shared`关键字声明的外部引用，并且您不能更改它的共享的状态时。</span><span class="sxs-lookup"><span data-stu-id="fb992-165">You cannot use the `Shared` keyword when declaring an external reference, and you cannot alter its shared status.</span></span>  
  
     <span data-ttu-id="fb992-166">外部过程不能参与重写、 实现接口成员，或处理事件。</span><span class="sxs-lookup"><span data-stu-id="fb992-166">An external procedure cannot participate in overriding, implement interface members, or handle events.</span></span> <span data-ttu-id="fb992-167">因此，不能使用`Overrides`， `Overridable`， `NotOverridable`， `MustOverride`， `Implements`，或`Handles`中的关键字`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="fb992-167">Accordingly, you cannot use the `Overrides`, `Overridable`, `NotOverridable`, `MustOverride`, `Implements`, or `Handles` keyword in a `Declare` statement.</span></span>  
  
-   <span data-ttu-id="fb992-168">**外部过程的名称。**</span><span class="sxs-lookup"><span data-stu-id="fb992-168">**External Procedure Name.**</span></span> <span data-ttu-id="fb992-169">不需要此外部引用指定相同的名称 (在`name`) 作为其外部文件中的过程的入口点名称 (`aliasname`)。</span><span class="sxs-lookup"><span data-stu-id="fb992-169">You do not have to give this external reference the same name (in `name`) as the procedure's entry-point name within its external file (`aliasname`).</span></span> <span data-ttu-id="fb992-170">可以使用`Alias`子句来指定入口点名称。</span><span class="sxs-lookup"><span data-stu-id="fb992-170">You can use an `Alias` clause to specify the entry-point name.</span></span> <span data-ttu-id="fb992-171">这可以是外部的过程相同的作用域中具有与 Visual Basic 保留的修饰符或变量、 过程或任何其他编程元素同名的情况下很有用。</span><span class="sxs-lookup"><span data-stu-id="fb992-171">This can be useful if the external procedure has the same name as a Visual Basic reserved modifier or a variable, procedure, or any other programming element in the same scope.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="fb992-172">大多数 Dll 中的入口点名称是区分大小写。</span><span class="sxs-lookup"><span data-stu-id="fb992-172">Entry-point names in most DLLs are case-sensitive.</span></span>  
  
-   <span data-ttu-id="fb992-173">**外部过程号。**</span><span class="sxs-lookup"><span data-stu-id="fb992-173">**External Procedure Number.**</span></span> <span data-ttu-id="fb992-174">或者，可以使用`Alias`子句来指定外部文件的入口点的导出表内的序号。</span><span class="sxs-lookup"><span data-stu-id="fb992-174">Alternatively, you can use an `Alias` clause to specify the ordinal number of the entry point within the export table of the external file.</span></span> <span data-ttu-id="fb992-175">若要执行此操作，应先`aliasname`以数字符号 (`#`)。</span><span class="sxs-lookup"><span data-stu-id="fb992-175">To do this, you begin `aliasname` with a number sign (`#`).</span></span> <span data-ttu-id="fb992-176">这可以是很有用，如果在 Visual Basic 中不允许外部过程的名称中的任何字符或外部文件导出不带名称的过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-176">This can be useful if any character in the external procedure name is not allowed in Visual Basic, or if the external file exports the procedure without a name.</span></span>  
  
## <a name="data-type-rules"></a><span data-ttu-id="fb992-177">数据类型的规则</span><span class="sxs-lookup"><span data-stu-id="fb992-177">Data Type Rules</span></span>  
  
-   <span data-ttu-id="fb992-178">**参数数据类型。**</span><span class="sxs-lookup"><span data-stu-id="fb992-178">**Parameter Data Types.**</span></span> <span data-ttu-id="fb992-179">如果`Option Strict`是`On`，必须指定每个参数中的数据类型`parameterlist`。</span><span class="sxs-lookup"><span data-stu-id="fb992-179">If `Option Strict` is `On`, you must specify the data type of each parameter in `parameterlist`.</span></span> <span data-ttu-id="fb992-180">这可以是任何数据类型或枚举、 结构、 类或接口的名称。</span><span class="sxs-lookup"><span data-stu-id="fb992-180">This can be any data type or the name of an enumeration, structure, class, or interface.</span></span> <span data-ttu-id="fb992-181">内`parameterlist`，则使用`As`子句来指定要传递给每个参数的自变量的数据类型。</span><span class="sxs-lookup"><span data-stu-id="fb992-181">Within `parameterlist`, you use an `As` clause to specify the data type of the argument to be passed to each parameter.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="fb992-182">如果外部过程不针对.NET Framework 编写的您必须采取措施的数据类型相对应。</span><span class="sxs-lookup"><span data-stu-id="fb992-182">If the external procedure was not written for the .NET Framework, you must take care that the data types correspond.</span></span> <span data-ttu-id="fb992-183">例如，如果声明到 Visual Basic 6.0 过程使用的外部引用`Integer`参数 （在 Visual Basic 6.0 中为 16 位），必须标识相应的参数作为`Short`中`Declare`语句，因为这是 16 位在 Visual Basic 中的位的整数类型。</span><span class="sxs-lookup"><span data-stu-id="fb992-183">For example, if you declare an external reference to a Visual Basic 6.0 procedure with an `Integer` parameter (16 bits in Visual Basic 6.0), you must identify the corresponding argument as `Short` in the `Declare` statement, because that is the 16-bit integer type in Visual Basic.</span></span> <span data-ttu-id="fb992-184">同样，`Long`在 Visual Basic 6.0 中，具有不同的数据宽度和`Date`的实现方式不同。</span><span class="sxs-lookup"><span data-stu-id="fb992-184">Similarly, `Long` has a different data width in Visual Basic 6.0, and `Date` is implemented differently.</span></span>  
  
-   <span data-ttu-id="fb992-185">**返回的数据类型。**</span><span class="sxs-lookup"><span data-stu-id="fb992-185">**Return Data Type.**</span></span> <span data-ttu-id="fb992-186">如果外部过程`Function`并`Option Strict`是`On`，必须指定返回给调用代码的值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="fb992-186">If the external procedure is a `Function` and `Option Strict` is `On`, you must specify the data type of the value returned to the calling code.</span></span> <span data-ttu-id="fb992-187">这可以是任何数据类型或枚举、 结构、 类或接口的名称。</span><span class="sxs-lookup"><span data-stu-id="fb992-187">This can be any data type or the name of an enumeration, structure, class, or interface.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="fb992-188">Visual Basic 编译器不验证您的数据类型是与这些外部过程兼容。</span><span class="sxs-lookup"><span data-stu-id="fb992-188">The Visual Basic compiler does not verify that your data types are compatible with those of the external procedure.</span></span> <span data-ttu-id="fb992-189">如果存在不匹配，公共语言运行时将生成<xref:System.Runtime.InteropServices.MarshalDirectiveException>运行时异常。</span><span class="sxs-lookup"><span data-stu-id="fb992-189">If there is a mismatch, the common language runtime generates a <xref:System.Runtime.InteropServices.MarshalDirectiveException> exception at run time.</span></span>  
  
-   <span data-ttu-id="fb992-190">**默认数据类型。**</span><span class="sxs-lookup"><span data-stu-id="fb992-190">**Default Data Types.**</span></span> <span data-ttu-id="fb992-191">如果`Option Strict`是`Off`而且未指定参数中的数据类型`parameterlist`，Visual Basic 编译器将转换为相应的参数[Object Data Type](../../../visual-basic/language-reference/data-types/object-data-type.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-191">If `Option Strict` is `Off` and you do not specify the data type of a parameter in `parameterlist`, the Visual Basic compiler converts the corresponding argument to the [Object Data Type](../../../visual-basic/language-reference/data-types/object-data-type.md).</span></span> <span data-ttu-id="fb992-192">同样，如果未指定`returntype`，编译器采用返回数据类型为`Object`。</span><span class="sxs-lookup"><span data-stu-id="fb992-192">Similarly, if you do not specify `returntype`, the compiler takes the return data type to be `Object`.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="fb992-193">处理可能在不同平台上编写的外部过程，因为它是危险做出任何关于数据类型假设或允许它们采用默认设置。</span><span class="sxs-lookup"><span data-stu-id="fb992-193">Because you are dealing with an external procedure that might have been written on a different platform, it is dangerous to make any assumptions about data types or to allow them to default.</span></span> <span data-ttu-id="fb992-194">如果有的话，它会更安全，以指定每个参数和返回值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="fb992-194">It is much safer to specify the data type of every parameter and of the return value, if any.</span></span> <span data-ttu-id="fb992-195">这还可以提高代码的可读性。</span><span class="sxs-lookup"><span data-stu-id="fb992-195">This also improves the readability of your code.</span></span>  
  
## <a name="behavior"></a><span data-ttu-id="fb992-196">行为</span><span class="sxs-lookup"><span data-stu-id="fb992-196">Behavior</span></span>  
  
-   <span data-ttu-id="fb992-197">**作用域。**</span><span class="sxs-lookup"><span data-stu-id="fb992-197">**Scope.**</span></span> <span data-ttu-id="fb992-198">在其类、 结构或模块的作用域中是外部引用。</span><span class="sxs-lookup"><span data-stu-id="fb992-198">An external reference is in scope throughout its class, structure, or module.</span></span>  
  
-   <span data-ttu-id="fb992-199">**生存期。**</span><span class="sxs-lookup"><span data-stu-id="fb992-199">**Lifetime.**</span></span> <span data-ttu-id="fb992-200">外部引用具有相同的生存期类、 结构或在其中声明的模块。</span><span class="sxs-lookup"><span data-stu-id="fb992-200">An external reference has the same lifetime as the class, structure, or module in which it is declared.</span></span>  
  
-   <span data-ttu-id="fb992-201">**调用外部过程。**</span><span class="sxs-lookup"><span data-stu-id="fb992-201">**Calling an External Procedure.**</span></span> <span data-ttu-id="fb992-202">调用外部过程调用的相同方式`Function`或`Sub`过程 — 通过在表达式中使用它，如果它返回一个值，或通过指定其[Call 语句](../../../visual-basic/language-reference/statements/call-statement.md)如果它不返回值。</span><span class="sxs-lookup"><span data-stu-id="fb992-202">You call an external procedure the same way you call a `Function` or `Sub` procedure—by using it in an expression if it returns a value, or by specifying it in a [Call Statement](../../../visual-basic/language-reference/statements/call-statement.md) if it does not return a value.</span></span>  
  
     <span data-ttu-id="fb992-203">将参数传递到完全按照指定的外部过程`parameterlist`在`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="fb992-203">You pass arguments to the external procedure exactly as specified by `parameterlist` in the `Declare` statement.</span></span> <span data-ttu-id="fb992-204">不会考虑外部文件中最初声明参数的方式。</span><span class="sxs-lookup"><span data-stu-id="fb992-204">Do not take into account how the parameters were originally declared in the external file.</span></span> <span data-ttu-id="fb992-205">同样，如果没有返回值，使用它完全按照指定的`returntype`在`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="fb992-205">Similarly, if there is a return value, use it exactly as specified by `returntype` in the `Declare` statement.</span></span>  
  
-   <span data-ttu-id="fb992-206">**字符集。**</span><span class="sxs-lookup"><span data-stu-id="fb992-206">**Character Sets.**</span></span> <span data-ttu-id="fb992-207">可以指定在`charsetmodifier`如何 Visual Basic 应封送字符串时调用的外部过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-207">You can specify in `charsetmodifier` how Visual Basic should marshal strings when it calls the external procedure.</span></span> <span data-ttu-id="fb992-208">`Ansi`修饰符指示 Visual Basic 进行封送为 ANSI 值的所有字符串和`Unicode`修饰符将指示该封都送为 Unicode 值的所有字符串。</span><span class="sxs-lookup"><span data-stu-id="fb992-208">The `Ansi` modifier directs Visual Basic to marshal all strings to ANSI values, and the `Unicode` modifier directs it to marshal all strings to Unicode values.</span></span> <span data-ttu-id="fb992-209">`Auto`修饰符将定向到封送字符串，根据.NET Framework 的 Visual Basic 规则基于外部引用`name`，或`aliasname`如果指定。</span><span class="sxs-lookup"><span data-stu-id="fb992-209">The `Auto` modifier directs Visual Basic to marshal strings according to .NET Framework rules based on the external reference `name`, or `aliasname` if specified.</span></span> <span data-ttu-id="fb992-210">默认值为 `Ansi`。</span><span class="sxs-lookup"><span data-stu-id="fb992-210">The default value is `Ansi`.</span></span>  
  
     <span data-ttu-id="fb992-211">`charsetmodifier` 此外可以指定 Visual Basic 应如何查找其外部文件中的外部过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-211">`charsetmodifier` also specifies how Visual Basic should look up the external procedure within its external file.</span></span> <span data-ttu-id="fb992-212">`Ansi` 和`Unicode`直接 Visual Basic，而无需在搜索过程中修改其名称进行查找。</span><span class="sxs-lookup"><span data-stu-id="fb992-212">`Ansi` and `Unicode` both direct Visual Basic to look it up without modifying its name during the search.</span></span> <span data-ttu-id="fb992-213">`Auto` 指示 Visual Basic，若要确定运行时平台的基字符集和可能修改外部过程的名称，按如下所示：</span><span class="sxs-lookup"><span data-stu-id="fb992-213">`Auto` directs Visual Basic to determine the base character set of the run-time platform and possibly modify the external procedure name, as follows:</span></span>  
  
    -   <span data-ttu-id="fb992-214">ANSI 平台，如 Windows 95、 Windows 98 或 Windows Millennium Edition 上首先查找与没有名称的修改的外部过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-214">On an ANSI platform, such as Windows 95, Windows 98, or Windows Millennium Edition, first look up the external procedure with no name modification.</span></span> <span data-ttu-id="fb992-215">如果失败，将"A"追加到外部过程名称的末尾，并再次查找。</span><span class="sxs-lookup"><span data-stu-id="fb992-215">If that fails, append "A" to the end of the external procedure name and look it up again.</span></span>  
  
    -   <span data-ttu-id="fb992-216">在 Unicode 平台上，如 Windows NT、 Windows 2000 或 Windows XP 中，首先查找与没有名称的修改的外部过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-216">On a Unicode platform, such as Windows NT, Windows 2000, or Windows XP, first look up the external procedure with no name modification.</span></span> <span data-ttu-id="fb992-217">如果该操作失败，则将追加"W"到末尾的外部过程的名称，并再次查找。</span><span class="sxs-lookup"><span data-stu-id="fb992-217">If that fails, append "W" to the end of the external procedure name and look it up again.</span></span>  
  
-   <span data-ttu-id="fb992-218">**机制。**</span><span class="sxs-lookup"><span data-stu-id="fb992-218">**Mechanism.**</span></span> <span data-ttu-id="fb992-219">Visual Basic 使用.NET Framework*平台调用*(PInvoke) 机制来解析和访问外部过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-219">Visual Basic uses the .NET Framework *platform invoke* (PInvoke) mechanism to resolve and access external procedures.</span></span> <span data-ttu-id="fb992-220">`Declare`语句和<xref:System.Runtime.InteropServices.DllImportAttribute>这两个类使用此机制自动，并且不需要任何知识的 PInvoke。</span><span class="sxs-lookup"><span data-stu-id="fb992-220">The `Declare` statement and the <xref:System.Runtime.InteropServices.DllImportAttribute> class both use this mechanism automatically, and you do not need any knowledge of PInvoke.</span></span> <span data-ttu-id="fb992-221">有关详细信息，请参见[演练：调用 Windows Api](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-221">For more information, see [Walkthrough: Calling Windows APIs](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md).</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="fb992-222">如果外部过程外部公共语言运行时 (CLR) 运行，则*非托管代码*。</span><span class="sxs-lookup"><span data-stu-id="fb992-222">If the external procedure runs outside the common language runtime (CLR), it is *unmanaged code*.</span></span> <span data-ttu-id="fb992-223">当调用此类过程，例如 Windows API 函数或 COM 方法，可能会使你的应用程序的安全风险。</span><span class="sxs-lookup"><span data-stu-id="fb992-223">When you call such a procedure, for example a Windows API function or a COM method, you might expose your application to security risks.</span></span> <span data-ttu-id="fb992-224">有关详细信息，请参阅[用于非托管代码安全编码准则](../../../framework/security/secure-coding-guidelines-for-unmanaged-code.md)。</span><span class="sxs-lookup"><span data-stu-id="fb992-224">For more information, see [Secure Coding Guidelines for Unmanaged Code](../../../framework/security/secure-coding-guidelines-for-unmanaged-code.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="fb992-225">示例</span><span class="sxs-lookup"><span data-stu-id="fb992-225">Example</span></span>  
 <span data-ttu-id="fb992-226">下面的示例声明的外部引用`Function`返回当前用户名称的过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-226">The following example declares an external reference to a `Function` procedure that returns the current user name.</span></span> <span data-ttu-id="fb992-227">然后，它调用外部过程`GetUserNameA`作为的一部分`getUser`过程。</span><span class="sxs-lookup"><span data-stu-id="fb992-227">It then calls the external procedure `GetUserNameA` as part of the `getUser` procedure.</span></span>  
  
 [!code-vb[VbVbalrStatements#15](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class1.vb#15)]  
  
## <a name="example"></a><span data-ttu-id="fb992-228">示例</span><span class="sxs-lookup"><span data-stu-id="fb992-228">Example</span></span>  
 <span data-ttu-id="fb992-229"><xref:System.Runtime.InteropServices.DllImportAttribute>提供非托管代码中使用函数的替代方法。</span><span class="sxs-lookup"><span data-stu-id="fb992-229">The <xref:System.Runtime.InteropServices.DllImportAttribute> provides an alternative way of using functions in unmanaged code.</span></span> <span data-ttu-id="fb992-230">下面的示例声明导入的函数，而无需使用`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="fb992-230">The following example declares an imported function without using a `Declare` statement.</span></span>  
  
 [!code-vb[VbVbalrStatements#16](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class1.vb#16)]  
  
 [!code-vb[VbVbalrStatements#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class1.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="fb992-231">请参阅</span><span class="sxs-lookup"><span data-stu-id="fb992-231">See also</span></span>
- <xref:Microsoft.VisualBasic.ErrObject.LastDllError%2A>
- [<span data-ttu-id="fb992-232">Imports 语句（.NET 命名空间和类型）</span><span class="sxs-lookup"><span data-stu-id="fb992-232">Imports Statement (.NET Namespace and Type)</span></span>](../../../visual-basic/language-reference/statements/imports-statement-net-namespace-and-type.md)
- [<span data-ttu-id="fb992-233">AddressOf 运算符</span><span class="sxs-lookup"><span data-stu-id="fb992-233">AddressOf Operator</span></span>](../../../visual-basic/language-reference/operators/addressof-operator.md)
- [<span data-ttu-id="fb992-234">Function 语句</span><span class="sxs-lookup"><span data-stu-id="fb992-234">Function Statement</span></span>](../../../visual-basic/language-reference/statements/function-statement.md)
- [<span data-ttu-id="fb992-235">Sub 语句</span><span class="sxs-lookup"><span data-stu-id="fb992-235">Sub Statement</span></span>](../../../visual-basic/language-reference/statements/sub-statement.md)
- [<span data-ttu-id="fb992-236">参数列表</span><span class="sxs-lookup"><span data-stu-id="fb992-236">Parameter List</span></span>](../../../visual-basic/language-reference/statements/parameter-list.md)
- [<span data-ttu-id="fb992-237">Call 语句</span><span class="sxs-lookup"><span data-stu-id="fb992-237">Call Statement</span></span>](../../../visual-basic/language-reference/statements/call-statement.md)
- [<span data-ttu-id="fb992-238">演练：调用 Windows API</span><span class="sxs-lookup"><span data-stu-id="fb992-238">Walkthrough: Calling Windows APIs</span></span>](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md)
