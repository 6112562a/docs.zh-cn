---
title: Declare Statement
ms.date: 07/20/2015
f1_keywords:
- vb.Declare
- vb.Lib
- vb.Any
helpviewer_keywords:
- Lib keyword [Visual Basic]
- declaring procedures [Visual Basic], Declare statement
- functions [Visual Basic], function procedures
- declarations [Visual Basic], procedures
- procedures [Visual Basic], declaration
- procedures [Visual Basic], external
- Alias keyword [Visual Basic]
- external references [Visual Basic], Visual Basic
- DLLs, declaring procedures
- Declare statement [Visual Basic]
- declarations [Visual Basic], external
- Visual Basic code, Function procedures
- As keyword [Visual Basic], in Declare statement
- resources [Visual Basic], declaring
- Public keyword [Visual Basic], Declare statement
- platform invoke, Visual Basic external references
- Sub procedures [Visual Basic], declarations
- APIs, declaring API functions
- Visual Basic code, Sub procedures
- Function procedures [Visual Basic], declaring
ms.assetid: d3f21fb0-b804-4c99-97ed-583b23894cf1
ms.openlocfilehash: 48a36e3ecdef40810ea7a3194e85b5b646154331
ms.sourcegitcommit: 17ee6605e01ef32506f8fdc686954244ba6911de
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/22/2019
ms.locfileid: "74354092"
---
# <a name="declare-statement"></a><span data-ttu-id="2e6a1-102">Declare Statement</span><span class="sxs-lookup"><span data-stu-id="2e6a1-102">Declare Statement</span></span>

<span data-ttu-id="2e6a1-103">声明对外部文件中所实现过程的引用。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-103">Declares a reference to a procedure implemented in an external file.</span></span>

## <a name="syntax"></a><span data-ttu-id="2e6a1-104">语法</span><span class="sxs-lookup"><span data-stu-id="2e6a1-104">Syntax</span></span>

```vb
[ <attributelist> ] [ accessmodifier ] [ Shadows ] [ Overloads ] _
Declare [ charsetmodifier ] [ Sub ] name Lib "libname" _
[ Alias "aliasname" ] [ ([ parameterlist ]) ]
' -or-
[ <attributelist> ] [ accessmodifier ] [ Shadows ] [ Overloads ] _
Declare [ charsetmodifier ] [ Function ] name Lib "libname" _
[ Alias "aliasname" ] [ ([ parameterlist ]) ] [ As returntype ]
```

## <a name="parts"></a><span data-ttu-id="2e6a1-105">部件</span><span class="sxs-lookup"><span data-stu-id="2e6a1-105">Parts</span></span>

|<span data-ttu-id="2e6a1-106">术语</span><span class="sxs-lookup"><span data-stu-id="2e6a1-106">Term</span></span>|<span data-ttu-id="2e6a1-107">Definition</span><span class="sxs-lookup"><span data-stu-id="2e6a1-107">Definition</span></span>|
|---|---|
|`attributelist`|<span data-ttu-id="2e6a1-108">可选。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-108">Optional.</span></span> <span data-ttu-id="2e6a1-109">请参阅[特性列表](../../../visual-basic/language-reference/statements/attribute-list.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-109">See [Attribute List](../../../visual-basic/language-reference/statements/attribute-list.md).</span></span>|
|`accessmodifier`|<span data-ttu-id="2e6a1-110">可选。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-110">Optional.</span></span> <span data-ttu-id="2e6a1-111">可以是以下各项之一：</span><span class="sxs-lookup"><span data-stu-id="2e6a1-111">Can be one of the following:</span></span><br /><br /> <span data-ttu-id="2e6a1-112">-   [公有](../../../visual-basic/language-reference/modifiers/public.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-112">-   [Public](../../../visual-basic/language-reference/modifiers/public.md)</span></span><br /><span data-ttu-id="2e6a1-113">-   [保护](../../../visual-basic/language-reference/modifiers/protected.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-113">-   [Protected](../../../visual-basic/language-reference/modifiers/protected.md)</span></span><br /><span data-ttu-id="2e6a1-114">-   [朋友](../../../visual-basic/language-reference/modifiers/friend.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-114">-   [Friend](../../../visual-basic/language-reference/modifiers/friend.md)</span></span><br /><span data-ttu-id="2e6a1-115">-   [私有](../../../visual-basic/language-reference/modifiers/private.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-115">-   [Private](../../../visual-basic/language-reference/modifiers/private.md)</span></span><br /><span data-ttu-id="2e6a1-116">- [受保护的朋友](../../language-reference/modifiers/protected-friend.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-116">- [Protected Friend](../../language-reference/modifiers/protected-friend.md)</span></span><br /><span data-ttu-id="2e6a1-117">- [私有保护](../../language-reference/modifiers/private-protected.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-117">- [Private Protected](../../language-reference/modifiers/private-protected.md)</span></span><br /><br /> <span data-ttu-id="2e6a1-118">请参阅 [Access levels in Visual Basic](../../../visual-basic/programming-guide/language-features/declared-elements/access-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-118">See [Access levels in Visual Basic](../../../visual-basic/programming-guide/language-features/declared-elements/access-levels.md).</span></span>|
|`Shadows`|<span data-ttu-id="2e6a1-119">可选。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-119">Optional.</span></span> <span data-ttu-id="2e6a1-120">请参阅[阴影](../../../visual-basic/language-reference/modifiers/shadows.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-120">See [Shadows](../../../visual-basic/language-reference/modifiers/shadows.md).</span></span>|
|`charsetmodifier`|<span data-ttu-id="2e6a1-121">可选。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-121">Optional.</span></span> <span data-ttu-id="2e6a1-122">指定字符集和文件搜索信息。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-122">Specifies character set and file search information.</span></span> <span data-ttu-id="2e6a1-123">可以是以下各项之一：</span><span class="sxs-lookup"><span data-stu-id="2e6a1-123">Can be one of the following:</span></span><br /><br /> <span data-ttu-id="2e6a1-124">-   [Ansi](../../../visual-basic/language-reference/modifiers/ansi.md) （默认值）</span><span class="sxs-lookup"><span data-stu-id="2e6a1-124">-   [Ansi](../../../visual-basic/language-reference/modifiers/ansi.md) (default)</span></span><br /><span data-ttu-id="2e6a1-125">-   [Unicode](../../../visual-basic/language-reference/modifiers/unicode.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-125">-   [Unicode](../../../visual-basic/language-reference/modifiers/unicode.md)</span></span><br /><span data-ttu-id="2e6a1-126">-   [自动](../../../visual-basic/language-reference/modifiers/auto.md)</span><span class="sxs-lookup"><span data-stu-id="2e6a1-126">-   [Auto](../../../visual-basic/language-reference/modifiers/auto.md)</span></span>|
|`Sub`|<span data-ttu-id="2e6a1-127">可选，但必须出现 `Sub` 或 `Function`。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-127">Optional, but either `Sub` or `Function` must appear.</span></span> <span data-ttu-id="2e6a1-128">指示外部过程不返回值。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-128">Indicates that the external procedure does not return a value.</span></span>|
|`Function`|<span data-ttu-id="2e6a1-129">可选，但必须出现 `Sub` 或 `Function`。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-129">Optional, but either `Sub` or `Function` must appear.</span></span> <span data-ttu-id="2e6a1-130">指示外部过程返回值。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-130">Indicates that the external procedure returns a value.</span></span>|
|`name`|<span data-ttu-id="2e6a1-131">必需。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-131">Required.</span></span> <span data-ttu-id="2e6a1-132">此外部引用的名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-132">Name of this external reference.</span></span> <span data-ttu-id="2e6a1-133">有关详细信息，请参阅已[声明的元素名称](../../../visual-basic/programming-guide/language-features/declared-elements/declared-element-names.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-133">For more information, see [Declared Element Names](../../../visual-basic/programming-guide/language-features/declared-elements/declared-element-names.md).</span></span>|
|`Lib`|<span data-ttu-id="2e6a1-134">必需。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-134">Required.</span></span> <span data-ttu-id="2e6a1-135">引入 `Lib` 子句，该子句标识包含外部过程的外部文件（DLL 或代码资源）。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-135">Introduces a `Lib` clause, which identifies the external file (DLL or code resource) that contains an external procedure.</span></span>|
|`libname`|<span data-ttu-id="2e6a1-136">必需。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-136">Required.</span></span> <span data-ttu-id="2e6a1-137">包含已声明过程的文件的名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-137">Name of the file that contains the declared procedure.</span></span>|
|`Alias`|<span data-ttu-id="2e6a1-138">可选。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-138">Optional.</span></span> <span data-ttu-id="2e6a1-139">指示无法在其文件中按照 `name`中指定的名称标识所声明的过程。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-139">Indicates that the procedure being declared cannot be identified within its file by the name specified in `name`.</span></span> <span data-ttu-id="2e6a1-140">在 `aliasname`中指定其标识。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-140">You specify its identification in `aliasname`.</span></span>|
|`aliasname`|<span data-ttu-id="2e6a1-141">如果使用 `Alias` 关键字，则为必需。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-141">Required if you use the `Alias` keyword.</span></span> <span data-ttu-id="2e6a1-142">通过以下两种方式之一标识过程的字符串：</span><span class="sxs-lookup"><span data-stu-id="2e6a1-142">String that identifies the procedure in one of two ways:</span></span><br /><br /> <span data-ttu-id="2e6a1-143">过程在其文件中的入口点名称，在引号（`""`）中</span><span class="sxs-lookup"><span data-stu-id="2e6a1-143">The entry point name of the procedure within its file, within quotes (`""`)</span></span><br /><br /> <span data-ttu-id="2e6a1-144">\- 或 -</span><span class="sxs-lookup"><span data-stu-id="2e6a1-144">-or-</span></span><br /><br /> <span data-ttu-id="2e6a1-145">数字符号（`#`），后跟一个整数，该整数指定过程入口点在其文件中的序号</span><span class="sxs-lookup"><span data-stu-id="2e6a1-145">A number sign (`#`) followed by an integer specifying the ordinal number of the procedure's entry point within its file</span></span>|
|`parameterlist`|<span data-ttu-id="2e6a1-146">如果过程使用参数，则为必需。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-146">Required if the procedure takes parameters.</span></span> <span data-ttu-id="2e6a1-147">请参阅[参数列表](../../../visual-basic/language-reference/statements/parameter-list.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-147">See [Parameter List](../../../visual-basic/language-reference/statements/parameter-list.md).</span></span>|
|`returntype`|<span data-ttu-id="2e6a1-148">如果指定 `Function` 并且 `Option Strict` `On`，则为必需。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-148">Required if `Function` is specified and `Option Strict` is `On`.</span></span> <span data-ttu-id="2e6a1-149">过程返回的值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-149">Data type of the value returned by the procedure.</span></span>|

## <a name="remarks"></a><span data-ttu-id="2e6a1-150">备注</span><span class="sxs-lookup"><span data-stu-id="2e6a1-150">Remarks</span></span>

<span data-ttu-id="2e6a1-151">有时，您需要调用项目外的文件（如 DLL 或代码资源）中定义的过程。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-151">Sometimes you need to call a procedure defined in a file (such as a DLL or code resource) outside your project.</span></span> <span data-ttu-id="2e6a1-152">当你执行此操作时，Visual Basic 编译器不能访问正确调用过程所需的信息，例如过程所在的位置、标识方法、调用序列和返回类型，以及它使用的字符串字符集。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-152">When you do this, the Visual Basic compiler does not have access to the information it needs to call the procedure correctly, such as where the procedure is located, how it is identified, its calling sequence and return type, and the string character set it uses.</span></span> <span data-ttu-id="2e6a1-153">`Declare` 语句创建对外部过程的引用并提供此必要信息。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-153">The `Declare` statement creates a reference to an external procedure and supplies this necessary information.</span></span>

<span data-ttu-id="2e6a1-154">只能在模块级别使用 `Declare`。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-154">You can use `Declare` only at module level.</span></span> <span data-ttu-id="2e6a1-155">这意味着外部引用的*声明上下文*必须是类、结构或模块，不能是源文件、命名空间、接口、过程或块。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-155">This means the *declaration context* for an external reference must be a class, structure, or module, and cannot be a source file, namespace, interface, procedure, or block.</span></span> <span data-ttu-id="2e6a1-156">有关详细信息，请参阅[声明上下文和默认访问级别](../../../visual-basic/language-reference/statements/declaration-contexts-and-default-access-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-156">For more information, see [Declaration Contexts and Default Access Levels](../../../visual-basic/language-reference/statements/declaration-contexts-and-default-access-levels.md).</span></span>

<span data-ttu-id="2e6a1-157">外部引用默认为[公共](../../../visual-basic/language-reference/modifiers/public.md)访问。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-157">External references default to [Public](../../../visual-basic/language-reference/modifiers/public.md) access.</span></span> <span data-ttu-id="2e6a1-158">您可以使用访问修饰符调整其访问级别。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-158">You can adjust their access levels with the access modifiers.</span></span>

## <a name="rules"></a><span data-ttu-id="2e6a1-159">规则</span><span class="sxs-lookup"><span data-stu-id="2e6a1-159">Rules</span></span>

- <span data-ttu-id="2e6a1-160">**属性.**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-160">**Attributes.**</span></span> <span data-ttu-id="2e6a1-161">您可以将属性应用于外部引用。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-161">You can apply attributes to an external reference.</span></span> <span data-ttu-id="2e6a1-162">所应用的任何属性仅在您的项目中有效，而不是在外部文件中。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-162">Any attribute you apply has effect only in your project, not in the external file.</span></span>

- <span data-ttu-id="2e6a1-163">**组成.**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-163">**Modifiers.**</span></span> <span data-ttu-id="2e6a1-164">外部过程是隐式[共享](../../../visual-basic/language-reference/modifiers/shared.md)的。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-164">External procedures are implicitly [Shared](../../../visual-basic/language-reference/modifiers/shared.md).</span></span> <span data-ttu-id="2e6a1-165">声明外部引用时，不能使用 `Shared` 关键字，也不能更改其共享状态。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-165">You cannot use the `Shared` keyword when declaring an external reference, and you cannot alter its shared status.</span></span>

  <span data-ttu-id="2e6a1-166">外部过程不能参与重写、实现接口成员或处理事件。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-166">An external procedure cannot participate in overriding, implement interface members, or handle events.</span></span> <span data-ttu-id="2e6a1-167">因此，不能在 `Implements`语句中使用 `Overrides`、`Overridable`、`NotOverridable`、`MustOverride`、`Handles` 或 `Declare` 关键字。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-167">Accordingly, you cannot use the `Overrides`, `Overridable`, `NotOverridable`, `MustOverride`, `Implements`, or `Handles` keyword in a `Declare` statement.</span></span>

- <span data-ttu-id="2e6a1-168">**外部过程名称。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-168">**External Procedure Name.**</span></span> <span data-ttu-id="2e6a1-169">您不必为此外部引用指定与过程在其外部文件（`aliasname`）中的入口点名称相同的名称（在 `name`中）。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-169">You do not have to give this external reference the same name (in `name`) as the procedure's entry-point name within its external file (`aliasname`).</span></span> <span data-ttu-id="2e6a1-170">您可以使用 `Alias` 子句来指定入口点名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-170">You can use an `Alias` clause to specify the entry-point name.</span></span> <span data-ttu-id="2e6a1-171">如果外部过程与同一范围内的 Visual Basic 保留修饰符、变量、过程或任何其他编程元素同名，这会很有用。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-171">This can be useful if the external procedure has the same name as a Visual Basic reserved modifier or a variable, procedure, or any other programming element in the same scope.</span></span>

  > [!NOTE]
  > <span data-ttu-id="2e6a1-172">大多数 Dll 中的入口点名称都区分大小写。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-172">Entry-point names in most DLLs are case-sensitive.</span></span>

- <span data-ttu-id="2e6a1-173">**外部过程号。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-173">**External Procedure Number.**</span></span> <span data-ttu-id="2e6a1-174">或者，您可以使用 `Alias` 子句来指定外部文件的导出表中入口点的序号。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-174">Alternatively, you can use an `Alias` clause to specify the ordinal number of the entry point within the export table of the external file.</span></span> <span data-ttu-id="2e6a1-175">为此，您开始 `aliasname` 数字符号（`#`）。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-175">To do this, you begin `aliasname` with a number sign (`#`).</span></span> <span data-ttu-id="2e6a1-176">如果 Visual Basic 中不允许使用外部过程名称中的任何字符，或者如果外部文件导出没有名称的过程，则这会很有用。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-176">This can be useful if any character in the external procedure name is not allowed in Visual Basic, or if the external file exports the procedure without a name.</span></span>

## <a name="data-type-rules"></a><span data-ttu-id="2e6a1-177">数据类型规则</span><span class="sxs-lookup"><span data-stu-id="2e6a1-177">Data Type Rules</span></span>

- <span data-ttu-id="2e6a1-178">**参数数据类型。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-178">**Parameter Data Types.**</span></span> <span data-ttu-id="2e6a1-179">如果 `On``Option Strict`，则必须在 `parameterlist`中指定每个参数的数据类型。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-179">If `Option Strict` is `On`, you must specify the data type of each parameter in `parameterlist`.</span></span> <span data-ttu-id="2e6a1-180">这可以是任何数据类型，也可以是枚举、结构、类或接口的名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-180">This can be any data type or the name of an enumeration, structure, class, or interface.</span></span> <span data-ttu-id="2e6a1-181">在 `parameterlist`中，使用 `As` 子句来指定要传递给每个参数的参数的数据类型。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-181">Within `parameterlist`, you use an `As` clause to specify the data type of the argument to be passed to each parameter.</span></span>

  > [!NOTE]
  > <span data-ttu-id="2e6a1-182">如果没有为 .NET Framework 编写外部过程，则必须注意数据类型是对应的。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-182">If the external procedure was not written for the .NET Framework, you must take care that the data types correspond.</span></span> <span data-ttu-id="2e6a1-183">例如，如果使用 `Integer` 参数声明对 Visual Basic 6.0 过程的外部引用（Visual Basic 6.0 中的16位），则必须将相应的参数标识为 `Declare` 语句中的 `Short`，因为这是 Visual Basic 中的16位整数类型。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-183">For example, if you declare an external reference to a Visual Basic 6.0 procedure with an `Integer` parameter (16 bits in Visual Basic 6.0), you must identify the corresponding argument as `Short` in the `Declare` statement, because that is the 16-bit integer type in Visual Basic.</span></span> <span data-ttu-id="2e6a1-184">同样，`Long` 在 Visual Basic 6.0 中具有不同的数据宽度，`Date` 的实现方式不同。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-184">Similarly, `Long` has a different data width in Visual Basic 6.0, and `Date` is implemented differently.</span></span>

- <span data-ttu-id="2e6a1-185">**返回数据类型。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-185">**Return Data Type.**</span></span> <span data-ttu-id="2e6a1-186">如果外部过程是 `Function` 并且 `Option Strict` `On`，则必须指定返回到调用代码的值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-186">If the external procedure is a `Function` and `Option Strict` is `On`, you must specify the data type of the value returned to the calling code.</span></span> <span data-ttu-id="2e6a1-187">这可以是任何数据类型，也可以是枚举、结构、类或接口的名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-187">This can be any data type or the name of an enumeration, structure, class, or interface.</span></span>

  > [!NOTE]
  > <span data-ttu-id="2e6a1-188">Visual Basic 编译器不会验证数据类型是否与外部过程的数据类型兼容。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-188">The Visual Basic compiler does not verify that your data types are compatible with those of the external procedure.</span></span> <span data-ttu-id="2e6a1-189">如果存在不匹配的情况，则公共语言运行时将在运行时生成 <xref:System.Runtime.InteropServices.MarshalDirectiveException> 异常。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-189">If there is a mismatch, the common language runtime generates a <xref:System.Runtime.InteropServices.MarshalDirectiveException> exception at run time.</span></span>

- <span data-ttu-id="2e6a1-190">**默认数据类型。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-190">**Default Data Types.**</span></span> <span data-ttu-id="2e6a1-191">如果 `Off` `Option Strict` 并且未在 `parameterlist`指定参数的数据类型，则 Visual Basic 编译器会将相应的参数转换为[对象数据类型](../../../visual-basic/language-reference/data-types/object-data-type.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-191">If `Option Strict` is `Off` and you do not specify the data type of a parameter in `parameterlist`, the Visual Basic compiler converts the corresponding argument to the [Object Data Type](../../../visual-basic/language-reference/data-types/object-data-type.md).</span></span> <span data-ttu-id="2e6a1-192">同样，如果不指定 `returntype`，编译器会将返回数据类型作为 `Object`。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-192">Similarly, if you do not specify `returntype`, the compiler takes the return data type to be `Object`.</span></span>

  > [!NOTE]
  > <span data-ttu-id="2e6a1-193">因为你要处理的是可能已在其他平台上编写的外部过程，所以对数据类型进行任何假设或允许其默认值是危险的。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-193">Because you are dealing with an external procedure that might have been written on a different platform, it is dangerous to make any assumptions about data types or to allow them to default.</span></span> <span data-ttu-id="2e6a1-194">最安全的方法是指定每个参数的数据类型和返回值（如果有）。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-194">It is much safer to specify the data type of every parameter and of the return value, if any.</span></span> <span data-ttu-id="2e6a1-195">这也会提高代码的可读性。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-195">This also improves the readability of your code.</span></span>

## <a name="behavior"></a><span data-ttu-id="2e6a1-196">行为</span><span class="sxs-lookup"><span data-stu-id="2e6a1-196">Behavior</span></span>

- <span data-ttu-id="2e6a1-197">**内.**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-197">**Scope.**</span></span> <span data-ttu-id="2e6a1-198">外部引用在其类、结构或模块的范围内。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-198">An external reference is in scope throughout its class, structure, or module.</span></span>

- <span data-ttu-id="2e6a1-199">**生存期.**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-199">**Lifetime.**</span></span> <span data-ttu-id="2e6a1-200">外部引用与声明它的类、结构或模块具有相同的生存期。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-200">An external reference has the same lifetime as the class, structure, or module in which it is declared.</span></span>

- <span data-ttu-id="2e6a1-201">**调用外部过程。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-201">**Calling an External Procedure.**</span></span> <span data-ttu-id="2e6a1-202">调用外部过程的方法与调用 `Function` 或 `Sub` 过程的方法相同，方法是在表达式中使用它，如果返回值，则在表达式中使用它; 如果不返回值，则在[Call 语句](../../../visual-basic/language-reference/statements/call-statement.md)中指定。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-202">You call an external procedure the same way you call a `Function` or `Sub` procedure—by using it in an expression if it returns a value, or by specifying it in a [Call Statement](../../../visual-basic/language-reference/statements/call-statement.md) if it does not return a value.</span></span>

  <span data-ttu-id="2e6a1-203">您可以按 `Declare` 语句中 `parameterlist` 的指定完全将参数传递给外部过程。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-203">You pass arguments to the external procedure exactly as specified by `parameterlist` in the `Declare` statement.</span></span> <span data-ttu-id="2e6a1-204">不要考虑参数最初在外部文件中的声明方式。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-204">Do not take into account how the parameters were originally declared in the external file.</span></span> <span data-ttu-id="2e6a1-205">同样，如果有返回值，则按 `Declare` 语句中 `returntype` 的指定方式使用。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-205">Similarly, if there is a return value, use it exactly as specified by `returntype` in the `Declare` statement.</span></span>

- <span data-ttu-id="2e6a1-206">**字符集。**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-206">**Character Sets.**</span></span> <span data-ttu-id="2e6a1-207">您可以在 `charsetmodifier` Visual Basic 在调用外部过程时如何封送字符串。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-207">You can specify in `charsetmodifier` how Visual Basic should marshal strings when it calls the external procedure.</span></span> <span data-ttu-id="2e6a1-208">`Ansi` 修饰符指示 Visual Basic 将所有字符串封送为 ANSI 值，`Unicode` 修饰符指示它将所有字符串封送为 Unicode 值。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-208">The `Ansi` modifier directs Visual Basic to marshal all strings to ANSI values, and the `Unicode` modifier directs it to marshal all strings to Unicode values.</span></span> <span data-ttu-id="2e6a1-209">`Auto` 修饰符根据外部引用 `name`或 `aliasname` （如果已指定）指示 Visual Basic 封送 .NET Framework 字符串。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-209">The `Auto` modifier directs Visual Basic to marshal strings according to .NET Framework rules based on the external reference `name`, or `aliasname` if specified.</span></span> <span data-ttu-id="2e6a1-210">默认值为 `Ansi`。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-210">The default value is `Ansi`.</span></span>

  <span data-ttu-id="2e6a1-211">`charsetmodifier` 还指定了 Visual Basic 应该如何查找外部文件中的外部过程。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-211">`charsetmodifier` also specifies how Visual Basic should look up the external procedure within its external file.</span></span> <span data-ttu-id="2e6a1-212">`Ansi` 和 `Unicode` 直接 Visual Basic 在搜索过程中进行查找，而不修改其名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-212">`Ansi` and `Unicode` both direct Visual Basic to look it up without modifying its name during the search.</span></span> <span data-ttu-id="2e6a1-213">`Auto` 指示 Visual Basic 确定运行时平台的基本字符集，并可能修改外部过程名称，如下所示：</span><span class="sxs-lookup"><span data-stu-id="2e6a1-213">`Auto` directs Visual Basic to determine the base character set of the run-time platform and possibly modify the external procedure name, as follows:</span></span>

  - <span data-ttu-id="2e6a1-214">在 ANSI 平台（如 Windows 95、Windows 98 或 Windows Millennium Edition）上，首先查找不带名称修改的外部过程。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-214">On an ANSI platform, such as Windows 95, Windows 98, or Windows Millennium Edition, first look up the external procedure with no name modification.</span></span> <span data-ttu-id="2e6a1-215">如果此操作失败，请在外部过程名称末尾追加 "A"，并再次查找。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-215">If that fails, append "A" to the end of the external procedure name and look it up again.</span></span>

  - <span data-ttu-id="2e6a1-216">在 Unicode 平台（如 Windows NT、Windows 2000 或 Windows XP）上，首先查找外部过程，而不修改名称。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-216">On a Unicode platform, such as Windows NT, Windows 2000, or Windows XP, first look up the external procedure with no name modification.</span></span> <span data-ttu-id="2e6a1-217">如果此操作失败，请将 "W" 追加到外部过程名称的末尾，并再次查找。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-217">If that fails, append "W" to the end of the external procedure name and look it up again.</span></span>

- <span data-ttu-id="2e6a1-218">**机制.**</span><span class="sxs-lookup"><span data-stu-id="2e6a1-218">**Mechanism.**</span></span> <span data-ttu-id="2e6a1-219">Visual Basic 使用 .NET Framework*平台调用*（PInvoke）机制来解析和访问外部过程。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-219">Visual Basic uses the .NET Framework *platform invoke* (PInvoke) mechanism to resolve and access external procedures.</span></span> <span data-ttu-id="2e6a1-220">`Declare` 语句和 <xref:System.Runtime.InteropServices.DllImportAttribute> 类都自动使用这种机制，无需任何对 PInvoke 的了解。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-220">The `Declare` statement and the <xref:System.Runtime.InteropServices.DllImportAttribute> class both use this mechanism automatically, and you do not need any knowledge of PInvoke.</span></span> <span data-ttu-id="2e6a1-221">有关详细信息，请参阅[演练：调用 Windows api](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-221">For more information, see [Walkthrough: Calling Windows APIs](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2e6a1-222">如果外部过程在公共语言运行时（CLR）之外运行，则它是不*受管理的代码*。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-222">If the external procedure runs outside the common language runtime (CLR), it is *unmanaged code*.</span></span> <span data-ttu-id="2e6a1-223">如果调用此类过程（例如 Windows API 函数或 COM 方法），则可能会向应用程序带来安全风险。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-223">When you call such a procedure, for example a Windows API function or a COM method, you might expose your application to security risks.</span></span> <span data-ttu-id="2e6a1-224">有关详细信息，请参阅[非托管代码的安全编码指导原则](../../../framework/security/secure-coding-guidelines-for-unmanaged-code.md)。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-224">For more information, see [Secure Coding Guidelines for Unmanaged Code](../../../framework/security/secure-coding-guidelines-for-unmanaged-code.md).</span></span>

## <a name="example"></a><span data-ttu-id="2e6a1-225">示例</span><span class="sxs-lookup"><span data-stu-id="2e6a1-225">Example</span></span>

<span data-ttu-id="2e6a1-226">下面的示例声明一个对返回当前用户名的 `Function` 过程的外部引用。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-226">The following example declares an external reference to a `Function` procedure that returns the current user name.</span></span> <span data-ttu-id="2e6a1-227">然后，它调用外部过程作为 `getUser` 过程的一部分 `GetUserNameA`。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-227">It then calls the external procedure `GetUserNameA` as part of the `getUser` procedure.</span></span>

[!code-vb[VbVbalrStatements#15](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class1.vb#15)]

## <a name="example"></a><span data-ttu-id="2e6a1-228">示例</span><span class="sxs-lookup"><span data-stu-id="2e6a1-228">Example</span></span>

<span data-ttu-id="2e6a1-229"><xref:System.Runtime.InteropServices.DllImportAttribute> 提供了一种在非托管代码中使用函数的替代方法。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-229">The <xref:System.Runtime.InteropServices.DllImportAttribute> provides an alternative way of using functions in unmanaged code.</span></span> <span data-ttu-id="2e6a1-230">下面的示例声明一个导入的函数，而不使用 `Declare` 语句。</span><span class="sxs-lookup"><span data-stu-id="2e6a1-230">The following example declares an imported function without using a `Declare` statement.</span></span>

[!code-vb[VbVbalrStatements#16](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class1.vb#16)]

[!code-vb[VbVbalrStatements#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class1.vb#1)]

## <a name="see-also"></a><span data-ttu-id="2e6a1-231">另请参阅</span><span class="sxs-lookup"><span data-stu-id="2e6a1-231">See also</span></span>

- <xref:Microsoft.VisualBasic.ErrObject.LastDllError%2A>
- [<span data-ttu-id="2e6a1-232">Imports 语句（.NET 命名空间和类型）</span><span class="sxs-lookup"><span data-stu-id="2e6a1-232">Imports Statement (.NET Namespace and Type)</span></span>](../../../visual-basic/language-reference/statements/imports-statement-net-namespace-and-type.md)
- [<span data-ttu-id="2e6a1-233">AddressOf 运算符</span><span class="sxs-lookup"><span data-stu-id="2e6a1-233">AddressOf Operator</span></span>](../../../visual-basic/language-reference/operators/addressof-operator.md)
- [<span data-ttu-id="2e6a1-234">Function 语句</span><span class="sxs-lookup"><span data-stu-id="2e6a1-234">Function Statement</span></span>](../../../visual-basic/language-reference/statements/function-statement.md)
- [<span data-ttu-id="2e6a1-235">Sub 语句</span><span class="sxs-lookup"><span data-stu-id="2e6a1-235">Sub Statement</span></span>](../../../visual-basic/language-reference/statements/sub-statement.md)
- [<span data-ttu-id="2e6a1-236">参数列表</span><span class="sxs-lookup"><span data-stu-id="2e6a1-236">Parameter List</span></span>](../../../visual-basic/language-reference/statements/parameter-list.md)
- [<span data-ttu-id="2e6a1-237">Call 语句</span><span class="sxs-lookup"><span data-stu-id="2e6a1-237">Call Statement</span></span>](../../../visual-basic/language-reference/statements/call-statement.md)
- [<span data-ttu-id="2e6a1-238">演练：调用 Windows API</span><span class="sxs-lookup"><span data-stu-id="2e6a1-238">Walkthrough: Calling Windows APIs</span></span>](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md)
