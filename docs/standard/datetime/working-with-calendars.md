---
title: 使用日历
ms.date: 04/01/2019
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- globalization [.NET], calendars
- calendars, global applications
- global applications, calendars
- world-ready applications, calendars
- international applications [.NET], calendars
- culture, calendars
ms.assetid: 0c1534e5-979b-4c8a-a588-1c24301aefb3
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 28e1979b6ceb1b343764900cc7d49a576a7a4030
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/30/2019
ms.locfileid: "68630546"
---
# <a name="working-with-calendars"></a><span data-ttu-id="0f7a0-102">使用日历</span><span class="sxs-lookup"><span data-stu-id="0f7a0-102">Working with calendars</span></span>

<span data-ttu-id="0f7a0-103">尽管日期和时间值表示时间中的某一刻，但其字符串表示形式区分区域性，并取决于特定区域性显示日期和时间值所用的约定以及该区域性使用的日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-103">Although a date and time value represents a moment in time, its string representation is culture-sensitive and depends both on the conventions used for displaying date and time values by a specific culture and on the calendar used by that culture.</span></span> <span data-ttu-id="0f7a0-104">本主题探讨了对 .NET 中的日历的支持, 并讨论了使用日期值时的 calendar 类的使用。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-104">This topic explores the support for calendars in .NET and discusses the use of the calendar classes when working with date values.</span></span>

## <a name="calendars-in-net"></a><span data-ttu-id="0f7a0-105">.NET 中的日历</span><span class="sxs-lookup"><span data-stu-id="0f7a0-105">Calendars in .NET</span></span>

<span data-ttu-id="0f7a0-106">.Net 中的所有日历均派生<xref:System.Globalization.Calendar?displayProperty=nameWithType>自类, 该类提供基本日历实现。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-106">All calendars in .NET derive from the <xref:System.Globalization.Calendar?displayProperty=nameWithType> class, which provides the base calendar implementation.</span></span> <span data-ttu-id="0f7a0-107">从 <xref:System.Globalization.Calendar> 类继承的类之一是 <xref:System.Globalization.EastAsianLunisolarCalendar> 类，该类是所有阴阳历的基类。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-107">One of the classes that inherits from the <xref:System.Globalization.Calendar> class is the <xref:System.Globalization.EastAsianLunisolarCalendar> class, which is the base class for all lunisolar calendars.</span></span> <span data-ttu-id="0f7a0-108">.NET 包括以下日历实现:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-108">.NET includes the following calendar implementations:</span></span>

* <span data-ttu-id="0f7a0-109"><xref:System.Globalization.ChineseLunisolarCalendar>，表示中国阴阳历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-109"><xref:System.Globalization.ChineseLunisolarCalendar>, which represents the Chinese lunisolar calendar.</span></span>

* <span data-ttu-id="0f7a0-110"><xref:System.Globalization.GregorianCalendar>，表示公历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-110"><xref:System.Globalization.GregorianCalendar>, which represents the Gregorian calendar.</span></span> <span data-ttu-id="0f7a0-111">此日历进一步细分为 <xref:System.Globalization.GregorianCalendarTypes?displayProperty=nameWithType> 枚举定义的子类型（如阿拉伯和中东法国）。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-111">This calendar is further divided into subtypes (such as Arabic and Middle East French) that are defined by the <xref:System.Globalization.GregorianCalendarTypes?displayProperty=nameWithType> enumeration.</span></span> <span data-ttu-id="0f7a0-112"><xref:System.Globalization.GregorianCalendar.CalendarType%2A?displayProperty=nameWithType> 属性指定公历的子类型。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-112">The <xref:System.Globalization.GregorianCalendar.CalendarType%2A?displayProperty=nameWithType> property specifies the subtype of the Gregorian calendar.</span></span>

* <span data-ttu-id="0f7a0-113"><xref:System.Globalization.HebrewCalendar>，表示希伯来历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-113"><xref:System.Globalization.HebrewCalendar>, which represents the Hebrew calendar.</span></span>

* <span data-ttu-id="0f7a0-114"><xref:System.Globalization.HijriCalendar>，表示回历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-114"><xref:System.Globalization.HijriCalendar>, which represents the Hijri calendar.</span></span>

* <span data-ttu-id="0f7a0-115"><xref:System.Globalization.JapaneseCalendar>，表示日本历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-115"><xref:System.Globalization.JapaneseCalendar>, which represents the Japanese calendar.</span></span>

* <span data-ttu-id="0f7a0-116"><xref:System.Globalization.JapaneseLunisolarCalendar>，表示日本阴阳历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-116"><xref:System.Globalization.JapaneseLunisolarCalendar>, which represents the Japanese lunisolar calendar.</span></span>

* <span data-ttu-id="0f7a0-117"><xref:System.Globalization.JulianCalendar>，表示罗马儒略历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-117"><xref:System.Globalization.JulianCalendar>, which represents the Julian calendar.</span></span>

* <span data-ttu-id="0f7a0-118"><xref:System.Globalization.KoreanCalendar>，表示朝鲜历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-118"><xref:System.Globalization.KoreanCalendar>, which represents the Korean calendar.</span></span>

* <span data-ttu-id="0f7a0-119"><xref:System.Globalization.KoreanLunisolarCalendar>，表示朝鲜阴阳历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-119"><xref:System.Globalization.KoreanLunisolarCalendar>, which represents the Korean lunisolar calendar.</span></span>

* <span data-ttu-id="0f7a0-120"><xref:System.Globalization.PersianCalendar>，表示波斯历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-120"><xref:System.Globalization.PersianCalendar>, which represents the Persian calendar.</span></span>

* <span data-ttu-id="0f7a0-121"><xref:System.Globalization.TaiwanCalendar>，表示台湾历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-121"><xref:System.Globalization.TaiwanCalendar>, which represents the Taiwan calendar.</span></span>

* <span data-ttu-id="0f7a0-122"><xref:System.Globalization.TaiwanLunisolarCalendar>，表示台湾阴阳历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-122"><xref:System.Globalization.TaiwanLunisolarCalendar>, which represents the Taiwan lunisolar calendar.</span></span>

* <span data-ttu-id="0f7a0-123"><xref:System.Globalization.ThaiBuddhistCalendar>，表示泰国佛历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-123"><xref:System.Globalization.ThaiBuddhistCalendar>, which represents the Thai Buddhist calendar.</span></span>

* <span data-ttu-id="0f7a0-124"><xref:System.Globalization.UmAlQuraCalendar>，表示古兰经历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-124"><xref:System.Globalization.UmAlQuraCalendar>, which represents the Um Al Qura calendar.</span></span>

<span data-ttu-id="0f7a0-125">可通过以下两种方法之一来使用日历：</span><span class="sxs-lookup"><span data-stu-id="0f7a0-125">A calendar can be used in one of two ways:</span></span>

* <span data-ttu-id="0f7a0-126">作为特定区域性使用的日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-126">As the calendar used by a specific culture.</span></span> <span data-ttu-id="0f7a0-127">每个 <xref:System.Globalization.CultureInfo> 对象都有当前日历，这是该对象当前使用的日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-127">Each <xref:System.Globalization.CultureInfo> object has a current calendar, which is the calendar that the object is currently using.</span></span> <span data-ttu-id="0f7a0-128">所有日期和时间值的字符串表示形式会自动反映当前的区域性及其当前日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-128">The string representations of all date and time values automatically reflect the current culture and its current calendar.</span></span> <span data-ttu-id="0f7a0-129">通常，当前的日历是该区域性的默认日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-129">Typically, the current calendar is the culture's default calendar.</span></span> <span data-ttu-id="0f7a0-130"><xref:System.Globalization.CultureInfo>对象还具有可选日历, 其中包含区域性可使用的其他日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-130"><xref:System.Globalization.CultureInfo> objects also have optional calendars, which include additional calendars that the culture can use.</span></span>

* <span data-ttu-id="0f7a0-131">作为与特定区域性无关的独立日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-131">As a standalone calendar independent of a specific culture.</span></span> <span data-ttu-id="0f7a0-132">在这种情况下，<xref:System.Globalization.Calendar> 方法用于将日期表示为反映日历的值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-132">In this case, <xref:System.Globalization.Calendar> methods are used to express dates as values that reflect the calendar.</span></span>

<span data-ttu-id="0f7a0-133">请注意，以下六个日历类只能用作独立日历：<xref:System.Globalization.ChineseLunisolarCalendar>、<xref:System.Globalization.JapaneseLunisolarCalendar>、<xref:System.Globalization.JulianCalendar>、<xref:System.Globalization.KoreanLunisolarCalendar>、<xref:System.Globalization.PersianCalendar> 和 <xref:System.Globalization.TaiwanLunisolarCalendar>。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-133">Note that six calendar classes – <xref:System.Globalization.ChineseLunisolarCalendar>, <xref:System.Globalization.JapaneseLunisolarCalendar>, <xref:System.Globalization.JulianCalendar>, <xref:System.Globalization.KoreanLunisolarCalendar>, <xref:System.Globalization.PersianCalendar>, and <xref:System.Globalization.TaiwanLunisolarCalendar> – can be used only as standalone calendars.</span></span> <span data-ttu-id="0f7a0-134">任何区域性都不将这些日历用作默认日历或可选日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-134">They are not used by any culture as either the default calendar or as an optional calendar.</span></span>

## <a name="calendars-and-cultures"></a><span data-ttu-id="0f7a0-135">日历和区域性</span><span class="sxs-lookup"><span data-stu-id="0f7a0-135">Calendars and cultures</span></span>

<span data-ttu-id="0f7a0-136">每个区域性都有默认日历，由 <xref:System.Globalization.CultureInfo.Calendar%2A?displayProperty=nameWithType> 属性定义。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-136">Each culture has a default calendar, which is defined by the <xref:System.Globalization.CultureInfo.Calendar%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0f7a0-137"><xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> 属性可返回 <xref:System.Globalization.Calendar> 对象的数组，该数组指定特定区域性支持的所有日历，包括该区域性的默认日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-137">The <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> property returns an array of <xref:System.Globalization.Calendar> objects that specifies all the calendars supported by a particular culture, including that culture's default calendar.</span></span>

<span data-ttu-id="0f7a0-138">下面的示例演示 <xref:System.Globalization.CultureInfo.Calendar%2A?displayProperty=nameWithType> 和 <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> 属性。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-138">The following example illustrates the <xref:System.Globalization.CultureInfo.Calendar%2A?displayProperty=nameWithType> and <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> properties.</span></span> <span data-ttu-id="0f7a0-139">该示例为泰语（泰国）和日语（日本）区域性创建 `CultureInfo` 对象，并显示它们的默认和可选日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-139">It creates `CultureInfo` objects for the Thai (Thailand) and Japanese (Japan) cultures and displays their default and optional calendars.</span></span> <span data-ttu-id="0f7a0-140">请注意，在这两种情况下，区域性的默认日历也包括在 <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> 集合中。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-140">Note that in both cases, the culture's default calendar is also included in the <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> collection.</span></span>

[!code-csharp[Conceptual.Calendars#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/calendarinfo1.cs#1)]
[!code-vb[Conceptual.Calendars#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/calendarinfo1.vb#1)]

<span data-ttu-id="0f7a0-141">特定 <xref:System.Globalization.CultureInfo> 对象当前正在使用的日历由区域性的 <xref:System.Globalization.DateTimeFormatInfo.Calendar%2A?displayProperty=nameWithType> 属性定义。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-141">The calendar currently in use by a particular <xref:System.Globalization.CultureInfo> object is defined by the culture's <xref:System.Globalization.DateTimeFormatInfo.Calendar%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0f7a0-142">区域性的 <xref:System.Globalization.DateTimeFormatInfo> 对象由 <xref:System.Globalization.CultureInfo.DateTimeFormat%2A?displayProperty=nameWithType> 属性返回。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-142">A culture's <xref:System.Globalization.DateTimeFormatInfo> object is returned by the <xref:System.Globalization.CultureInfo.DateTimeFormat%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0f7a0-143">创建区域性时，其默认值与 <xref:System.Globalization.CultureInfo.Calendar%2A?displayProperty=nameWithType> 属性的值相同。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-143">When a culture is created, its default value is the same as the value of the <xref:System.Globalization.CultureInfo.Calendar%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0f7a0-144">但是，可将区域性的当前日历更改为 <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> 属性返回的数组中包含的任何日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-144">However, you can change the culture's current calendar to any calendar contained in the array returned by the <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0f7a0-145">如果尝试将当前日历设置为 <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> 属性值中不包括的日历，则会引发 <xref:System.ArgumentException>。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-145">If you try to set the current calendar to a calendar that is not included in the <xref:System.Globalization.CultureInfo.OptionalCalendars%2A?displayProperty=nameWithType> property value, an <xref:System.ArgumentException> is thrown.</span></span>

<span data-ttu-id="0f7a0-146">以下示例将更改阿拉伯（沙特阿拉伯）区域性使用的日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-146">The following example changes the calendar used by the Arabic (Saudi Arabia) culture.</span></span> <span data-ttu-id="0f7a0-147">它首先实例化一个 <xref:System.DateTime> 值并使用当前区域性（在此示例中，为英语（美国））和当前区域性的日历（在此示例中，为公历）显示该值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-147">It first instantiates a <xref:System.DateTime> value and displays it using the current culture - which, in this case, is English (United States) - and the current culture's calendar (which, in this case, is the Gregorian calendar).</span></span> <span data-ttu-id="0f7a0-148">接下来，该示例将当前区域性更改为阿拉伯语（沙特阿拉伯），并使用其默认的古兰经历显示该日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-148">Next, it changes the current culture to Arabic (Saudi Arabia) and displays the date using its default Um Al-Qura calendar.</span></span> <span data-ttu-id="0f7a0-149">然后，该示例调用 `CalendarExists` 方法来确定阿拉伯语（沙特阿拉伯）区域性是否支持该回历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-149">It then calls the `CalendarExists` method to determine whether the Hijri calendar is supported by the Arabic (Saudi Arabia) culture.</span></span> <span data-ttu-id="0f7a0-150">因为该日历受支持，所以该示例将当前日历更改为回历并再次显示日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-150">Because the calendar is supported, it changes the current calendar to Hijri and again displays the date.</span></span> <span data-ttu-id="0f7a0-151">请注意，在每种情况下，均使用当前区域性的当前日历来显示日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-151">Note that in each case, the date is displayed using the current culture's current calendar.</span></span>

[!code-csharp[Conceptual.Calendars#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/changecalendar2.cs#2)]
[!code-vb[Conceptual.Calendars#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/changecalendar2.vb#2)]

## <a name="dates-and-calendars"></a><span data-ttu-id="0f7a0-152">日期和日历</span><span class="sxs-lookup"><span data-stu-id="0f7a0-152">Dates and calendars</span></span>

<span data-ttu-id="0f7a0-153">除包括 <xref:System.Globalization.Calendar> 类型参数并允许日期的元素（即月、日和年）以指定日历反映值的构造函数外，<xref:System.DateTime> 和 <xref:System.DateTimeOffset> 值始终基于公历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-153">With the exception of the constructors that include a parameter of type <xref:System.Globalization.Calendar> and allow the elements of a date (that is, the month, the day, and the year) to reflect values in a designated calendar, both <xref:System.DateTime> and <xref:System.DateTimeOffset> values are always based on the Gregorian calendar.</span></span> <span data-ttu-id="0f7a0-154">例如，这意味着 <xref:System.DateTime.Year%2A?displayProperty=nameWithType> 属性返回公历的年，<xref:System.DateTime.Day%2A?displayProperty=nameWithType> 属性返回公历的当月日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-154">This means, for example, that the <xref:System.DateTime.Year%2A?displayProperty=nameWithType> property returns the year in the Gregorian calendar, and the <xref:System.DateTime.Day%2A?displayProperty=nameWithType> property returns the day of the month in the Gregorian calendar.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0f7a0-155">请记住，日期值与其字符串表示形式之间是有差异的，这一点很重要。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-155">It is important to remember that there is a difference between a date value and its string representation.</span></span> <span data-ttu-id="0f7a0-156">前者基于公历，后者基于特定区域性的当前日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-156">The former is based on the Gregorian calendar; the latter is based on the current calendar of a specific culture.</span></span>

<span data-ttu-id="0f7a0-157">下面的示例演示了 <xref:System.DateTime> 属性与其对应的 <xref:System.Globalization.Calendar> 方法之间的这一差异。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-157">The following example illustrates this difference between <xref:System.DateTime> properties and their corresponding <xref:System.Globalization.Calendar> methods.</span></span> <span data-ttu-id="0f7a0-158">在此示例中，当前区域性为阿拉伯语（埃及），当前日历为古兰经历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-158">In the example, the current culture is Arabic (Egypt), and the current calendar is Um Al Qura.</span></span> <span data-ttu-id="0f7a0-159"><xref:System.DateTime> 值设置为 2011 年 7 月 15 日。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-159">A <xref:System.DateTime> value is set to the fifteenth day of the seventh month of 2011.</span></span> <span data-ttu-id="0f7a0-160">很显然，该值被解释为公历日期，因为这些相同的值是由 <xref:System.DateTime.ToString%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> 方法在使用不变区域性的约定时返回的。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-160">It is clear that this is interpreted as a Gregorian date, because these same values are returned by the <xref:System.DateTime.ToString%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> method when it uses the conventions of the invariant culture.</span></span> <span data-ttu-id="0f7a0-161">使用当前区域性的约定设置格式后，该日期的字符串表示形式为 14/08/32，与古兰经历中的日期等效。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-161">The string representation of the date that is formatted using the conventions of the current culture is 14/08/32, which is the equivalent date in the Um Al Qura calendar.</span></span> <span data-ttu-id="0f7a0-162">接下来，使用 `DateTime` 和 `Calendar` 的成员返回 <xref:System.DateTime> 值的日、月和年。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-162">Next, members of `DateTime` and `Calendar` are used to return the day, the month, and the year of the <xref:System.DateTime> value.</span></span> <span data-ttu-id="0f7a0-163">在每种情况下，<xref:System.DateTime> 成员返回的值反映公历中的值，而 <xref:System.Globalization.UmAlQuraCalendar> 成员返回的值反映古兰经历中的值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-163">In each case, the values returned by <xref:System.DateTime> members reflect values in the Gregorian calendar, whereas values returned by <xref:System.Globalization.UmAlQuraCalendar> members reflect values in the Uum al-Qura calendar.</span></span>

[!code-csharp[Conceptual.Calendars#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/datesandcalendars2.cs#3)]
[!code-vb[Conceptual.Calendars#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/datesandcalendars2.vb#3)]

### <a name="instantiating-dates-based-on-a-calendar"></a><span data-ttu-id="0f7a0-164">基于日历实例化日期</span><span class="sxs-lookup"><span data-stu-id="0f7a0-164">Instantiating dates based on a calendar</span></span>

<span data-ttu-id="0f7a0-165">由于 <xref:System.DateTime> 和 <xref:System.DateTimeOffset> 值基于公历，因此如果要使用不同日历中的日、月或年的值，必须调用包括 <xref:System.Globalization.Calendar> 类型参数的重载构造函数来实例化日期值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-165">Because <xref:System.DateTime> and <xref:System.DateTimeOffset> values are based on the Gregorian calendar, you must call an overloaded constructor that includes a parameter of type <xref:System.Globalization.Calendar> to instantiate a date value if you want to use the day, month, or year values from a different calendar.</span></span> <span data-ttu-id="0f7a0-166">还可以调用特定日历的 <xref:System.Globalization.Calendar.ToDateTime%2A?displayProperty=nameWithType> 方法的重载之一，以基于特定日历的值来实例化 <xref:System.DateTime> 对象。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-166">You can also call one of the overloads of a specific calendar's <xref:System.Globalization.Calendar.ToDateTime%2A?displayProperty=nameWithType> method to instantiate a <xref:System.DateTime> object based on the values of a particular calendar.</span></span>

<span data-ttu-id="0f7a0-167">下面的示例通过向 <xref:System.DateTime> 构造函数传递一个 <xref:System.Globalization.HebrewCalendar> 对象来实例化一个 <xref:System.DateTime> 值，通过调用 <xref:System.DateTime> 方法来实例化另一个 <xref:System.Globalization.HebrewCalendar.ToDateTime%28System.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%29?displayProperty=nameWithType> 值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-167">The following example instantiates one <xref:System.DateTime> value by passing a <xref:System.Globalization.HebrewCalendar> object to a <xref:System.DateTime> constructor, and instantiates a second <xref:System.DateTime> value by calling the <xref:System.Globalization.HebrewCalendar.ToDateTime%28System.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="0f7a0-168">由于这两个值是使用希伯来历中的相同值创建的，因此对 <xref:System.DateTime.Equals%2A?displayProperty=nameWithType> 方法的调用显示这两个 <xref:System.DateTime> 值相等。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-168">Because the two values are created with identical values from the Hebrew calendar, the call to the <xref:System.DateTime.Equals%2A?displayProperty=nameWithType> method shows that the two <xref:System.DateTime> values are equal.</span></span>

[!code-csharp[Conceptual.Calendars#4](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/instantiatehcdate1.cs#4)]
[!code-vb[Conceptual.Calendars#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/instantiatehcdate1.vb#4)]

### <a name="representing-dates-in-the-current-calendar"></a><span data-ttu-id="0f7a0-169">表示当前日历中的日期</span><span class="sxs-lookup"><span data-stu-id="0f7a0-169">Representing dates in the current calendar</span></span>

<span data-ttu-id="0f7a0-170">在将日期转换为字符串时，日期和时间格式设置方法始终使用当前日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-170">Date and time formatting methods always use the current calendar when converting dates to strings.</span></span> <span data-ttu-id="0f7a0-171">这意味着，年、月和当月日期的字符串表示形式反映当前日历，不一定反映公历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-171">This means that the string representation of the year, the month, and the day of the month reflect the current calendar, and do not necessarily reflect the Gregorian calendar.</span></span>

<span data-ttu-id="0f7a0-172">下面的示例演示当前日历如何影响日期的字符串表示形式。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-172">The following example shows how the current calendar affects the string representation of a date.</span></span> <span data-ttu-id="0f7a0-173">该示例将当前区域性更改为中文（繁体，台湾），并实例化日期值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-173">It changes the current culture to Chinese (Traditional, Taiwan), and instantiates a date value.</span></span> <span data-ttu-id="0f7a0-174">然后，该示例显示当前日历和日期，将当前日历更改为 <xref:System.Globalization.TaiwanCalendar>，并再次显示当前日历和日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-174">It then displays the current calendar and the date, changes the current calendar to <xref:System.Globalization.TaiwanCalendar>, and displays the current calendar and date once again.</span></span> <span data-ttu-id="0f7a0-175">初次显示日期时，它表示为公历日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-175">The first time the date is displayed, it is represented as a date in the Gregorian calendar.</span></span> <span data-ttu-id="0f7a0-176">第二次显示日期时，它表示为台湾日历中的日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-176">The second time it is displayed, it is represented as a date in the Taiwan calendar.</span></span>

[!code-csharp[Conceptual.Calendars#5](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/currentcalendar1.cs#5)]
[!code-vb[Conceptual.Calendars#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/currentcalendar1.vb#5)]

### <a name="representing-dates-in-a-non-current-calendar"></a><span data-ttu-id="0f7a0-177">表示非当前日历中的日期</span><span class="sxs-lookup"><span data-stu-id="0f7a0-177">Representing dates in a non-current calendar</span></span>

<span data-ttu-id="0f7a0-178">若要使用特定区域性的当前日历之外的日历表示日期，必须调用该 <xref:System.Globalization.Calendar> 对象的方法。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-178">To represent a date using a calendar that is not the current calendar of a particular culture, you must call methods of that <xref:System.Globalization.Calendar> object.</span></span> <span data-ttu-id="0f7a0-179">例如，<xref:System.Globalization.Calendar.GetYear%2A?displayProperty=nameWithType>、<xref:System.Globalization.Calendar.GetMonth%2A?displayProperty=nameWithType> 和 <xref:System.Globalization.Calendar.GetDayOfMonth%2A?displayProperty=nameWithType> 方法可将年、月和日转换为反映特定日历的值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-179">For example, the <xref:System.Globalization.Calendar.GetYear%2A?displayProperty=nameWithType>, <xref:System.Globalization.Calendar.GetMonth%2A?displayProperty=nameWithType>, and <xref:System.Globalization.Calendar.GetDayOfMonth%2A?displayProperty=nameWithType> methods convert the year, month, and day to values that reflect a particular calendar.</span></span>

> [!WARNING]
> <span data-ttu-id="0f7a0-180">由于某些日历不是任何区域性的可选日历，因此用这些日历表示日期始终需要调用日历方法。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-180">Because some calendars are not optional calendars of any culture, representing dates in these calendars always requires that you call calendar methods.</span></span> <span data-ttu-id="0f7a0-181">对于派生自 <xref:System.Globalization.EastAsianLunisolarCalendar>、<xref:System.Globalization.JulianCalendar> 和 <xref:System.Globalization.PersianCalendar> 类的所有日历而言，均为这种情况。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-181">This is true of all calendars that derive from the <xref:System.Globalization.EastAsianLunisolarCalendar>, <xref:System.Globalization.JulianCalendar>, and <xref:System.Globalization.PersianCalendar> classes.</span></span>

<span data-ttu-id="0f7a0-182">下面的示例使用 <xref:System.Globalization.JulianCalendar> 对象实例化罗马儒略历的日期 1905 年 1 月 9 日。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-182">The following example uses a <xref:System.Globalization.JulianCalendar> object to instantiate a date, January 9, 1905, in the Julian calendar.</span></span> <span data-ttu-id="0f7a0-183">使用默认（公历）日历显示此日期时，该日期表示为 1905 年 1 月 22 日。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-183">When this date is displayed using the default (Gregorian) calendar, it is represented as January 22, 1905.</span></span> <span data-ttu-id="0f7a0-184">通过调用各种 <xref:System.Globalization.JulianCalendar> 方法，可用罗马儒略历表示日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-184">Calls to individual <xref:System.Globalization.JulianCalendar> methods enable the date to be represented in the Julian calendar.</span></span>

[!code-csharp[Conceptual.Calendars#6](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/noncurrentcalendar1.cs#6)]
[!code-vb[Conceptual.Calendars#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/noncurrentcalendar1.vb#6)]

### <a name="calendars-and-date-ranges"></a><span data-ttu-id="0f7a0-185">日历和日期范围</span><span class="sxs-lookup"><span data-stu-id="0f7a0-185">Calendars and date ranges</span></span>

<span data-ttu-id="0f7a0-186">日历支持的最早日期由其 <xref:System.Globalization.Calendar.MinSupportedDateTime%2A?displayProperty=nameWithType> 属性指示。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-186">The earliest date supported by a calendar is indicated by that calendar's <xref:System.Globalization.Calendar.MinSupportedDateTime%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="0f7a0-187">对于 <xref:System.Globalization.GregorianCalendar> 类，该日期为公历公元 0001 年 1 月 1 日。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-187">For the <xref:System.Globalization.GregorianCalendar> class, that date is January 1, 0001 C.E.</span></span> <span data-ttu-id="0f7a0-188">.NET 中的大多数其他日历都支持更晚的日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-188">Most of the other calendars in .NET support a later date.</span></span> <span data-ttu-id="0f7a0-189">尝试使用日历支持的最早日期前面的日期和时间值将引发 <xref:System.ArgumentOutOfRangeException> 异常。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-189">Trying to work with a date and time value that precedes a calendar's earliest supported date throws an <xref:System.ArgumentOutOfRangeException> exception.</span></span>

<span data-ttu-id="0f7a0-190">但是，有一个很重要的异常。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-190">However, there is one important exception.</span></span> <span data-ttu-id="0f7a0-191"><xref:System.DateTime> 对象和 <xref:System.DateTimeOffset> 对象的默认（未初始化的）值等于 <xref:System.Globalization.GregorianCalendar.MinSupportedDateTime%2A?displayProperty=nameWithType> 值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-191">The default (uninitialized) value of a <xref:System.DateTime> object and a <xref:System.DateTimeOffset> object is equal to the <xref:System.Globalization.GregorianCalendar.MinSupportedDateTime%2A?displayProperty=nameWithType> value.</span></span> <span data-ttu-id="0f7a0-192">如果你尝试在不支持0001年1月1日的日历中设置此日期的格式</span><span class="sxs-lookup"><span data-stu-id="0f7a0-192">If you try to format this date in a calendar that does not support January 1, 0001 C.E.</span></span> <span data-ttu-id="0f7a0-193">并且不提供格式说明符, 格式设置方法使用 "s" (可排序日期/时间模式) 格式说明符, 而不是 "G" (常规日期/时间模式) 格式说明符。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-193">and you do not provide a format specifier, the formatting method uses the "s" (sortable date/time pattern) format specifier instead of the "G" (general date/time pattern) format specifier.</span></span> <span data-ttu-id="0f7a0-194">因此，格式设置操作将不会引发 <xref:System.ArgumentOutOfRangeException> 异常。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-194">As a result, the formatting operation does not throw an <xref:System.ArgumentOutOfRangeException> exception.</span></span> <span data-ttu-id="0f7a0-195">相反，它会返回不受支持的日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-195">Instead, it returns the unsupported date.</span></span> <span data-ttu-id="0f7a0-196">下面的示例阐释了这一点，在使用日语日历将当前区域性设置为日语（日本）以及使用古兰经历将当前区域性设置为阿拉伯语（埃及）时，它将显示 <xref:System.DateTime.MinValue?displayProperty=nameWithType> 的值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-196">This is illustrated in the following example, which displays the value of <xref:System.DateTime.MinValue?displayProperty=nameWithType> when the current culture is set to Japanese (Japan) with the Japanese calendar, and to Arabic (Egypt) with the Um Al Qura calendar.</span></span> <span data-ttu-id="0f7a0-197">它还会将当前区域性设置为英语（美国），并调用 <xref:System.DateTime.ToString%28System.IFormatProvider%29?displayProperty=nameWithType> 方法以及所有这些 <xref:System.Globalization.CultureInfo> 对象。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-197">It also sets the current culture to English (United States) and calls the <xref:System.DateTime.ToString%28System.IFormatProvider%29?displayProperty=nameWithType> method with each of these <xref:System.Globalization.CultureInfo> objects.</span></span> <span data-ttu-id="0f7a0-198">在每种情况下，均使用可排序的日期/时间模式来显示日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-198">In each case, the date is displayed by using the sortable date/time pattern.</span></span>

[!code-csharp[Conceptual.Calendars#11](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/minsupporteddatetime1.cs#11)]
[!code-vb[Conceptual.Calendars#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/minsupporteddatetime1.vb#11)]

## <a name="working-with-eras"></a><span data-ttu-id="0f7a0-199">使用纪元</span><span class="sxs-lookup"><span data-stu-id="0f7a0-199">Working with eras</span></span>

<span data-ttu-id="0f7a0-200">日历通常将日期划分为纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-200">Calendars typically divide dates into eras.</span></span> <span data-ttu-id="0f7a0-201">但是, .net <xref:System.Globalization.Calendar>中的类不支持日历定义的每个纪元, 并且大多数<xref:System.Globalization.Calendar>类只支持单个纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-201">However, the <xref:System.Globalization.Calendar> classes in .NET do not support every era defined by a calendar, and most of the <xref:System.Globalization.Calendar> classes support only a single era.</span></span> <span data-ttu-id="0f7a0-202">只有 <xref:System.Globalization.JapaneseCalendar> 和 <xref:System.Globalization.JapaneseLunisolarCalendar> 类支持多个纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-202">Only the <xref:System.Globalization.JapaneseCalendar> and <xref:System.Globalization.JapaneseLunisolarCalendar> classes support multiple eras.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0f7a0-203">Reiwa 时代, <xref:System.Globalization.JapaneseCalendar>和<xref:System.Globalization.JapaneseLunisolarCalendar>中的新纪元于5月1日 (2019) 开始。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-203">The Reiwa era, a new era in the <xref:System.Globalization.JapaneseCalendar> and <xref:System.Globalization.JapaneseLunisolarCalendar>, begins on May 1, 2019.</span></span> <span data-ttu-id="0f7a0-204">此更改会影响使用这些日历的所有应用程序。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-204">This change affects all applications that use these calendars.</span></span> <span data-ttu-id="0f7a0-205">有关详细信息, 请参阅以下文章:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-205">See the following articles for more information:</span></span>
> - <span data-ttu-id="0f7a0-206">在[.net 的日式日历中处理新时代](https://devblogs.microsoft.com/dotnet/handling-a-new-era-in-the-japanese-calendar-in-net/), 这会将添加到 .net 的功能记录为支持包含多个纪元的日历, 并讨论在处理多个纪元日历时要使用的最佳方案。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-206">[Handling a new era in the Japanese calendar in .NET](https://devblogs.microsoft.com/dotnet/handling-a-new-era-in-the-japanese-calendar-in-net/), which documents features added to .NET to support calendars with multiple eras and discusses best practices to use when handling multi-era calendars.</span></span>
> - <span data-ttu-id="0f7a0-207">[准备应用程序以进行日本时代更改](/windows/uwp/design/globalizing/japanese-era-change), 这提供了有关在 Windows 上测试应用程序以确保其对时代的准备情况发生变化的信息。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-207">[Prepare your application for the Japanese era change](/windows/uwp/design/globalizing/japanese-era-change), which provides information on testing your applications on Windows to ensure their readiness for the era change.</span></span>
> - <span data-ttu-id="0f7a0-208">[.NET Framework 的新日语时代更新的摘要](https://support.microsoft.com/help/4477957/new-japanese-era-updates-for-net-framework), 其中列出了与新日语日历时代相关的单独 Windows 版本 .NET Framework 更新, 为多个时代支持提供新 .NET Framework 功能的说明, 并包括在测试应用程序中查找。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-208">[Summary of new Japanese Era updates for .NET Framework](https://support.microsoft.com/help/4477957/new-japanese-era-updates-for-net-framework), which lists .NET Framework updates for individual Windows versions that are related to the new Japanese calendar era, notes new .NET Framework features for multi-era support, and includes things to look for in testing your applications.</span></span>

<span data-ttu-id="0f7a0-209">大多数日历中的纪元表示非常长的时间段。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-209">An era in most calendars denotes an extremely long time period.</span></span> <span data-ttu-id="0f7a0-210">例如, 在公历中, 当前纪元跨越两个以上的 millennia。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-210">In the Gregorian calendar, for example, the current era spans more than two millennia.</span></span> <span data-ttu-id="0f7a0-211"><xref:System.Globalization.JapaneseCalendar> 对于<xref:System.Globalization.JapaneseLunisolarCalendar>和, 两个支持多个纪元的日历不是这样。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-211">For the <xref:System.Globalization.JapaneseCalendar> and the <xref:System.Globalization.JapaneseLunisolarCalendar>, the two calendars that support multiple eras, this is not the case.</span></span> <span data-ttu-id="0f7a0-212">纪元对应于高层的 reign 的时间段。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-212">An era corresponds to the period of an emperor's reign.</span></span> <span data-ttu-id="0f7a0-213">支持多个纪元, 特别是当前纪元的上限未知时, 会带来特殊的挑战。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-213">Support for multiple eras, particularly when the upper limit of the current era is unknown, poses special challenges.</span></span>

### <a name="eras-and-era-names"></a><span data-ttu-id="0f7a0-214">纪元和纪元名称</span><span class="sxs-lookup"><span data-stu-id="0f7a0-214">Eras and era names</span></span>

<span data-ttu-id="0f7a0-215">在 .net 中, 表示特定日历实现支持的纪元的整数以相反顺序<xref:System.Globalization.Calendar.Eras%2A?displayProperty=nameWithType>存储在数组中。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-215">In .NET, integers that represent the eras supported by a particular calendar implementation are stored in reverse order in the <xref:System.Globalization.Calendar.Eras%2A?displayProperty=nameWithType> array.</span></span> <span data-ttu-id="0f7a0-216">当前纪元 (即具有最新时间范围的纪元) 位于索引零处, 对于<xref:System.Globalization.Calendar>支持多个纪元的类, 每个连续索引将反映以前的纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-216">The current era (which is the era with the latest time range) is at index zero, and for <xref:System.Globalization.Calendar> classes that support multiple eras, each successive index reflects the previous era.</span></span> <span data-ttu-id="0f7a0-217">静态的 <xref:System.Globalization.Calendar.CurrentEra?displayProperty=nameWithType> 属性定义当前纪元在 <xref:System.Globalization.Calendar.Eras%2A?displayProperty=nameWithType> 数组中的索引；它是一个值始终为零的常数。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-217">The static <xref:System.Globalization.Calendar.CurrentEra?displayProperty=nameWithType> property defines the index of the current era in the <xref:System.Globalization.Calendar.Eras%2A?displayProperty=nameWithType> array; it is a constant whose value is always zero.</span></span> <span data-ttu-id="0f7a0-218">各个 <xref:System.Globalization.Calendar> 类还包括可返回当前纪元值的静态字段。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-218">Individual <xref:System.Globalization.Calendar> classes also include static fields that return the value of the current era.</span></span> <span data-ttu-id="0f7a0-219">下表中列出了这些字段。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-219">They are listed in the following table.</span></span>

| <span data-ttu-id="0f7a0-220">日历类</span><span class="sxs-lookup"><span data-stu-id="0f7a0-220">Calendar class</span></span>                                        | <span data-ttu-id="0f7a0-221">当前纪元字段</span><span class="sxs-lookup"><span data-stu-id="0f7a0-221">Current era field</span></span>                                                 |
| ----------------------------------------------------- | ----------------------------------------------------------------- |
| <xref:System.Globalization.ChineseLunisolarCalendar>  | <xref:System.Globalization.ChineseLunisolarCalendar.ChineseEra>   |
| <xref:System.Globalization.GregorianCalendar>         | <xref:System.Globalization.GregorianCalendar.ADEra>               |
| <xref:System.Globalization.HebrewCalendar>            | <xref:System.Globalization.HebrewCalendar.HebrewEra>              |
| <xref:System.Globalization.HijriCalendar>             | <xref:System.Globalization.HijriCalendar.HijriEra>                |
| <xref:System.Globalization.JapaneseLunisolarCalendar> | <xref:System.Globalization.JapaneseLunisolarCalendar.JapaneseEra> |
| <xref:System.Globalization.JulianCalendar>            | <xref:System.Globalization.JulianCalendar.JulianEra>              |
| <xref:System.Globalization.KoreanCalendar>            | <xref:System.Globalization.KoreanCalendar.KoreanEra>              |
| <xref:System.Globalization.KoreanLunisolarCalendar>   | <xref:System.Globalization.KoreanLunisolarCalendar.GregorianEra>  |
| <xref:System.Globalization.PersianCalendar>           | <xref:System.Globalization.PersianCalendar.PersianEra>            |
| <xref:System.Globalization.ThaiBuddhistCalendar>      | <xref:System.Globalization.ThaiBuddhistCalendar.ThaiBuddhistEra>  |
| <xref:System.Globalization.UmAlQuraCalendar>          | <xref:System.Globalization.UmAlQuraCalendar.UmAlQuraEra>          |

<span data-ttu-id="0f7a0-222">通过将特定纪元编号传递给 <xref:System.Globalization.DateTimeFormatInfo.GetEraName%2A?displayProperty=nameWithType> 或 <xref:System.Globalization.DateTimeFormatInfo.GetAbbreviatedEraName%2A?displayProperty=nameWithType> 方法，可检索与该纪元编号对应的名称。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-222">The name that corresponds to a particular era number can be retrieved by passing the era number to the <xref:System.Globalization.DateTimeFormatInfo.GetEraName%2A?displayProperty=nameWithType> or <xref:System.Globalization.DateTimeFormatInfo.GetAbbreviatedEraName%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="0f7a0-223">下面的示例调用这些方法来检索有关 <xref:System.Globalization.GregorianCalendar> 类中的纪元支持信息。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-223">The following example calls these methods to retrieve information about era support in the <xref:System.Globalization.GregorianCalendar> class.</span></span> <span data-ttu-id="0f7a0-224">它显示与当前纪元的第二年1月1日相对应的公历日期, 以及与每个受支持的日文日历时代的第二年1月1日相对应的公历日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-224">It displays the Gregorian calendar date that corresponds to January 1 of the second year of the current era, as well as the Gregorian calendar date that corresponds to January 1 of the second year of each supported Japanese calendar era.</span></span>

[!code-csharp[Conceptual.Calendars#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/instantiatewithera1.cs)]
[!code-vb[Conceptual.Calendars#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/instantiatewithera1.vb)]

<span data-ttu-id="0f7a0-225">此外，“g”自定义日期和时间格式字符串还包括一个日期和时间的字符串表示形式的日期纪元名称。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-225">In addition, the "g" custom date and time format string includes a calendar's era name in the string representation of a date and time.</span></span> <span data-ttu-id="0f7a0-226">有关详细信息, 请参阅[自定义日期和时间格式字符串](../../../docs/standard/base-types/custom-date-and-time-format-strings.md)。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-226">For more information, see [Custom date and time format strings](../../../docs/standard/base-types/custom-date-and-time-format-strings.md).</span></span>

### <a name="instantiating-a-date-with-an-era"></a><span data-ttu-id="0f7a0-227">使用纪元实例化日期</span><span class="sxs-lookup"><span data-stu-id="0f7a0-227">Instantiating a date with an era</span></span>

<span data-ttu-id="0f7a0-228">对于支持多<xref:System.Globalization.Calendar>个纪元的两个类, 由特定年份、月份和月份值组成的日期可能是不明确的。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-228">For the two <xref:System.Globalization.Calendar> classes that support multiple eras, a date that consists of a particular year, month, and day of the month value can be ambiguous.</span></span> <span data-ttu-id="0f7a0-229">例如, 支持的所有纪元的<xref:System.Globalization.JapaneseCalendar>年份数为1。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-229">For example, all eras supported by the <xref:System.Globalization.JapaneseCalendar> have years whose number is 1.</span></span> <span data-ttu-id="0f7a0-230">通常，如果未指定纪元，则日期和时间以及日历方法都假定该值属于当前纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-230">Ordinarily, if an era is not specified, both date and time and calendar methods assume that values belong to the current era.</span></span> <span data-ttu-id="0f7a0-231">这适用于包含<xref:System.Globalization.Calendar>类型参数的<xref:System.DateTime.%23ctor%2A> 和<xref:System.DateTimeOffset.%23ctor%2A>构造函数, 以及 [JapaneseCalendar.ToDateTime](xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)) 和 [JapaneseLunisolarCalendar.ToDateTime](xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)) 方法。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-231">This is true of the <xref:System.DateTime.%23ctor%2A> and <xref:System.DateTimeOffset.%23ctor%2A> constructors that include parameters of type <xref:System.Globalization.Calendar>, as well as the [JapaneseCalendar.ToDateTime](xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)) and [JapaneseLunisolarCalendar.ToDateTime](xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)) methods.</span></span> <span data-ttu-id="0f7a0-232">下面的示例实例化表示未指定纪元的第二年1月1日的日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-232">The following example instantiates a date that represents January 1 of the second year of an unspecified era.</span></span> <span data-ttu-id="0f7a0-233">如果在 Reiwa 纪元为当前纪元时执行该示例, 则该日期将被解释为 Reiwa 纪元的第二年。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-233">If you execute the example when the Reiwa era is the current era, the date is interpreted as the second year of the Reiwa era.</span></span> <span data-ttu-id="0f7a0-234">纪元令和在由<xref:System.DateTime.ToString(System.String,System.IFormatProvider)?displayProperty=nameWithType>方法返回的字符串中的年份之前, 并对应于公历的2020年1月1日。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-234">The era, 令和, precedes the year in the string returned by the <xref:System.DateTime.ToString(System.String,System.IFormatProvider)?displayProperty=nameWithType> method and corresponds to January 1, 2020, in the Gregorian calendar.</span></span> <span data-ttu-id="0f7a0-235">(Reiwa 时代从公历的2019年开始。)</span><span class="sxs-lookup"><span data-stu-id="0f7a0-235">(The Reiwa era begins in the year 2019 of the Gregorian calendar.)</span></span>

[!code-csharp[A date in the current era](~/samples/snippets/standard/datetime/calendars/current-era/cs/program.cs)]
[!code-vb[A date in the current era](~/samples/snippets/standard/datetime/calendars/current-era/vb/program.vb)]

<span data-ttu-id="0f7a0-236">但是, 如果纪元发生更改, 则此代码的目的不明确。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-236">However, if the era changes, the intent of this code becomes ambiguous.</span></span> <span data-ttu-id="0f7a0-237">表示当前纪元的第二年的日期, 或它是否用于表示 Heisei 时代的第二年？</span><span class="sxs-lookup"><span data-stu-id="0f7a0-237">Is the date intended to represent the second year of the current era, or is it intended to represent the second year of the Heisei era?</span></span> <span data-ttu-id="0f7a0-238">可以通过两种方法来避免这种歧义:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-238">There are two ways to avoid this ambiguity:</span></span>

- <span data-ttu-id="0f7a0-239">使用默认<xref:System.Globalization.GregorianCalendar>类实例化日期和时间值。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-239">Instantiate the date and time value using the default <xref:System.Globalization.GregorianCalendar> class.</span></span> <span data-ttu-id="0f7a0-240">然后, 可以使用日语日历或日语阴阳历来表示日期的字符串表示形式, 如下面的示例所示。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-240">You can then use the Japanese calendar or the Japanese Lunisolar calendar for the string representation of dates, as the following example shows.</span></span>

  [!code-csharp[Insantiating a Gregorian date](~/samples/snippets/standard/datetime/calendars/gregorian/cs/program.cs)]
  [!code-vb[Instantiating a Gregorian date](~/samples/snippets/standard/datetime/calendars/gregorian/vb/program.vb)]

- <span data-ttu-id="0f7a0-241">调用显式指定纪元的日期和时间方法。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-241">Call a date and time method that explicitly specifies an era.</span></span> <span data-ttu-id="0f7a0-242">这包括以下方法:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-242">This includes the following methods:</span></span>

  - <span data-ttu-id="0f7a0-243"><xref:System.Globalization.JapaneseCalendar> <xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)>或类<xref:System.Globalization.JapaneseLunisolarCalendar>的方法。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-243">The <xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)> method of the <xref:System.Globalization.JapaneseCalendar> or <xref:System.Globalization.JapaneseLunisolarCalendar> class.</span></span>

  - <span data-ttu-id="0f7a0-244"><xref:System.DateTime>或分析<xref:System.DateTimeOffset>方法(如<xref:System.DateTime.TryParse%2A> <xref:System.Globalization.DateTimeStyles> 、、或)<xref:System.DateTime.TryParseExact%2A>, 其中包括要分析的字符串和可选的参数 (如果当前区域性为日语-日本 (" <xref:System.DateTime.ParseExact%2A> <xref:System.DateTime.Parse%2A>ja-jp "), 并且该区域性的日历是<xref:System.Globalization.JapaneseCalendar>。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-244">A <xref:System.DateTime> or <xref:System.DateTimeOffset> parsing method, such as <xref:System.DateTime.Parse%2A>, <xref:System.DateTime.TryParse%2A>, <xref:System.DateTime.ParseExact%2A>, or <xref:System.DateTime.TryParseExact%2A>, that includes the string to be parsed and optionally a <xref:System.Globalization.DateTimeStyles> argument if the current culture is Japanese-Japan ("ja-JP") and that culture's calendar is the <xref:System.Globalization.JapaneseCalendar>.</span></span> <span data-ttu-id="0f7a0-245">要分析的字符串必须包括纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-245">The string to be parsed must include the era.</span></span>

  - <span data-ttu-id="0f7a0-246">一个<xref:System.DateTime>或<xref:System.DateTimeOffset> 分析方法<xref:System.IFormatProvider>, 其中包含类型的参数。`provider`</span><span class="sxs-lookup"><span data-stu-id="0f7a0-246">A <xref:System.DateTime> or <xref:System.DateTimeOffset> parsing method that includes a `provider` parameter of type <xref:System.IFormatProvider>.</span></span> <span data-ttu-id="0f7a0-247">`provider`<xref:System.Globalization.CultureInfo>必须是一个对象, 该对象表示其当前日历为<xref:System.Globalization.DateTimeFormatInfo> <xref:System.Globalization.JapaneseCalendar>的或其<xref:System.Globalization.DateTimeFormatInfo.Calendar>属性为<xref:System.Globalization.JapaneseCalendar>的对象。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-247">`provider` must be either a <xref:System.Globalization.CultureInfo> object that represents the Japanese-Japan ("ja-JP") culture whose current calendar is <xref:System.Globalization.JapaneseCalendar> or a <xref:System.Globalization.DateTimeFormatInfo> object whose <xref:System.Globalization.DateTimeFormatInfo.Calendar> property is <xref:System.Globalization.JapaneseCalendar>.</span></span> <span data-ttu-id="0f7a0-248">要分析的字符串必须包括纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-248">The string to be parsed must include the era.</span></span>

  <span data-ttu-id="0f7a0-249">下面的示例使用三种方法来实例化 Meiji 纪元中的日期和时间, 该日期和时间从1868年9月8日开始, 结束于1912年7月29日结束。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-249">The following example uses three of these methods to instantiate a date and time in the Meiji era, which began on September 8, 1868, and ended on July 29, 1912.</span></span>

  [!code-csharp[A date in a specified era](~/samples/snippets/standard/datetime/calendars/specify-era/cs/program.cs)]
  [!code-vb[A date in a specified era](~/samples/snippets/standard/datetime/calendars/specify-era/vb/program.vb)]

> [!TIP]
> <span data-ttu-id="0f7a0-250">处理支持多个纪元的日历时,*始终*使用公历日期来实例化日期, 或者在基于该日历实例化日期和时间时指定纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-250">When working with calendars that support multiple eras, *always* use the Gregorian date to instantiate a date, or specify the era when you instantiate a date and time based on that calendar.</span></span>

<span data-ttu-id="0f7a0-251">在为<xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)>方法指定纪元时, 提供日历的<xref:System.Globalization.Calendar.Eras>属性中的纪元索引。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-251">In specifying an era to the <xref:System.Globalization.Calendar.ToDateTime(System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32,System.Int32)> method, you provide the index of the era in the calendar's <xref:System.Globalization.Calendar.Eras> property.</span></span> <span data-ttu-id="0f7a0-252">但对于其纪元可能会发生更改的日历, 这些索引不是常量值;当前纪元位于索引 0, 最早的纪元位于索引`Eras.Length - 1`处。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-252">For calendars whose eras are subject to change, however, these indexes are not constant values; the current era is at index 0, and the oldest era is at index `Eras.Length - 1`.</span></span> <span data-ttu-id="0f7a0-253">将新纪元添加到日历时, 先前纪元的索引将增加1。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-253">When a new era is added to a calendar, the indexes of the previous eras increase by one.</span></span> <span data-ttu-id="0f7a0-254">可以提供相应的纪元索引, 如下所示:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-254">You can supply the appropriate era index as follows:</span></span>

- <span data-ttu-id="0f7a0-255">对于当前纪元中的日期, 请始终使用日历的<xref:System.Globalization.Calendar.CurrentEra>属性。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-255">For dates in the current era, always use the calendar's <xref:System.Globalization.Calendar.CurrentEra> property.</span></span>

- <span data-ttu-id="0f7a0-256">对于指定纪元中的日期, 请使用<xref:System.Globalization.DateTimeFormatInfo.GetEraName%2A?displayProperty=nameWithType>方法检索对应于指定纪元名称的索引。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-256">For dates in a specified era, use the <xref:System.Globalization.DateTimeFormatInfo.GetEraName%2A?displayProperty=nameWithType> method to retrieve the index that corresponds to a specified era name.</span></span> <span data-ttu-id="0f7a0-257">这要求<xref:System.Globalization.JapaneseCalendar>是表示 ja-jp 区域性的<xref:System.Globalization.CultureInfo>对象的当前日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-257">This requires that the <xref:System.Globalization.JapaneseCalendar> be the current calendar of the <xref:System.Globalization.CultureInfo> object that represents the ja-JP culture.</span></span>  <span data-ttu-id="0f7a0-258">(此方法也适用<xref:System.Globalization.JapaneseLunisolarCalendar>于, 因为它支持与相同的纪元<xref:System.Globalization.JapaneseCalendar>。)前面的示例演示了这种方法。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-258">(This technique works for the <xref:System.Globalization.JapaneseLunisolarCalendar> as well, since it supports the same eras as the <xref:System.Globalization.JapaneseCalendar>.) The previous example illustrates this approach.</span></span>

### <a name="calendars-eras-and-date-ranges-relaxed-range-checks"></a><span data-ttu-id="0f7a0-259">日历、纪元和日期范围:宽松范围检查</span><span class="sxs-lookup"><span data-stu-id="0f7a0-259">Calendars, eras, and date ranges: Relaxed range checks</span></span>

<span data-ttu-id="0f7a0-260">与单个日历非常类似, 它们具有受支持的日期范围<xref:System.Globalization.JapaneseCalendar> , <xref:System.Globalization.JapaneseLunisolarCalendar>和类中的纪元也具有受支持的范围。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-260">Very much like individual calendars have supported date ranges, eras in the <xref:System.Globalization.JapaneseCalendar> and <xref:System.Globalization.JapaneseLunisolarCalendar> classes also have supported ranges.</span></span> <span data-ttu-id="0f7a0-261">以前, .NET 使用了严格的纪元范围检查, 以确保特定于纪元的日期在纪元的范围内。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-261">Previously, .NET used strict era range checks to ensure that an era-specific date was within the range of that era.</span></span> <span data-ttu-id="0f7a0-262">也就是说, 如果日期在指定纪元的范围之外, 则该方法将引发<xref:System.ArgumentOutOfRangeException>。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-262">That is, if a date is outside of the range of the specified era, the method throws an <xref:System.ArgumentOutOfRangeException>.</span></span> <span data-ttu-id="0f7a0-263">目前, 默认情况下, .NET 使用宽松范围检查。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-263">Currently, .NET uses relaxed ranged checking by default.</span></span> <span data-ttu-id="0f7a0-264">所有版本的 .NET 的更新引入了宽松纪元范围检查;尝试将位于指定纪元范围之外的特定于纪元的日期实例化到以下纪元, 并且不会引发异常。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-264">Updates to all versions of .NET introduced relaxed era range checks; the attempt to instantiate an era-specific date that is outside the range of the specified era "overflows" into the following era, and no exception is thrown.</span></span>

<span data-ttu-id="0f7a0-265">下面的示例尝试在 Showa 纪元的65th 年中实例化日期, 该日期从1926年12月25日开始, 到1989年1月7日结束。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-265">The following example attempts to instantiate a date in the 65th year of the Showa era, which began on December 25, 1926 and ended on January 7, 1989.</span></span> <span data-ttu-id="0f7a0-266">此日期对应于1990年1月9日, 超过了 Showa 时代<xref:System.Globalization.JapaneseCalendar>的范围。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-266">This date corresponds to January 9, 1990, which is outside the range of the Showa era in the <xref:System.Globalization.JapaneseCalendar>.</span></span> <span data-ttu-id="0f7a0-267">如示例中的输出所示, 该示例显示的日期为1990年1月9日, 在 Heisei 时代的第二年。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-267">As the output from the example illustrates, the date displayed by the example is January 9, 1990, in the second year of the Heisei era.</span></span>

  [!code-csharp[Relaxed range checks](~/samples/snippets/standard/datetime/calendars/relaxed-range/cs/program.cs)]
  [!code-vb[Relaxed range checks](~/samples/snippets/standard/datetime/calendars/relaxed-range/vb/program.vb)]

<span data-ttu-id="0f7a0-268">如果不需要宽松范围检查, 则可以通过多种方式还原严格范围检查, 具体取决于运行应用程序的 .NET 版本:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-268">If relaxed range checks are undesirable, you can restore strict range checks in a number of ways, depending on the version of .NET on which your application is running:</span></span>

- <span data-ttu-id="0f7a0-269">**.NET Core:** 可以将以下内容添加到*netcore*配置文件:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-269">**.NET Core:** You can add the following to the *.netcore.runtime.json* config file:</span></span>

  ```json
  "runtimeOptions": {
    "configProperties": {
        "Switch.System.Globalization.EnforceJapaneseEraYearRanges": true
    }
  }
  ```

- <span data-ttu-id="0f7a0-270">**.NET Framework 4.6 或更高版本:** 可以设置以下 AppContext 开关:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-270">**.NET Framework 4.6 or later:** You can set the following AppContext switch:</span></span>

  ```xml
  <?xml version="1.0" encoding="utf-8"?>
  <configuration>
    <runtime>
      <AppContextSwitchOverrides value="Switch.System.Globalization.EnforceJapaneseEraYearRanges=true" />
    </runtime>
  </configuration>
  ```

- <span data-ttu-id="0f7a0-271">**.NET Framework 4.5.2 或更早版本:** 可以设置以下注册表值:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-271">**.NET Framework 4.5.2 or earlier:** You can set the following registry value:</span></span>

   |  |  |
   |--|--|
   |<span data-ttu-id="0f7a0-272">Key</span><span class="sxs-lookup"><span data-stu-id="0f7a0-272">Key</span></span> | <span data-ttu-id="0f7a0-273">HKEY_LOCAL_MACHINE\Software\Microsoft\.NETFramework\AppContext</span><span class="sxs-lookup"><span data-stu-id="0f7a0-273">HKEY_LOCAL_MACHINE\Software\Microsoft\.NETFramework\AppContext</span></span> |
   |<span data-ttu-id="0f7a0-274">name</span><span class="sxs-lookup"><span data-stu-id="0f7a0-274">Name</span></span> | <span data-ttu-id="0f7a0-275">Switch.System.Globalization.EnforceJapaneseEraYearRanges</span><span class="sxs-lookup"><span data-stu-id="0f7a0-275">Switch.System.Globalization.EnforceJapaneseEraYearRanges</span></span> |
   |<span data-ttu-id="0f7a0-276">类型</span><span class="sxs-lookup"><span data-stu-id="0f7a0-276">Type</span></span> | <span data-ttu-id="0f7a0-277">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="0f7a0-277">REG_SZ</span></span> |
   |<span data-ttu-id="0f7a0-278">值</span><span class="sxs-lookup"><span data-stu-id="0f7a0-278">Value</span></span> | <span data-ttu-id="0f7a0-279">true</span><span class="sxs-lookup"><span data-stu-id="0f7a0-279">true</span></span> |

<span data-ttu-id="0f7a0-280">启用严格范围检查后, 上面的示例将引发<xref:System.ArgumentOutOfRangeException> , 并显示以下输出:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-280">With strict range checks enabled, the previous example throws an <xref:System.ArgumentOutOfRangeException> and displays the following output:</span></span>

```console
Unhandled Exception: System.ArgumentOutOfRangeException: Valid values are between 1 and 64, inclusive.
Parameter name: year
   at System.Globalization.GregorianCalendarHelper.GetYearOffset(Int32 year, Int32 era, Boolean throwOnError)
   at System.Globalization.GregorianCalendarHelper.ToDateTime(Int32 year, Int32 month, Int32 day, Int32 hour, Int32 minute, Int32 second, Int32 millisecond, Int32 era)
   at Example.Main()
```

### <a name="representing-dates-in-calendars-with-multiple-eras"></a><span data-ttu-id="0f7a0-281">用多个纪元表示日历中的日期</span><span class="sxs-lookup"><span data-stu-id="0f7a0-281">Representing dates in calendars with multiple eras</span></span>

<span data-ttu-id="0f7a0-282">如果 <xref:System.Globalization.Calendar> 对象支持纪元并且是 <xref:System.Globalization.CultureInfo> 对象的当前日历，则纪元将包括在完整日期和时间、长日期和短日期模式的日期和时间值的字符串表示形式中。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-282">If a <xref:System.Globalization.Calendar> object supports eras and is the current calendar of a <xref:System.Globalization.CultureInfo> object, the era is included in the string representation of a date and time value for the full date and time, long date, and short date patterns.</span></span> <span data-ttu-id="0f7a0-283">下面的示例显示当前区域性为日语（日本）并且当前日历为日本日历时的这些日期模式。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-283">The following example displays these date patterns when the current culture is Japan (Japanese) and the current calendar is the Japanese calendar.</span></span>

[!code-csharp[Conceptual.Calendars#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/formatstrings1.cs#8)]
[!code-vb[Conceptual.Calendars#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/formatstrings1.vb#8)]

> [!WARNING]
> <span data-ttu-id="0f7a0-284">类是 .net 中唯一支持多个纪元中的日期并且可以是<xref:System.Globalization.CultureInfo>对象的当前日历 (具体而言, 是表示日语 (日本) 区域性的<xref:System.Globalization.CultureInfo>对象) 的 calendar 类。 <xref:System.Globalization.JapaneseCalendar></span><span class="sxs-lookup"><span data-stu-id="0f7a0-284">The <xref:System.Globalization.JapaneseCalendar> class is the only calendar class in .NET that both supports dates in more than one era and that can be the current calendar of a <xref:System.Globalization.CultureInfo> object - specifically, of a <xref:System.Globalization.CultureInfo> object that represents the Japanese (Japan) culture.</span></span>

<span data-ttu-id="0f7a0-285">对于所有日历，“g”自定义格式说明符会在结果字符串中包括纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-285">For all calendars, the "g" custom format specifier includes the era in the result string.</span></span> <span data-ttu-id="0f7a0-286">下面的示例使用“MM-dd-yyyy g”自定义格式字符串，在当前日历为公历时在结果字符串中包括纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-286">The following example uses the "MM-dd-yyyy g" custom format string to include the era in the result string when the current calendar is the Gregorian calendar.</span></span>

[!code-csharp[Conceptual.Calendars#9](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/formatstrings2.cs#9)]
[!code-vb[Conceptual.Calendars#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/formatstrings2.vb#9)]

<span data-ttu-id="0f7a0-287">当日期的字符串表示形式用非当前日历来表示时，<xref:System.Globalization.Calendar> 类包括一个可与 <xref:System.Globalization.Calendar.GetEra%2A?displayProperty=nameWithType>、<xref:System.Globalization.Calendar.GetYear%2A?displayProperty=nameWithType> 和 <xref:System.Globalization.Calendar.GetMonth%2A?displayProperty=nameWithType> 方法一起使用的 <xref:System.Globalization.Calendar.GetDayOfMonth%2A?displayProperty=nameWithType> 方法，以明确指示日期及其所属纪元。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-287">In cases where the string representation of a date is expressed in a calendar that is not the current calendar, the <xref:System.Globalization.Calendar> class includes a <xref:System.Globalization.Calendar.GetEra%2A?displayProperty=nameWithType> method that can be used along with the <xref:System.Globalization.Calendar.GetYear%2A?displayProperty=nameWithType>, <xref:System.Globalization.Calendar.GetMonth%2A?displayProperty=nameWithType>, and <xref:System.Globalization.Calendar.GetDayOfMonth%2A?displayProperty=nameWithType> methods to unambiguously indicate a date as well as the era to which it belongs.</span></span> <span data-ttu-id="0f7a0-288">下面的示例使用 <xref:System.Globalization.JapaneseLunisolarCalendar> 类来提供演示。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-288">The following example uses the <xref:System.Globalization.JapaneseLunisolarCalendar> class to provide an illustration.</span></span> <span data-ttu-id="0f7a0-289">但请注意，在结果字符串中包括有意义的名称或缩写（而不是表示纪元的整数）需要您实例化 <xref:System.Globalization.DateTimeFormatInfo> 对象并使 <xref:System.Globalization.JapaneseCalendar> 成为其当前日历。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-289">However, note that including a meaningful name or abbreviation instead of an integer for the era in the result string requires that you instantiate a <xref:System.Globalization.DateTimeFormatInfo> object and make <xref:System.Globalization.JapaneseCalendar> its current calendar.</span></span> <span data-ttu-id="0f7a0-290">（<xref:System.Globalization.JapaneseLunisolarCalendar> 日历不能为任何区域性的当前日历，但在此示例中，两个日历共享相同的纪元。）</span><span class="sxs-lookup"><span data-stu-id="0f7a0-290">(The <xref:System.Globalization.JapaneseLunisolarCalendar> calendar cannot be the current calendar of any culture, but in this case the two calendars share the same eras.)</span></span>

[!code-csharp[Conceptual.Calendars#10](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.calendars/cs/formatstrings3.cs#10)]
[!code-vb[Conceptual.Calendars#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.calendars/vb/formatstrings3.vb#10)]

<span data-ttu-id="0f7a0-291">在日本日历中, 年代的第一年称为 Gannen (元年)。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-291">In the Japanese calendars, the first year of an era is called Gannen (元年).</span></span> <span data-ttu-id="0f7a0-292">例如, Heisei 时代的第一年不是 Heisei 1, 而是 Heisei Gannen。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-292">For example, instead of Heisei 1, the first year of the Heisei era can be described as Heisei Gannen.</span></span> <span data-ttu-id="0f7a0-293">当使用以下标准或自定义日期和时间格式字符串与<xref:System.Globalization.CultureInfo>表示日语-日本 ("ja-jp") 区域性的对象使用时,.net采用这种格式设置操作的格式<xref:System.Globalization.JapaneseCalendar>类:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-293">.NET adopts this convention in formatting operations for dates and times formatted with the following standard or custom date and time format strings when they are used with a <xref:System.Globalization.CultureInfo> object that represents the Japanese-Japan ("ja-JP") culture with the <xref:System.Globalization.JapaneseCalendar> class:</span></span>

- <span data-ttu-id="0f7a0-294">[长日期模式](../base-types/standard-date-and-time-format-strings.md#LongDate), 由 "D" 标准日期和时间格式字符串指示。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-294">[The long date pattern](../base-types/standard-date-and-time-format-strings.md#LongDate), indicated by the "D" standard date and time format string.</span></span>
- <span data-ttu-id="0f7a0-295">"F" 标准日期和时间格式字符串指示[的完整日期长时间模式](../base-types/standard-date-and-time-format-strings.md#FullDateLongTime)。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-295">[The full date long time pattern](../base-types/standard-date-and-time-format-strings.md#FullDateLongTime), indicated by the "F" standard date and time format string.</span></span>
- <span data-ttu-id="0f7a0-296">"F" 标准日期和时间格式字符串指示[的完整日期短时间模式](../base-types/standard-date-and-time-format-strings.md#FullDateShortTime)。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-296">[The full date short time pattern](../base-types/standard-date-and-time-format-strings.md#FullDateShortTime), indicated by the "f" standard date and time format string.</span></span>
- <span data-ttu-id="0f7a0-297">[年份/月份模式](../base-types/standard-date-and-time-format-strings.md#YearMonth), 由 Y "或" y "标准日期和时间格式字符串指示。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-297">[The year/month pattern](../base-types/standard-date-and-time-format-strings.md#YearMonth), indicated by the Y" or "y" standard date and time format string.</span></span>
- <span data-ttu-id="0f7a0-298">["Ggy" 年 "" 或 "ggy年"[自定义日期和时间格式字符串](../base-types/custom-date-and-time-format-strings.md)。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-298">[The "ggy'年'" or "ggy年" [custom date and time format string](../base-types/custom-date-and-time-format-strings.md).</span></span>

<span data-ttu-id="0f7a0-299">例如, 下面的示例在的 Heisei 时代<xref:System.Globalization.JapaneseCalendar>的第一年显示日期。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-299">For example, the following example displays a date in the first year of the Heisei era in the <xref:System.Globalization.JapaneseCalendar> .</span></span>

  [!code-csharp[gannen](~/samples/snippets/standard/datetime/calendars/gannen/cs/program.cs)]
  [!code-vb[gannen](~/samples/snippets/standard/datetime/calendars/gannen/vb/gannen-fmt.vb)]

<span data-ttu-id="0f7a0-300">如果在格式设置操作中不需要此行为, 则可以通过执行下列操作来还原以前的行为, 该行为始终将纪元的第一年表示为 "1", 而不是 "Gannen", 具体取决于 .NET 的版本:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-300">If this behavior is undesirable in formatting operations, you can restore the previous behavior, which always represents the first year of an era as “1” rather than “Gannen”, by doing the following, depending on the version of .NET:</span></span>

- <span data-ttu-id="0f7a0-301">**.NET Core:** 可以将以下内容添加到*netcore*配置文件:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-301">**.NET Core:** You can add the following to the *.netcore.runtime.json* config file:</span></span>

  ```json
  "runtimeOptions": {
    "configProperties": {
        "Switch.System.Globalization.FormatJapaneseFirstYearAsANumber": true
    }
  }
  ```

- <span data-ttu-id="0f7a0-302">**.NET Framework 4.6 或更高版本:** 可以设置以下 AppContext 开关:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-302">**.NET Framework 4.6 or later:** You can set the following AppContext switch:</span></span>

  ```xml
  <?xml version="1.0" encoding="utf-8"?>
  <configuration>
    <runtime>
      <AppContextSwitchOverrides value="Switch.System.Globalization.FormatJapaneseFirstYearAsANumber=true" />
    </runtime>
  </configuration>
  ```

- <span data-ttu-id="0f7a0-303">**.NET Framework 4.5.2 或更早版本:** 可以设置以下注册表值:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-303">**.NET Framework 4.5.2 or earlier:** You can set the following registry value:</span></span>

   |  |  |
   |--|--|
   |<span data-ttu-id="0f7a0-304">Key</span><span class="sxs-lookup"><span data-stu-id="0f7a0-304">Key</span></span> | <span data-ttu-id="0f7a0-305">HKEY_LOCAL_MACHINE\Software\Microsoft\.NETFramework\AppContext</span><span class="sxs-lookup"><span data-stu-id="0f7a0-305">HKEY_LOCAL_MACHINE\Software\Microsoft\.NETFramework\AppContext</span></span> |
   |<span data-ttu-id="0f7a0-306">名称</span><span class="sxs-lookup"><span data-stu-id="0f7a0-306">Name</span></span> | <span data-ttu-id="0f7a0-307">Switch.System.Globalization.FormatJapaneseFirstYearAsANumber</span><span class="sxs-lookup"><span data-stu-id="0f7a0-307">Switch.System.Globalization.FormatJapaneseFirstYearAsANumber</span></span> |
   |<span data-ttu-id="0f7a0-308">类型</span><span class="sxs-lookup"><span data-stu-id="0f7a0-308">Type</span></span> | <span data-ttu-id="0f7a0-309">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="0f7a0-309">REG_SZ</span></span> |
   |<span data-ttu-id="0f7a0-310">值</span><span class="sxs-lookup"><span data-stu-id="0f7a0-310">Value</span></span> | <span data-ttu-id="0f7a0-311">true</span><span class="sxs-lookup"><span data-stu-id="0f7a0-311">true</span></span> |

<span data-ttu-id="0f7a0-312">如果禁用格式设置操作中的 gannen 支持, 上一个示例将显示以下输出:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-312">With gannen support in formatting operations disabled, the previous example displays the following output:</span></span>

```console
Japanese calendar date: 平成1年8月18日 (Gregorian: Friday, August 18, 1989)
```

<span data-ttu-id="0f7a0-313">.NET 还进行了更新, 以便日期和时间分析操作支持包含 "1" 或 Gannen 表示的年份的字符串。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-313">.NET has also been updated so that date and time parsing operations support strings that contain the year represented as either "1" or Gannen.</span></span> <span data-ttu-id="0f7a0-314">尽管不需要执行此操作, 但可以还原以前的行为, 以便仅将 "1" 识别为纪元的第一年。</span><span class="sxs-lookup"><span data-stu-id="0f7a0-314">Although you should not need to do this, you can restore the previous behavior to recognizes only “1” as the first year of an era.</span></span> <span data-ttu-id="0f7a0-315">可以按以下方式执行此操作, 具体取决于 .NET 的版本:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-315">You can do this as follows, depending on the version of .NET:</span></span>

- <span data-ttu-id="0f7a0-316">**.NET Core:** 可以将以下内容添加到*netcore*配置文件:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-316">**.NET Core:** You can add the following to the *.netcore.runtime.json* config file:</span></span>

  ```json
  "runtimeOptions": {
    "configProperties": {
        "Switch.System.Globalization.EnforceLegacyJapaneseDateParsing": true
    }
  }
  ```

- <span data-ttu-id="0f7a0-317">**.NET Framework 4.6 或更高版本:** 可以设置以下 AppContext 开关:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-317">**.NET Framework 4.6 or later:** You can set the following AppContext switch:</span></span>

  ```xml
  <?xml version="1.0" encoding="utf-8"?>
  <configuration>
    <runtime>
      <AppContextSwitchOverrides value="Switch.System.Globalization.EnforceLegacyJapaneseDateParsing=true" />
    </runtime>
  </configuration>
  ```

- <span data-ttu-id="0f7a0-318">**.NET Framework 4.5.2 或更早版本:** 可以设置以下注册表值:</span><span class="sxs-lookup"><span data-stu-id="0f7a0-318">**.NET Framework 4.5.2 or earlier:** You can set the following registry value:</span></span>

   |  |  |
   |--|--|  
   |<span data-ttu-id="0f7a0-319">Key</span><span class="sxs-lookup"><span data-stu-id="0f7a0-319">Key</span></span> | <span data-ttu-id="0f7a0-320">HKEY_LOCAL_MACHINE\Software\Microsoft\.NETFramework\AppContext</span><span class="sxs-lookup"><span data-stu-id="0f7a0-320">HKEY_LOCAL_MACHINE\Software\Microsoft\.NETFramework\AppContext</span></span> |
   |<span data-ttu-id="0f7a0-321">name</span><span class="sxs-lookup"><span data-stu-id="0f7a0-321">Name</span></span> | <span data-ttu-id="0f7a0-322">Switch.System.Globalization.EnforceLegacyJapaneseDateParsing</span><span class="sxs-lookup"><span data-stu-id="0f7a0-322">Switch.System.Globalization.EnforceLegacyJapaneseDateParsing</span></span> |
   |<span data-ttu-id="0f7a0-323">类型</span><span class="sxs-lookup"><span data-stu-id="0f7a0-323">Type</span></span> | <span data-ttu-id="0f7a0-324">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="0f7a0-324">REG_SZ</span></span> |
   |<span data-ttu-id="0f7a0-325">值</span><span class="sxs-lookup"><span data-stu-id="0f7a0-325">Value</span></span> | <span data-ttu-id="0f7a0-326">true</span><span class="sxs-lookup"><span data-stu-id="0f7a0-326">true</span></span> | 

## <a name="see-also"></a><span data-ttu-id="0f7a0-327">请参阅</span><span class="sxs-lookup"><span data-stu-id="0f7a0-327">See also</span></span>

- [<span data-ttu-id="0f7a0-328">如何：以非公历日历显示日期</span><span class="sxs-lookup"><span data-stu-id="0f7a0-328">How to: Display dates in non-Gregorian calendars</span></span>](../../../docs/standard/base-types/how-to-display-dates-in-non-gregorian-calendars.md)
- [<span data-ttu-id="0f7a0-329">示例：日历周范围实用工具</span><span class="sxs-lookup"><span data-stu-id="0f7a0-329">Sample: Calendar week range utility</span></span>](https://code.msdn.microsoft.com/NET-Framework-4-Calendar-3360a84a)
- [<span data-ttu-id="0f7a0-330">Calendar 类</span><span class="sxs-lookup"><span data-stu-id="0f7a0-330">Calendar class</span></span>](xref:System.Globalization.Calendar)
