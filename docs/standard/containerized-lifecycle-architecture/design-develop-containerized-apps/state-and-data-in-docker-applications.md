---
title: Docker 应用程序中的状态和数据
description: 了解可用的选项以在容器化应用程序中保存状态。
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 11/23/2018
ms.openlocfilehash: 9d924f0fffca73b57626910bc3c3ca95b4478300
ms.sourcegitcommit: 30e2fe5cc4165aa6dde7218ec80a13def3255e98
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/13/2019
ms.locfileid: "56218744"
---
# <a name="state-and-data-in-docker-applications"></a><span data-ttu-id="b27b5-103">Docker 应用程序中的状态和数据</span><span class="sxs-lookup"><span data-stu-id="b27b5-103">State and data in Docker applications</span></span>

<span data-ttu-id="b27b5-104">容器的基元是不可变性。</span><span class="sxs-lookup"><span data-stu-id="b27b5-104">A primitive of containers is immutability.</span></span> <span data-ttu-id="b27b5-105">与 VM 相比，容器将不会作为一种常见情况消失。</span><span class="sxs-lookup"><span data-stu-id="b27b5-105">When compared to a VM, containers don't disappear as a common occurrence.</span></span> <span data-ttu-id="b27b5-106">在从死信进程、 重载的 CPU 或完整或失败的磁盘的各种窗体中，VM 可能会失败。</span><span class="sxs-lookup"><span data-stu-id="b27b5-106">A VM might fail in various forms from dead processes, overloaded CPU, or a full or failed disk.</span></span> <span data-ttu-id="b27b5-107">我们希望在可用的 VM 和 RAID 驱动器来确保驱动器故障维护的数据。</span><span class="sxs-lookup"><span data-stu-id="b27b5-107">Yet, we expect the VM to be available and RAID drives are commonplace to assure drive failures maintain data.</span></span>

<span data-ttu-id="b27b5-108">但是，容器被认为是非进程的实例。</span><span class="sxs-lookup"><span data-stu-id="b27b5-108">However, containers are thought to be instances of processes.</span></span> <span data-ttu-id="b27b5-109">进程不维护持久状态。</span><span class="sxs-lookup"><span data-stu-id="b27b5-109">A process doesn't maintain durable state.</span></span> <span data-ttu-id="b27b5-110">即使容器可以写入其本地存储，假定将无限期地将围绕该实例将等效于假定单副本内存将持久。</span><span class="sxs-lookup"><span data-stu-id="b27b5-110">Even though a container can write to its local storage, assuming that the instance will be around indefinitely would be equivalent to assuming a single-copy memory will be durable.</span></span> <span data-ttu-id="b27b5-111">您应假定复制的容器与进程一样，，已终止，或者，当托管容器业务流程协调程序时，可能会将它们移动。</span><span class="sxs-lookup"><span data-stu-id="b27b5-111">You should assume that containers, like processes, are duplicated, killed, or, when managed with a container orchestrator, they might be moved.</span></span>

<span data-ttu-id="b27b5-112">Docker 使用一项功能称为*覆盖文件系统*实现写入时复制过程，用于存储任何更新信息到容器，相比原始映像所基于的根文件系统。</span><span class="sxs-lookup"><span data-stu-id="b27b5-112">Docker uses a feature known as an *overlay file system* to implement a copy-on-write process that stores any updated information to the root file system of a container, compared to the original image on which it is based.</span></span> <span data-ttu-id="b27b5-113">如果随后从系统删除该容器，这些更改将丢失。</span><span class="sxs-lookup"><span data-stu-id="b27b5-113">These changes are lost if the container is subsequently deleted from the system.</span></span> <span data-ttu-id="b27b5-114">一个容器，因此，不具有持久性存储区默认情况下。</span><span class="sxs-lookup"><span data-stu-id="b27b5-114">A container, therefore, does not have persistent storage by default.</span></span> <span data-ttu-id="b27b5-115">尽管可以保存容器的状态，但设计系统解决此问题是与容器体系结构原则冲突。</span><span class="sxs-lookup"><span data-stu-id="b27b5-115">Although it's possible to save the state of a container, designing a system around this would be in conflict with the principle of container architecture.</span></span>

<span data-ttu-id="b27b5-116">若要管理 Docker 应用程序中的持久性数据，还有常见解决方案：</span><span class="sxs-lookup"><span data-stu-id="b27b5-116">To manage persistent data in Docker applications, there are common solutions:</span></span>

-   <span data-ttu-id="b27b5-117">[**数据卷**](https://docs.docker.com/engine/tutorials/dockervolumes/) 这些装载到主机，只需特别说明。</span><span class="sxs-lookup"><span data-stu-id="b27b5-117">[**Data volumes**](https://docs.docker.com/engine/tutorials/dockervolumes/) These mount to the host, as just noted.</span></span>

-   <span data-ttu-id="b27b5-118">[**数据卷容器**](https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container) 这些跨容器，使用可以循环的外部容器提供共享的存储。</span><span class="sxs-lookup"><span data-stu-id="b27b5-118">[**Data volume containers**](https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container) These provide shared storage across containers, using an external container that can cycle.</span></span>

-   <span data-ttu-id="b27b5-119">[**卷插件**](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume) 这些卷装载到远程位置，提供持久性。</span><span class="sxs-lookup"><span data-stu-id="b27b5-119">[**Volume Plugins**](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume) These mount volumes to remote locations, providing long-term persistence.</span></span>

-   <span data-ttu-id="b27b5-120">**远程数据源** 示例包括 SQL 数据库和无 SQL 数据库或缓存服务，如 Redis。</span><span class="sxs-lookup"><span data-stu-id="b27b5-120">**Remote data sources** Examples include SQL and NO-SQL databases or cache services like Redis.</span></span>

-   <span data-ttu-id="b27b5-121">[**Azure 存储**](https://docs.microsoft.com/azure/storage/) 这提供异地可分发平台即服务 (PaaS) 存储，提供最佳的容器为持久性。</span><span class="sxs-lookup"><span data-stu-id="b27b5-121">[**Azure Storage**](https://docs.microsoft.com/azure/storage/) This provides geo distributable platform as a service (PaaS) storage, providing the best of containers as long-term persistence.</span></span>

<span data-ttu-id="b27b5-122">数据卷被专门指定跳过的一个或多个容器内的目录[联合的文件系统](https://docs.docker.com/glossary/?term=Union%20file%20system)。</span><span class="sxs-lookup"><span data-stu-id="b27b5-122">Data volumes are specially designated directories within one or more containers that bypass the [Union File System](https://docs.docker.com/glossary/?term=Union%20file%20system).</span></span> <span data-ttu-id="b27b5-123">数据卷用于维护数据，独立于容器的生命周期。</span><span class="sxs-lookup"><span data-stu-id="b27b5-123">Data volumes are designed to maintain data, independent of the container's life cycle.</span></span> <span data-ttu-id="b27b5-124">Docker 因此永远不会自动删除卷时您删除容器，也不能将它不再引用的容器的"垃圾收集"的卷。</span><span class="sxs-lookup"><span data-stu-id="b27b5-124">Docker therefore never automatically deletes volumes when you remove a container, nor will it "garbage collect" volumes that are no longer referenced by a container.</span></span> <span data-ttu-id="b27b5-125">主机操作系统可以浏览和编辑任何卷中的数据公开发布，这是尽量少使用的数据卷的只是另一个原因。</span><span class="sxs-lookup"><span data-stu-id="b27b5-125">The host operating system can browse and edit the data in any volume freely, which is just another reason to use data volumes sparingly.</span></span>

<span data-ttu-id="b27b5-126">一个[数据卷容器](https://docs.docker.com/glossary/?term=volume)是对常规数据卷的改进。</span><span class="sxs-lookup"><span data-stu-id="b27b5-126">A [data volume container](https://docs.docker.com/glossary/?term=volume) is an improvement over regular data volumes.</span></span> <span data-ttu-id="b27b5-127">实质上是处于休眠状态容器具有一个或多个数据卷 （如前面所述），在其中创建它。</span><span class="sxs-lookup"><span data-stu-id="b27b5-127">It is essentially a dormant container that has one or more data volumes created within it (as described earlier).</span></span> <span data-ttu-id="b27b5-128">数据卷容器从中央装入点提供对容器的访问。</span><span class="sxs-lookup"><span data-stu-id="b27b5-128">The data volume container provides access to containers from a central mount point.</span></span> <span data-ttu-id="b27b5-129">访问此方法的优点是它抽象出原始数据，使逻辑装入点的数据容器的位置。</span><span class="sxs-lookup"><span data-stu-id="b27b5-129">The benefit of this method of access is that it abstracts the location of the original data, making the data container a logical mount point.</span></span> <span data-ttu-id="b27b5-130">它还允许访问的数据容器卷来创建和销毁时将数据保存在专用容器中持久保留的"应用程序"容器。</span><span class="sxs-lookup"><span data-stu-id="b27b5-130">It also allows "application" containers accessing the data container volumes to be created and destroyed while keeping the data persistent in a dedicated container.</span></span>

<span data-ttu-id="b27b5-131">图 4-5 显示了常规 Docker 卷可以置于存储超出容器本身，但在主机服务器/VM 物理边界内。</span><span class="sxs-lookup"><span data-stu-id="b27b5-131">Figure 4-5 shows that regular Docker volumes can be placed on storage out of the containers themselves but within the host server/VM physical boundaries.</span></span> <span data-ttu-id="b27b5-132">*Docker 卷不能使用到另一个将卷从一台主机服务器/VM*。</span><span class="sxs-lookup"><span data-stu-id="b27b5-132">*Docker volumes don't have the ability to use a volume from one host server/VM to another*.</span></span>

![](./media/image5.png)

<span data-ttu-id="b27b5-133">图 4-5:数据卷和用于容器的应用/容器的外部数据源</span><span class="sxs-lookup"><span data-stu-id="b27b5-133">Figure 4-5: Data volumes and external data sources for containers apps/containers</span></span>

<span data-ttu-id="b27b5-134">因为无法管理在单独的物理主机运行的容器之间共享的数据，建议不使用卷用于业务数据除非 Docker 主机是固定的主机/VM，因为在业务流程协调程序中使用 Docker 容器时容器应介于 1 到另一台主机，具体取决于要由群集执行的优化移动。</span><span class="sxs-lookup"><span data-stu-id="b27b5-134">Due to the inability to manage data shared between containers that run on separate physical hosts, it is recommended that you not use volumes for business data unless the Docker host is a fixed host/VM, because when using Docker containers in an orchestrator, containers are expected to be moved from one to another host, depending on the optimizations to be performed by the cluster.</span></span>

<span data-ttu-id="b27b5-135">因此，常规数据卷是一个良好的机制用于跟踪文件、 临时文件或任何类似的概念，并不影响业务数据一致性，如果或跨多个主机移动用户的容器。</span><span class="sxs-lookup"><span data-stu-id="b27b5-135">Therefore, regular data volumes are a good mechanism to work with trace files, temporal files, or any similar concept that won't affect the business data consistency if or when your containers are moved across multiple hosts.</span></span>

<span data-ttu-id="b27b5-136">[卷插件](https://docs.docker.com/engine/extend/plugins_volume/)跨群集中的所有主机提供的数据。</span><span class="sxs-lookup"><span data-stu-id="b27b5-136">[Volume plug-ins](https://docs.docker.com/engine/extend/plugins_volume/) provide data across all hosts in a cluster.</span></span> <span data-ttu-id="b27b5-137">尽管并非所有卷插件都是相同的但卷插件通常提供外部化不可变的容器中的持久可靠存储。</span><span class="sxs-lookup"><span data-stu-id="b27b5-137">Although not all volume plug-ins are created equally, volume plug-ins typically provide externalized persistent reliable storage from the immutable containers.</span></span>

<span data-ttu-id="b27b5-138">远程数据源和 SQL 数据库、 DocumentDB、 或的远程如 Redis 缓存等缓存应该是与开发不带容器相同。</span><span class="sxs-lookup"><span data-stu-id="b27b5-138">Remote data sources and caches like SQL Database, DocumentDB, or a remote cache like Redis would be the same as developing without containers.</span></span> <span data-ttu-id="b27b5-139">这是一种首选方法，且经实践证明的业务应用程序数据存储。</span><span class="sxs-lookup"><span data-stu-id="b27b5-139">This is one of the preferred, and proven, ways to store business application data.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="b27b5-140">[上一页](monolithic-applications.md)
>[下一页](soa-applications.md)</span><span class="sxs-lookup"><span data-stu-id="b27b5-140">[Previous](monolithic-applications.md)
[Next](soa-applications.md)</span></span>