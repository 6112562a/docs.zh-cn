---
title: Docker 应用程序中的状态和数据
description: 了解可用的选项以在容器化应用程序中保存状态。
ms.date: 02/15/2019
ms.openlocfilehash: bc171a419632f2ac61c7c9bf6b201b84e0691c3a
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/15/2019
ms.locfileid: "65641242"
---
# <a name="state-and-data-in-docker-applications"></a><span data-ttu-id="c2de8-103">Docker 应用程序中的状态和数据</span><span class="sxs-lookup"><span data-stu-id="c2de8-103">State and data in Docker applications</span></span>

<span data-ttu-id="c2de8-104">在大多数情况下，可以将容器视为进程的实例。</span><span class="sxs-lookup"><span data-stu-id="c2de8-104">In most cases, you can think of a container as an instance of a process.</span></span> <span data-ttu-id="c2de8-105">进程不维护持久状态。</span><span class="sxs-lookup"><span data-stu-id="c2de8-105">A process does not maintain persistent state.</span></span> <span data-ttu-id="c2de8-106">虽然容器可以写入其本地存储，假定实例将无限期围绕就像假设内存中的单个位置将持久。</span><span class="sxs-lookup"><span data-stu-id="c2de8-106">While a container can write to its local storage, assuming that an instance will be around indefinitely is like assuming that a single location in memory will be durable.</span></span> <span data-ttu-id="c2de8-107">应假设容器映像，与进程一样，有多个实例，并且它们最终将会终止;如果使用容器 orchestrator 管理它们，那么应该假定，它们可能会获取从一个节点或 VM 之间移动。</span><span class="sxs-lookup"><span data-stu-id="c2de8-107">Container images, like processes, should be assumed to have multiple instances and that they will eventually be killed; if they're managed with a container orchestrator, it should be assumed that they might get moved from one node or VM to another.</span></span>

<span data-ttu-id="c2de8-108">以下解决方案用于管理 Docker 应用程序中的持久性数据：</span><span class="sxs-lookup"><span data-stu-id="c2de8-108">The following solutions are used to manage persistent data in Docker applications:</span></span>

<span data-ttu-id="c2de8-109">从 Docker 主机，作为 [Docker 卷](https://docs.docker.com/engine/admin/volumes/)：</span><span class="sxs-lookup"><span data-stu-id="c2de8-109">From the Docker host, as [Docker Volumes](https://docs.docker.com/engine/admin/volumes/):</span></span>

- <span data-ttu-id="c2de8-110">**卷**存储在由 Docker 管理的主机文件系统区域中。</span><span class="sxs-lookup"><span data-stu-id="c2de8-110">**Volumes** are stored in an area of the host filesystem that's managed by Docker.</span></span>

- <span data-ttu-id="c2de8-111">**将绑定装载**可以映射到主机文件系统中任何文件夹中，因此不能从 Docker 进程控制访问，并可带来安全风险，因为容器可以访问敏感的操作系统文件夹。</span><span class="sxs-lookup"><span data-stu-id="c2de8-111">**Bind mounts** can map to any folder in the host filesystem, so access can't be controlled from a Docker process and can pose a security risk as a container could access sensitive OS folders.</span></span>

- <span data-ttu-id="c2de8-112">**tmpfs 装载**类似仅存在于主机内存中的虚拟文件夹，并且绝不会写入文件系统。</span><span class="sxs-lookup"><span data-stu-id="c2de8-112">**tmpfs mounts** are like virtual folders that only exist in the host's memory and are never written to the filesystem.</span></span>

<span data-ttu-id="c2de8-113">从远程存储：</span><span class="sxs-lookup"><span data-stu-id="c2de8-113">From remote storage:</span></span>

- <span data-ttu-id="c2de8-114">[Azure 存储](https://azure.microsoft.com/documentation/services/storage/)提供可异地分发存储，为容器提供良好的持久性解决方案。</span><span class="sxs-lookup"><span data-stu-id="c2de8-114">[Azure Storage](https://azure.microsoft.com/documentation/services/storage/) provides geo-distributable storage, providing a good long-term persistence solution for containers.</span></span>

- <span data-ttu-id="c2de8-115">远程关系数据库喜欢[Azure SQL 数据库](https://azure.microsoft.com/services/sql-database/)，等 NoSQL 数据库[Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction)，或缓存服务，如[Redis](https://redis.io/)。</span><span class="sxs-lookup"><span data-stu-id="c2de8-115">Remote relational databases like [Azure SQL Database](https://azure.microsoft.com/services/sql-database/), NoSQL databases like [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), or cache services like [Redis](https://redis.io/).</span></span>

<span data-ttu-id="c2de8-116">从 Docker 容器：</span><span class="sxs-lookup"><span data-stu-id="c2de8-116">From the Docker container:</span></span>

- <span data-ttu-id="c2de8-117">Docker 提供一个名为“覆盖文件系统”的功能。</span><span class="sxs-lookup"><span data-stu-id="c2de8-117">Docker provides a feature named the *overlay file system*.</span></span> <span data-ttu-id="c2de8-118">此功能实现了写入时复制任务存储到的容器的根文件系统更新信息。</span><span class="sxs-lookup"><span data-stu-id="c2de8-118">This feature implements a copy-on-write task that stores updated information to the root file system of the container.</span></span> <span data-ttu-id="c2de8-119">该信息"介绍了在最前面的"容器所基于的原始图像。</span><span class="sxs-lookup"><span data-stu-id="c2de8-119">That information "lays on top of" the original image on which the container is based.</span></span> <span data-ttu-id="c2de8-120">如果从系统中删除容器，则这些更改将丢失。</span><span class="sxs-lookup"><span data-stu-id="c2de8-120">If the container is deleted from the system, those changes are lost.</span></span> <span data-ttu-id="c2de8-121">因此，虽然可能保存在其本地存储的容器的状态，但设计基于此功能的系统容器设计，它默认情况下是无状态的前提相冲突。</span><span class="sxs-lookup"><span data-stu-id="c2de8-121">Therefore, while it's possible to save the state of a container within its local storage, designing a system based on this feature would conflict with the premise of container design, which by default is stateless.</span></span>

- <span data-ttu-id="c2de8-122">但是，Docker 卷现在是首选的方法来处理在 Docker 中的本地数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-122">However, Docker Volumes is now the preferred way to handle local data in Docker.</span></span> <span data-ttu-id="c2de8-123">如果需要有关在容器中存储的详细信息，则检查[Docker 存储驱动程序](https://docs.docker.com/engine/userguide/storagedriver/)并[有关映像、 容器和存储驱动程序](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/)。</span><span class="sxs-lookup"><span data-stu-id="c2de8-123">If you need more information about storage in containers, check on [Docker storage drivers](https://docs.docker.com/engine/userguide/storagedriver/) and [About images, containers, and storage drivers](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/).</span></span>

<span data-ttu-id="c2de8-124">下面提供了有关这些选项的其他详细信息。</span><span class="sxs-lookup"><span data-stu-id="c2de8-124">The following provides additional detail about these options.</span></span>

<span data-ttu-id="c2de8-125">**卷**是从主机 OS 映射到容器目录的目录。</span><span class="sxs-lookup"><span data-stu-id="c2de8-125">**Volumes** are directories mapped from the host OS to directories in containers.</span></span> <span data-ttu-id="c2de8-126">当容器中的代码访问该目录时，该访问实际上是对主机操作系统上的一个目录的访问。</span><span class="sxs-lookup"><span data-stu-id="c2de8-126">When code in the container has access to the directory, that access is actually to a directory on the host OS.</span></span> <span data-ttu-id="c2de8-127">此目录不与容器自身的生存期绑定，且该目录由 Docker 管理并独立于主机计算机的核心功能。</span><span class="sxs-lookup"><span data-stu-id="c2de8-127">This directory is not tied to the lifetime of the container itself, and the directory is managed by Docker and isolated from the core functionality of the host machine.</span></span> <span data-ttu-id="c2de8-128">因此，数据卷用于将独立于容器的生命周期的数据持久保存。</span><span class="sxs-lookup"><span data-stu-id="c2de8-128">Thus, data volumes are designed to persist data independently of the life of the container.</span></span> <span data-ttu-id="c2de8-129">如果从 Docker 主机中删除容器或图像，不会删除数据卷中保留的数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-129">If you delete a container or an image from the Docker host, the data persisted in the data volume is not deleted.</span></span>

<span data-ttu-id="c2de8-130">可以命名卷，也可以让卷保持匿名（默认设置）。</span><span class="sxs-lookup"><span data-stu-id="c2de8-130">Volumes can be named or anonymous (the default).</span></span> <span data-ttu-id="c2de8-131">命名卷是**数据卷容器**的演变，它使得在不同容器之间共享数据变得容易。</span><span class="sxs-lookup"><span data-stu-id="c2de8-131">Named volumes are the evolution of **Data Volume Containers** and make it easy to share data between containers.</span></span> <span data-ttu-id="c2de8-132">卷还支持卷驱动程序，可用于将数据存储在远程主机，以及其他选项。</span><span class="sxs-lookup"><span data-stu-id="c2de8-132">Volumes also support volume drivers that allow you to store data on remote hosts, among other options.</span></span>

<span data-ttu-id="c2de8-133">**将绑定装载**已经面世了很长时间，并允许将映射到容器中的装入点的任何文件夹。</span><span class="sxs-lookup"><span data-stu-id="c2de8-133">**Bind mounts** have been available for a long time and allow the mapping of any folder to a mount point in a container.</span></span> <span data-ttu-id="c2de8-134">绑定挂载的限制比卷的限制多，并存在一些重要安全问题，因此，卷是建议选项。</span><span class="sxs-lookup"><span data-stu-id="c2de8-134">Bind mounts have more limitations than volumes and some important security issues, so volumes are the recommended option.</span></span>

<span data-ttu-id="c2de8-135">**`tmpfs` 装载**是虚拟文件夹，仅在主机的内存中保留，所以永远不会写入到文件系统。</span><span class="sxs-lookup"><span data-stu-id="c2de8-135">**`tmpfs` mounts** are virtual folders that live only in the host's memory and are never written to the filesystem.</span></span> <span data-ttu-id="c2de8-136">它们快速且安全，但使用内存且仅适用于非持久性数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-136">They are fast and secure but use memory and are only meant for non-persistent data.</span></span>

<span data-ttu-id="c2de8-137">如图 4-5 所示，常规 Docker 卷可以存储在容器本身之外，但是在主机服务器或 VM 的物理边界内。</span><span class="sxs-lookup"><span data-stu-id="c2de8-137">As shown in Figure 4-5, regular Docker volumes can be stored outside of the containers themselves but within the physical boundaries of the host server or VM.</span></span> <span data-ttu-id="c2de8-138">但是，Docker 容器不能从一个主机服务器或 VM 访问另一个主机服务器或 VM 的卷。</span><span class="sxs-lookup"><span data-stu-id="c2de8-138">However, Docker containers cannot access a volume from one host server or VM to another.</span></span> <span data-ttu-id="c2de8-139">换而言之，如果使用这些卷，那么不能管理在不同 Docker 主机上运行的容器之间共享的数据，尽管可通过支持远程主机的卷驱动程序来实现这一功能。</span><span class="sxs-lookup"><span data-stu-id="c2de8-139">In other words, with these volumes, it isn't possible to manage data shared between containers that run on different Docker hosts, although it could be achieved with a volume driver that supports remote hosts.</span></span>

![<span data-ttu-id="c2de8-140">卷可在容器之间共享，但仅限于同一台主机，除非使用支持远程主机的远程驱动程序。</span><span class="sxs-lookup"><span data-stu-id="c2de8-140">Volumes can be shared between containers, but only in the same host, unless you use a remote driver that supports remote hosts.</span></span> ](./media/image5.png)

<span data-ttu-id="c2de8-141">**图 4-5**。</span><span class="sxs-lookup"><span data-stu-id="c2de8-141">**Figure 4-5**.</span></span> <span data-ttu-id="c2de8-142">基于容器的应用程序的卷和外部数据源</span><span class="sxs-lookup"><span data-stu-id="c2de8-142">Volumes and external data sources for container-based applications</span></span>

<span data-ttu-id="c2de8-143">此外，当 Docker 容器由业务流程协调程序管理时，容器可能会在主机之间“移动”，这取决于群集所执行的优化。</span><span class="sxs-lookup"><span data-stu-id="c2de8-143">In addition, when Docker containers are managed by an orchestrator, containers might "move" between hosts, depending on the optimizations performed by the cluster.</span></span> <span data-ttu-id="c2de8-144">因此，不建议将数据卷用于业务数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-144">Therefore, it isn't recommended that you use data volumes for business data.</span></span> <span data-ttu-id="c2de8-145">但它们是一个良好的机制，可以使用跟踪文件、 临时文件，或类似，不会影响业务数据一致性。</span><span class="sxs-lookup"><span data-stu-id="c2de8-145">But they are a good mechanism to work with trace files, temporal files, or similar, that will not impact business data consistency.</span></span>

<span data-ttu-id="c2de8-146">远程数据源和缓存工具（如 Azure SQL 数据库、Azure Cosmos DB）或远程缓存（如 Redis）可以在容器化应用程序中使用，与开发时没有容器的使用方式相同。</span><span class="sxs-lookup"><span data-stu-id="c2de8-146">**Remote data sources and cache** tools like Azure SQL Database, Azure Cosmos DB, or a remote cache like Redis can be used in containerized applications the same way they are used when developing without containers.</span></span> <span data-ttu-id="c2de8-147">这是存储业务应用程序数据的一种行之有效的方法。</span><span class="sxs-lookup"><span data-stu-id="c2de8-147">This is a proven way to store business application data.</span></span>

<span data-ttu-id="c2de8-148">Azure 存储。</span><span class="sxs-lookup"><span data-stu-id="c2de8-148">**Azure Storage.**</span></span> <span data-ttu-id="c2de8-149">业务数据通常需要放在外部资源或数据库，如 Azure 存储中。</span><span class="sxs-lookup"><span data-stu-id="c2de8-149">Business data usually needs to be placed in external resources or databases, like Azure Storage.</span></span> <span data-ttu-id="c2de8-150">Azure 存储提供在云中的以下服务：</span><span class="sxs-lookup"><span data-stu-id="c2de8-150">Azure Storage provides the following services in the cloud:</span></span>

- <span data-ttu-id="c2de8-151">Blob 存储存储非结构化的对象数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-151">Blob storage stores unstructured object data.</span></span> <span data-ttu-id="c2de8-152">Blob 可以是任何类型的文本或二进制数据，如文档或媒体文件（图像、音频和视频文件）。</span><span class="sxs-lookup"><span data-stu-id="c2de8-152">A blob can be any type of text or binary data, such as document or media files (images, audio, and video files).</span></span> <span data-ttu-id="c2de8-153">Blob 存储也称为对象存储。</span><span class="sxs-lookup"><span data-stu-id="c2de8-153">Blob storage is also referred to as Object storage.</span></span>

- <span data-ttu-id="c2de8-154">文件存储提供共享的存储使用标准 SMB 协议的旧版应用程序。</span><span class="sxs-lookup"><span data-stu-id="c2de8-154">File storage offers shared storage for legacy applications using the standard SMB protocol.</span></span> <span data-ttu-id="c2de8-155">Azure 虚拟机和云服务可以通过装载的共享在应用程序组件之间共享文件数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-155">Azure virtual machines and cloud services can share file data across application components via mounted shares.</span></span> <span data-ttu-id="c2de8-156">在本地应用程序可以访问通过文件服务 REST API 的共享中的文件数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-156">On-premises applications can access file data in a share via the File Service REST API.</span></span>

- <span data-ttu-id="c2de8-157">表存储存储结构化数据集。</span><span class="sxs-lookup"><span data-stu-id="c2de8-157">Table storage stores structured datasets.</span></span> <span data-ttu-id="c2de8-158">表存储是 NoSQL 键属性数据存储，它允许快速开发和快速访问大量数据。</span><span class="sxs-lookup"><span data-stu-id="c2de8-158">Table storage is a NoSQL key-attribute data store, which allows rapid development and fast access to large quantities of data.</span></span>

<span data-ttu-id="c2de8-159">关系数据库和 NoSQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="c2de8-159">**Relational databases and NoSQL databases.**</span></span> <span data-ttu-id="c2de8-160">外部数据库有很多选择，包括关系数据库（如 SQL Server、PostgreSQL、Oracle）或 NoSQL 数据库（如 Azure Cosmos DB、MongoDB）等。这些数据库不会加以解释本指南的一部分，因为它们完全是不同的主题。</span><span class="sxs-lookup"><span data-stu-id="c2de8-160">There are many choices for external databases, from relational databases like SQL Server, PostgreSQL, Oracle, or NoSQL databases like Azure Cosmos DB, MongoDB, etc. These databases are not going to be explained as part of this guide since they are a different topic altogether.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="c2de8-161">[上一页](monolithic-applications.md)
>[下一页](soa-applications.md)</span><span class="sxs-lookup"><span data-stu-id="c2de8-161">[Previous](monolithic-applications.md)
[Next](soa-applications.md)</span></span>
