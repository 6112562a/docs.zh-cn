---
ms.openlocfilehash: 5b3f9bcb56d3e34568afd8b97fb9ebe09a677f4c
ms.sourcegitcommit: d55e14eb63588830c0ba1ea95a24ce6c57ef8c8c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/11/2019
ms.locfileid: "67802718"
---
### <a name="net-interop-will-now-queryinterface-for-iagileobject-a-winrt-interface"></a><span data-ttu-id="0524d-101">.NET Interop 现将为 IAgileObject 的 QueryInterface（WinRT 接口）</span><span class="sxs-lookup"><span data-stu-id="0524d-101">.NET Interop will now QueryInterface for IAgileObject (a WinRT interface)</span></span>

|   |   |
|---|---|
|<span data-ttu-id="0524d-102">详细信息</span><span class="sxs-lookup"><span data-stu-id="0524d-102">Details</span></span>|<span data-ttu-id="0524d-103">自 .NET Framework 4.8 起，使用带有 .NET 委托的 WinRT 事件时，Windows 将为 IAgileObject 进行 QI。</span><span class="sxs-lookup"><span data-stu-id="0524d-103">When using a WinRT event with a .NET delegate, Windows will QI for IAgileObject starting with the .NET Framework 4.8.</span></span>  <span data-ttu-id="0524d-104">在以前版本的 .NET Framework 中，运行时进行该 QI 将失败，并且无法订阅事件。</span><span class="sxs-lookup"><span data-stu-id="0524d-104">In previous versions of the .NET Framework, the runtime would fail that QI, and the event could not be subscribed.</span></span><ul><li><span data-ttu-id="0524d-105">[x] Quirked</span><span class="sxs-lookup"><span data-stu-id="0524d-105">[ x ] Quirked</span></span></li></ul>|
|<span data-ttu-id="0524d-106">建议</span><span class="sxs-lookup"><span data-stu-id="0524d-106">Suggestion</span></span>|<span data-ttu-id="0524d-107">如果为 IAgileObject 启用 QI 会中断执行，则可以通过设置以下配置来禁用此代码。</span><span class="sxs-lookup"><span data-stu-id="0524d-107">If enabling the QI for IAgileObject breaks execution, you can disable this code by setting the following configuration.</span></span> <h4><span data-ttu-id="0524d-108">方法 1：环境变量</span><span class="sxs-lookup"><span data-stu-id="0524d-108">Method 1: Environment variable</span></span></h4> <span data-ttu-id="0524d-109">设置以下环境变量：COMPLUS_DisableCCWSupportIAgileObject=1 此方法会影响任何继承此环境变量的环境。</span><span class="sxs-lookup"><span data-stu-id="0524d-109">Set the following environment variable:COMPLUS_DisableCCWSupportIAgileObject=1This method affects any environment that inherits this environment variable.</span></span> <span data-ttu-id="0524d-110">这可能只是一个控制台会话，或者如果在全局范围内设置环境变量，它可能会影响整个计算机。环境变量名称不区分大小写。</span><span class="sxs-lookup"><span data-stu-id="0524d-110">This might be just a single console session, or it might affect the entire machine if you set the environment variable globally.The environment variable name is not case-sensitive.</span></span> <h4><span data-ttu-id="0524d-111">方法 2：注册表</span><span class="sxs-lookup"><span data-stu-id="0524d-111">Method 2: Registry</span></span></h4> <span data-ttu-id="0524d-112">使用注册表编辑器 (regedit.exe)，查找以下某个子项：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft.NETFramework HKEY_CURRENT_USER\SOFTWARE\Microsoft.NETFramework 然后添加以下内容：值名称：DisableCCWSupportIAgileObject 类型：DWORD（32 位）值（也称为 REG_WORD）值：1 可以使用 Windows REG.EXE 工具从命令行或脚本环境添加此值。</span><span class="sxs-lookup"><span data-stu-id="0524d-112">Using Registry Editor (regedit.exe), find either of the following subkeys:HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft.NETFramework HKEY_CURRENT_USER\SOFTWARE\Microsoft.NETFrameworkThen add the following:Value name: DisableCCWSupportIAgileObject Type: DWORD (32-bit) Value (also called REG_WORD) Value: 1You can use the Windows REG.EXE tool to add this value from a command-line or scripting environment.</span></span> <span data-ttu-id="0524d-113">例如:</span><span class="sxs-lookup"><span data-stu-id="0524d-113">For example:</span></span><pre><code class="lang-console">reg add HKLM\SOFTWARE\Microsoft\.NETFramework /v DisableCCWSupportIAgileObject /t REG_DWORD /d 1&#13;&#10;</code></pre><span data-ttu-id="0524d-114">在这种情况下，使用 <code>HKLM</code> 而不使用 <code>HKEY_LOCAL_MACHINE</code>。</span><span class="sxs-lookup"><span data-stu-id="0524d-114">In this case, <code>HKLM</code> is used instead of <code>HKEY_LOCAL_MACHINE</code>.</span></span> <span data-ttu-id="0524d-115">使用 <code>reg add /?</code> 查看有关此语法的相关帮助。注册表值名称不区分大小写。</span><span class="sxs-lookup"><span data-stu-id="0524d-115">Use <code>reg add /?</code> to see help on this syntax.The registry value name is not case-sensitive.</span></span>|
|<span data-ttu-id="0524d-116">范围</span><span class="sxs-lookup"><span data-stu-id="0524d-116">Scope</span></span>|<span data-ttu-id="0524d-117">边缘</span><span class="sxs-lookup"><span data-stu-id="0524d-117">Edge</span></span>|
|<span data-ttu-id="0524d-118">Version</span><span class="sxs-lookup"><span data-stu-id="0524d-118">Version</span></span>|<span data-ttu-id="0524d-119">4.8</span><span class="sxs-lookup"><span data-stu-id="0524d-119">4.8</span></span>|
|<span data-ttu-id="0524d-120">类型</span><span class="sxs-lookup"><span data-stu-id="0524d-120">Type</span></span>|<span data-ttu-id="0524d-121">运行时</span><span class="sxs-lookup"><span data-stu-id="0524d-121">Runtime</span></span>|

